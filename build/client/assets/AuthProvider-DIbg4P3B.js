import{b as k,t as R,B as Oc,R as Ct}from"./index-CWD__XTI.js";function fr(r){return Object.keys(r)}function Bn(r){return r&&typeof r=="object"&&!Array.isArray(r)}function Ri(r,e){const t={...r},n=e;return Bn(r)&&Bn(e)&&Object.keys(e).forEach(o=>{Bn(n[o])&&o in r?t[o]=Ri(t[o],n[o]):t[o]=n[o]}),t}function Nc(r){return r.replace(/[A-Z]/g,e=>`-${e.toLowerCase()}`)}function Mo(r){return r==="0rem"?"0rem":`calc(${r} * var(--mantine-scale))`}function Pi(r,{shouldScale:e=!1}={}){function t(n){if(n===0||n==="0")return`0${r}`;if(typeof n=="number"){const o=`${n/16}${r}`;return e?Mo(o):o}if(typeof n=="string"){if(n===""||n.startsWith("calc(")||n.startsWith("clamp(")||n.includes("rgba("))return n;if(n.includes(","))return n.split(",").map(i=>t(i)).join(",");if(n.includes(" "))return n.split(" ").map(i=>t(i)).join(" ");const o=n.replace("px","");if(!Number.isNaN(Number(o))){const i=`${Number(o)/16}${r}`;return e?Mo(i):i}}return n}return t}const C=Pi("rem",{shouldScale:!0}),lf=Pi("em");function pr(r){return Object.keys(r).reduce((e,t)=>(r[t]!==void 0&&(e[t]=r[t]),e),{})}function Oi(r){if(typeof r=="number")return!0;if(typeof r=="string"){if(r.startsWith("calc(")||r.startsWith("var(")||r.includes(" ")&&r.trim()!=="")return!0;const e=/^[+-]?[0-9]+(\.[0-9]+)?(px|em|rem|ex|ch|lh|rlh|vw|vh|vmin|vmax|vb|vi|svw|svh|lvw|lvh|dvw|dvh|cm|mm|in|pt|pc|q|cqw|cqh|cqi|cqb|cqmin|cqmax|%)?$/;return r.trim().split(/\s+/).every(n=>e.test(n))}return!1}function we(r,e="size",t=!0){if(r!==void 0)return Oi(r)?t?C(r):r:`var(--${e}-${r})`}function df(r){return we(r,"mantine-spacing")}function Ni(r){return r===void 0?"var(--mantine-radius-default)":we(r,"mantine-radius")}function St(r){return we(r,"mantine-font-size")}function Mc(r){return we(r,"mantine-line-height",!1)}function hf(r){if(r)return we(r,"mantine-shadow",!1)}function Uc(r,e){try{return r.addEventListener("change",e),()=>r.removeEventListener("change",e)}catch{return r.addListener(e),()=>r.removeListener(e)}}function Dc(r,e){return typeof window<"u"&&"matchMedia"in window?window.matchMedia(r).matches:!1}function Lc(r,e,{getInitialValueInEffect:t}={getInitialValueInEffect:!0}){const[n,o]=k.useState(t?e:Dc(r));return k.useEffect(()=>{try{const i=window.matchMedia(r);return o(i.matches),Uc(i,s=>o(s.matches))}catch{return}},[r]),n||!1}function xc(r,e){const t=k.useRef(!1);k.useEffect(()=>()=>{t.current=!1},[]),k.useEffect(()=>{if(t.current)return r();t.current=!0},e)}function Hc(r,e){return Lc("(prefers-reduced-motion: reduce)",r,e)}function uf(r){return r}function Mi(r){var e,t,n="";if(typeof r=="string"||typeof r=="number")n+=r;else if(typeof r=="object")if(Array.isArray(r)){var o=r.length;for(e=0;e<o;e++)r[e]&&(t=Mi(r[e]))&&(n&&(n+=" "),n+=t)}else for(t in r)r[t]&&(n&&(n+=" "),n+=t);return n}function Qe(){for(var r,e,t=0,n="",o=arguments.length;t<o;t++)(r=arguments[t])&&(e=Mi(r))&&(n&&(n+=" "),n+=e);return n}const Fc={};function Bc(r){const e={};return r.forEach(t=>{Object.entries(t).forEach(([n,o])=>{e[n]?e[n]=Qe(e[n],o):e[n]=o})}),e}function mr({theme:r,classNames:e,props:t,stylesCtx:n}){const i=(Array.isArray(e)?e:[e]).map(s=>typeof s=="function"?s(r,t,n):s||Fc);return Bc(i)}function Yn({theme:r,styles:e,props:t,stylesCtx:n}){return(Array.isArray(e)?e:[e]).reduce((i,s)=>typeof s=="function"?{...i,...s(r,t,n)}:{...i,...s},{})}const Kc=k.createContext(null);function Fe(){const r=k.useContext(Kc);if(!r)throw new Error("[@mantine/core] MantineProvider was not found in tree");return r}function gf(){return Fe().cssVariablesResolver}function $c(){return Fe().classNamesPrefix}function Gc(){return Fe().getStyleNonce}function zc(){return Fe().withStaticClasses}function qc(){return Fe().headless}function jc(){return Fe().stylesTransform?.sx}function Vc(){return Fe().stylesTransform?.styles}function Wc(){return Fe().env||"default"}function Qc(r){return/^#?([0-9A-F]{3}){1,2}([0-9A-F]{2})?$/i.test(r)}function Yc(r){let e=r.replace("#","");if(e.length===3){const s=e.split("");e=[s[0],s[0],s[1],s[1],s[2],s[2]].join("")}if(e.length===8){const s=parseInt(e.slice(6,8),16)/255;return{r:parseInt(e.slice(0,2),16),g:parseInt(e.slice(2,4),16),b:parseInt(e.slice(4,6),16),a:s}}const t=parseInt(e,16),n=t>>16&255,o=t>>8&255,i=t&255;return{r:n,g:o,b:i,a:1}}function Jc(r){const[e,t,n,o]=r.replace(/[^0-9,./]/g,"").split(/[/,]/).map(Number);return{r:e,g:t,b:n,a:o===void 0?1:o}}function Xc(r){const e=/^hsla?\(\s*(\d+)\s*,\s*(\d+%)\s*,\s*(\d+%)\s*(,\s*(0?\.\d+|\d+(\.\d+)?))?\s*\)$/i,t=r.match(e);if(!t)return{r:0,g:0,b:0,a:1};const n=parseInt(t[1],10),o=parseInt(t[2],10)/100,i=parseInt(t[3],10)/100,s=t[5]?parseFloat(t[5]):void 0,a=(1-Math.abs(2*i-1))*o,c=n/60,l=a*(1-Math.abs(c%2-1)),h=i-a/2;let u,g,m;return c>=0&&c<1?(u=a,g=l,m=0):c>=1&&c<2?(u=l,g=a,m=0):c>=2&&c<3?(u=0,g=a,m=l):c>=3&&c<4?(u=0,g=l,m=a):c>=4&&c<5?(u=l,g=0,m=a):(u=a,g=0,m=l),{r:Math.round((u+h)*255),g:Math.round((g+h)*255),b:Math.round((m+h)*255),a:s||1}}function yr(r){return Qc(r)?Yc(r):r.startsWith("rgb")?Jc(r):r.startsWith("hsl")?Xc(r):{r:0,g:0,b:0,a:1}}function Ut(r,e){if(r.startsWith("var("))return`color-mix(in srgb, ${r}, black ${e*100}%)`;const{r:t,g:n,b:o,a:i}=yr(r),s=1-e,a=c=>Math.round(c*s);return`rgba(${a(t)}, ${a(n)}, ${a(o)}, ${i})`}function Zc(r,e){return typeof r.primaryShade=="number"?r.primaryShade:e==="dark"?r.primaryShade.dark:r.primaryShade.light}function Kn(r){return r<=.03928?r/12.92:((r+.055)/1.055)**2.4}function el(r){const e=r.match(/oklch\((.*?)%\s/);return e?parseFloat(e[1]):null}function tl(r){if(r.startsWith("oklch("))return(el(r)||0)/100;const{r:e,g:t,b:n}=yr(r),o=e/255,i=t/255,s=n/255,a=Kn(o),c=Kn(i),l=Kn(s);return .2126*a+.7152*c+.0722*l}function ft(r,e=.179){return r.startsWith("var(")?!1:tl(r)>e}function mn({color:r,theme:e,colorScheme:t}){if(typeof r!="string")throw new Error(`[@mantine/core] Failed to parse color. Expected color to be a string, instead got ${typeof r}`);if(r==="bright")return{color:r,value:t==="dark"?e.white:e.black,shade:void 0,isThemeColor:!1,isLight:ft(t==="dark"?e.white:e.black,e.luminanceThreshold),variable:"--mantine-color-bright"};if(r==="dimmed")return{color:r,value:t==="dark"?e.colors.dark[2]:e.colors.gray[7],shade:void 0,isThemeColor:!1,isLight:ft(t==="dark"?e.colors.dark[2]:e.colors.gray[6],e.luminanceThreshold),variable:"--mantine-color-dimmed"};if(r==="white"||r==="black")return{color:r,value:r==="white"?e.white:e.black,shade:void 0,isThemeColor:!1,isLight:ft(r==="white"?e.white:e.black,e.luminanceThreshold),variable:`--mantine-color-${r}`};const[n,o]=r.split("."),i=o?Number(o):void 0,s=n in e.colors;if(s){const a=i!==void 0?e.colors[n][i]:e.colors[n][Zc(e,t||"light")];return{color:n,value:a,shade:i,isThemeColor:s,isLight:ft(a,e.luminanceThreshold),variable:o?`--mantine-color-${n}-${i}`:`--mantine-color-${n}-filled`}}return{color:r,value:r,isThemeColor:s,isLight:ft(r,e.luminanceThreshold),shade:i,variable:void 0}}function Wt(r,e){const t=mn({color:r||e.primaryColor,theme:e});return t.variable?`var(${t.variable})`:r}function Jn(r,e){const t={from:r?.from||e.defaultGradient.from,to:r?.to||e.defaultGradient.to,deg:r?.deg??e.defaultGradient.deg??0},n=Wt(t.from,e),o=Wt(t.to,e);return`linear-gradient(${t.deg}deg, ${n} 0%, ${o} 100%)`}function Se(r,e){if(typeof r!="string"||e>1||e<0)return"rgba(0, 0, 0, 1)";if(r.startsWith("var(")){const i=(1-e)*100;return`color-mix(in srgb, ${r}, transparent ${i}%)`}if(r.startsWith("oklch"))return r.includes("/")?r.replace(/\/\s*[\d.]+\s*\)/,`/ ${e})`):r.replace(")",` / ${e})`);const{r:t,g:n,b:o}=yr(r);return`rgba(${t}, ${n}, ${o}, ${e})`}const ff=Se,nl=({color:r,theme:e,variant:t,gradient:n,autoContrast:o})=>{const i=mn({color:r,theme:e}),s=typeof o=="boolean"?o:e.autoContrast;if(t==="none")return{background:"transparent",hover:"transparent",color:"inherit",border:"none"};if(t==="filled"){const a=s&&i.isLight?"var(--mantine-color-black)":"var(--mantine-color-white)";return i.isThemeColor?i.shade===void 0?{background:`var(--mantine-color-${r}-filled)`,hover:`var(--mantine-color-${r}-filled-hover)`,color:a,border:`${C(1)} solid transparent`}:{background:`var(--mantine-color-${i.color}-${i.shade})`,hover:`var(--mantine-color-${i.color}-${i.shade===9?8:i.shade+1})`,color:a,border:`${C(1)} solid transparent`}:{background:r,hover:Ut(r,.1),color:a,border:`${C(1)} solid transparent`}}if(t==="light"){if(i.isThemeColor){if(i.shade===void 0)return{background:`var(--mantine-color-${r}-light)`,hover:`var(--mantine-color-${r}-light-hover)`,color:`var(--mantine-color-${r}-light-color)`,border:`${C(1)} solid transparent`};const a=e.colors[i.color][i.shade];return{background:Se(a,.1),hover:Se(a,.12),color:`var(--mantine-color-${i.color}-${Math.min(i.shade,6)})`,border:`${C(1)} solid transparent`}}return{background:Se(r,.1),hover:Se(r,.12),color:r,border:`${C(1)} solid transparent`}}if(t==="outline")return i.isThemeColor?i.shade===void 0?{background:"transparent",hover:`var(--mantine-color-${r}-outline-hover)`,color:`var(--mantine-color-${r}-outline)`,border:`${C(1)} solid var(--mantine-color-${r}-outline)`}:{background:"transparent",hover:Se(e.colors[i.color][i.shade],.05),color:`var(--mantine-color-${i.color}-${i.shade})`,border:`${C(1)} solid var(--mantine-color-${i.color}-${i.shade})`}:{background:"transparent",hover:Se(r,.05),color:r,border:`${C(1)} solid ${r}`};if(t==="subtle"){if(i.isThemeColor){if(i.shade===void 0)return{background:"transparent",hover:`var(--mantine-color-${r}-light-hover)`,color:`var(--mantine-color-${r}-light-color)`,border:`${C(1)} solid transparent`};const a=e.colors[i.color][i.shade];return{background:"transparent",hover:Se(a,.12),color:`var(--mantine-color-${i.color}-${Math.min(i.shade,6)})`,border:`${C(1)} solid transparent`}}return{background:"transparent",hover:Se(r,.12),color:r,border:`${C(1)} solid transparent`}}return t==="transparent"?i.isThemeColor?i.shade===void 0?{background:"transparent",hover:"transparent",color:`var(--mantine-color-${r}-light-color)`,border:`${C(1)} solid transparent`}:{background:"transparent",hover:"transparent",color:`var(--mantine-color-${i.color}-${Math.min(i.shade,6)})`,border:`${C(1)} solid transparent`}:{background:"transparent",hover:"transparent",color:r,border:`${C(1)} solid transparent`}:t==="white"?i.isThemeColor?i.shade===void 0?{background:"var(--mantine-color-white)",hover:Ut(e.white,.01),color:`var(--mantine-color-${r}-filled)`,border:`${C(1)} solid transparent`}:{background:"var(--mantine-color-white)",hover:Ut(e.white,.01),color:`var(--mantine-color-${i.color}-${i.shade})`,border:`${C(1)} solid transparent`}:{background:"var(--mantine-color-white)",hover:Ut(e.white,.01),color:r,border:`${C(1)} solid transparent`}:t==="gradient"?{background:Jn(n,e),hover:Jn(n,e),color:"var(--mantine-color-white)",border:"none"}:t==="default"?{background:"var(--mantine-color-default)",hover:"var(--mantine-color-default-hover)",color:"var(--mantine-color-default-color)",border:`${C(1)} solid var(--mantine-color-default-border)`}:{}},rl={dark:["#C9C9C9","#b8b8b8","#828282","#696969","#424242","#3b3b3b","#2e2e2e","#242424","#1f1f1f","#141414"],gray:["#f8f9fa","#f1f3f5","#e9ecef","#dee2e6","#ced4da","#adb5bd","#868e96","#495057","#343a40","#212529"],red:["#fff5f5","#ffe3e3","#ffc9c9","#ffa8a8","#ff8787","#ff6b6b","#fa5252","#f03e3e","#e03131","#c92a2a"],pink:["#fff0f6","#ffdeeb","#fcc2d7","#faa2c1","#f783ac","#f06595","#e64980","#d6336c","#c2255c","#a61e4d"],grape:["#f8f0fc","#f3d9fa","#eebefa","#e599f7","#da77f2","#cc5de8","#be4bdb","#ae3ec9","#9c36b5","#862e9c"],violet:["#f3f0ff","#e5dbff","#d0bfff","#b197fc","#9775fa","#845ef7","#7950f2","#7048e8","#6741d9","#5f3dc4"],indigo:["#edf2ff","#dbe4ff","#bac8ff","#91a7ff","#748ffc","#5c7cfa","#4c6ef5","#4263eb","#3b5bdb","#364fc7"],blue:["#e7f5ff","#d0ebff","#a5d8ff","#74c0fc","#4dabf7","#339af0","#228be6","#1c7ed6","#1971c2","#1864ab"],cyan:["#e3fafc","#c5f6fa","#99e9f2","#66d9e8","#3bc9db","#22b8cf","#15aabf","#1098ad","#0c8599","#0b7285"],teal:["#e6fcf5","#c3fae8","#96f2d7","#63e6be","#38d9a9","#20c997","#12b886","#0ca678","#099268","#087f5b"],green:["#ebfbee","#d3f9d8","#b2f2bb","#8ce99a","#69db7c","#51cf66","#40c057","#37b24d","#2f9e44","#2b8a3e"],lime:["#f4fce3","#e9fac8","#d8f5a2","#c0eb75","#a9e34b","#94d82d","#82c91e","#74b816","#66a80f","#5c940d"],yellow:["#fff9db","#fff3bf","#ffec99","#ffe066","#ffd43b","#fcc419","#fab005","#f59f00","#f08c00","#e67700"],orange:["#fff4e6","#ffe8cc","#ffd8a8","#ffc078","#ffa94d","#ff922b","#fd7e14","#f76707","#e8590c","#d9480f"]},Uo="-apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Helvetica, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji",Ui={scale:1,fontSmoothing:!0,focusRing:"auto",white:"#fff",black:"#000",colors:rl,primaryShade:{light:6,dark:8},primaryColor:"blue",variantColorResolver:nl,autoContrast:!1,luminanceThreshold:.3,fontFamily:Uo,fontFamilyMonospace:"ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, Liberation Mono, Courier New, monospace",respectReducedMotion:!1,cursorType:"default",defaultGradient:{from:"blue",to:"cyan",deg:45},defaultRadius:"sm",activeClassName:"mantine-active",focusClassName:"",headings:{fontFamily:Uo,fontWeight:"700",textWrap:"wrap",sizes:{h1:{fontSize:C(34),lineHeight:"1.3"},h2:{fontSize:C(26),lineHeight:"1.35"},h3:{fontSize:C(22),lineHeight:"1.4"},h4:{fontSize:C(18),lineHeight:"1.45"},h5:{fontSize:C(16),lineHeight:"1.5"},h6:{fontSize:C(14),lineHeight:"1.5"}}},fontSizes:{xs:C(12),sm:C(14),md:C(16),lg:C(18),xl:C(20)},lineHeights:{xs:"1.4",sm:"1.45",md:"1.55",lg:"1.6",xl:"1.65"},radius:{xs:C(2),sm:C(4),md:C(8),lg:C(16),xl:C(32)},spacing:{xs:C(10),sm:C(12),md:C(16),lg:C(20),xl:C(32)},breakpoints:{xs:"36em",sm:"48em",md:"62em",lg:"75em",xl:"88em"},shadows:{xs:`0 ${C(1)} ${C(3)} rgba(0, 0, 0, 0.05), 0 ${C(1)} ${C(2)} rgba(0, 0, 0, 0.1)`,sm:`0 ${C(1)} ${C(3)} rgba(0, 0, 0, 0.05), rgba(0, 0, 0, 0.05) 0 ${C(10)} ${C(15)} ${C(-5)}, rgba(0, 0, 0, 0.04) 0 ${C(7)} ${C(7)} ${C(-5)}`,md:`0 ${C(1)} ${C(3)} rgba(0, 0, 0, 0.05), rgba(0, 0, 0, 0.05) 0 ${C(20)} ${C(25)} ${C(-5)}, rgba(0, 0, 0, 0.04) 0 ${C(10)} ${C(10)} ${C(-5)}`,lg:`0 ${C(1)} ${C(3)} rgba(0, 0, 0, 0.05), rgba(0, 0, 0, 0.05) 0 ${C(28)} ${C(23)} ${C(-7)}, rgba(0, 0, 0, 0.04) 0 ${C(12)} ${C(12)} ${C(-7)}`,xl:`0 ${C(1)} ${C(3)} rgba(0, 0, 0, 0.05), rgba(0, 0, 0, 0.05) 0 ${C(36)} ${C(28)} ${C(-7)}, rgba(0, 0, 0, 0.04) 0 ${C(17)} ${C(17)} ${C(-7)}`},other:{},components:{}},ol="[@mantine/core] MantineProvider: Invalid theme.primaryColor, it accepts only key of theme.colors, learn more – https://mantine.dev/theming/colors/#primary-color",Do="[@mantine/core] MantineProvider: Invalid theme.primaryShade, it accepts only 0-9 integers or an object { light: 0-9, dark: 0-9 }";function $n(r){return r<0||r>9?!1:parseInt(r.toString(),10)===r}function Lo(r){if(!(r.primaryColor in r.colors))throw new Error(ol);if(typeof r.primaryShade=="object"&&(!$n(r.primaryShade.dark)||!$n(r.primaryShade.light)))throw new Error(Do);if(typeof r.primaryShade=="number"&&!$n(r.primaryShade))throw new Error(Do)}function il(r,e){if(!e)return Lo(r),r;const t=Ri(r,e);return e.fontFamily&&!e.headings?.fontFamily&&(t.headings.fontFamily=e.fontFamily),Lo(t),t}const Cr=k.createContext(null),sl=()=>k.useContext(Cr)||Ui;function Nt(){const r=k.useContext(Cr);if(!r)throw new Error("@mantine/core: MantineProvider was not found in component tree, make sure you have it in your app");return r}function al({theme:r,children:e,inherit:t=!0}){const n=sl(),o=k.useMemo(()=>il(t?n:Ui,r),[r,n,t]);return R.jsx(Cr.Provider,{value:o,children:e})}al.displayName="@mantine/core/MantineThemeProvider";const cl={always:"mantine-focus-always",auto:"mantine-focus-auto",never:"mantine-focus-never"};function ll({theme:r,options:e,unstyled:t}){return Qe(e?.focusable&&!t&&(r.focusClassName||cl[r.focusRing]),e?.active&&!t&&r.activeClassName)}function dl({selector:r,stylesCtx:e,options:t,props:n,theme:o}){return mr({theme:o,classNames:t?.classNames,props:t?.props||n,stylesCtx:e})[r]}function xo({selector:r,stylesCtx:e,theme:t,classNames:n,props:o}){return mr({theme:t,classNames:n,props:o,stylesCtx:e})[r]}function hl({rootSelector:r,selector:e,className:t}){return r===e?t:void 0}function ul({selector:r,classes:e,unstyled:t}){return t?void 0:e[r]}function gl({themeName:r,classNamesPrefix:e,selector:t,withStaticClass:n}){return n===!1?[]:r.map(o=>`${e}-${o}-${t}`)}function fl({themeName:r,theme:e,selector:t,props:n,stylesCtx:o}){return r.map(i=>mr({theme:e,classNames:e.components[i]?.classNames,props:n,stylesCtx:o})?.[t])}function pl({options:r,classes:e,selector:t,unstyled:n}){return r?.variant&&!n?e[`${t}--${r.variant}`]:void 0}function ml({theme:r,options:e,themeName:t,selector:n,classNamesPrefix:o,classNames:i,classes:s,unstyled:a,className:c,rootSelector:l,props:h,stylesCtx:u,withStaticClasses:g,headless:m,transformedStyles:I}){return Qe(ll({theme:r,options:e,unstyled:a||m}),fl({theme:r,themeName:t,selector:n,props:h,stylesCtx:u}),pl({options:e,classes:s,selector:n,unstyled:a}),xo({selector:n,stylesCtx:u,theme:r,classNames:i,props:h}),xo({selector:n,stylesCtx:u,theme:r,classNames:I,props:h}),dl({selector:n,stylesCtx:u,options:e,props:h,theme:r}),hl({rootSelector:l,selector:n,className:c}),ul({selector:n,classes:s,unstyled:a||m}),g&&!m&&gl({themeName:t,classNamesPrefix:o,selector:n,withStaticClass:e?.withStaticClass}),e?.className)}function yl({theme:r,themeName:e,props:t,stylesCtx:n,selector:o}){return e.map(i=>Yn({theme:r,styles:r.components[i]?.styles,props:t,stylesCtx:n})[o]).reduce((i,s)=>({...i,...s}),{})}function Xn({style:r,theme:e}){return Array.isArray(r)?[...r].reduce((t,n)=>({...t,...Xn({style:n,theme:e})}),{}):typeof r=="function"?r(e):r??{}}function Cl(r){return r.reduce((e,t)=>(t&&Object.keys(t).forEach(n=>{e[n]={...e[n],...pr(t[n])}}),e),{})}function Tl({vars:r,varsResolver:e,theme:t,props:n,stylesCtx:o,selector:i,themeName:s,headless:a}){return Cl([a?{}:e?.(t,n,o),...s.map(c=>t.components?.[c]?.vars?.(t,n,o)),r?.(t,n,o)])?.[i]}function Al({theme:r,themeName:e,selector:t,options:n,props:o,stylesCtx:i,rootSelector:s,styles:a,style:c,vars:l,varsResolver:h,headless:u,withStylesTransform:g}){return{...!g&&yl({theme:r,themeName:e,props:o,stylesCtx:i,selector:t}),...!g&&Yn({theme:r,styles:a,props:o,stylesCtx:i})[t],...!g&&Yn({theme:r,styles:n?.styles,props:n?.props||o,stylesCtx:i})[t],...Tl({theme:r,props:o,stylesCtx:i,vars:l,varsResolver:h,selector:t,themeName:e,headless:u}),...s===t?Xn({style:c,theme:r}):null,...Xn({style:n?.style,theme:r})}}function Il({props:r,stylesCtx:e,themeName:t}){const n=Nt(),o=Vc()?.();return{getTransformedStyles:s=>o?[...s.map(c=>o(c,{props:r,theme:n,ctx:e})),...t.map(c=>o(n.components[c]?.styles,{props:r,theme:n,ctx:e}))].filter(Boolean):[],withStylesTransform:!!o}}function ct({name:r,classes:e,props:t,stylesCtx:n,className:o,style:i,rootSelector:s="root",unstyled:a,classNames:c,styles:l,vars:h,varsResolver:u,attributes:g}){const m=Nt(),I=$c(),w=zc(),P=qc(),b=(Array.isArray(r)?r:[r]).filter(S=>S),{withStylesTransform:v,getTransformedStyles:O}=Il({props:t,stylesCtx:n,themeName:b});return(S,x)=>({className:ml({theme:m,options:x,themeName:b,selector:S,classNamesPrefix:I,classNames:c,classes:e,unstyled:a,className:o,rootSelector:s,props:t,stylesCtx:n,withStaticClasses:w,headless:P,transformedStyles:O([x?.styles,l])}),style:Al({theme:m,themeName:b,selector:S,options:x,props:t,stylesCtx:n,rootSelector:s,styles:l,style:i,vars:h,varsResolver:u,headless:P,withStylesTransform:v}),...g?.[S]})}function Ge(r,e,t){const n=Nt(),o=n.components[r]?.defaultProps,i=typeof o=="function"?o(n):o;return{...e,...i,...pr(t)}}function Gn(r){return fr(r).reduce((e,t)=>r[t]!==void 0?`${e}${Nc(t)}:${r[t]};`:e,"").trim()}function wl({selector:r,styles:e,media:t,container:n}){const o=e?Gn(e):"",i=Array.isArray(t)?t.map(a=>`@media${a.query}{${r}{${Gn(a.styles)}}}`):[],s=Array.isArray(n)?n.map(a=>`@container ${a.query}{${r}{${Gn(a.styles)}}}`):[];return`${o?`${r}{${o}}`:""}${i.join("")}${s.join("")}`.trim()}function El(r){const e=Gc();return R.jsx("style",{"data-mantine-styles":"inline",nonce:e?.(),dangerouslySetInnerHTML:{__html:wl(r)}})}function vl(r){const{m:e,mx:t,my:n,mt:o,mb:i,ml:s,mr:a,me:c,ms:l,p:h,px:u,py:g,pt:m,pb:I,pl:w,pr:P,pe:b,ps:v,bd:O,bdrs:S,bg:x,c:j,opacity:F,ff:Ee,fz:se,fw:Be,lts:Hn,ta:Fn,lh:rc,fs:oc,tt:ic,td:sc,w:ac,miw:cc,maw:lc,h:dc,mih:hc,mah:uc,bgsz:gc,bgp:fc,bgr:pc,bga:mc,pos:yc,top:Cc,left:Tc,bottom:Ac,right:Ic,inset:wc,display:Ec,flex:vc,hiddenFrom:Sc,visibleFrom:kc,lightHidden:bc,darkHidden:_c,sx:Rc,...Pc}=r;return{styleProps:pr({m:e,mx:t,my:n,mt:o,mb:i,ml:s,mr:a,me:c,ms:l,p:h,px:u,py:g,pt:m,pb:I,pl:w,pr:P,pe:b,ps:v,bd:O,bg:x,c:j,opacity:F,ff:Ee,fz:se,fw:Be,lts:Hn,ta:Fn,lh:rc,fs:oc,tt:ic,td:sc,w:ac,miw:cc,maw:lc,h:dc,mih:hc,mah:uc,bgsz:gc,bgp:fc,bgr:pc,bga:mc,pos:yc,top:Cc,left:Tc,bottom:Ac,right:Ic,inset:wc,display:Ec,flex:vc,bdrs:S,hiddenFrom:Sc,visibleFrom:kc,lightHidden:bc,darkHidden:_c,sx:Rc}),rest:Pc}}const Sl={m:{type:"spacing",property:"margin"},mt:{type:"spacing",property:"marginTop"},mb:{type:"spacing",property:"marginBottom"},ml:{type:"spacing",property:"marginLeft"},mr:{type:"spacing",property:"marginRight"},ms:{type:"spacing",property:"marginInlineStart"},me:{type:"spacing",property:"marginInlineEnd"},mx:{type:"spacing",property:"marginInline"},my:{type:"spacing",property:"marginBlock"},p:{type:"spacing",property:"padding"},pt:{type:"spacing",property:"paddingTop"},pb:{type:"spacing",property:"paddingBottom"},pl:{type:"spacing",property:"paddingLeft"},pr:{type:"spacing",property:"paddingRight"},ps:{type:"spacing",property:"paddingInlineStart"},pe:{type:"spacing",property:"paddingInlineEnd"},px:{type:"spacing",property:"paddingInline"},py:{type:"spacing",property:"paddingBlock"},bd:{type:"border",property:"border"},bdrs:{type:"radius",property:"borderRadius"},bg:{type:"color",property:"background"},c:{type:"textColor",property:"color"},opacity:{type:"identity",property:"opacity"},ff:{type:"fontFamily",property:"fontFamily"},fz:{type:"fontSize",property:"fontSize"},fw:{type:"identity",property:"fontWeight"},lts:{type:"size",property:"letterSpacing"},ta:{type:"identity",property:"textAlign"},lh:{type:"lineHeight",property:"lineHeight"},fs:{type:"identity",property:"fontStyle"},tt:{type:"identity",property:"textTransform"},td:{type:"identity",property:"textDecoration"},w:{type:"spacing",property:"width"},miw:{type:"spacing",property:"minWidth"},maw:{type:"spacing",property:"maxWidth"},h:{type:"spacing",property:"height"},mih:{type:"spacing",property:"minHeight"},mah:{type:"spacing",property:"maxHeight"},bgsz:{type:"size",property:"backgroundSize"},bgp:{type:"identity",property:"backgroundPosition"},bgr:{type:"identity",property:"backgroundRepeat"},bga:{type:"identity",property:"backgroundAttachment"},pos:{type:"identity",property:"position"},top:{type:"size",property:"top"},left:{type:"size",property:"left"},bottom:{type:"size",property:"bottom"},right:{type:"size",property:"right"},inset:{type:"size",property:"inset"},display:{type:"identity",property:"display"},flex:{type:"identity",property:"flex"}};function Tr(r,e){const t=mn({color:r,theme:e});return t.color==="dimmed"?"var(--mantine-color-dimmed)":t.color==="bright"?"var(--mantine-color-bright)":t.variable?`var(${t.variable})`:t.color}function kl(r,e){const t=mn({color:r,theme:e});return t.isThemeColor&&t.shade===void 0?`var(--mantine-color-${t.color}-text)`:Tr(r,e)}function bl(r,e){if(typeof r=="number")return C(r);if(typeof r=="string"){const[t,n,...o]=r.split(" ").filter(s=>s.trim()!=="");let i=`${C(t)}`;return n&&(i+=` ${n}`),o.length>0&&(i+=` ${Tr(o.join(" "),e)}`),i.trim()}return r}const Ho={text:"var(--mantine-font-family)",mono:"var(--mantine-font-family-monospace)",monospace:"var(--mantine-font-family-monospace)",heading:"var(--mantine-font-family-headings)",headings:"var(--mantine-font-family-headings)"};function _l(r){return typeof r=="string"&&r in Ho?Ho[r]:r}const Rl=["h1","h2","h3","h4","h5","h6"];function Pl(r,e){return typeof r=="string"&&r in e.fontSizes?`var(--mantine-font-size-${r})`:typeof r=="string"&&Rl.includes(r)?`var(--mantine-${r}-font-size)`:typeof r=="number"||typeof r=="string"?C(r):r}function Ol(r){return r}const Nl=["h1","h2","h3","h4","h5","h6"];function Ml(r,e){return typeof r=="string"&&r in e.lineHeights?`var(--mantine-line-height-${r})`:typeof r=="string"&&Nl.includes(r)?`var(--mantine-${r}-line-height)`:r}function Ul(r,e){return typeof r=="string"&&r in e.radius?`var(--mantine-radius-${r})`:typeof r=="number"||typeof r=="string"?C(r):r}function Dl(r){return typeof r=="number"?C(r):r}function Ll(r,e){if(typeof r=="number")return C(r);if(typeof r=="string"){const t=r.replace("-","");if(!(t in e.spacing))return C(r);const n=`--mantine-spacing-${t}`;return r.startsWith("-")?`calc(var(${n}) * -1)`:`var(${n})`}return r}const zn={color:Tr,textColor:kl,fontSize:Pl,spacing:Ll,radius:Ul,identity:Ol,size:Dl,lineHeight:Ml,fontFamily:_l,border:bl};function Fo(r){return r.replace("(min-width: ","").replace("em)","")}function xl({media:r,...e}){const n=Object.keys(r).sort((o,i)=>Number(Fo(o))-Number(Fo(i))).map(o=>({query:o,styles:r[o]}));return{...e,media:n}}function Hl(r){if(typeof r!="object"||r===null)return!1;const e=Object.keys(r);return!(e.length===1&&e[0]==="base")}function Fl(r){return typeof r=="object"&&r!==null?"base"in r?r.base:void 0:r}function Bl(r){return typeof r=="object"&&r!==null?fr(r).filter(e=>e!=="base"):[]}function Kl(r,e){return typeof r=="object"&&r!==null&&e in r?r[e]:r}function $l({styleProps:r,data:e,theme:t}){return xl(fr(r).reduce((n,o)=>{if(o==="hiddenFrom"||o==="visibleFrom"||o==="sx")return n;const i=e[o],s=Array.isArray(i.property)?i.property:[i.property],a=Fl(r[o]);if(!Hl(r[o]))return s.forEach(l=>{n.inlineStyles[l]=zn[i.type](a,t)}),n;n.hasResponsiveStyles=!0;const c=Bl(r[o]);return s.forEach(l=>{a!=null&&(n.styles[l]=zn[i.type](a,t)),c.forEach(h=>{const u=`(min-width: ${t.breakpoints[h]})`;n.media[u]={...n.media[u],[l]:zn[i.type](Kl(r[o],h),t)}})}),n},{hasResponsiveStyles:!1,styles:{},inlineStyles:{},media:{}}))}function Gl(){return`__m__-${k.useId().replace(/[:«»]/g,"")}`}function Di(r){return r.startsWith("data-")?r:`data-${r}`}function zl(r){return Object.keys(r).reduce((e,t)=>{const n=r[t];return n===void 0||n===""||n===!1||n===null||(e[Di(t)]=r[t]),e},{})}function Li(r){return r?typeof r=="string"?{[Di(r)]:!0}:Array.isArray(r)?[...r].reduce((e,t)=>({...e,...Li(t)}),{}):zl(r):null}function Zn(r,e){return Array.isArray(r)?[...r].reduce((t,n)=>({...t,...Zn(n,e)}),{}):typeof r=="function"?r(e):r??{}}function ql({theme:r,style:e,vars:t,styleProps:n}){const o=Zn(e,r),i=Zn(t,r);return{...o,...i,...n}}const xi=k.forwardRef(({component:r,style:e,__vars:t,className:n,variant:o,mod:i,size:s,hiddenFrom:a,visibleFrom:c,lightHidden:l,darkHidden:h,renderRoot:u,__size:g,...m},I)=>{const w=Nt(),P=r||"div",{styleProps:b,rest:v}=vl(m),S=jc()?.()?.(b.sx),x=Gl(),j=$l({styleProps:b,theme:w,data:Sl}),F={ref:I,style:ql({theme:w,style:e,vars:t,styleProps:j.inlineStyles}),className:Qe(n,S,{[x]:j.hasResponsiveStyles,"mantine-light-hidden":l,"mantine-dark-hidden":h,[`mantine-hidden-from-${a}`]:a,[`mantine-visible-from-${c}`]:c}),"data-variant":o,"data-size":Oi(s)?void 0:s||void 0,size:g,...Li(i),...v};return R.jsxs(R.Fragment,{children:[j.hasResponsiveStyles&&R.jsx(El,{selector:`.${x}`,styles:j.styles,media:j.media}),typeof u=="function"?u(F):R.jsx(P,{...F})]})});xi.displayName="@mantine/core/Box";const ce=xi;function Hi(r){return r}function Ar(r){const e=k.forwardRef(r);return e.extend=Hi,e.withProps=t=>{const n=k.forwardRef((o,i)=>R.jsx(e,{...t,...o,ref:i}));return n.extend=e.extend,n.displayName=`WithProps(${e.displayName})`,n},e}function Ir(r){const e=k.forwardRef(r);return e.withProps=t=>{const n=k.forwardRef((o,i)=>R.jsx(e,{...t,...o,ref:i}));return n.extend=e.extend,n.displayName=`WithProps(${e.displayName})`,n},e.extend=Hi,e}var Fi={root:"m_87cf2631"};const jl={__staticSelector:"UnstyledButton"},wr=Ir((r,e)=>{const t=Ge("UnstyledButton",jl,r),{className:n,component:o="button",__staticSelector:i,unstyled:s,classNames:a,styles:c,style:l,attributes:h,...u}=t,g=ct({name:i,props:t,classes:Fi,className:n,style:l,classNames:a,styles:c,unstyled:s,attributes:h});return R.jsx(ce,{...g("root",{focusable:!0}),component:o,ref:e,type:o==="button"?"button":void 0,...u})});wr.classes=Fi;wr.displayName="@mantine/core/UnstyledButton";const pt=r=>({in:{opacity:1,transform:"scale(1)"},out:{opacity:0,transform:`scale(.9) translateY(${r==="bottom"?10:-10}px)`},transitionProperty:"transform, opacity"}),Dt={fade:{in:{opacity:1},out:{opacity:0},transitionProperty:"opacity"},"fade-up":{in:{opacity:1,transform:"translateY(0)"},out:{opacity:0,transform:"translateY(30px)"},transitionProperty:"opacity, transform"},"fade-down":{in:{opacity:1,transform:"translateY(0)"},out:{opacity:0,transform:"translateY(-30px)"},transitionProperty:"opacity, transform"},"fade-left":{in:{opacity:1,transform:"translateX(0)"},out:{opacity:0,transform:"translateX(30px)"},transitionProperty:"opacity, transform"},"fade-right":{in:{opacity:1,transform:"translateX(0)"},out:{opacity:0,transform:"translateX(-30px)"},transitionProperty:"opacity, transform"},scale:{in:{opacity:1,transform:"scale(1)"},out:{opacity:0,transform:"scale(0)"},common:{transformOrigin:"top"},transitionProperty:"transform, opacity"},"scale-y":{in:{opacity:1,transform:"scaleY(1)"},out:{opacity:0,transform:"scaleY(0)"},common:{transformOrigin:"top"},transitionProperty:"transform, opacity"},"scale-x":{in:{opacity:1,transform:"scaleX(1)"},out:{opacity:0,transform:"scaleX(0)"},common:{transformOrigin:"left"},transitionProperty:"transform, opacity"},"skew-up":{in:{opacity:1,transform:"translateY(0) skew(0deg, 0deg)"},out:{opacity:0,transform:"translateY(-20px) skew(-10deg, -5deg)"},common:{transformOrigin:"top"},transitionProperty:"transform, opacity"},"skew-down":{in:{opacity:1,transform:"translateY(0) skew(0deg, 0deg)"},out:{opacity:0,transform:"translateY(20px) skew(-10deg, -5deg)"},common:{transformOrigin:"bottom"},transitionProperty:"transform, opacity"},"rotate-left":{in:{opacity:1,transform:"translateY(0) rotate(0deg)"},out:{opacity:0,transform:"translateY(20px) rotate(-5deg)"},common:{transformOrigin:"bottom"},transitionProperty:"transform, opacity"},"rotate-right":{in:{opacity:1,transform:"translateY(0) rotate(0deg)"},out:{opacity:0,transform:"translateY(20px) rotate(5deg)"},common:{transformOrigin:"top"},transitionProperty:"transform, opacity"},"slide-down":{in:{opacity:1,transform:"translateY(0)"},out:{opacity:0,transform:"translateY(-100%)"},common:{transformOrigin:"top"},transitionProperty:"transform, opacity"},"slide-up":{in:{opacity:1,transform:"translateY(0)"},out:{opacity:0,transform:"translateY(100%)"},common:{transformOrigin:"bottom"},transitionProperty:"transform, opacity"},"slide-left":{in:{opacity:1,transform:"translateX(0)"},out:{opacity:0,transform:"translateX(100%)"},common:{transformOrigin:"left"},transitionProperty:"transform, opacity"},"slide-right":{in:{opacity:1,transform:"translateX(0)"},out:{opacity:0,transform:"translateX(-100%)"},common:{transformOrigin:"right"},transitionProperty:"transform, opacity"},pop:{...pt("bottom"),common:{transformOrigin:"center center"}},"pop-bottom-left":{...pt("bottom"),common:{transformOrigin:"bottom left"}},"pop-bottom-right":{...pt("bottom"),common:{transformOrigin:"bottom right"}},"pop-top-left":{...pt("top"),common:{transformOrigin:"top left"}},"pop-top-right":{...pt("top"),common:{transformOrigin:"top right"}}},Bo={entering:"in",entered:"in",exiting:"out",exited:"out","pre-exiting":"out","pre-entering":"out"};function Vl({transition:r,state:e,duration:t,timingFunction:n}){const o={WebkitBackfaceVisibility:"hidden",transitionDuration:`${t}ms`,transitionTimingFunction:n};return typeof r=="string"?r in Dt?{transitionProperty:Dt[r].transitionProperty,...o,...Dt[r].common,...Dt[r][Bo[e]]}:{}:{transitionProperty:r.transitionProperty,...o,...r.common,...r[Bo[e]]}}function Wl({duration:r,exitDuration:e,timingFunction:t,mounted:n,onEnter:o,onExit:i,onEntered:s,onExited:a,enterDelay:c,exitDelay:l}){const h=Nt(),u=Hc(),g=h.respectReducedMotion?u:!1,[m,I]=k.useState(g?0:r),[w,P]=k.useState(n?"entered":"exited"),b=k.useRef(-1),v=k.useRef(-1),O=k.useRef(-1);function S(){window.clearTimeout(b.current),window.clearTimeout(v.current),cancelAnimationFrame(O.current)}const x=F=>{S();const Ee=F?o:i,se=F?s:a,Be=g?0:F?r:e;I(Be),Be===0?(typeof Ee=="function"&&Ee(),typeof se=="function"&&se(),P(F?"entered":"exited")):O.current=requestAnimationFrame(()=>{Oc.flushSync(()=>{P(F?"pre-entering":"pre-exiting")}),O.current=requestAnimationFrame(()=>{typeof Ee=="function"&&Ee(),P(F?"entering":"exiting"),b.current=window.setTimeout(()=>{typeof se=="function"&&se(),P(F?"entered":"exited")},Be)})})},j=F=>{if(S(),typeof(F?c:l)!="number"){x(F);return}v.current=window.setTimeout(()=>{x(F)},F?c:l)};return xc(()=>{j(n)},[n]),k.useEffect(()=>()=>{S()},[]),{transitionDuration:m,transitionStatus:w,transitionTimingFunction:t||"ease"}}function Bi({keepMounted:r,transition:e="fade",duration:t=250,exitDuration:n=t,mounted:o,children:i,timingFunction:s="ease",onExit:a,onEntered:c,onEnter:l,onExited:h,enterDelay:u,exitDelay:g}){const m=Wc(),{transitionDuration:I,transitionStatus:w,transitionTimingFunction:P}=Wl({mounted:o,exitDuration:n,duration:t,timingFunction:s,onExit:a,onEntered:c,onEnter:l,onExited:h,enterDelay:u,exitDelay:g});return I===0||m==="test"?o?R.jsx(R.Fragment,{children:i({})}):r?i({display:"none"}):null:w==="exited"?r?i({display:"none"}):null:R.jsx(R.Fragment,{children:i(Vl({transition:e,duration:I,state:w,timingFunction:P}))})}Bi.displayName="@mantine/core/Transition";var fe={root:"m_5ae2e3c",barsLoader:"m_7a2bd4cd",bar:"m_870bb79","bars-loader-animation":"m_5d2b3b9d",dotsLoader:"m_4e3f22d7",dot:"m_870c4af","loader-dots-animation":"m_aac34a1",ovalLoader:"m_b34414df","oval-loader-animation":"m_f8e89c4b"};const Ki=k.forwardRef(({className:r,...e},t)=>R.jsxs(ce,{component:"span",className:Qe(fe.barsLoader,r),...e,ref:t,children:[R.jsx("span",{className:fe.bar}),R.jsx("span",{className:fe.bar}),R.jsx("span",{className:fe.bar})]}));Ki.displayName="@mantine/core/Bars";const $i=k.forwardRef(({className:r,...e},t)=>R.jsxs(ce,{component:"span",className:Qe(fe.dotsLoader,r),...e,ref:t,children:[R.jsx("span",{className:fe.dot}),R.jsx("span",{className:fe.dot}),R.jsx("span",{className:fe.dot})]}));$i.displayName="@mantine/core/Dots";const Gi=k.forwardRef(({className:r,...e},t)=>R.jsx(ce,{component:"span",className:Qe(fe.ovalLoader,r),...e,ref:t}));Gi.displayName="@mantine/core/Oval";const zi={bars:Ki,oval:Gi,dots:$i},Ql={loaders:zi,type:"oval"},Yl=(r,{size:e,color:t})=>({root:{"--loader-size":we(e,"loader-size"),"--loader-color":t?Wt(t,r):void 0}}),yn=Ar((r,e)=>{const t=Ge("Loader",Ql,r),{size:n,color:o,type:i,vars:s,className:a,style:c,classNames:l,styles:h,unstyled:u,loaders:g,variant:m,children:I,attributes:w,...P}=t,b=ct({name:"Loader",props:t,classes:fe,className:a,style:c,classNames:l,styles:h,unstyled:u,attributes:w,vars:s,varsResolver:Yl});return I?R.jsx(ce,{...b("root"),ref:e,...P,children:I}):R.jsx(ce,{...b("root"),ref:e,component:g[i],variant:m,size:n,...P})});yn.defaultLoaders=zi;yn.classes=fe;yn.displayName="@mantine/core/Loader";var qi={root:"m_b6d8b162"};function Jl(r){if(r==="start")return"start";if(r==="end"||r)return"end"}const Xl={inherit:!1},Zl=(r,{variant:e,lineClamp:t,gradient:n,size:o,color:i})=>({root:{"--text-fz":St(o),"--text-lh":Mc(o),"--text-gradient":e==="gradient"?Jn(n,r):void 0,"--text-line-clamp":typeof t=="number"?t.toString():void 0,"--text-color":i?Wt(i,r):void 0}}),ji=Ir((r,e)=>{const t=Ge("Text",Xl,r),{lineClamp:n,truncate:o,inline:i,inherit:s,gradient:a,span:c,__staticSelector:l,vars:h,className:u,style:g,classNames:m,styles:I,unstyled:w,variant:P,mod:b,size:v,attributes:O,...S}=t,x=ct({name:["Text",l],props:t,classes:qi,className:u,style:g,classNames:m,styles:I,unstyled:w,attributes:O,vars:h,varsResolver:Zl});return R.jsx(ce,{...x("root",{focusable:!0}),ref:e,component:c?"span":"p",variant:P,mod:[{"data-truncate":Jl(o),"data-line-clamp":typeof n=="number","data-inline":i,"data-inherit":s},b],size:v,...S})});ji.classes=qi;ji.displayName="@mantine/core/Text";var lt={root:"m_77c9d27d",inner:"m_80f1301b",label:"m_811560b9",section:"m_a74036a",loader:"m_a25b86ee",group:"m_80d6d844",groupSection:"m_70be2a01"};const Ko={orientation:"horizontal"},ed=(r,{borderWidth:e})=>({group:{"--button-border-width":C(e)}}),Er=Ar((r,e)=>{const t=Ge("ButtonGroup",Ko,r),{className:n,style:o,classNames:i,styles:s,unstyled:a,orientation:c,vars:l,borderWidth:h,variant:u,mod:g,attributes:m,...I}=Ge("ButtonGroup",Ko,r),w=ct({name:"ButtonGroup",props:t,classes:lt,className:n,style:o,classNames:i,styles:s,unstyled:a,attributes:m,vars:l,varsResolver:ed,rootSelector:"group"});return R.jsx(ce,{...w("group"),ref:e,variant:u,mod:[{"data-orientation":c},g],role:"group",...I})});Er.classes=lt;Er.displayName="@mantine/core/ButtonGroup";const td=(r,{radius:e,color:t,gradient:n,variant:o,autoContrast:i,size:s})=>{const a=r.variantColorResolver({color:t||r.primaryColor,theme:r,gradient:n,variant:o||"filled",autoContrast:i});return{groupSection:{"--section-height":we(s,"section-height"),"--section-padding-x":we(s,"section-padding-x"),"--section-fz":s?.includes("compact")?St(s.replace("compact-","")):St(s),"--section-radius":e===void 0?void 0:Ni(e),"--section-bg":t||o?a.background:void 0,"--section-color":a.color,"--section-bd":t||o?a.border:void 0}}},vr=Ar((r,e)=>{const t=Ge("ButtonGroupSection",null,r),{className:n,style:o,classNames:i,styles:s,unstyled:a,vars:c,variant:l,gradient:h,radius:u,autoContrast:g,attributes:m,...I}=t,w=ct({name:"ButtonGroupSection",props:t,classes:lt,className:n,style:o,classNames:i,styles:s,unstyled:a,attributes:m,vars:c,varsResolver:td,rootSelector:"groupSection"});return R.jsx(ce,{...w("groupSection"),ref:e,variant:l,...I})});vr.classes=lt;vr.displayName="@mantine/core/ButtonGroupSection";const nd={in:{opacity:1,transform:`translate(-50%, calc(-50% + ${C(1)}))`},out:{opacity:0,transform:"translate(-50%, -200%)"},common:{transformOrigin:"center"},transitionProperty:"transform, opacity"},rd=(r,{radius:e,color:t,gradient:n,variant:o,size:i,justify:s,autoContrast:a})=>{const c=r.variantColorResolver({color:t||r.primaryColor,theme:r,gradient:n,variant:o||"filled",autoContrast:a});return{root:{"--button-justify":s,"--button-height":we(i,"button-height"),"--button-padding-x":we(i,"button-padding-x"),"--button-fz":i?.includes("compact")?St(i.replace("compact-","")):St(i),"--button-radius":e===void 0?void 0:Ni(e),"--button-bg":t||o?c.background:void 0,"--button-hover":t||o?c.hover:void 0,"--button-color":c.color,"--button-bd":t||o?c.border:void 0,"--button-hover-color":t||o?c.hoverColor:void 0}}},Cn=Ir((r,e)=>{const t=Ge("Button",null,r),{style:n,vars:o,className:i,color:s,disabled:a,children:c,leftSection:l,rightSection:h,fullWidth:u,variant:g,radius:m,loading:I,loaderProps:w,gradient:P,classNames:b,styles:v,unstyled:O,"data-disabled":S,autoContrast:x,mod:j,attributes:F,...Ee}=t,se=ct({name:"Button",props:t,classes:lt,className:i,style:n,classNames:b,styles:v,unstyled:O,attributes:F,vars:o,varsResolver:rd}),Be=!!l,Hn=!!h;return R.jsxs(wr,{ref:e,...se("root",{active:!a&&!I&&!S}),unstyled:O,variant:g,disabled:a||I,mod:[{disabled:a||S,loading:I,block:u,"with-left-section":Be,"with-right-section":Hn},j],...Ee,children:[typeof I=="boolean"&&R.jsx(Bi,{mounted:I,transition:nd,duration:150,children:Fn=>R.jsx(ce,{component:"span",...se("loader",{style:Fn}),"aria-hidden":!0,children:R.jsx(yn,{color:"var(--button-color)",size:"calc(var(--button-height) / 1.8)",...w})})}),R.jsxs("span",{...se("inner"),children:[l&&R.jsx(ce,{component:"span",...se("section"),mod:{position:"left"},children:l}),R.jsx(ce,{component:"span",mod:{loading:I},...se("label"),children:c}),h&&R.jsx(ce,{component:"span",...se("section"),mod:{position:"right"},children:h})]})]})});Cn.classes=lt;Cn.displayName="@mantine/core/Button";Cn.Group=Er;Cn.GroupSection=vr;const p={LIBRARY_NAME:"MSAL.JS",SKU:"msal.js.common",DEFAULT_AUTHORITY:"https://login.microsoftonline.com/common/",DEFAULT_AUTHORITY_HOST:"login.microsoftonline.com",DEFAULT_COMMON_TENANT:"common",ADFS:"adfs",DSTS:"dstsv2",AAD_INSTANCE_DISCOVERY_ENDPT:"https://login.microsoftonline.com/common/discovery/instance?api-version=1.1&authorization_endpoint=",CIAM_AUTH_URL:".ciamlogin.com",AAD_TENANT_DOMAIN_SUFFIX:".onmicrosoft.com",RESOURCE_DELIM:"|",NO_ACCOUNT:"NO_ACCOUNT",CLAIMS:"claims",CONSUMER_UTID:"9188040d-6c67-4c5b-b112-36a304b66dad",OPENID_SCOPE:"openid",PROFILE_SCOPE:"profile",OFFLINE_ACCESS_SCOPE:"offline_access",EMAIL_SCOPE:"email",CODE_GRANT_TYPE:"authorization_code",RT_GRANT_TYPE:"refresh_token",S256_CODE_CHALLENGE_METHOD:"S256",URL_FORM_CONTENT_TYPE:"application/x-www-form-urlencoded;charset=utf-8",AUTHORIZATION_PENDING:"authorization_pending",NOT_DEFINED:"not_defined",EMPTY_STRING:"",NOT_APPLICABLE:"N/A",NOT_AVAILABLE:"Not Available",FORWARD_SLASH:"/",IMDS_ENDPOINT:"http://169.254.169.254/metadata/instance/compute/location",IMDS_VERSION:"2020-06-01",IMDS_TIMEOUT:2e3,AZURE_REGION_AUTO_DISCOVER_FLAG:"TryAutoDetect",REGIONAL_AUTH_PUBLIC_CLOUD_SUFFIX:"login.microsoft.com",KNOWN_PUBLIC_CLOUDS:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"],SHR_NONCE_VALIDITY:240,INVALID_INSTANCE:"invalid_instance"},Me={SUCCESS:200,SUCCESS_RANGE_START:200,SUCCESS_RANGE_END:299,REDIRECT:302,CLIENT_ERROR:400,CLIENT_ERROR_RANGE_START:400,BAD_REQUEST:400,UNAUTHORIZED:401,NOT_FOUND:404,REQUEST_TIMEOUT:408,GONE:410,TOO_MANY_REQUESTS:429,CLIENT_ERROR_RANGE_END:499,SERVER_ERROR:500,SERVER_ERROR_RANGE_START:500,SERVICE_UNAVAILABLE:503,GATEWAY_TIMEOUT:504,SERVER_ERROR_RANGE_END:599,MULTI_SIDED_ERROR:600},$e={GET:"GET",POST:"POST"},dt=[p.OPENID_SCOPE,p.PROFILE_SCOPE,p.OFFLINE_ACCESS_SCOPE],$o=[...dt,p.EMAIL_SCOPE],te={CONTENT_TYPE:"Content-Type",CONTENT_LENGTH:"Content-Length",RETRY_AFTER:"Retry-After",CCS_HEADER:"X-AnchorMailbox",WWWAuthenticate:"WWW-Authenticate",AuthenticationInfo:"Authentication-Info",X_MS_REQUEST_ID:"x-ms-request-id",X_MS_HTTP_VERSION:"x-ms-httpver"},Go={ACTIVE_ACCOUNT_FILTERS:"active-account-filters"},Ue={COMMON:"common",ORGANIZATIONS:"organizations",CONSUMERS:"consumers"},Lt={ACCESS_TOKEN:"access_token",XMS_CC:"xms_cc"},Q={LOGIN:"login",SELECT_ACCOUNT:"select_account",CONSENT:"consent",NONE:"none",NO_SESSION:"no_session"},Sr={CODE:"code",IDTOKEN_TOKEN_REFRESHTOKEN:"id_token token refresh_token"},Tn={QUERY:"query",FRAGMENT:"fragment"},od={QUERY:"query"},Vi={AUTHORIZATION_CODE_GRANT:"authorization_code",REFRESH_TOKEN_GRANT:"refresh_token"},xt={MSSTS_ACCOUNT_TYPE:"MSSTS",ADFS_ACCOUNT_TYPE:"ADFS",GENERIC_ACCOUNT_TYPE:"Generic"},kt={CACHE_KEY_SEPARATOR:"-",CLIENT_INFO_SEPARATOR:"."},W={ID_TOKEN:"IdToken",ACCESS_TOKEN:"AccessToken",ACCESS_TOKEN_WITH_AUTH_SCHEME:"AccessToken_With_AuthScheme",REFRESH_TOKEN:"RefreshToken"},kr="appmetadata",id="client_info",Qt="1",Yt={CACHE_KEY:"authority-metadata",REFRESH_TIME_SECONDS:3600*24},ae={CONFIG:"config",CACHE:"cache",NETWORK:"network",HARDCODED_VALUES:"hardcoded_values"},V={SCHEMA_VERSION:5,MAX_LAST_HEADER_BYTES:330,MAX_CACHED_ERRORS:50,CACHE_KEY:"server-telemetry",CATEGORY_SEPARATOR:"|",VALUE_SEPARATOR:",",OVERFLOW_TRUE:"1",OVERFLOW_FALSE:"0",UNKNOWN_ERROR:"unknown_error"},U={BEARER:"Bearer",POP:"pop",SSH:"ssh-cert"},It={DEFAULT_THROTTLE_TIME_SECONDS:60,DEFAULT_MAX_THROTTLE_TIME_SECONDS:3600,THROTTLING_PREFIX:"throttling",X_MS_LIB_CAPABILITY_VALUE:"retry-after, h429"},zo={INVALID_GRANT_ERROR:"invalid_grant",CLIENT_MISMATCH_ERROR:"client_mismatch"},Je={FAILED_AUTO_DETECTION:"1",INTERNAL_CACHE:"2",ENVIRONMENT_VARIABLE:"3",IMDS:"4"},qn={CONFIGURED_NO_AUTO_DETECTION:"2",AUTO_DETECTION_REQUESTED_SUCCESSFUL:"4",AUTO_DETECTION_REQUESTED_FAILED:"5"},Ke={NOT_APPLICABLE:"0",FORCE_REFRESH_OR_CLAIMS:"1",NO_CACHED_ACCESS_TOKEN:"2",CACHED_ACCESS_TOKEN_EXPIRED:"3",PROACTIVELY_REFRESHED:"4"},sd={Pop:"pop"},Wi=300;const Jt="unexpected_error",ad="post_request_failed";const qo={[Jt]:"Unexpected error in authentication.",[ad]:"Post request failed from the network, could be a 4xx/5xx or a network unavailability. Please check the exact error code for details."};class L extends Error{constructor(e,t,n){const o=t?`${e}: ${t}`:e;super(o),Object.setPrototypeOf(this,L.prototype),this.errorCode=e||p.EMPTY_STRING,this.errorMessage=t||p.EMPTY_STRING,this.subError=n||p.EMPTY_STRING,this.name="AuthError"}setCorrelationId(e){this.correlationId=e}}function er(r,e){return new L(r,e?`${qo[r]} ${e}`:qo[r])}const br="client_info_decoding_error",Qi="client_info_empty_error",_r="token_parsing_error",Yi="null_or_empty_token",ke="endpoints_resolution_error",Ji="network_error",Xi="openid_config_error",Zi="hash_not_deserialized",st="invalid_state",es="state_mismatch",tr="state_not_found",ts="nonce_mismatch",Rr="auth_time_not_found",ns="max_age_transpired",cd="multiple_matching_tokens",ld="multiple_matching_accounts",rs="multiple_matching_appMetadata",os="request_cannot_be_made",is="cannot_remove_empty_scope",ss="cannot_append_scopeset",nr="empty_input_scopeset",dd="device_code_polling_cancelled",hd="device_code_expired",ud="device_code_unknown_error",Pr="no_account_in_silent_request",as="invalid_cache_record",Or="invalid_cache_environment",rr="no_account_found",or="no_crypto_object",gd="unexpected_credential_type",fd="invalid_assertion",pd="invalid_client_credential",De="token_refresh_required",md="user_timeout_reached",cs="token_claims_cnf_required_for_signedjwt",ls="authorization_code_missing_from_server_response",ds="binding_key_not_removed",hs="end_session_endpoint_not_supported",Nr="key_id_missing",yd="no_network_connectivity",Cd="user_canceled",Td="missing_tenant_id_error",_="method_not_implemented",Ad="nested_app_auth_bridge_disabled",Id="platform_broker_error";const jo={[br]:"The client info could not be parsed/decoded correctly",[Qi]:"The client info was empty",[_r]:"Token cannot be parsed",[Yi]:"The token is null or empty",[ke]:"Endpoints cannot be resolved",[Ji]:"Network request failed",[Xi]:"Could not retrieve endpoints. Check your authority and verify the .well-known/openid-configuration endpoint returns the required endpoints.",[Zi]:"The hash parameters could not be deserialized",[st]:"State was not the expected format",[es]:"State mismatch error",[tr]:"State not found",[ts]:"Nonce mismatch error",[Rr]:"Max Age was requested and the ID token is missing the auth_time variable. auth_time is an optional claim and is not enabled by default - it must be enabled. See https://aka.ms/msaljs/optional-claims for more information.",[ns]:"Max Age is set to 0, or too much time has elapsed since the last end-user authentication.",[cd]:"The cache contains multiple tokens satisfying the requirements. Call AcquireToken again providing more requirements such as authority or account.",[ld]:"The cache contains multiple accounts satisfying the given parameters. Please pass more info to obtain the correct account",[rs]:"The cache contains multiple appMetadata satisfying the given parameters. Please pass more info to obtain the correct appMetadata",[os]:"Token request cannot be made without authorization code or refresh token.",[is]:"Cannot remove null or empty scope from ScopeSet",[ss]:"Cannot append ScopeSet",[nr]:"Empty input ScopeSet cannot be processed",[dd]:"Caller has cancelled token endpoint polling during device code flow by setting DeviceCodeRequest.cancel = true.",[hd]:"Device code is expired.",[ud]:"Device code stopped polling for unknown reasons.",[Pr]:"Please pass an account object, silent flow is not supported without account information",[as]:"Cache record object was null or undefined.",[Or]:"Invalid environment when attempting to create cache entry",[rr]:"No account found in cache for given key.",[or]:"No crypto object detected.",[gd]:"Unexpected credential type.",[fd]:"Client assertion must meet requirements described in https://tools.ietf.org/html/rfc7515",[pd]:"Client credential (secret, certificate, or assertion) must not be empty when creating a confidential client. An application should at most have one credential",[De]:"Cannot return token from cache because it must be refreshed. This may be due to one of the following reasons: forceRefresh parameter is set to true, claims have been requested, there is no cached access token or it is expired.",[md]:"User defined timeout for device code polling reached",[cs]:"Cannot generate a POP jwt if the token_claims are not populated",[ls]:"Server response does not contain an authorization code to proceed",[ds]:"Could not remove the credential's binding key from storage.",[hs]:"The provided authority does not support logout",[Nr]:"A keyId value is missing from the requested bound token's cache record and is required to match the token to it's stored binding key.",[yd]:"No network connectivity. Check your internet connection.",[Cd]:"User cancelled the flow.",[Td]:"A tenant id - not common, organizations, or consumers - must be specified when using the client_credentials flow.",[_]:"This method has not been implemented",[Ad]:"The nested app auth bridge is disabled",[Id]:"An error occurred in the native broker. See the platformBrokerError property for details."};class Mr extends L{constructor(e,t){super(e,t?`${jo[e]}: ${t}`:jo[e]),this.name="ClientAuthError",Object.setPrototypeOf(this,Mr.prototype)}}function y(r,e){return new Mr(r,e)}const Xt={createNewGuid:()=>{throw y(_)},base64Decode:()=>{throw y(_)},base64Encode:()=>{throw y(_)},base64UrlEncode:()=>{throw y(_)},encodeKid:()=>{throw y(_)},async getPublicKeyThumbprint(){throw y(_)},async removeTokenBindingKey(){throw y(_)},async clearKeystore(){throw y(_)},async signJwt(){throw y(_)},async hashString(){throw y(_)}};var H;(function(r){r[r.Error=0]="Error",r[r.Warning=1]="Warning",r[r.Info=2]="Info",r[r.Verbose=3]="Verbose",r[r.Trace=4]="Trace"})(H||(H={}));class _e{constructor(e,t,n){this.level=H.Info;const o=()=>{},i=e||_e.createDefaultLoggerOptions();this.localCallback=i.loggerCallback||o,this.piiLoggingEnabled=i.piiLoggingEnabled||!1,this.level=typeof i.logLevel=="number"?i.logLevel:H.Info,this.correlationId=i.correlationId||p.EMPTY_STRING,this.packageName=t||p.EMPTY_STRING,this.packageVersion=n||p.EMPTY_STRING}static createDefaultLoggerOptions(){return{loggerCallback:()=>{},piiLoggingEnabled:!1,logLevel:H.Info}}clone(e,t,n){return new _e({loggerCallback:this.localCallback,piiLoggingEnabled:this.piiLoggingEnabled,logLevel:this.level,correlationId:n||this.correlationId},e,t)}logMessage(e,t){if(t.logLevel>this.level||!this.piiLoggingEnabled&&t.containsPii)return;const i=`${`[${new Date().toUTCString()}] : [${t.correlationId||this.correlationId||""}]`} : ${this.packageName}@${this.packageVersion} : ${H[t.logLevel]} - ${e}`;this.executeCallback(t.logLevel,i,t.containsPii||!1)}executeCallback(e,t,n){this.localCallback&&this.localCallback(e,t,n)}error(e,t){this.logMessage(e,{logLevel:H.Error,containsPii:!1,correlationId:t||p.EMPTY_STRING})}errorPii(e,t){this.logMessage(e,{logLevel:H.Error,containsPii:!0,correlationId:t||p.EMPTY_STRING})}warning(e,t){this.logMessage(e,{logLevel:H.Warning,containsPii:!1,correlationId:t||p.EMPTY_STRING})}warningPii(e,t){this.logMessage(e,{logLevel:H.Warning,containsPii:!0,correlationId:t||p.EMPTY_STRING})}info(e,t){this.logMessage(e,{logLevel:H.Info,containsPii:!1,correlationId:t||p.EMPTY_STRING})}infoPii(e,t){this.logMessage(e,{logLevel:H.Info,containsPii:!0,correlationId:t||p.EMPTY_STRING})}verbose(e,t){this.logMessage(e,{logLevel:H.Verbose,containsPii:!1,correlationId:t||p.EMPTY_STRING})}verbosePii(e,t){this.logMessage(e,{logLevel:H.Verbose,containsPii:!0,correlationId:t||p.EMPTY_STRING})}trace(e,t){this.logMessage(e,{logLevel:H.Trace,containsPii:!1,correlationId:t||p.EMPTY_STRING})}tracePii(e,t){this.logMessage(e,{logLevel:H.Trace,containsPii:!0,correlationId:t||p.EMPTY_STRING})}isPiiLoggingEnabled(){return this.piiLoggingEnabled||!1}}const us="@azure/msal-common",Ur="15.13.3";const Dr={None:"none"};const gs="redirect_uri_empty",wd="claims_request_parsing_error",fs="authority_uri_insecure",Tt="url_parse_error",ps="empty_url_error",ms="empty_input_scopes_error",Lr="invalid_claims",ys="token_request_empty",Cs="logout_request_empty",Ed="invalid_code_challenge_method",xr="pkce_params_missing",Hr="invalid_cloud_discovery_metadata",Ts="invalid_authority_metadata",As="untrusted_authority",An="missing_ssh_jwk",Is="missing_ssh_kid",vd="missing_nonce_authentication_header",Sd="invalid_authentication_header",ws="cannot_set_OIDCOptions",Es="cannot_allow_platform_broker",vs="authority_mismatch",Ss="invalid_request_method_for_EAR",ks="invalid_authorize_post_body_parameters",bs="invalid_platform_broker_configuration";const kd={[gs]:"A redirect URI is required for all calls, and none has been set.",[wd]:"Could not parse the given claims request object.",[fs]:"Authority URIs must use https.  Please see here for valid authority configuration options: https://docs.microsoft.com/en-us/azure/active-directory/develop/msal-js-initializing-client-applications#configuration-options",[Tt]:"URL could not be parsed into appropriate segments.",[ps]:"URL was empty or null.",[ms]:"Scopes cannot be passed as null, undefined or empty array because they are required to obtain an access token.",[Lr]:"Given claims parameter must be a stringified JSON object.",[ys]:"Token request was empty and not found in cache.",[Cs]:"The logout request was null or undefined.",[Ed]:'code_challenge_method passed is invalid. Valid values are "plain" and "S256".',[xr]:"Both params: code_challenge and code_challenge_method are to be passed if to be sent in the request",[Hr]:"Invalid cloudDiscoveryMetadata provided. Must be a stringified JSON object containing tenant_discovery_endpoint and metadata fields",[Ts]:"Invalid authorityMetadata provided. Must by a stringified JSON object containing authorization_endpoint, token_endpoint, issuer fields.",[As]:"The provided authority is not a trusted authority. Please include this authority in the knownAuthorities config parameter.",[An]:"Missing sshJwk in SSH certificate request. A stringified JSON Web Key is required when using the SSH authentication scheme.",[Is]:"Missing sshKid in SSH certificate request. A string that uniquely identifies the public SSH key is required when using the SSH authentication scheme.",[vd]:"Unable to find an authentication header containing server nonce. Either the Authentication-Info or WWW-Authenticate headers must be present in order to obtain a server nonce.",[Sd]:"Invalid authentication header provided",[ws]:"Cannot set OIDCOptions parameter. Please change the protocol mode to OIDC or use a non-Microsoft authority.",[Es]:"Cannot set allowPlatformBroker parameter to true when not in AAD protocol mode.",[vs]:"Authority mismatch error. Authority provided in login request or PublicClientApplication config does not match the environment of the provided account. Please use a matching account or make an interactive request to login to this authority.",[ks]:"Invalid authorize post body parameters provided. If you are using authorizePostBodyParameters, the request method must be POST. Please check the request method and parameters.",[Ss]:"Invalid request method for EAR protocol mode. The request method cannot be GET when using EAR protocol mode. Please change the request method to POST.",[bs]:"Invalid platform broker configuration. `allowPlatformBrokerWithDOM` can only be enabled when `allowPlatformBroker` is enabled."};class Fr extends L{constructor(e){super(e,kd[e]),this.name="ClientConfigurationError",Object.setPrototypeOf(this,Fr.prototype)}}function D(r){return new Fr(r)}class le{static isEmptyObj(e){if(e)try{const t=JSON.parse(e);return Object.keys(t).length===0}catch{}return!0}static startsWith(e,t){return e.indexOf(t)===0}static endsWith(e,t){return e.length>=t.length&&e.lastIndexOf(t)===e.length-t.length}static queryStringToObject(e){const t={},n=e.split("&"),o=i=>decodeURIComponent(i.replace(/\+/g," "));return n.forEach(i=>{if(i.trim()){const[s,a]=i.split(/=(.+)/g,2);s&&a&&(t[o(s)]=o(a))}}),t}static trimArrayEntries(e){return e.map(t=>t.trim())}static removeEmptyStringsFromArray(e){return e.filter(t=>!!t)}static jsonParseHelper(e){try{return JSON.parse(e)}catch{return null}}static matchPattern(e,t){return new RegExp(e.replace(/\\/g,"\\\\").replace(/\*/g,"[^ ]*").replace(/\?/g,"\\?")).test(t)}}class q{constructor(e){const t=e?le.trimArrayEntries([...e]):[],n=t?le.removeEmptyStringsFromArray(t):[];if(!n||!n.length)throw D(ms);this.scopes=new Set,n.forEach(o=>this.scopes.add(o))}static fromString(e){const n=(e||p.EMPTY_STRING).split(" ");return new q(n)}static createSearchScopes(e){const t=e&&e.length>0?e:[...dt],n=new q(t);return n.containsOnlyOIDCScopes()?n.removeScope(p.OFFLINE_ACCESS_SCOPE):n.removeOIDCScopes(),n}containsScope(e){const t=this.printScopesLowerCase().split(" "),n=new q(t);return e?n.scopes.has(e.toLowerCase()):!1}containsScopeSet(e){return!e||e.scopes.size<=0?!1:this.scopes.size>=e.scopes.size&&e.asArray().every(t=>this.containsScope(t))}containsOnlyOIDCScopes(){let e=0;return $o.forEach(t=>{this.containsScope(t)&&(e+=1)}),this.scopes.size===e}appendScope(e){e&&this.scopes.add(e.trim())}appendScopes(e){try{e.forEach(t=>this.appendScope(t))}catch{throw y(ss)}}removeScope(e){if(!e)throw y(is);this.scopes.delete(e.trim())}removeOIDCScopes(){$o.forEach(e=>{this.scopes.delete(e)})}unionScopeSets(e){if(!e)throw y(nr);const t=new Set;return e.scopes.forEach(n=>t.add(n.toLowerCase())),this.scopes.forEach(n=>t.add(n.toLowerCase())),t}intersectingScopeSets(e){if(!e)throw y(nr);e.containsOnlyOIDCScopes()||e.removeOIDCScopes();const t=this.unionScopeSets(e),n=e.getScopeCount(),o=this.getScopeCount();return t.size<o+n}getScopeCount(){return this.scopes.size}asArray(){const e=[];return this.scopes.forEach(t=>e.push(t)),e}printScopes(){return this.scopes?this.asArray().join(" "):p.EMPTY_STRING}printScopesLowerCase(){return this.printScopes().toLowerCase()}}function Zt(r,e){if(!r)throw y(Qi);try{const t=e(r);return JSON.parse(t)}catch{throw y(br)}}function et(r){if(!r)throw y(br);const e=r.split(kt.CLIENT_INFO_SEPARATOR,2);return{uid:e[0],utid:e.length<2?p.EMPTY_STRING:e[1]}}function Vo(r,e){return!!r&&!!e&&r===e.split(".")[1]}function In(r,e,t,n){if(n){const{oid:o,sub:i,tid:s,name:a,tfp:c,acr:l,preferred_username:h,upn:u,login_hint:g}=n,m=s||c||l||"";return{tenantId:m,localAccountId:o||i||"",name:a,username:h||u||"",loginHint:g,isHomeTenant:Vo(m,r)}}else return{tenantId:t,localAccountId:e,username:"",isHomeTenant:Vo(t,r)}}function Br(r,e,t,n){let o=r;if(e){const{isHomeTenant:i,...s}=e;o={...r,...s}}if(t){const{isHomeTenant:i,...s}=In(r.homeAccountId,r.localAccountId,r.tenantId,t);return o={...o,...s,idTokenClaims:t,idToken:n},o}return o}const ge={Default:0,Adfs:1,Dsts:2,Ciam:3};function Kr(r){return r&&(r.tid||r.tfp||r.acr)||null}const oe={AAD:"AAD",OIDC:"OIDC",EAR:"EAR"};class B{static getAccountInfo(e){return{homeAccountId:e.homeAccountId,environment:e.environment,tenantId:e.realm,username:e.username,localAccountId:e.localAccountId,loginHint:e.loginHint,name:e.name,nativeAccountId:e.nativeAccountId,authorityType:e.authorityType,tenantProfiles:new Map((e.tenantProfiles||[]).map(t=>[t.tenantId,t])),dataBoundary:e.dataBoundary}}isSingleTenant(){return!this.tenantProfiles}static createAccount(e,t,n){const o=new B;t.authorityType===ge.Adfs?o.authorityType=xt.ADFS_ACCOUNT_TYPE:t.protocolMode===oe.OIDC?o.authorityType=xt.GENERIC_ACCOUNT_TYPE:o.authorityType=xt.MSSTS_ACCOUNT_TYPE;let i;e.clientInfo&&n&&(i=Zt(e.clientInfo,n),i.xms_tdbr&&(o.dataBoundary=i.xms_tdbr==="EU"?"EU":"None")),o.clientInfo=e.clientInfo,o.homeAccountId=e.homeAccountId,o.nativeAccountId=e.nativeAccountId;const s=e.environment||t&&t.getPreferredCache();if(!s)throw y(Or);o.environment=s,o.realm=i?.utid||Kr(e.idTokenClaims)||"",o.localAccountId=i?.uid||e.idTokenClaims?.oid||e.idTokenClaims?.sub||"";const a=e.idTokenClaims?.preferred_username||e.idTokenClaims?.upn,c=e.idTokenClaims?.emails?e.idTokenClaims.emails[0]:null;if(o.username=a||c||"",o.loginHint=e.idTokenClaims?.login_hint,o.name=e.idTokenClaims?.name||"",o.cloudGraphHostName=e.cloudGraphHostName,o.msGraphHost=e.msGraphHost,e.tenantProfiles)o.tenantProfiles=e.tenantProfiles;else{const l=In(e.homeAccountId,o.localAccountId,o.realm,e.idTokenClaims);o.tenantProfiles=[l]}return o}static createFromAccountInfo(e,t,n){const o=new B;return o.authorityType=e.authorityType||xt.GENERIC_ACCOUNT_TYPE,o.homeAccountId=e.homeAccountId,o.localAccountId=e.localAccountId,o.nativeAccountId=e.nativeAccountId,o.realm=e.tenantId,o.environment=e.environment,o.username=e.username,o.name=e.name,o.loginHint=e.loginHint,o.cloudGraphHostName=t,o.msGraphHost=n,o.tenantProfiles=Array.from(e.tenantProfiles?.values()||[]),o.dataBoundary=e.dataBoundary,o}static generateHomeAccountId(e,t,n,o,i){if(!(t===ge.Adfs||t===ge.Dsts)){if(e)try{const s=Zt(e,o.base64Decode);if(s.uid&&s.utid)return`${s.uid}.${s.utid}`}catch{}n.warning("No client info in response")}return i?.sub||""}static isAccountEntity(e){return e?e.hasOwnProperty("homeAccountId")&&e.hasOwnProperty("environment")&&e.hasOwnProperty("realm")&&e.hasOwnProperty("localAccountId")&&e.hasOwnProperty("username")&&e.hasOwnProperty("authorityType"):!1}static accountInfoIsEqual(e,t,n){if(!e||!t)return!1;let o=!0;if(n){const i=e.idTokenClaims||{},s=t.idTokenClaims||{};o=i.iat===s.iat&&i.nonce===s.nonce}return e.homeAccountId===t.homeAccountId&&e.localAccountId===t.localAccountId&&e.username===t.username&&e.tenantId===t.tenantId&&e.loginHint===t.loginHint&&e.environment===t.environment&&e.nativeAccountId===t.nativeAccountId&&o}}function Ae(r,e){const t=bd(r);try{const n=e(t);return JSON.parse(n)}catch{throw y(_r)}}function Ie(r){if(!r.signin_state)return!1;const e=["kmsi","dvc_dmjd"];return r.signin_state.some(n=>e.includes(n.trim().toLowerCase()))}function bd(r){if(!r)throw y(Yi);const t=/^([^\.\s]*)\.([^\.\s]+)\.([^\.\s]*)$/.exec(r);if(!t||t.length<4)throw y(_r);return t[2]}function _s(r,e){if(e===0||Date.now()-3e5>r+e)throw y(ns)}function Wo(r){if(!r)return r;let e=r.toLowerCase();return le.endsWith(e,"?")?e=e.slice(0,-1):le.endsWith(e,"?/")&&(e=e.slice(0,-2)),le.endsWith(e,"/")||(e+="/"),e}function Rs(r){return r.startsWith("#/")?r.substring(2):r.startsWith("#")||r.startsWith("?")?r.substring(1):r}function en(r){if(!r||r.indexOf("=")<0)return null;try{const e=Rs(r),t=Object.fromEntries(new URLSearchParams(e));if(t.code||t.ear_jwe||t.error||t.error_description||t.state)return t}catch{throw y(Zi)}return null}function bt(r,e=!0,t){const n=new Array;return r.forEach((o,i)=>{!e&&t&&i in t?n.push(`${i}=${o}`):n.push(`${i}=${encodeURIComponent(o)}`)}),n.join("&")}function Qo(r){if(!r)return r;const e=r.split("#")[0];try{const t=new URL(e),n=t.origin+t.pathname+t.search;return Wo(n)}catch{return Wo(e)}}class N{get urlString(){return this._urlString}constructor(e){if(this._urlString=e,!this._urlString)throw D(ps);e.includes("#")||(this._urlString=N.canonicalizeUri(e))}static canonicalizeUri(e){if(e){let t=e.toLowerCase();return le.endsWith(t,"?")?t=t.slice(0,-1):le.endsWith(t,"?/")&&(t=t.slice(0,-2)),le.endsWith(t,"/")||(t+="/"),t}return e}validateAsUri(){let e;try{e=this.getUrlComponents()}catch{throw D(Tt)}if(!e.HostNameAndPort||!e.PathSegments)throw D(Tt);if(!e.Protocol||e.Protocol.toLowerCase()!=="https:")throw D(fs)}static appendQueryString(e,t){return t?e.indexOf("?")<0?`${e}?${t}`:`${e}&${t}`:e}static removeHashFromUrl(e){return N.canonicalizeUri(e.split("#")[0])}replaceTenantPath(e){const t=this.getUrlComponents(),n=t.PathSegments;return e&&n.length!==0&&(n[0]===Ue.COMMON||n[0]===Ue.ORGANIZATIONS)&&(n[0]=e),N.constructAuthorityUriFromObject(t)}getUrlComponents(){const e=RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?"),t=this.urlString.match(e);if(!t)throw D(Tt);const n={Protocol:t[1],HostNameAndPort:t[4],AbsolutePath:t[5],QueryString:t[7]};let o=n.AbsolutePath.split("/");return o=o.filter(i=>i&&i.length>0),n.PathSegments=o,n.QueryString&&n.QueryString.endsWith("/")&&(n.QueryString=n.QueryString.substring(0,n.QueryString.length-1)),n}static getDomainFromUrl(e){const t=RegExp("^([^:/?#]+://)?([^/?#]*)"),n=e.match(t);if(!n)throw D(Tt);return n[2]}static getAbsoluteUrl(e,t){if(e[0]===p.FORWARD_SLASH){const o=new N(t).getUrlComponents();return o.Protocol+"//"+o.HostNameAndPort+e}return e}static constructAuthorityUriFromObject(e){return new N(e.Protocol+"//"+e.HostNameAndPort+"/"+e.PathSegments.join("/"))}static hashContainsKnownProperties(e){return!!en(e)}}const Ps={endpointMetadata:{"login.microsoftonline.com":{token_endpoint:"https://login.microsoftonline.com/{tenantid}/oauth2/v2.0/token",jwks_uri:"https://login.microsoftonline.com/{tenantid}/discovery/v2.0/keys",issuer:"https://login.microsoftonline.com/{tenantid}/v2.0",authorization_endpoint:"https://login.microsoftonline.com/{tenantid}/oauth2/v2.0/authorize",end_session_endpoint:"https://login.microsoftonline.com/{tenantid}/oauth2/v2.0/logout"},"login.chinacloudapi.cn":{token_endpoint:"https://login.chinacloudapi.cn/{tenantid}/oauth2/v2.0/token",jwks_uri:"https://login.chinacloudapi.cn/{tenantid}/discovery/v2.0/keys",issuer:"https://login.partner.microsoftonline.cn/{tenantid}/v2.0",authorization_endpoint:"https://login.chinacloudapi.cn/{tenantid}/oauth2/v2.0/authorize",end_session_endpoint:"https://login.chinacloudapi.cn/{tenantid}/oauth2/v2.0/logout"},"login.microsoftonline.us":{token_endpoint:"https://login.microsoftonline.us/{tenantid}/oauth2/v2.0/token",jwks_uri:"https://login.microsoftonline.us/{tenantid}/discovery/v2.0/keys",issuer:"https://login.microsoftonline.us/{tenantid}/v2.0",authorization_endpoint:"https://login.microsoftonline.us/{tenantid}/oauth2/v2.0/authorize",end_session_endpoint:"https://login.microsoftonline.us/{tenantid}/oauth2/v2.0/logout"}},instanceDiscoveryMetadata:{metadata:[{preferred_network:"login.microsoftonline.com",preferred_cache:"login.windows.net",aliases:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"]},{preferred_network:"login.partner.microsoftonline.cn",preferred_cache:"login.partner.microsoftonline.cn",aliases:["login.partner.microsoftonline.cn","login.chinacloudapi.cn"]},{preferred_network:"login.microsoftonline.de",preferred_cache:"login.microsoftonline.de",aliases:["login.microsoftonline.de"]},{preferred_network:"login.microsoftonline.us",preferred_cache:"login.microsoftonline.us",aliases:["login.microsoftonline.us","login.usgovcloudapi.net"]},{preferred_network:"login-us.microsoftonline.com",preferred_cache:"login-us.microsoftonline.com",aliases:["login-us.microsoftonline.com"]}]}},Yo=Ps.endpointMetadata,$r=Ps.instanceDiscoveryMetadata,Os=new Set;$r.metadata.forEach(r=>{r.aliases.forEach(e=>{Os.add(e)})});function _d(r,e){let t;const n=r.canonicalAuthority;if(n){const o=new N(n).getUrlComponents().HostNameAndPort;t=Jo(o,r.cloudDiscoveryMetadata?.metadata,ae.CONFIG,e)||Jo(o,$r.metadata,ae.HARDCODED_VALUES,e)||r.knownAuthorities}return t||[]}function Jo(r,e,t,n){if(n?.trace(`getAliasesFromMetadata called with source: ${t}`),r&&e){const o=tn(e,r);if(o)return n?.trace(`getAliasesFromMetadata: found cloud discovery metadata in ${t}, returning aliases`),o.aliases;n?.trace(`getAliasesFromMetadata: did not find cloud discovery metadata in ${t}`)}return null}function Rd(r){return tn($r.metadata,r)}function tn(r,e){for(let t=0;t<r.length;t++){const n=r[t];if(n.aliases.includes(e))return n}return null}const nn="cache_quota_exceeded",Gr="cache_error_unknown";const jn={[nn]:"Exceeded cache storage capacity.",[Gr]:"Unexpected error occurred when using cache storage."};class tt extends L{constructor(e,t){const n=t||(jn[e]?jn[e]:jn[Gr]);super(`${e}: ${n}`),Object.setPrototypeOf(this,tt.prototype),this.name="CacheError",this.errorCode=e,this.errorMessage=n}}function ir(r){return r instanceof Error?r.name==="QuotaExceededError"||r.name==="NS_ERROR_DOM_QUOTA_REACHED"||r.message.includes("exceeded the quota")?new tt(nn):new tt(r.name,r.message):new tt(Gr)}class sr{constructor(e,t,n,o,i){this.clientId=e,this.cryptoImpl=t,this.commonLogger=n.clone(us,Ur),this.staticAuthorityOptions=i,this.performanceClient=o}getAllAccounts(e,t){return this.buildTenantProfiles(this.getAccountsFilteredBy(e,t),t,e)}getAccountInfoFilteredBy(e,t){if(Object.keys(e).length===0||Object.values(e).every(o=>!o))return this.commonLogger.warning("getAccountInfoFilteredBy: Account filter is empty or invalid, returning null"),null;const n=this.getAllAccounts(e,t);return n.length>1?n.sort(i=>i.idTokenClaims?-1:1)[0]:n.length===1?n[0]:null}getBaseAccountInfo(e,t){const n=this.getAccountsFilteredBy(e,t);return n.length>0?B.getAccountInfo(n[0]):null}buildTenantProfiles(e,t,n){return e.flatMap(o=>this.getTenantProfilesFromAccountEntity(o,t,n?.tenantId,n))}getTenantedAccountInfoByFilter(e,t,n,o,i){let s=null,a;if(i&&!this.tenantProfileMatchesFilter(n,i))return null;const c=this.getIdToken(e,o,t,n.tenantId);return c&&(a=Ae(c.secret,this.cryptoImpl.base64Decode),!this.idTokenClaimsMatchTenantProfileFilter(a,i))?null:(s=Br(e,n,a,c?.secret),s)}getTenantProfilesFromAccountEntity(e,t,n,o){const i=B.getAccountInfo(e);let s=i.tenantProfiles||new Map;const a=this.getTokenKeys();if(n){const l=s.get(n);if(l)s=new Map([[n,l]]);else return[]}const c=[];return s.forEach(l=>{const h=this.getTenantedAccountInfoByFilter(i,a,l,t,o);h&&c.push(h)}),c}tenantProfileMatchesFilter(e,t){return!(t.localAccountId&&!this.matchLocalAccountIdFromTenantProfile(e,t.localAccountId)||t.name&&e.name!==t.name||t.isHomeTenant!==void 0&&e.isHomeTenant!==t.isHomeTenant)}idTokenClaimsMatchTenantProfileFilter(e,t){return!(t&&(t.localAccountId&&!this.matchLocalAccountIdFromTokenClaims(e,t.localAccountId)||t.loginHint&&!this.matchLoginHintFromTokenClaims(e,t.loginHint)||t.username&&!this.matchUsername(e.preferred_username,t.username)||t.name&&!this.matchName(e,t.name)||t.sid&&!this.matchSid(e,t.sid)))}async saveCacheRecord(e,t,n,o){if(!e)throw y(as);try{e.account&&await this.setAccount(e.account,t,n),e.idToken&&o?.idToken!==!1&&await this.setIdTokenCredential(e.idToken,t,n),e.accessToken&&o?.accessToken!==!1&&await this.saveAccessToken(e.accessToken,t,n),e.refreshToken&&o?.refreshToken!==!1&&await this.setRefreshTokenCredential(e.refreshToken,t,n),e.appMetadata&&this.setAppMetadata(e.appMetadata,t)}catch(i){throw this.commonLogger?.error("CacheManager.saveCacheRecord: failed"),i instanceof L?i:ir(i)}}async saveAccessToken(e,t,n){const o={clientId:e.clientId,credentialType:e.credentialType,environment:e.environment,homeAccountId:e.homeAccountId,realm:e.realm,tokenType:e.tokenType,requestedClaimsHash:e.requestedClaimsHash},i=this.getTokenKeys(),s=q.fromString(e.target);i.accessToken.forEach(a=>{if(!this.accessTokenKeyMatchesFilter(a,o,!1))return;const c=this.getAccessTokenCredential(a,t);c&&this.credentialMatchesFilter(c,o)&&q.fromString(c.target).intersectingScopeSets(s)&&this.removeAccessToken(a,t)}),await this.setAccessTokenCredential(e,t,n)}getAccountsFilteredBy(e,t){const n=this.getAccountKeys(),o=[];return n.forEach(i=>{const s=this.getAccount(i,t);if(!s||e.homeAccountId&&!this.matchHomeAccountId(s,e.homeAccountId)||e.username&&!this.matchUsername(s.username,e.username)||e.environment&&!this.matchEnvironment(s,e.environment)||e.realm&&!this.matchRealm(s,e.realm)||e.nativeAccountId&&!this.matchNativeAccountId(s,e.nativeAccountId)||e.authorityType&&!this.matchAuthorityType(s,e.authorityType))return;const a={localAccountId:e?.localAccountId,name:e?.name},c=s.tenantProfiles?.filter(l=>this.tenantProfileMatchesFilter(l,a));c&&c.length===0||o.push(s)}),o}credentialMatchesFilter(e,t){return!(t.clientId&&!this.matchClientId(e,t.clientId)||t.userAssertionHash&&!this.matchUserAssertionHash(e,t.userAssertionHash)||typeof t.homeAccountId=="string"&&!this.matchHomeAccountId(e,t.homeAccountId)||t.environment&&!this.matchEnvironment(e,t.environment)||t.realm&&!this.matchRealm(e,t.realm)||t.credentialType&&!this.matchCredentialType(e,t.credentialType)||t.familyId&&!this.matchFamilyId(e,t.familyId)||t.target&&!this.matchTarget(e,t.target)||(t.requestedClaimsHash||e.requestedClaimsHash)&&e.requestedClaimsHash!==t.requestedClaimsHash||e.credentialType===W.ACCESS_TOKEN_WITH_AUTH_SCHEME&&(t.tokenType&&!this.matchTokenType(e,t.tokenType)||t.tokenType===U.SSH&&t.keyId&&!this.matchKeyId(e,t.keyId)))}getAppMetadataFilteredBy(e){const t=this.getKeys(),n={};return t.forEach(o=>{if(!this.isAppMetadata(o))return;const i=this.getAppMetadata(o);i&&(e.environment&&!this.matchEnvironment(i,e.environment)||e.clientId&&!this.matchClientId(i,e.clientId)||(n[o]=i))}),n}getAuthorityMetadataByAlias(e){const t=this.getAuthorityMetadataKeys();let n=null;return t.forEach(o=>{if(!this.isAuthorityMetadata(o)||o.indexOf(this.clientId)===-1)return;const i=this.getAuthorityMetadata(o);i&&i.aliases.indexOf(e)!==-1&&(n=i)}),n}removeAllAccounts(e){this.getAllAccounts({},e).forEach(n=>{this.removeAccount(n,e)})}removeAccount(e,t){this.removeAccountContext(e,t);const n=this.getAccountKeys(),o=i=>i.includes(e.homeAccountId)&&i.includes(e.environment);n.filter(o).forEach(i=>{this.removeItem(i,t),this.performanceClient.incrementFields({accountsRemoved:1},t)})}removeAccountContext(e,t){const n=this.getTokenKeys(),o=i=>i.includes(e.homeAccountId)&&i.includes(e.environment);n.idToken.filter(o).forEach(i=>{this.removeIdToken(i,t)}),n.accessToken.filter(o).forEach(i=>{this.removeAccessToken(i,t)}),n.refreshToken.filter(o).forEach(i=>{this.removeRefreshToken(i,t)})}removeAccessToken(e,t){const n=this.getAccessTokenCredential(e,t);if(this.removeItem(e,t),this.performanceClient.incrementFields({accessTokensRemoved:1},t),!n||n.credentialType.toLowerCase()!==W.ACCESS_TOKEN_WITH_AUTH_SCHEME.toLowerCase()||n.tokenType!==U.POP)return;const o=n.keyId;o&&this.cryptoImpl.removeTokenBindingKey(o).catch(()=>{this.commonLogger.error(`Failed to remove token binding key ${o}`,t),this.performanceClient?.incrementFields({removeTokenBindingKeyFailure:1},t)})}removeAppMetadata(e){return this.getKeys().forEach(n=>{this.isAppMetadata(n)&&this.removeItem(n,e)}),!0}getIdToken(e,t,n,o,i){this.commonLogger.trace("CacheManager - getIdToken called");const s={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:W.ID_TOKEN,clientId:this.clientId,realm:o},a=this.getIdTokensByFilter(s,t,n),c=a.size;if(c<1)return this.commonLogger.info("CacheManager:getIdToken - No token found"),null;if(c>1){let l=a;if(!o){const h=new Map;a.forEach((g,m)=>{g.realm===e.tenantId&&h.set(m,g)});const u=h.size;if(u<1)return this.commonLogger.info("CacheManager:getIdToken - Multiple ID tokens found for account but none match account entity tenant id, returning first result"),a.values().next().value;if(u===1)return this.commonLogger.info("CacheManager:getIdToken - Multiple ID tokens found for account, defaulting to home tenant profile"),h.values().next().value;l=h}return this.commonLogger.info("CacheManager:getIdToken - Multiple matching ID tokens found, clearing them"),l.forEach((h,u)=>{this.removeIdToken(u,t)}),i&&t&&i.addFields({multiMatchedID:a.size},t),null}return this.commonLogger.info("CacheManager:getIdToken - Returning ID token"),a.values().next().value}getIdTokensByFilter(e,t,n){const o=n&&n.idToken||this.getTokenKeys().idToken,i=new Map;return o.forEach(s=>{if(!this.idTokenKeyMatchesFilter(s,{clientId:this.clientId,...e}))return;const a=this.getIdTokenCredential(s,t);a&&this.credentialMatchesFilter(a,e)&&i.set(s,a)}),i}idTokenKeyMatchesFilter(e,t){const n=e.toLowerCase();return!(t.clientId&&n.indexOf(t.clientId.toLowerCase())===-1||t.homeAccountId&&n.indexOf(t.homeAccountId.toLowerCase())===-1)}removeIdToken(e,t){this.removeItem(e,t)}removeRefreshToken(e,t){this.removeItem(e,t)}getAccessToken(e,t,n,o){const i=t.correlationId;this.commonLogger.trace("CacheManager - getAccessToken called",i);const s=q.createSearchScopes(t.scopes),a=t.authenticationScheme||U.BEARER,c=a.toLowerCase()!==U.BEARER.toLowerCase()?W.ACCESS_TOKEN_WITH_AUTH_SCHEME:W.ACCESS_TOKEN,l={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:c,clientId:this.clientId,realm:o||e.tenantId,target:s,tokenType:a,keyId:t.sshKid,requestedClaimsHash:t.requestedClaimsHash},h=n&&n.accessToken||this.getTokenKeys().accessToken,u=[];h.forEach(m=>{if(this.accessTokenKeyMatchesFilter(m,l,!0)){const I=this.getAccessTokenCredential(m,i);I&&this.credentialMatchesFilter(I,l)&&u.push(I)}});const g=u.length;return g<1?(this.commonLogger.info("CacheManager:getAccessToken - No token found",i),null):g>1?(this.commonLogger.info("CacheManager:getAccessToken - Multiple access tokens found, clearing them",i),u.forEach(m=>{this.removeAccessToken(this.generateCredentialKey(m),i)}),this.performanceClient.addFields({multiMatchedAT:u.length},i),null):(this.commonLogger.info("CacheManager:getAccessToken - Returning access token",i),u[0])}accessTokenKeyMatchesFilter(e,t,n){const o=e.toLowerCase();if(t.clientId&&o.indexOf(t.clientId.toLowerCase())===-1||t.homeAccountId&&o.indexOf(t.homeAccountId.toLowerCase())===-1||t.realm&&o.indexOf(t.realm.toLowerCase())===-1||t.requestedClaimsHash&&o.indexOf(t.requestedClaimsHash.toLowerCase())===-1)return!1;if(t.target){const i=t.target.asArray();for(let s=0;s<i.length;s++){if(n&&!o.includes(i[s].toLowerCase()))return!1;if(!n&&o.includes(i[s].toLowerCase()))return!0}}return!0}getAccessTokensByFilter(e,t){const n=this.getTokenKeys(),o=[];return n.accessToken.forEach(i=>{if(!this.accessTokenKeyMatchesFilter(i,e,!0))return;const s=this.getAccessTokenCredential(i,t);s&&this.credentialMatchesFilter(s,e)&&o.push(s)}),o}getRefreshToken(e,t,n,o,i){this.commonLogger.trace("CacheManager - getRefreshToken called");const s=t?Qt:void 0,a={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:W.REFRESH_TOKEN,clientId:this.clientId,familyId:s},c=o&&o.refreshToken||this.getTokenKeys().refreshToken,l=[];c.forEach(u=>{if(this.refreshTokenKeyMatchesFilter(u,a)){const g=this.getRefreshTokenCredential(u,n);g&&this.credentialMatchesFilter(g,a)&&l.push(g)}});const h=l.length;return h<1?(this.commonLogger.info("CacheManager:getRefreshToken - No refresh token found."),null):(h>1&&i&&n&&i.addFields({multiMatchedRT:h},n),this.commonLogger.info("CacheManager:getRefreshToken - returning refresh token"),l[0])}refreshTokenKeyMatchesFilter(e,t){const n=e.toLowerCase();return!(t.familyId&&n.indexOf(t.familyId.toLowerCase())===-1||!t.familyId&&t.clientId&&n.indexOf(t.clientId.toLowerCase())===-1||t.homeAccountId&&n.indexOf(t.homeAccountId.toLowerCase())===-1)}readAppMetadataFromCache(e){const t={environment:e,clientId:this.clientId},n=this.getAppMetadataFilteredBy(t),o=Object.keys(n).map(s=>n[s]),i=o.length;if(i<1)return null;if(i>1)throw y(rs);return o[0]}isAppMetadataFOCI(e){const t=this.readAppMetadataFromCache(e);return!!(t&&t.familyId===Qt)}matchHomeAccountId(e,t){return typeof e.homeAccountId=="string"&&t===e.homeAccountId}matchLocalAccountIdFromTokenClaims(e,t){const n=e.oid||e.sub;return t===n}matchLocalAccountIdFromTenantProfile(e,t){return e.localAccountId===t}matchName(e,t){return t.toLowerCase()===e.name?.toLowerCase()}matchUsername(e,t){return!!(e&&typeof e=="string"&&t?.toLowerCase()===e.toLowerCase())}matchUserAssertionHash(e,t){return!!(e.userAssertionHash&&t===e.userAssertionHash)}matchEnvironment(e,t){if(this.staticAuthorityOptions){const o=_d(this.staticAuthorityOptions,this.commonLogger);if(o.includes(t)&&o.includes(e.environment))return!0}const n=this.getAuthorityMetadataByAlias(t);return!!(n&&n.aliases.indexOf(e.environment)>-1)}matchCredentialType(e,t){return e.credentialType&&t.toLowerCase()===e.credentialType.toLowerCase()}matchClientId(e,t){return!!(e.clientId&&t===e.clientId)}matchFamilyId(e,t){return!!(e.familyId&&t===e.familyId)}matchRealm(e,t){return e.realm?.toLowerCase()===t.toLowerCase()}matchNativeAccountId(e,t){return!!(e.nativeAccountId&&t===e.nativeAccountId)}matchLoginHintFromTokenClaims(e,t){return e.login_hint===t||e.preferred_username===t||e.upn===t}matchSid(e,t){return e.sid===t}matchAuthorityType(e,t){return!!(e.authorityType&&t.toLowerCase()===e.authorityType.toLowerCase())}matchTarget(e,t){return e.credentialType!==W.ACCESS_TOKEN&&e.credentialType!==W.ACCESS_TOKEN_WITH_AUTH_SCHEME||!e.target?!1:q.fromString(e.target).containsScopeSet(t)}matchTokenType(e,t){return!!(e.tokenType&&e.tokenType===t)}matchKeyId(e,t){return!!(e.keyId&&e.keyId===t)}isAppMetadata(e){return e.indexOf(kr)!==-1}isAuthorityMetadata(e){return e.indexOf(Yt.CACHE_KEY)!==-1}generateAuthorityMetadataCacheKey(e){return`${Yt.CACHE_KEY}-${this.clientId}-${e}`}static toObject(e,t){for(const n in t)e[n]=t[n];return e}}class Pd extends sr{async setAccount(){throw y(_)}getAccount(){throw y(_)}async setIdTokenCredential(){throw y(_)}getIdTokenCredential(){throw y(_)}async setAccessTokenCredential(){throw y(_)}getAccessTokenCredential(){throw y(_)}async setRefreshTokenCredential(){throw y(_)}getRefreshTokenCredential(){throw y(_)}setAppMetadata(){throw y(_)}getAppMetadata(){throw y(_)}setServerTelemetry(){throw y(_)}getServerTelemetry(){throw y(_)}setAuthorityMetadata(){throw y(_)}getAuthorityMetadata(){throw y(_)}getAuthorityMetadataKeys(){throw y(_)}setThrottlingCache(){throw y(_)}getThrottlingCache(){throw y(_)}removeItem(){throw y(_)}getKeys(){throw y(_)}getAccountKeys(){throw y(_)}getTokenKeys(){throw y(_)}generateCredentialKey(){throw y(_)}generateAccountKey(){throw y(_)}}const d={AcquireTokenByCode:"acquireTokenByCode",AcquireTokenByRefreshToken:"acquireTokenByRefreshToken",AcquireTokenSilent:"acquireTokenSilent",AcquireTokenSilentAsync:"acquireTokenSilentAsync",AcquireTokenPopup:"acquireTokenPopup",AcquireTokenPreRedirect:"acquireTokenPreRedirect",AcquireTokenRedirect:"acquireTokenRedirect",CryptoOptsGetPublicKeyThumbprint:"cryptoOptsGetPublicKeyThumbprint",CryptoOptsSignJwt:"cryptoOptsSignJwt",SilentCacheClientAcquireToken:"silentCacheClientAcquireToken",SilentIframeClientAcquireToken:"silentIframeClientAcquireToken",AwaitConcurrentIframe:"awaitConcurrentIframe",SilentRefreshClientAcquireToken:"silentRefreshClientAcquireToken",SsoSilent:"ssoSilent",StandardInteractionClientGetDiscoveredAuthority:"standardInteractionClientGetDiscoveredAuthority",FetchAccountIdWithNativeBroker:"fetchAccountIdWithNativeBroker",NativeInteractionClientAcquireToken:"nativeInteractionClientAcquireToken",BaseClientCreateTokenRequestHeaders:"baseClientCreateTokenRequestHeaders",NetworkClientSendPostRequestAsync:"networkClientSendPostRequestAsync",RefreshTokenClientExecutePostToTokenEndpoint:"refreshTokenClientExecutePostToTokenEndpoint",AuthorizationCodeClientExecutePostToTokenEndpoint:"authorizationCodeClientExecutePostToTokenEndpoint",BrokerHandhshake:"brokerHandshake",AcquireTokenByRefreshTokenInBroker:"acquireTokenByRefreshTokenInBroker",AcquireTokenByBroker:"acquireTokenByBroker",RefreshTokenClientExecuteTokenRequest:"refreshTokenClientExecuteTokenRequest",RefreshTokenClientAcquireToken:"refreshTokenClientAcquireToken",RefreshTokenClientAcquireTokenWithCachedRefreshToken:"refreshTokenClientAcquireTokenWithCachedRefreshToken",RefreshTokenClientAcquireTokenByRefreshToken:"refreshTokenClientAcquireTokenByRefreshToken",RefreshTokenClientCreateTokenRequestBody:"refreshTokenClientCreateTokenRequestBody",AcquireTokenFromCache:"acquireTokenFromCache",SilentFlowClientAcquireCachedToken:"silentFlowClientAcquireCachedToken",SilentFlowClientGenerateResultFromCacheRecord:"silentFlowClientGenerateResultFromCacheRecord",AcquireTokenBySilentIframe:"acquireTokenBySilentIframe",InitializeBaseRequest:"initializeBaseRequest",InitializeSilentRequest:"initializeSilentRequest",InitializeClientApplication:"initializeClientApplication",InitializeCache:"initializeCache",SilentIframeClientTokenHelper:"silentIframeClientTokenHelper",SilentHandlerInitiateAuthRequest:"silentHandlerInitiateAuthRequest",SilentHandlerMonitorIframeForHash:"silentHandlerMonitorIframeForHash",SilentHandlerLoadFrame:"silentHandlerLoadFrame",SilentHandlerLoadFrameSync:"silentHandlerLoadFrameSync",StandardInteractionClientCreateAuthCodeClient:"standardInteractionClientCreateAuthCodeClient",StandardInteractionClientGetClientConfiguration:"standardInteractionClientGetClientConfiguration",StandardInteractionClientInitializeAuthorizationRequest:"standardInteractionClientInitializeAuthorizationRequest",GetAuthCodeUrl:"getAuthCodeUrl",GetStandardParams:"getStandardParams",HandleCodeResponseFromServer:"handleCodeResponseFromServer",HandleCodeResponse:"handleCodeResponse",HandleResponseEar:"handleResponseEar",HandleResponsePlatformBroker:"handleResponsePlatformBroker",HandleResponseCode:"handleResponseCode",UpdateTokenEndpointAuthority:"updateTokenEndpointAuthority",AuthClientAcquireToken:"authClientAcquireToken",AuthClientExecuteTokenRequest:"authClientExecuteTokenRequest",AuthClientCreateTokenRequestBody:"authClientCreateTokenRequestBody",PopTokenGenerateCnf:"popTokenGenerateCnf",PopTokenGenerateKid:"popTokenGenerateKid",HandleServerTokenResponse:"handleServerTokenResponse",DeserializeResponse:"deserializeResponse",AuthorityFactoryCreateDiscoveredInstance:"authorityFactoryCreateDiscoveredInstance",AuthorityResolveEndpointsAsync:"authorityResolveEndpointsAsync",AuthorityResolveEndpointsFromLocalSources:"authorityResolveEndpointsFromLocalSources",AuthorityGetCloudDiscoveryMetadataFromNetwork:"authorityGetCloudDiscoveryMetadataFromNetwork",AuthorityUpdateCloudDiscoveryMetadata:"authorityUpdateCloudDiscoveryMetadata",AuthorityGetEndpointMetadataFromNetwork:"authorityGetEndpointMetadataFromNetwork",AuthorityUpdateEndpointMetadata:"authorityUpdateEndpointMetadata",AuthorityUpdateMetadataWithRegionalInformation:"authorityUpdateMetadataWithRegionalInformation",RegionDiscoveryDetectRegion:"regionDiscoveryDetectRegion",RegionDiscoveryGetRegionFromIMDS:"regionDiscoveryGetRegionFromIMDS",RegionDiscoveryGetCurrentVersion:"regionDiscoveryGetCurrentVersion",AcquireTokenByCodeAsync:"acquireTokenByCodeAsync",GetEndpointMetadataFromNetwork:"getEndpointMetadataFromNetwork",GetCloudDiscoveryMetadataFromNetworkMeasurement:"getCloudDiscoveryMetadataFromNetworkMeasurement",HandleRedirectPromiseMeasurement:"handleRedirectPromise",HandleNativeRedirectPromiseMeasurement:"handleNativeRedirectPromise",UpdateCloudDiscoveryMetadataMeasurement:"updateCloudDiscoveryMetadataMeasurement",UsernamePasswordClientAcquireToken:"usernamePasswordClientAcquireToken",NativeMessageHandlerHandshake:"nativeMessageHandlerHandshake",NativeGenerateAuthResult:"nativeGenerateAuthResult",RemoveHiddenIframe:"removeHiddenIframe",ClearTokensAndKeysWithClaims:"clearTokensAndKeysWithClaims",CacheManagerGetRefreshToken:"cacheManagerGetRefreshToken",ImportExistingCache:"importExistingCache",SetUserData:"setUserData",LocalStorageUpdated:"localStorageUpdated",GeneratePkceCodes:"generatePkceCodes",GenerateCodeVerifier:"generateCodeVerifier",GenerateCodeChallengeFromVerifier:"generateCodeChallengeFromVerifier",Sha256Digest:"sha256Digest",GetRandomValues:"getRandomValues",GenerateHKDF:"generateHKDF",GenerateBaseKey:"generateBaseKey",Base64Decode:"base64Decode",UrlEncodeArr:"urlEncodeArr",Encrypt:"encrypt",Decrypt:"decrypt",GenerateEarKey:"generateEarKey",DecryptEarResponse:"decryptEarResponse"},Od={InProgress:1};class Xo{startMeasurement(){}endMeasurement(){}flushMeasurement(){return null}}class Ns{generateId(){return"callback-id"}startMeasurement(e,t){return{end:()=>null,discard:()=>{},add:()=>{},increment:()=>{},event:{eventId:this.generateId(),status:Od.InProgress,authority:"",libraryName:"",libraryVersion:"",clientId:"",name:e,startTimeMs:Date.now(),correlationId:t||""},measurement:new Xo}}startPerformanceMeasurement(){return new Xo}calculateQueuedTime(){return 0}addQueueMeasurement(){}setPreQueueTime(){}endMeasurement(){return null}discardMeasurements(){}removePerformanceCallback(){return!0}addPerformanceCallback(){return""}emitEvents(){}addFields(){}incrementFields(){}cacheEventByCorrelationId(){}}const Ms={tokenRenewalOffsetSeconds:Wi,preventCorsPreflight:!1},Nd={loggerCallback:()=>{},piiLoggingEnabled:!1,logLevel:H.Info,correlationId:p.EMPTY_STRING},Md={claimsBasedCachingEnabled:!1},Ud={async sendGetRequestAsync(){throw y(_)},async sendPostRequestAsync(){throw y(_)}},Dd={sku:p.SKU,version:Ur,cpu:p.EMPTY_STRING,os:p.EMPTY_STRING},Ld={clientSecret:p.EMPTY_STRING,clientAssertion:void 0},xd={azureCloudInstance:Dr.None,tenant:`${p.DEFAULT_COMMON_TENANT}`},Hd={application:{appName:"",appVersion:""}};function Fd({authOptions:r,systemOptions:e,loggerOptions:t,cacheOptions:n,storageInterface:o,networkInterface:i,cryptoInterface:s,clientCredentials:a,libraryInfo:c,telemetry:l,serverTelemetryManager:h,persistencePlugin:u,serializableCache:g}){const m={...Nd,...t};return{authOptions:Bd(r),systemOptions:{...Ms,...e},loggerOptions:m,cacheOptions:{...Md,...n},storageInterface:o||new Pd(r.clientId,Xt,new _e(m),new Ns),networkInterface:i||Ud,cryptoInterface:s||Xt,clientCredentials:a||Ld,libraryInfo:{...Dd,...c},telemetry:{...Hd,...l},serverTelemetryManager:h||null,persistencePlugin:u||null,serializableCache:g||null}}function Bd(r){return{clientCapabilities:[],azureCloudOptions:xd,skipAuthorityMetadataCache:!1,instanceAware:!1,encodeExtraQueryParams:!1,...r}}function Us(r){return r.authOptions.authority.options.protocolMode===oe.OIDC}const pe={HOME_ACCOUNT_ID:"home_account_id",UPN:"UPN"};const ze="client_id",Ds="redirect_uri",Kd="response_type",$d="response_mode",Gd="grant_type",zd="claims",qd="scope",jd="refresh_token",Vd="state",Wd="nonce",Qd="prompt",Yd="code",Jd="code_challenge",Xd="code_challenge_method",Zd="code_verifier",eh="client-request-id",th="x-client-SKU",nh="x-client-VER",rh="x-client-OS",oh="x-client-CPU",ih="x-client-current-telemetry",sh="x-client-last-telemetry",ah="x-ms-lib-capability",ch="x-app-name",lh="x-app-ver",dh="post_logout_redirect_uri",hh="id_token_hint",uh="client_secret",gh="client_assertion",fh="client_assertion_type",Ls="token_type",xs="req_cnf",Zo="return_spa_code",ph="nativebroker",mh="logout_hint",yh="sid",Ch="login_hint",Th="domain_hint",Ah="x-client-xtra-sku",rn="brk_client_id",on="brk_redirect_uri",ar="instance_aware",Ih="ear_jwk",wh="ear_jwe_crypto";function wn(r,e,t){if(!e)return;const n=r.get(ze);n&&r.has(rn)&&t?.addFields({embeddedClientId:n,embeddedRedirectUri:r.get(Ds)},e)}function zr(r,e){r.set(Kd,e)}function Eh(r,e){r.set($d,e||od.QUERY)}function vh(r){r.set(ph,"1")}function qr(r,e,t=!0,n=dt){t&&!n.includes("openid")&&!e.includes("openid")&&n.push("openid");const o=t?[...e||[],...n]:e||[],i=new q(o);r.set(qd,i.printScopes())}function jr(r,e){r.set(ze,e)}function Vr(r,e){r.set(Ds,e)}function Sh(r,e){r.set(dh,e)}function kh(r,e){r.set(hh,e)}function bh(r,e){r.set(Th,e)}function Ht(r,e){r.set(Ch,e)}function sn(r,e){r.set(te.CCS_HEADER,`UPN:${e}`)}function wt(r,e){r.set(te.CCS_HEADER,`Oid:${e.uid}@${e.utid}`)}function ei(r,e){r.set(yh,e)}function Wr(r,e,t){const n=Mh(e,t);try{JSON.parse(n)}catch{throw D(Lr)}r.set(zd,n)}function Qr(r,e){r.set(eh,e)}function Yr(r,e){r.set(th,e.sku),r.set(nh,e.version),e.os&&r.set(rh,e.os),e.cpu&&r.set(oh,e.cpu)}function Jr(r,e){e?.appName&&r.set(ch,e.appName),e?.appVersion&&r.set(lh,e.appVersion)}function _h(r,e){r.set(Qd,e)}function Hs(r,e){e&&r.set(Vd,e)}function Rh(r,e){r.set(Wd,e)}function Xr(r,e,t){if(e&&t)r.set(Jd,e),r.set(Xd,t);else throw D(xr)}function Ph(r,e){r.set(Yd,e)}function Oh(r,e){r.set(jd,e)}function Nh(r,e){r.set(Zd,e)}function Fs(r,e){r.set(uh,e)}function Bs(r,e){e&&r.set(gh,e)}function Ks(r,e){e&&r.set(fh,e)}function $s(r,e){r.set(Gd,e)}function Zr(r){r.set(id,"1")}function Gs(r){r.has(ar)||r.set(ar,"true")}function Le(r,e){Object.entries(e).forEach(([t,n])=>{!r.has(t)&&n&&r.set(t,n)})}function Mh(r,e){let t;if(!r)t={};else try{t=JSON.parse(r)}catch{throw D(Lr)}return e&&e.length>0&&(t.hasOwnProperty(Lt.ACCESS_TOKEN)||(t[Lt.ACCESS_TOKEN]={}),t[Lt.ACCESS_TOKEN][Lt.XMS_CC]={values:e}),JSON.stringify(t)}function eo(r,e){e&&(r.set(Ls,U.POP),r.set(xs,e))}function zs(r,e){e&&(r.set(Ls,U.SSH),r.set(xs,e))}function qs(r,e){r.set(ih,e.generateCurrentRequestHeaderValue()),r.set(sh,e.generateLastRequestHeaderValue())}function js(r){r.set(ah,It.X_MS_LIB_CAPABILITY_VALUE)}function Uh(r,e){r.set(mh,e)}function En(r,e,t){r.has(rn)||r.set(rn,e),r.has(on)||r.set(on,t)}function Dh(r,e){r.set(Ih,encodeURIComponent(e)),r.set(wh,"eyJhbGciOiJkaXIiLCJlbmMiOiJBMjU2R0NNIn0")}function Lh(r,e){Object.entries(e).forEach(([t,n])=>{n&&r.set(t,n)})}function xh(r){return r.hasOwnProperty("authorization_endpoint")&&r.hasOwnProperty("token_endpoint")&&r.hasOwnProperty("issuer")&&r.hasOwnProperty("jwks_uri")}function Hh(r){return r.hasOwnProperty("tenant_discovery_endpoint")&&r.hasOwnProperty("metadata")}function Fh(r){return r.hasOwnProperty("error")&&r.hasOwnProperty("error_description")}const de=(r,e,t,n,o)=>(...i)=>{t.trace(`Executing function ${e}`);const s=n?.startMeasurement(e,o);if(o){const a=e+"CallCount";n?.incrementFields({[a]:1},o)}try{const a=r(...i);return s?.end({success:!0}),t.trace(`Returning result from ${e}`),a}catch(a){t.trace(`Error occurred in ${e}`);try{t.trace(JSON.stringify(a))}catch{t.trace("Unable to print error message.")}throw s?.end({success:!1},a),a}},f=(r,e,t,n,o)=>(...i)=>{t.trace(`Executing function ${e}`);const s=n?.startMeasurement(e,o);if(o){const a=e+"CallCount";n?.incrementFields({[a]:1},o)}return n?.setPreQueueTime(e,o),r(...i).then(a=>(t.trace(`Returning result from ${e}`),s?.end({success:!0}),a)).catch(a=>{t.trace(`Error occurred in ${e}`);try{t.trace(JSON.stringify(a))}catch{t.trace("Unable to print error message.")}throw s?.end({success:!1},a),a})};class vn{constructor(e,t,n,o){this.networkInterface=e,this.logger=t,this.performanceClient=n,this.correlationId=o}async detectRegion(e,t){this.performanceClient?.addQueueMeasurement(d.RegionDiscoveryDetectRegion,this.correlationId);let n=e;if(n)t.region_source=Je.ENVIRONMENT_VARIABLE;else{const o=vn.IMDS_OPTIONS;try{const i=await f(this.getRegionFromIMDS.bind(this),d.RegionDiscoveryGetRegionFromIMDS,this.logger,this.performanceClient,this.correlationId)(p.IMDS_VERSION,o);if(i.status===Me.SUCCESS&&(n=i.body,t.region_source=Je.IMDS),i.status===Me.BAD_REQUEST){const s=await f(this.getCurrentVersion.bind(this),d.RegionDiscoveryGetCurrentVersion,this.logger,this.performanceClient,this.correlationId)(o);if(!s)return t.region_source=Je.FAILED_AUTO_DETECTION,null;const a=await f(this.getRegionFromIMDS.bind(this),d.RegionDiscoveryGetRegionFromIMDS,this.logger,this.performanceClient,this.correlationId)(s,o);a.status===Me.SUCCESS&&(n=a.body,t.region_source=Je.IMDS)}}catch{return t.region_source=Je.FAILED_AUTO_DETECTION,null}}return n||(t.region_source=Je.FAILED_AUTO_DETECTION),n||null}async getRegionFromIMDS(e,t){return this.performanceClient?.addQueueMeasurement(d.RegionDiscoveryGetRegionFromIMDS,this.correlationId),this.networkInterface.sendGetRequestAsync(`${p.IMDS_ENDPOINT}?api-version=${e}&format=text`,t,p.IMDS_TIMEOUT)}async getCurrentVersion(e){this.performanceClient?.addQueueMeasurement(d.RegionDiscoveryGetCurrentVersion,this.correlationId);try{const t=await this.networkInterface.sendGetRequestAsync(`${p.IMDS_ENDPOINT}?format=json`,e);return t.status===Me.BAD_REQUEST&&t.body&&t.body["newest-versions"]&&t.body["newest-versions"].length>0?t.body["newest-versions"][0]:null}catch{return null}}}vn.IMDS_OPTIONS={headers:{Metadata:"true"}};function ie(){return Math.round(new Date().getTime()/1e3)}function ti(r){return r.getTime()/1e3}function nt(r){return r?new Date(Number(r)*1e3):new Date}function an(r,e){const t=Number(r)||0;return ie()+e>t}function ni(r,e){const t=Number(r)+e*24*60*60*1e3;return Date.now()>t}function Bh(r){return Number(r)>ie()}function Sn(r,e,t,n,o){return{credentialType:W.ID_TOKEN,homeAccountId:r,environment:e,clientId:n,secret:t,realm:o,lastUpdatedAt:Date.now().toString()}}function kn(r,e,t,n,o,i,s,a,c,l,h,u,g,m,I){const w={homeAccountId:r,credentialType:W.ACCESS_TOKEN,secret:t,cachedAt:ie().toString(),expiresOn:s.toString(),extendedExpiresOn:a.toString(),environment:e,clientId:n,realm:o,target:i,tokenType:h||U.BEARER,lastUpdatedAt:Date.now().toString()};if(u&&(w.userAssertionHash=u),l&&(w.refreshOn=l.toString()),m&&(w.requestedClaims=m,w.requestedClaimsHash=I),w.tokenType?.toLowerCase()!==U.BEARER.toLowerCase())switch(w.credentialType=W.ACCESS_TOKEN_WITH_AUTH_SCHEME,w.tokenType){case U.POP:const P=Ae(t,c);if(!P?.cnf?.kid)throw y(cs);w.keyId=P.cnf.kid;break;case U.SSH:w.keyId=g}return w}function Vs(r,e,t,n,o,i,s){const a={credentialType:W.REFRESH_TOKEN,homeAccountId:r,environment:e,clientId:n,secret:t,lastUpdatedAt:Date.now().toString()};return i&&(a.userAssertionHash=i),o&&(a.familyId=o),s&&(a.expiresOn=s.toString()),a}function bn(r){return r.hasOwnProperty("homeAccountId")&&r.hasOwnProperty("environment")&&r.hasOwnProperty("credentialType")&&r.hasOwnProperty("clientId")&&r.hasOwnProperty("secret")}function ri(r){return r?bn(r)&&r.hasOwnProperty("realm")&&r.hasOwnProperty("target")&&(r.credentialType===W.ACCESS_TOKEN||r.credentialType===W.ACCESS_TOKEN_WITH_AUTH_SCHEME):!1}function Kh(r){return r?bn(r)&&r.hasOwnProperty("realm")&&r.credentialType===W.ID_TOKEN:!1}function oi(r){return r?bn(r)&&r.credentialType===W.REFRESH_TOKEN:!1}function $h(r,e){const t=r.indexOf(V.CACHE_KEY)===0;let n=!0;return e&&(n=e.hasOwnProperty("failedRequests")&&e.hasOwnProperty("errors")&&e.hasOwnProperty("cacheHits")),t&&n}function Gh(r,e){let t=!1;r&&(t=r.indexOf(It.THROTTLING_PREFIX)===0);let n=!0;return e&&(n=e.hasOwnProperty("throttleTime")),t&&n}function zh({environment:r,clientId:e}){return[kr,r,e].join(kt.CACHE_KEY_SEPARATOR).toLowerCase()}function qh(r,e){return e?r.indexOf(kr)===0&&e.hasOwnProperty("clientId")&&e.hasOwnProperty("environment"):!1}function jh(r,e){return e?r.indexOf(Yt.CACHE_KEY)===0&&e.hasOwnProperty("aliases")&&e.hasOwnProperty("preferred_cache")&&e.hasOwnProperty("preferred_network")&&e.hasOwnProperty("canonical_authority")&&e.hasOwnProperty("authorization_endpoint")&&e.hasOwnProperty("token_endpoint")&&e.hasOwnProperty("issuer")&&e.hasOwnProperty("aliasesFromNetwork")&&e.hasOwnProperty("endpointsFromNetwork")&&e.hasOwnProperty("expiresAt")&&e.hasOwnProperty("jwks_uri"):!1}function ii(){return ie()+Yt.REFRESH_TIME_SECONDS}function Ft(r,e,t){r.authorization_endpoint=e.authorization_endpoint,r.token_endpoint=e.token_endpoint,r.end_session_endpoint=e.end_session_endpoint,r.issuer=e.issuer,r.endpointsFromNetwork=t,r.jwks_uri=e.jwks_uri}function Vn(r,e,t){r.aliases=e.aliases,r.preferred_cache=e.preferred_cache,r.preferred_network=e.preferred_network,r.aliasesFromNetwork=t}function si(r){return r.expiresAt<=ie()}class X{constructor(e,t,n,o,i,s,a,c){this.canonicalAuthority=e,this._canonicalAuthority.validateAsUri(),this.networkInterface=t,this.cacheManager=n,this.authorityOptions=o,this.regionDiscoveryMetadata={region_used:void 0,region_source:void 0,region_outcome:void 0},this.logger=i,this.performanceClient=a,this.correlationId=s,this.managedIdentity=c||!1,this.regionDiscovery=new vn(t,this.logger,this.performanceClient,this.correlationId)}getAuthorityType(e){if(e.HostNameAndPort.endsWith(p.CIAM_AUTH_URL))return ge.Ciam;const t=e.PathSegments;if(t.length)switch(t[0].toLowerCase()){case p.ADFS:return ge.Adfs;case p.DSTS:return ge.Dsts}return ge.Default}get authorityType(){return this.getAuthorityType(this.canonicalAuthorityUrlComponents)}get protocolMode(){return this.authorityOptions.protocolMode}get options(){return this.authorityOptions}get canonicalAuthority(){return this._canonicalAuthority.urlString}set canonicalAuthority(e){this._canonicalAuthority=new N(e),this._canonicalAuthority.validateAsUri(),this._canonicalAuthorityUrlComponents=null}get canonicalAuthorityUrlComponents(){return this._canonicalAuthorityUrlComponents||(this._canonicalAuthorityUrlComponents=this._canonicalAuthority.getUrlComponents()),this._canonicalAuthorityUrlComponents}get hostnameAndPort(){return this.canonicalAuthorityUrlComponents.HostNameAndPort.toLowerCase()}get tenant(){return this.canonicalAuthorityUrlComponents.PathSegments[0]}get authorizationEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.authorization_endpoint);throw y(ke)}get tokenEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.token_endpoint);throw y(ke)}get deviceCodeEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.token_endpoint.replace("/token","/devicecode"));throw y(ke)}get endSessionEndpoint(){if(this.discoveryComplete()){if(!this.metadata.end_session_endpoint)throw y(hs);return this.replacePath(this.metadata.end_session_endpoint)}else throw y(ke)}get selfSignedJwtAudience(){if(this.discoveryComplete())return this.replacePath(this.metadata.issuer);throw y(ke)}get jwksUri(){if(this.discoveryComplete())return this.replacePath(this.metadata.jwks_uri);throw y(ke)}canReplaceTenant(e){return e.PathSegments.length===1&&!X.reservedTenantDomains.has(e.PathSegments[0])&&this.getAuthorityType(e)===ge.Default&&this.protocolMode!==oe.OIDC}replaceTenant(e){return e.replace(/{tenant}|{tenantid}/g,this.tenant)}replacePath(e){let t=e;const o=new N(this.metadata.canonical_authority).getUrlComponents(),i=o.PathSegments;return this.canonicalAuthorityUrlComponents.PathSegments.forEach((a,c)=>{let l=i[c];if(c===0&&this.canReplaceTenant(o)){const h=new N(this.metadata.authorization_endpoint).getUrlComponents().PathSegments[0];l!==h&&(this.logger.verbose(`Replacing tenant domain name ${l} with id ${h}`),l=h)}a!==l&&(t=t.replace(`/${l}/`,`/${a}/`))}),this.replaceTenant(t)}get defaultOpenIdConfigurationEndpoint(){const e=this.hostnameAndPort;return this.canonicalAuthority.endsWith("v2.0/")||this.authorityType===ge.Adfs||this.protocolMode===oe.OIDC&&!this.isAliasOfKnownMicrosoftAuthority(e)?`${this.canonicalAuthority}.well-known/openid-configuration`:`${this.canonicalAuthority}v2.0/.well-known/openid-configuration`}discoveryComplete(){return!!this.metadata}async resolveEndpointsAsync(){this.performanceClient?.addQueueMeasurement(d.AuthorityResolveEndpointsAsync,this.correlationId);const e=this.getCurrentMetadataEntity(),t=await f(this.updateCloudDiscoveryMetadata.bind(this),d.AuthorityUpdateCloudDiscoveryMetadata,this.logger,this.performanceClient,this.correlationId)(e);this.canonicalAuthority=this.canonicalAuthority.replace(this.hostnameAndPort,e.preferred_network);const n=await f(this.updateEndpointMetadata.bind(this),d.AuthorityUpdateEndpointMetadata,this.logger,this.performanceClient,this.correlationId)(e);this.updateCachedMetadata(e,t,{source:n}),this.performanceClient?.addFields({cloudDiscoverySource:t,authorityEndpointSource:n},this.correlationId)}getCurrentMetadataEntity(){let e=this.cacheManager.getAuthorityMetadataByAlias(this.hostnameAndPort);return e||(e={aliases:[],preferred_cache:this.hostnameAndPort,preferred_network:this.hostnameAndPort,canonical_authority:this.canonicalAuthority,authorization_endpoint:"",token_endpoint:"",end_session_endpoint:"",issuer:"",aliasesFromNetwork:!1,endpointsFromNetwork:!1,expiresAt:ii(),jwks_uri:""}),e}updateCachedMetadata(e,t,n){t!==ae.CACHE&&n?.source!==ae.CACHE&&(e.expiresAt=ii(),e.canonical_authority=this.canonicalAuthority);const o=this.cacheManager.generateAuthorityMetadataCacheKey(e.preferred_cache);this.cacheManager.setAuthorityMetadata(o,e),this.metadata=e}async updateEndpointMetadata(e){this.performanceClient?.addQueueMeasurement(d.AuthorityUpdateEndpointMetadata,this.correlationId);const t=this.updateEndpointMetadataFromLocalSources(e);if(t){if(t.source===ae.HARDCODED_VALUES&&this.authorityOptions.azureRegionConfiguration?.azureRegion&&t.metadata){const o=await f(this.updateMetadataWithRegionalInformation.bind(this),d.AuthorityUpdateMetadataWithRegionalInformation,this.logger,this.performanceClient,this.correlationId)(t.metadata);Ft(e,o,!1),e.canonical_authority=this.canonicalAuthority}return t.source}let n=await f(this.getEndpointMetadataFromNetwork.bind(this),d.AuthorityGetEndpointMetadataFromNetwork,this.logger,this.performanceClient,this.correlationId)();if(n)return this.authorityOptions.azureRegionConfiguration?.azureRegion&&(n=await f(this.updateMetadataWithRegionalInformation.bind(this),d.AuthorityUpdateMetadataWithRegionalInformation,this.logger,this.performanceClient,this.correlationId)(n)),Ft(e,n,!0),ae.NETWORK;throw y(Xi,this.defaultOpenIdConfigurationEndpoint)}updateEndpointMetadataFromLocalSources(e){this.logger.verbose("Attempting to get endpoint metadata from authority configuration");const t=this.getEndpointMetadataFromConfig();if(t)return this.logger.verbose("Found endpoint metadata in authority configuration"),Ft(e,t,!1),{source:ae.CONFIG};if(this.logger.verbose("Did not find endpoint metadata in the config... Attempting to get endpoint metadata from the hardcoded values."),this.authorityOptions.skipAuthorityMetadataCache)this.logger.verbose("Skipping hardcoded metadata cache since skipAuthorityMetadataCache is set to true. Attempting to get endpoint metadata from the network metadata cache.");else{const o=this.getEndpointMetadataFromHardcodedValues();if(o)return Ft(e,o,!1),{source:ae.HARDCODED_VALUES,metadata:o};this.logger.verbose("Did not find endpoint metadata in hardcoded values... Attempting to get endpoint metadata from the network metadata cache.")}const n=si(e);return this.isAuthoritySameType(e)&&e.endpointsFromNetwork&&!n?(this.logger.verbose("Found endpoint metadata in the cache."),{source:ae.CACHE}):(n&&this.logger.verbose("The metadata entity is expired."),null)}isAuthoritySameType(e){return new N(e.canonical_authority).getUrlComponents().PathSegments.length===this.canonicalAuthorityUrlComponents.PathSegments.length}getEndpointMetadataFromConfig(){if(this.authorityOptions.authorityMetadata)try{return JSON.parse(this.authorityOptions.authorityMetadata)}catch{throw D(Ts)}return null}async getEndpointMetadataFromNetwork(){this.performanceClient?.addQueueMeasurement(d.AuthorityGetEndpointMetadataFromNetwork,this.correlationId);const e={},t=this.defaultOpenIdConfigurationEndpoint;this.logger.verbose(`Authority.getEndpointMetadataFromNetwork: attempting to retrieve OAuth endpoints from ${t}`);try{const n=await this.networkInterface.sendGetRequestAsync(t,e);return xh(n.body)?n.body:(this.logger.verbose("Authority.getEndpointMetadataFromNetwork: could not parse response as OpenID configuration"),null)}catch(n){return this.logger.verbose(`Authority.getEndpointMetadataFromNetwork: ${n}`),null}}getEndpointMetadataFromHardcodedValues(){return this.hostnameAndPort in Yo?Yo[this.hostnameAndPort]:null}async updateMetadataWithRegionalInformation(e){this.performanceClient?.addQueueMeasurement(d.AuthorityUpdateMetadataWithRegionalInformation,this.correlationId);const t=this.authorityOptions.azureRegionConfiguration?.azureRegion;if(t){if(t!==p.AZURE_REGION_AUTO_DISCOVER_FLAG)return this.regionDiscoveryMetadata.region_outcome=qn.CONFIGURED_NO_AUTO_DETECTION,this.regionDiscoveryMetadata.region_used=t,X.replaceWithRegionalInformation(e,t);const n=await f(this.regionDiscovery.detectRegion.bind(this.regionDiscovery),d.RegionDiscoveryDetectRegion,this.logger,this.performanceClient,this.correlationId)(this.authorityOptions.azureRegionConfiguration?.environmentRegion,this.regionDiscoveryMetadata);if(n)return this.regionDiscoveryMetadata.region_outcome=qn.AUTO_DETECTION_REQUESTED_SUCCESSFUL,this.regionDiscoveryMetadata.region_used=n,X.replaceWithRegionalInformation(e,n);this.regionDiscoveryMetadata.region_outcome=qn.AUTO_DETECTION_REQUESTED_FAILED}return e}async updateCloudDiscoveryMetadata(e){this.performanceClient?.addQueueMeasurement(d.AuthorityUpdateCloudDiscoveryMetadata,this.correlationId);const t=this.updateCloudDiscoveryMetadataFromLocalSources(e);if(t)return t;const n=await f(this.getCloudDiscoveryMetadataFromNetwork.bind(this),d.AuthorityGetCloudDiscoveryMetadataFromNetwork,this.logger,this.performanceClient,this.correlationId)();if(n)return Vn(e,n,!0),ae.NETWORK;throw D(As)}updateCloudDiscoveryMetadataFromLocalSources(e){this.logger.verbose("Attempting to get cloud discovery metadata  from authority configuration"),this.logger.verbosePii(`Known Authorities: ${this.authorityOptions.knownAuthorities||p.NOT_APPLICABLE}`),this.logger.verbosePii(`Authority Metadata: ${this.authorityOptions.authorityMetadata||p.NOT_APPLICABLE}`),this.logger.verbosePii(`Canonical Authority: ${e.canonical_authority||p.NOT_APPLICABLE}`);const t=this.getCloudDiscoveryMetadataFromConfig();if(t)return this.logger.verbose("Found cloud discovery metadata in authority configuration"),Vn(e,t,!1),ae.CONFIG;if(this.logger.verbose("Did not find cloud discovery metadata in the config... Attempting to get cloud discovery metadata from the hardcoded values."),this.options.skipAuthorityMetadataCache)this.logger.verbose("Skipping hardcoded cloud discovery metadata cache since skipAuthorityMetadataCache is set to true. Attempting to get cloud discovery metadata from the network metadata cache.");else{const o=Rd(this.hostnameAndPort);if(o)return this.logger.verbose("Found cloud discovery metadata from hardcoded values."),Vn(e,o,!1),ae.HARDCODED_VALUES;this.logger.verbose("Did not find cloud discovery metadata in hardcoded values... Attempting to get cloud discovery metadata from the network metadata cache.")}const n=si(e);return this.isAuthoritySameType(e)&&e.aliasesFromNetwork&&!n?(this.logger.verbose("Found cloud discovery metadata in the cache."),ae.CACHE):(n&&this.logger.verbose("The metadata entity is expired."),null)}getCloudDiscoveryMetadataFromConfig(){if(this.authorityType===ge.Ciam)return this.logger.verbose("CIAM authorities do not support cloud discovery metadata, generate the aliases from authority host."),X.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort);if(this.authorityOptions.cloudDiscoveryMetadata){this.logger.verbose("The cloud discovery metadata has been provided as a network response, in the config.");try{this.logger.verbose("Attempting to parse the cloud discovery metadata.");const e=JSON.parse(this.authorityOptions.cloudDiscoveryMetadata),t=tn(e.metadata,this.hostnameAndPort);if(this.logger.verbose("Parsed the cloud discovery metadata."),t)return this.logger.verbose("There is returnable metadata attached to the parsed cloud discovery metadata."),t;this.logger.verbose("There is no metadata attached to the parsed cloud discovery metadata.")}catch{throw this.logger.verbose("Unable to parse the cloud discovery metadata. Throwing Invalid Cloud Discovery Metadata Error."),D(Hr)}}return this.isInKnownAuthorities()?(this.logger.verbose("The host is included in knownAuthorities. Creating new cloud discovery metadata from the host."),X.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort)):null}async getCloudDiscoveryMetadataFromNetwork(){this.performanceClient?.addQueueMeasurement(d.AuthorityGetCloudDiscoveryMetadataFromNetwork,this.correlationId);const e=`${p.AAD_INSTANCE_DISCOVERY_ENDPT}${this.canonicalAuthority}oauth2/v2.0/authorize`,t={};let n=null;try{const o=await this.networkInterface.sendGetRequestAsync(e,t);let i,s;if(Hh(o.body))i=o.body,s=i.metadata,this.logger.verbosePii(`tenant_discovery_endpoint is: ${i.tenant_discovery_endpoint}`);else if(Fh(o.body)){if(this.logger.warning(`A CloudInstanceDiscoveryErrorResponse was returned. The cloud instance discovery network request's status code is: ${o.status}`),i=o.body,i.error===p.INVALID_INSTANCE)return this.logger.error("The CloudInstanceDiscoveryErrorResponse error is invalid_instance."),null;this.logger.warning(`The CloudInstanceDiscoveryErrorResponse error is ${i.error}`),this.logger.warning(`The CloudInstanceDiscoveryErrorResponse error description is ${i.error_description}`),this.logger.warning("Setting the value of the CloudInstanceDiscoveryMetadata (returned from the network) to []"),s=[]}else return this.logger.error("AAD did not return a CloudInstanceDiscoveryResponse or CloudInstanceDiscoveryErrorResponse"),null;this.logger.verbose("Attempting to find a match between the developer's authority and the CloudInstanceDiscoveryMetadata returned from the network request."),n=tn(s,this.hostnameAndPort)}catch(o){if(o instanceof L)this.logger.error(`There was a network error while attempting to get the cloud discovery instance metadata.
Error: ${o.errorCode}
Error Description: ${o.errorMessage}`);else{const i=o;this.logger.error(`A non-MSALJS error was thrown while attempting to get the cloud instance discovery metadata.
Error: ${i.name}
Error Description: ${i.message}`)}return null}return n||(this.logger.warning("The developer's authority was not found within the CloudInstanceDiscoveryMetadata returned from the network request."),this.logger.verbose("Creating custom Authority for custom domain scenario."),n=X.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort)),n}isInKnownAuthorities(){return this.authorityOptions.knownAuthorities.filter(t=>t&&N.getDomainFromUrl(t).toLowerCase()===this.hostnameAndPort).length>0}static generateAuthority(e,t){let n;if(t&&t.azureCloudInstance!==Dr.None){const o=t.tenant?t.tenant:p.DEFAULT_COMMON_TENANT;n=`${t.azureCloudInstance}/${o}/`}return n||e}static createCloudDiscoveryMetadataFromHost(e){return{preferred_network:e,preferred_cache:e,aliases:[e]}}getPreferredCache(){if(this.managedIdentity)return p.DEFAULT_AUTHORITY_HOST;if(this.discoveryComplete())return this.metadata.preferred_cache;throw y(ke)}isAlias(e){return this.metadata.aliases.indexOf(e)>-1}isAliasOfKnownMicrosoftAuthority(e){return Os.has(e)}static isPublicCloudAuthority(e){return p.KNOWN_PUBLIC_CLOUDS.indexOf(e)>=0}static buildRegionalAuthorityString(e,t,n){const o=new N(e);o.validateAsUri();const i=o.getUrlComponents();let s=`${t}.${i.HostNameAndPort}`;this.isPublicCloudAuthority(i.HostNameAndPort)&&(s=`${t}.${p.REGIONAL_AUTH_PUBLIC_CLOUD_SUFFIX}`);const a=N.constructAuthorityUriFromObject({...o.getUrlComponents(),HostNameAndPort:s}).urlString;return n?`${a}?${n}`:a}static replaceWithRegionalInformation(e,t){const n={...e};return n.authorization_endpoint=X.buildRegionalAuthorityString(n.authorization_endpoint,t),n.token_endpoint=X.buildRegionalAuthorityString(n.token_endpoint,t),n.end_session_endpoint&&(n.end_session_endpoint=X.buildRegionalAuthorityString(n.end_session_endpoint,t)),n}static transformCIAMAuthority(e){let t=e;const o=new N(e).getUrlComponents();if(o.PathSegments.length===0&&o.HostNameAndPort.endsWith(p.CIAM_AUTH_URL)){const i=o.HostNameAndPort.split(".")[0];t=`${t}${i}${p.AAD_TENANT_DOMAIN_SUFFIX}`}return t}}X.reservedTenantDomains=new Set(["{tenant}","{tenantid}",Ue.COMMON,Ue.CONSUMERS,Ue.ORGANIZATIONS]);function Vh(r){const n=new N(r).getUrlComponents().PathSegments.slice(-1)[0]?.toLowerCase();switch(n){case Ue.COMMON:case Ue.ORGANIZATIONS:case Ue.CONSUMERS:return;default:return n}}function Ws(r){return r.endsWith(p.FORWARD_SLASH)?r:`${r}${p.FORWARD_SLASH}`}function Wh(r){const e=r.cloudDiscoveryMetadata;let t;if(e)try{t=JSON.parse(e)}catch{throw D(Hr)}return{canonicalAuthority:r.authority?Ws(r.authority):void 0,knownAuthorities:r.knownAuthorities,cloudDiscoveryMetadata:t}}async function Qs(r,e,t,n,o,i,s){s?.addQueueMeasurement(d.AuthorityFactoryCreateDiscoveredInstance,i);const a=X.transformCIAMAuthority(Ws(r)),c=new X(a,e,t,n,o,i,s);try{return await f(c.resolveEndpointsAsync.bind(c),d.AuthorityResolveEndpointsAsync,o,s,i)(),c}catch{throw y(ke)}}class Ye extends L{constructor(e,t,n,o,i){super(e,t,n),this.name="ServerError",this.errorNo=o,this.status=i,Object.setPrototypeOf(this,Ye.prototype)}}function _n(r,e,t){return{clientId:r,authority:e.authority,scopes:e.scopes,homeAccountIdentifier:t,claims:e.claims,authenticationScheme:e.authenticationScheme,resourceRequestMethod:e.resourceRequestMethod,resourceRequestUri:e.resourceRequestUri,shrClaims:e.shrClaims,sshKid:e.sshKid,embeddedClientId:e.embeddedClientId||e.tokenBodyParameters?.clientId}}class Ce{static generateThrottlingStorageKey(e){return`${It.THROTTLING_PREFIX}.${JSON.stringify(e)}`}static preProcess(e,t,n){const o=Ce.generateThrottlingStorageKey(t),i=e.getThrottlingCache(o);if(i){if(i.throttleTime<Date.now()){e.removeItem(o,n);return}throw new Ye(i.errorCodes?.join(" ")||p.EMPTY_STRING,i.errorMessage,i.subError)}}static postProcess(e,t,n,o){if(Ce.checkResponseStatus(n)||Ce.checkResponseForRetryAfter(n)){const i={throttleTime:Ce.calculateThrottleTime(parseInt(n.headers[te.RETRY_AFTER])),error:n.body.error,errorCodes:n.body.error_codes,errorMessage:n.body.error_description,subError:n.body.suberror};e.setThrottlingCache(Ce.generateThrottlingStorageKey(t),i,o)}}static checkResponseStatus(e){return e.status===429||e.status>=500&&e.status<600}static checkResponseForRetryAfter(e){return e.headers?e.headers.hasOwnProperty(te.RETRY_AFTER)&&(e.status<200||e.status>=300):!1}static calculateThrottleTime(e){const t=e<=0?0:e,n=Date.now()/1e3;return Math.floor(Math.min(n+(t||It.DEFAULT_THROTTLE_TIME_SECONDS),n+It.DEFAULT_MAX_THROTTLE_TIME_SECONDS)*1e3)}static removeThrottle(e,t,n,o){const i=_n(t,n,o),s=this.generateThrottlingStorageKey(i);e.removeItem(s,n.correlationId)}}class Rn extends L{constructor(e,t,n){super(e.errorCode,e.errorMessage,e.subError),Object.setPrototypeOf(this,Rn.prototype),this.name="NetworkError",this.error=e,this.httpStatus=t,this.responseHeaders=n}}function At(r,e,t,n){return r.errorMessage=`${r.errorMessage}, additionalErrorInfo: error.name:${n?.name}, error.message:${n?.message}`,new Rn(r,e,t)}class to{constructor(e,t){this.config=Fd(e),this.logger=new _e(this.config.loggerOptions,us,Ur),this.cryptoUtils=this.config.cryptoInterface,this.cacheManager=this.config.storageInterface,this.networkClient=this.config.networkInterface,this.serverTelemetryManager=this.config.serverTelemetryManager,this.authority=this.config.authOptions.authority,this.performanceClient=t}createTokenRequestHeaders(e){const t={};if(t[te.CONTENT_TYPE]=p.URL_FORM_CONTENT_TYPE,!this.config.systemOptions.preventCorsPreflight&&e)switch(e.type){case pe.HOME_ACCOUNT_ID:try{const n=et(e.credential);t[te.CCS_HEADER]=`Oid:${n.uid}@${n.utid}`}catch(n){this.logger.verbose("Could not parse home account ID for CCS Header: "+n)}break;case pe.UPN:t[te.CCS_HEADER]=`UPN: ${e.credential}`;break}return t}async executePostToTokenEndpoint(e,t,n,o,i,s){s&&this.performanceClient?.addQueueMeasurement(s,i);const a=await this.sendPostRequest(o,e,{body:t,headers:n},i);return this.config.serverTelemetryManager&&a.status<500&&a.status!==429&&this.config.serverTelemetryManager.clearTelemetryCache(),a}async sendPostRequest(e,t,n,o){Ce.preProcess(this.cacheManager,e,o);let i;try{i=await f(this.networkClient.sendPostRequestAsync.bind(this.networkClient),d.NetworkClientSendPostRequestAsync,this.logger,this.performanceClient,o)(t,n);const s=i.headers||{};this.performanceClient?.addFields({refreshTokenSize:i.body.refresh_token?.length||0,httpVerToken:s[te.X_MS_HTTP_VERSION]||"",requestId:s[te.X_MS_REQUEST_ID]||""},o)}catch(s){if(s instanceof Rn){const a=s.responseHeaders;throw a&&this.performanceClient?.addFields({httpVerToken:a[te.X_MS_HTTP_VERSION]||"",requestId:a[te.X_MS_REQUEST_ID]||"",contentTypeHeader:a[te.CONTENT_TYPE]||void 0,contentLengthHeader:a[te.CONTENT_LENGTH]||void 0,httpStatus:s.httpStatus},o),s.error}throw s instanceof L?s:y(Ji)}return Ce.postProcess(this.cacheManager,e,i,o),i}async updateAuthority(e,t){this.performanceClient?.addQueueMeasurement(d.UpdateTokenEndpointAuthority,t);const n=`https://${e}/${this.authority.tenant}/`,o=await Qs(n,this.networkClient,this.cacheManager,this.authority.options,this.logger,t,this.performanceClient);this.authority=o}createTokenQueryParameters(e){const t=new Map;return e.embeddedClientId&&En(t,this.config.authOptions.clientId,this.config.authOptions.redirectUri),e.tokenQueryParameters&&Le(t,e.tokenQueryParameters),Qr(t,e.correlationId),wn(t,e.correlationId,this.performanceClient),bt(t)}}const cn="no_tokens_found",Ys="native_account_unavailable",no="refresh_token_expired",ro="ux_not_allowed",Qh="interaction_required",Yh="consent_required",Jh="login_required",Pn="bad_token";const ai=[Qh,Yh,Jh,Pn,ro],Xh=["message_only","additional_action","basic_action","user_password_expired","consent_required","bad_token"],Zh={[cn]:"No refresh token found in the cache. Please sign-in.",[Ys]:"The requested account is not available in the native broker. It may have been deleted or logged out. Please sign-in again using an interactive API.",[no]:"Refresh token has expired.",[Pn]:"Identity provider returned bad_token due to an expired or invalid refresh token. Please invoke an interactive API to resolve.",[ro]:"`canShowUI` flag in Edge was set to false. User interaction required on web page. Please invoke an interactive API to resolve."};class me extends L{constructor(e,t,n,o,i,s,a,c){super(e,t,n),Object.setPrototypeOf(this,me.prototype),this.timestamp=o||p.EMPTY_STRING,this.traceId=i||p.EMPTY_STRING,this.correlationId=s||p.EMPTY_STRING,this.claims=a||p.EMPTY_STRING,this.name="InteractionRequiredAuthError",this.errorNo=c}}function Js(r,e,t){const n=!!r&&ai.indexOf(r)>-1,o=!!t&&Xh.indexOf(t)>-1,i=!!e&&ai.some(s=>e.indexOf(s)>-1);return n||i||o}function ln(r){return new me(r,Zh[r])}class ht{static setRequestState(e,t,n){const o=ht.generateLibraryState(e,n);return t?`${o}${p.RESOURCE_DELIM}${t}`:o}static generateLibraryState(e,t){if(!e)throw y(or);const n={id:e.createNewGuid()};t&&(n.meta=t);const o=JSON.stringify(n);return e.base64Encode(o)}static parseRequestState(e,t){if(!e)throw y(or);if(!t)throw y(st);try{const n=t.split(p.RESOURCE_DELIM),o=n[0],i=n.length>1?n.slice(1).join(p.RESOURCE_DELIM):p.EMPTY_STRING,s=e.base64Decode(o),a=JSON.parse(s);return{userRequestState:i||p.EMPTY_STRING,libraryState:a}}catch{throw y(st)}}}const eu={SW:"sw"};class at{constructor(e,t){this.cryptoUtils=e,this.performanceClient=t}async generateCnf(e,t){this.performanceClient?.addQueueMeasurement(d.PopTokenGenerateCnf,e.correlationId);const n=await f(this.generateKid.bind(this),d.PopTokenGenerateCnf,t,this.performanceClient,e.correlationId)(e),o=this.cryptoUtils.base64UrlEncode(JSON.stringify(n));return{kid:n.kid,reqCnfString:o}}async generateKid(e){return this.performanceClient?.addQueueMeasurement(d.PopTokenGenerateKid,e.correlationId),{kid:await this.cryptoUtils.getPublicKeyThumbprint(e),xms_ksl:eu.SW}}async signPopToken(e,t,n){return this.signPayload(e,t,n)}async signPayload(e,t,n,o){const{resourceRequestMethod:i,resourceRequestUri:s,shrClaims:a,shrNonce:c,shrOptions:l}=n,u=(s?new N(s):void 0)?.getUrlComponents();return this.cryptoUtils.signJwt({at:e,ts:ie(),m:i?.toUpperCase(),u:u?.HostNameAndPort,nonce:c||this.cryptoUtils.createNewGuid(),p:u?.AbsolutePath,q:u?.QueryString?[[],u.QueryString]:void 0,client_claims:a||void 0,...o},t,l,n.correlationId)}}class tu{constructor(e,t){this.cache=e,this.hasChanged=t}get cacheHasChanged(){return this.hasChanged}get tokenCache(){return this.cache}}class qe{constructor(e,t,n,o,i,s,a){this.clientId=e,this.cacheStorage=t,this.cryptoObj=n,this.logger=o,this.serializableCache=i,this.persistencePlugin=s,this.performanceClient=a}validateTokenResponse(e,t){if(e.error||e.error_description||e.suberror){const n=`Error(s): ${e.error_codes||p.NOT_AVAILABLE} - Timestamp: ${e.timestamp||p.NOT_AVAILABLE} - Description: ${e.error_description||p.NOT_AVAILABLE} - Correlation ID: ${e.correlation_id||p.NOT_AVAILABLE} - Trace ID: ${e.trace_id||p.NOT_AVAILABLE}`,o=e.error_codes?.length?e.error_codes[0]:void 0,i=new Ye(e.error,n,e.suberror,o,e.status);if(t&&e.status&&e.status>=Me.SERVER_ERROR_RANGE_START&&e.status<=Me.SERVER_ERROR_RANGE_END){this.logger.warning(`executeTokenRequest:validateTokenResponse - AAD is currently unavailable and the access token is unable to be refreshed.
${i}`);return}else if(t&&e.status&&e.status>=Me.CLIENT_ERROR_RANGE_START&&e.status<=Me.CLIENT_ERROR_RANGE_END){this.logger.warning(`executeTokenRequest:validateTokenResponse - AAD is currently available but is unable to refresh the access token.
${i}`);return}throw Js(e.error,e.error_description,e.suberror)?new me(e.error,e.error_description,e.suberror,e.timestamp||p.EMPTY_STRING,e.trace_id||p.EMPTY_STRING,e.correlation_id||p.EMPTY_STRING,e.claims||p.EMPTY_STRING,o):i}}async handleServerTokenResponse(e,t,n,o,i,s,a,c,l){this.performanceClient?.addQueueMeasurement(d.HandleServerTokenResponse,e.correlation_id);let h;if(e.id_token){if(h=Ae(e.id_token||p.EMPTY_STRING,this.cryptoObj.base64Decode),i&&i.nonce&&h.nonce!==i.nonce)throw y(ts);if(o.maxAge||o.maxAge===0){const I=h.auth_time;if(!I)throw y(Rr);_s(I,o.maxAge)}}this.homeAccountIdentifier=B.generateHomeAccountId(e.client_info||p.EMPTY_STRING,t.authorityType,this.logger,this.cryptoObj,h);let u;i&&i.state&&(u=ht.parseRequestState(this.cryptoObj,i.state)),e.key_id=e.key_id||o.sshKid||void 0;const g=this.generateCacheRecord(e,t,n,o,h,s,i);let m;try{if(this.persistencePlugin&&this.serializableCache&&(this.logger.verbose("Persistence enabled, calling beforeCacheAccess"),m=new tu(this.serializableCache,!0),await this.persistencePlugin.beforeCacheAccess(m)),a&&!c&&g.account){const I=this.cacheStorage.generateAccountKey(B.getAccountInfo(g.account));if(!this.cacheStorage.getAccount(I,o.correlationId))return this.logger.warning("Account used to refresh tokens not in persistence, refreshed tokens will not be stored in the cache"),await qe.generateAuthenticationResult(this.cryptoObj,t,g,!1,o,h,u,void 0,l)}await this.cacheStorage.saveCacheRecord(g,o.correlationId,Ie(h||{}),o.storeInCache)}finally{this.persistencePlugin&&this.serializableCache&&m&&(this.logger.verbose("Persistence enabled, calling afterCacheAccess"),await this.persistencePlugin.afterCacheAccess(m))}return qe.generateAuthenticationResult(this.cryptoObj,t,g,!1,o,h,u,e,l)}generateCacheRecord(e,t,n,o,i,s,a){const c=t.getPreferredCache();if(!c)throw y(Or);const l=Kr(i);let h,u;e.id_token&&i&&(h=Sn(this.homeAccountIdentifier,c,e.id_token,this.clientId,l||""),u=oo(this.cacheStorage,t,this.homeAccountIdentifier,this.cryptoObj.base64Decode,o.correlationId,i,e.client_info,c,l,a,void 0,this.logger));let g=null;if(e.access_token){const w=e.scope?q.fromString(e.scope):new q(o.scopes||[]),P=(typeof e.expires_in=="string"?parseInt(e.expires_in,10):e.expires_in)||0,b=(typeof e.ext_expires_in=="string"?parseInt(e.ext_expires_in,10):e.ext_expires_in)||0,v=(typeof e.refresh_in=="string"?parseInt(e.refresh_in,10):e.refresh_in)||void 0,O=n+P,S=O+b,x=v&&v>0?n+v:void 0;g=kn(this.homeAccountIdentifier,c,e.access_token,this.clientId,l||t.tenant||"",w.printScopes(),O,S,this.cryptoObj.base64Decode,x,e.token_type,s,e.key_id,o.claims,o.requestedClaimsHash)}let m=null;if(e.refresh_token){let w;if(e.refresh_token_expires_in){const P=typeof e.refresh_token_expires_in=="string"?parseInt(e.refresh_token_expires_in,10):e.refresh_token_expires_in;w=n+P}m=Vs(this.homeAccountIdentifier,c,e.refresh_token,this.clientId,e.foci,s,w)}let I=null;return e.foci&&(I={clientId:this.clientId,environment:c,familyId:e.foci}),{account:u,idToken:h,accessToken:g,refreshToken:m,appMetadata:I}}static async generateAuthenticationResult(e,t,n,o,i,s,a,c,l){let h=p.EMPTY_STRING,u=[],g=null,m,I,w=p.EMPTY_STRING;if(n.accessToken){if(n.accessToken.tokenType===U.POP&&!i.popKid){const O=new at(e),{secret:S,keyId:x}=n.accessToken;if(!x)throw y(Nr);h=await O.signPopToken(S,x,i)}else h=n.accessToken.secret;u=q.fromString(n.accessToken.target).asArray(),g=nt(n.accessToken.expiresOn),m=nt(n.accessToken.extendedExpiresOn),n.accessToken.refreshOn&&(I=nt(n.accessToken.refreshOn))}n.appMetadata&&(w=n.appMetadata.familyId===Qt?Qt:"");const P=s?.oid||s?.sub||"",b=s?.tid||"";c?.spa_accountid&&n.account&&(n.account.nativeAccountId=c?.spa_accountid);const v=n.account?Br(B.getAccountInfo(n.account),void 0,s,n.idToken?.secret):null;return{authority:t.canonicalAuthority,uniqueId:P,tenantId:b,scopes:u,account:v,idToken:n?.idToken?.secret||"",idTokenClaims:s||{},accessToken:h,fromCache:o,expiresOn:g,extExpiresOn:m,refreshOn:I,correlationId:i.correlationId,requestId:l||p.EMPTY_STRING,familyId:w,tokenType:n.accessToken?.tokenType||p.EMPTY_STRING,state:a?a.userRequestState:p.EMPTY_STRING,cloudGraphHostName:n.account?.cloudGraphHostName||p.EMPTY_STRING,msGraphHost:n.account?.msGraphHost||p.EMPTY_STRING,code:c?.spa_code,fromNativeBroker:!1}}}function oo(r,e,t,n,o,i,s,a,c,l,h,u){u?.verbose("setCachedAccount called");const m=r.getAccountKeys().find(v=>v.startsWith(t));let I=null;m&&(I=r.getAccount(m,o));const w=I||B.createAccount({homeAccountId:t,idTokenClaims:i,clientInfo:s,environment:a,cloudGraphHostName:l?.cloud_graph_host_name,msGraphHost:l?.msgraph_host,nativeAccountId:h},e,n),P=w.tenantProfiles||[],b=c||w.realm;if(b&&!P.find(v=>v.tenantId===b)){const v=In(t,w.localAccountId,b,i);P.push(v)}return w.tenantProfiles=P,w}async function Xs(r,e,t){return typeof r=="string"?r:r({clientId:e,tokenEndpoint:t})}class Zs extends to{constructor(e,t){super(e,t),this.includeRedirectUri=!0,this.oidcDefaultScopes=this.config.authOptions.authority.options.OIDCOptions?.defaultScopes}async acquireToken(e,t){if(this.performanceClient?.addQueueMeasurement(d.AuthClientAcquireToken,e.correlationId),!e.code)throw y(os);const n=ie(),o=await f(this.executeTokenRequest.bind(this),d.AuthClientExecuteTokenRequest,this.logger,this.performanceClient,e.correlationId)(this.authority,e),i=o.headers?.[te.X_MS_REQUEST_ID],s=new qe(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,this.config.serializableCache,this.config.persistencePlugin,this.performanceClient);return s.validateTokenResponse(o.body),f(s.handleServerTokenResponse.bind(s),d.HandleServerTokenResponse,this.logger,this.performanceClient,e.correlationId)(o.body,this.authority,n,e,t,void 0,void 0,void 0,i)}getLogoutUri(e){if(!e)throw D(Cs);const t=this.createLogoutUrlQueryString(e);return N.appendQueryString(this.authority.endSessionEndpoint,t)}async executeTokenRequest(e,t){this.performanceClient?.addQueueMeasurement(d.AuthClientExecuteTokenRequest,t.correlationId);const n=this.createTokenQueryParameters(t),o=N.appendQueryString(e.tokenEndpoint,n),i=await f(this.createTokenRequestBody.bind(this),d.AuthClientCreateTokenRequestBody,this.logger,this.performanceClient,t.correlationId)(t);let s;if(t.clientInfo)try{const l=Zt(t.clientInfo,this.cryptoUtils.base64Decode);s={credential:`${l.uid}${kt.CLIENT_INFO_SEPARATOR}${l.utid}`,type:pe.HOME_ACCOUNT_ID}}catch(l){this.logger.verbose("Could not parse client info for CCS Header: "+l)}const a=this.createTokenRequestHeaders(s||t.ccsCredential),c=_n(this.config.authOptions.clientId,t);return f(this.executePostToTokenEndpoint.bind(this),d.AuthorizationCodeClientExecutePostToTokenEndpoint,this.logger,this.performanceClient,t.correlationId)(o,i,a,c,t.correlationId,d.AuthorizationCodeClientExecutePostToTokenEndpoint)}async createTokenRequestBody(e){this.performanceClient?.addQueueMeasurement(d.AuthClientCreateTokenRequestBody,e.correlationId);const t=new Map;if(jr(t,e.embeddedClientId||e.tokenBodyParameters?.[ze]||this.config.authOptions.clientId),this.includeRedirectUri)Vr(t,e.redirectUri);else if(!e.redirectUri)throw D(gs);if(qr(t,e.scopes,!0,this.oidcDefaultScopes),Ph(t,e.code),Yr(t,this.config.libraryInfo),Jr(t,this.config.telemetry.application),js(t),this.serverTelemetryManager&&!Us(this.config)&&qs(t,this.serverTelemetryManager),e.codeVerifier&&Nh(t,e.codeVerifier),this.config.clientCredentials.clientSecret&&Fs(t,this.config.clientCredentials.clientSecret),this.config.clientCredentials.clientAssertion){const o=this.config.clientCredentials.clientAssertion;Bs(t,await Xs(o.assertion,this.config.authOptions.clientId,e.resourceRequestUri)),Ks(t,o.assertionType)}if($s(t,Vi.AUTHORIZATION_CODE_GRANT),Zr(t),e.authenticationScheme===U.POP){const o=new at(this.cryptoUtils,this.performanceClient);let i;e.popKid?i=this.cryptoUtils.encodeKid(e.popKid):i=(await f(o.generateCnf.bind(o),d.PopTokenGenerateCnf,this.logger,this.performanceClient,e.correlationId)(e,this.logger)).reqCnfString,eo(t,i)}else if(e.authenticationScheme===U.SSH)if(e.sshJwk)zs(t,e.sshJwk);else throw D(An);(!le.isEmptyObj(e.claims)||this.config.authOptions.clientCapabilities&&this.config.authOptions.clientCapabilities.length>0)&&Wr(t,e.claims,this.config.authOptions.clientCapabilities);let n;if(e.clientInfo)try{const o=Zt(e.clientInfo,this.cryptoUtils.base64Decode);n={credential:`${o.uid}${kt.CLIENT_INFO_SEPARATOR}${o.utid}`,type:pe.HOME_ACCOUNT_ID}}catch(o){this.logger.verbose("Could not parse client info for CCS Header: "+o)}else n=e.ccsCredential;if(this.config.systemOptions.preventCorsPreflight&&n)switch(n.type){case pe.HOME_ACCOUNT_ID:try{const o=et(n.credential);wt(t,o)}catch(o){this.logger.verbose("Could not parse home account ID for CCS Header: "+o)}break;case pe.UPN:sn(t,n.credential);break}return e.embeddedClientId&&En(t,this.config.authOptions.clientId,this.config.authOptions.redirectUri),e.tokenBodyParameters&&Le(t,e.tokenBodyParameters),e.enableSpaAuthorizationCode&&(!e.tokenBodyParameters||!e.tokenBodyParameters[Zo])&&Le(t,{[Zo]:"1"}),wn(t,e.correlationId,this.performanceClient),bt(t)}createLogoutUrlQueryString(e){const t=new Map;return e.postLogoutRedirectUri&&Sh(t,e.postLogoutRedirectUri),e.correlationId&&Qr(t,e.correlationId),e.idTokenHint&&kh(t,e.idTokenHint),e.state&&Hs(t,e.state),e.logoutHint&&Uh(t,e.logoutHint),e.extraQueryParameters&&Le(t,e.extraQueryParameters),this.config.authOptions.instanceAware&&Gs(t),bt(t,this.config.authOptions.encodeExtraQueryParams,e.extraQueryParameters)}}const nu=300;class ru extends to{constructor(e,t){super(e,t)}async acquireToken(e){this.performanceClient?.addQueueMeasurement(d.RefreshTokenClientAcquireToken,e.correlationId);const t=ie(),n=await f(this.executeTokenRequest.bind(this),d.RefreshTokenClientExecuteTokenRequest,this.logger,this.performanceClient,e.correlationId)(e,this.authority),o=n.headers?.[te.X_MS_REQUEST_ID],i=new qe(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,this.config.serializableCache,this.config.persistencePlugin);return i.validateTokenResponse(n.body),f(i.handleServerTokenResponse.bind(i),d.HandleServerTokenResponse,this.logger,this.performanceClient,e.correlationId)(n.body,this.authority,t,e,void 0,void 0,!0,e.forceCache,o)}async acquireTokenByRefreshToken(e){if(!e)throw D(ys);if(this.performanceClient?.addQueueMeasurement(d.RefreshTokenClientAcquireTokenByRefreshToken,e.correlationId),!e.account)throw y(Pr);if(this.cacheManager.isAppMetadataFOCI(e.account.environment))try{return await f(this.acquireTokenWithCachedRefreshToken.bind(this),d.RefreshTokenClientAcquireTokenWithCachedRefreshToken,this.logger,this.performanceClient,e.correlationId)(e,!0)}catch(n){const o=n instanceof me&&n.errorCode===cn,i=n instanceof Ye&&n.errorCode===zo.INVALID_GRANT_ERROR&&n.subError===zo.CLIENT_MISMATCH_ERROR;if(o||i)return f(this.acquireTokenWithCachedRefreshToken.bind(this),d.RefreshTokenClientAcquireTokenWithCachedRefreshToken,this.logger,this.performanceClient,e.correlationId)(e,!1);throw n}return f(this.acquireTokenWithCachedRefreshToken.bind(this),d.RefreshTokenClientAcquireTokenWithCachedRefreshToken,this.logger,this.performanceClient,e.correlationId)(e,!1)}async acquireTokenWithCachedRefreshToken(e,t){this.performanceClient?.addQueueMeasurement(d.RefreshTokenClientAcquireTokenWithCachedRefreshToken,e.correlationId);const n=de(this.cacheManager.getRefreshToken.bind(this.cacheManager),d.CacheManagerGetRefreshToken,this.logger,this.performanceClient,e.correlationId)(e.account,t,e.correlationId,void 0,this.performanceClient);if(!n)throw ln(cn);if(n.expiresOn&&an(n.expiresOn,e.refreshTokenExpirationOffsetSeconds||nu))throw this.performanceClient?.addFields({rtExpiresOnMs:Number(n.expiresOn)},e.correlationId),ln(no);const o={...e,refreshToken:n.secret,authenticationScheme:e.authenticationScheme||U.BEARER,ccsCredential:{credential:e.account.homeAccountId,type:pe.HOME_ACCOUNT_ID}};try{return await f(this.acquireToken.bind(this),d.RefreshTokenClientAcquireToken,this.logger,this.performanceClient,e.correlationId)(o)}catch(i){if(i instanceof me&&(this.performanceClient?.addFields({rtExpiresOnMs:Number(n.expiresOn)},e.correlationId),i.subError===Pn)){this.logger.verbose("acquireTokenWithRefreshToken: bad refresh token, removing from cache");const s=this.cacheManager.generateCredentialKey(n);this.cacheManager.removeRefreshToken(s,e.correlationId)}throw i}}async executeTokenRequest(e,t){this.performanceClient?.addQueueMeasurement(d.RefreshTokenClientExecuteTokenRequest,e.correlationId);const n=this.createTokenQueryParameters(e),o=N.appendQueryString(t.tokenEndpoint,n),i=await f(this.createTokenRequestBody.bind(this),d.RefreshTokenClientCreateTokenRequestBody,this.logger,this.performanceClient,e.correlationId)(e),s=this.createTokenRequestHeaders(e.ccsCredential),a=_n(this.config.authOptions.clientId,e);return f(this.executePostToTokenEndpoint.bind(this),d.RefreshTokenClientExecutePostToTokenEndpoint,this.logger,this.performanceClient,e.correlationId)(o,i,s,a,e.correlationId,d.RefreshTokenClientExecutePostToTokenEndpoint)}async createTokenRequestBody(e){this.performanceClient?.addQueueMeasurement(d.RefreshTokenClientCreateTokenRequestBody,e.correlationId);const t=new Map;if(jr(t,e.embeddedClientId||e.tokenBodyParameters?.[ze]||this.config.authOptions.clientId),e.redirectUri&&Vr(t,e.redirectUri),qr(t,e.scopes,!0,this.config.authOptions.authority.options.OIDCOptions?.defaultScopes),$s(t,Vi.REFRESH_TOKEN_GRANT),Zr(t),Yr(t,this.config.libraryInfo),Jr(t,this.config.telemetry.application),js(t),this.serverTelemetryManager&&!Us(this.config)&&qs(t,this.serverTelemetryManager),Oh(t,e.refreshToken),this.config.clientCredentials.clientSecret&&Fs(t,this.config.clientCredentials.clientSecret),this.config.clientCredentials.clientAssertion){const n=this.config.clientCredentials.clientAssertion;Bs(t,await Xs(n.assertion,this.config.authOptions.clientId,e.resourceRequestUri)),Ks(t,n.assertionType)}if(e.authenticationScheme===U.POP){const n=new at(this.cryptoUtils,this.performanceClient);let o;e.popKid?o=this.cryptoUtils.encodeKid(e.popKid):o=(await f(n.generateCnf.bind(n),d.PopTokenGenerateCnf,this.logger,this.performanceClient,e.correlationId)(e,this.logger)).reqCnfString,eo(t,o)}else if(e.authenticationScheme===U.SSH)if(e.sshJwk)zs(t,e.sshJwk);else throw D(An);if((!le.isEmptyObj(e.claims)||this.config.authOptions.clientCapabilities&&this.config.authOptions.clientCapabilities.length>0)&&Wr(t,e.claims,this.config.authOptions.clientCapabilities),this.config.systemOptions.preventCorsPreflight&&e.ccsCredential)switch(e.ccsCredential.type){case pe.HOME_ACCOUNT_ID:try{const n=et(e.ccsCredential.credential);wt(t,n)}catch(n){this.logger.verbose("Could not parse home account ID for CCS Header: "+n)}break;case pe.UPN:sn(t,e.ccsCredential.credential);break}return e.embeddedClientId&&En(t,this.config.authOptions.clientId,this.config.authOptions.redirectUri),e.tokenBodyParameters&&Le(t,e.tokenBodyParameters),wn(t,e.correlationId,this.performanceClient),bt(t)}}class ou extends to{constructor(e,t){super(e,t)}async acquireCachedToken(e){this.performanceClient?.addQueueMeasurement(d.SilentFlowClientAcquireCachedToken,e.correlationId);let t=Ke.NOT_APPLICABLE;if(e.forceRefresh||!this.config.cacheOptions.claimsBasedCachingEnabled&&!le.isEmptyObj(e.claims))throw this.setCacheOutcome(Ke.FORCE_REFRESH_OR_CLAIMS,e.correlationId),y(De);if(!e.account)throw y(Pr);const n=e.account.tenantId||Vh(e.authority),o=this.cacheManager.getTokenKeys(),i=this.cacheManager.getAccessToken(e.account,e,o,n);if(i){if(Bh(i.cachedAt)||an(i.expiresOn,this.config.systemOptions.tokenRenewalOffsetSeconds))throw this.setCacheOutcome(Ke.CACHED_ACCESS_TOKEN_EXPIRED,e.correlationId),y(De);i.refreshOn&&an(i.refreshOn,0)&&(t=Ke.PROACTIVELY_REFRESHED)}else throw this.setCacheOutcome(Ke.NO_CACHED_ACCESS_TOKEN,e.correlationId),y(De);const s=e.authority||this.authority.getPreferredCache(),a={account:this.cacheManager.getAccount(this.cacheManager.generateAccountKey(e.account),e.correlationId),accessToken:i,idToken:this.cacheManager.getIdToken(e.account,e.correlationId,o,n,this.performanceClient),refreshToken:null,appMetadata:this.cacheManager.readAppMetadataFromCache(s)};return this.setCacheOutcome(t,e.correlationId),this.config.serverTelemetryManager&&this.config.serverTelemetryManager.incrementCacheHits(),[await f(this.generateResultFromCacheRecord.bind(this),d.SilentFlowClientGenerateResultFromCacheRecord,this.logger,this.performanceClient,e.correlationId)(a,e),t]}setCacheOutcome(e,t){this.serverTelemetryManager?.setCacheOutcome(e),this.performanceClient?.addFields({cacheOutcome:e},t),e!==Ke.NOT_APPLICABLE&&this.logger.info(`Token refresh is required due to cache outcome: ${e}`)}async generateResultFromCacheRecord(e,t){this.performanceClient?.addQueueMeasurement(d.SilentFlowClientGenerateResultFromCacheRecord,t.correlationId);let n;if(e.idToken&&(n=Ae(e.idToken.secret,this.config.cryptoInterface.base64Decode)),t.maxAge||t.maxAge===0){const o=n?.auth_time;if(!o)throw y(Rr);_s(o,t.maxAge)}return qe.generateAuthenticationResult(this.cryptoUtils,this.authority,e,!0,t,n)}}const iu={sendGetRequestAsync:()=>Promise.reject(y(_)),sendPostRequestAsync:()=>Promise.reject(y(_))};function su(r,e,t,n){const o=e.correlationId,i=new Map;jr(i,e.embeddedClientId||e.extraQueryParameters?.[ze]||r.clientId);const s=[...e.scopes||[],...e.extraScopesToConsent||[]];if(qr(i,s,!0,r.authority.options.OIDCOptions?.defaultScopes),Vr(i,e.redirectUri),Qr(i,o),Eh(i,e.responseMode),Zr(i),e.prompt&&(_h(i,e.prompt),n?.addFields({prompt:e.prompt},o)),e.domainHint&&(bh(i,e.domainHint),n?.addFields({domainHintFromRequest:!0},o)),e.prompt!==Q.SELECT_ACCOUNT)if(e.sid&&e.prompt===Q.NONE)t.verbose("createAuthCodeUrlQueryString: Prompt is none, adding sid from request"),ei(i,e.sid),n?.addFields({sidFromRequest:!0},o);else if(e.account){const a=lu(e.account);let c=du(e.account);if(c&&e.domainHint&&(t.warning('AuthorizationCodeClient.createAuthCodeUrlQueryString: "domainHint" param is set, skipping opaque "login_hint" claim. Please consider not passing domainHint'),c=null),c){t.verbose("createAuthCodeUrlQueryString: login_hint claim present on account"),Ht(i,c),n?.addFields({loginHintFromClaim:!0},o);try{const l=et(e.account.homeAccountId);wt(i,l)}catch{t.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}else if(a&&e.prompt===Q.NONE){t.verbose("createAuthCodeUrlQueryString: Prompt is none, adding sid from account"),ei(i,a),n?.addFields({sidFromClaim:!0},o);try{const l=et(e.account.homeAccountId);wt(i,l)}catch{t.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}else if(e.loginHint)t.verbose("createAuthCodeUrlQueryString: Adding login_hint from request"),Ht(i,e.loginHint),sn(i,e.loginHint),n?.addFields({loginHintFromRequest:!0},o);else if(e.account.username){t.verbose("createAuthCodeUrlQueryString: Adding login_hint from account"),Ht(i,e.account.username),n?.addFields({loginHintFromUpn:!0},o);try{const l=et(e.account.homeAccountId);wt(i,l)}catch{t.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}}else e.loginHint&&(t.verbose("createAuthCodeUrlQueryString: No account, adding login_hint from request"),Ht(i,e.loginHint),sn(i,e.loginHint),n?.addFields({loginHintFromRequest:!0},o));else t.verbose("createAuthCodeUrlQueryString: Prompt is select_account, ignoring account hints");return e.nonce&&Rh(i,e.nonce),e.state&&Hs(i,e.state),(e.claims||r.clientCapabilities&&r.clientCapabilities.length>0)&&Wr(i,e.claims,r.clientCapabilities),e.embeddedClientId&&En(i,r.clientId,r.redirectUri),r.instanceAware&&(!e.extraQueryParameters||!Object.keys(e.extraQueryParameters).includes(ar))&&Gs(i),i}function io(r,e,t,n){const o=bt(e,t,n);return N.appendQueryString(r.authorizationEndpoint,o)}function au(r,e){if(ea(r,e),!r.code)throw y(ls);return r}function ea(r,e){if(!r.state||!e)throw r.state?y(tr,"Cached State"):y(tr,"Server State");let t,n;try{t=decodeURIComponent(r.state)}catch{throw y(st,r.state)}try{n=decodeURIComponent(e)}catch{throw y(st,r.state)}if(t!==n)throw y(es);if(r.error||r.error_description||r.suberror){const o=cu(r);throw Js(r.error,r.error_description,r.suberror)?new me(r.error||"",r.error_description,r.suberror,r.timestamp||"",r.trace_id||"",r.correlation_id||"",r.claims||"",o):new Ye(r.error||"",r.error_description,r.suberror,o)}}function cu(r){const e="code=",t=r.error_uri?.lastIndexOf(e);return t&&t>=0?r.error_uri?.substring(t+e.length):void 0}function lu(r){return r.idTokenClaims?.sid||null}function du(r){return r.loginHint||r.idTokenClaims?.login_hint||null}const ci=",",ta="|";function hu(r){const{skus:e,libraryName:t,libraryVersion:n,extensionName:o,extensionVersion:i}=r,s=new Map([[0,[t,n]],[2,[o,i]]]);let a=[];if(e?.length){if(a=e.split(ci),a.length<4)return e}else a=Array.from({length:4},()=>ta);return s.forEach((c,l)=>{c.length===2&&c[0]?.length&&c[1]?.length&&uu({skuArr:a,index:l,skuName:c[0],skuVersion:c[1]})}),a.join(ci)}function uu(r){const{skuArr:e,index:t,skuName:n,skuVersion:o}=r;t>=e.length||(e[t]=[n,o].join(ta))}class _t{constructor(e,t){this.cacheOutcome=Ke.NOT_APPLICABLE,this.cacheManager=t,this.apiId=e.apiId,this.correlationId=e.correlationId,this.wrapperSKU=e.wrapperSKU||p.EMPTY_STRING,this.wrapperVer=e.wrapperVer||p.EMPTY_STRING,this.telemetryCacheKey=V.CACHE_KEY+kt.CACHE_KEY_SEPARATOR+e.clientId}generateCurrentRequestHeaderValue(){const e=`${this.apiId}${V.VALUE_SEPARATOR}${this.cacheOutcome}`,t=[this.wrapperSKU,this.wrapperVer],n=this.getNativeBrokerErrorCode();n?.length&&t.push(`broker_error=${n}`);const o=t.join(V.VALUE_SEPARATOR),i=this.getRegionDiscoveryFields(),s=[e,i].join(V.VALUE_SEPARATOR);return[V.SCHEMA_VERSION,s,o].join(V.CATEGORY_SEPARATOR)}generateLastRequestHeaderValue(){const e=this.getLastRequests(),t=_t.maxErrorsToSend(e),n=e.failedRequests.slice(0,2*t).join(V.VALUE_SEPARATOR),o=e.errors.slice(0,t).join(V.VALUE_SEPARATOR),i=e.errors.length,s=t<i?V.OVERFLOW_TRUE:V.OVERFLOW_FALSE,a=[i,s].join(V.VALUE_SEPARATOR);return[V.SCHEMA_VERSION,e.cacheHits,n,o,a].join(V.CATEGORY_SEPARATOR)}cacheFailedRequest(e){const t=this.getLastRequests();t.errors.length>=V.MAX_CACHED_ERRORS&&(t.failedRequests.shift(),t.failedRequests.shift(),t.errors.shift()),t.failedRequests.push(this.apiId,this.correlationId),e instanceof Error&&e&&e.toString()?e instanceof L?e.subError?t.errors.push(e.subError):e.errorCode?t.errors.push(e.errorCode):t.errors.push(e.toString()):t.errors.push(e.toString()):t.errors.push(V.UNKNOWN_ERROR),this.cacheManager.setServerTelemetry(this.telemetryCacheKey,t,this.correlationId)}incrementCacheHits(){const e=this.getLastRequests();return e.cacheHits+=1,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,e,this.correlationId),e.cacheHits}getLastRequests(){const e={failedRequests:[],errors:[],cacheHits:0};return this.cacheManager.getServerTelemetry(this.telemetryCacheKey)||e}clearTelemetryCache(){const e=this.getLastRequests(),t=_t.maxErrorsToSend(e),n=e.errors.length;if(t===n)this.cacheManager.removeItem(this.telemetryCacheKey,this.correlationId);else{const o={failedRequests:e.failedRequests.slice(t*2),errors:e.errors.slice(t),cacheHits:0};this.cacheManager.setServerTelemetry(this.telemetryCacheKey,o,this.correlationId)}}static maxErrorsToSend(e){let t,n=0,o=0;const i=e.errors.length;for(t=0;t<i;t++){const s=e.failedRequests[2*t]||p.EMPTY_STRING,a=e.failedRequests[2*t+1]||p.EMPTY_STRING,c=e.errors[t]||p.EMPTY_STRING;if(o+=s.toString().length+a.toString().length+c.length+3,o<V.MAX_LAST_HEADER_BYTES)n+=1;else break}return n}getRegionDiscoveryFields(){const e=[];return e.push(this.regionUsed||p.EMPTY_STRING),e.push(this.regionSource||p.EMPTY_STRING),e.push(this.regionOutcome||p.EMPTY_STRING),e.join(",")}updateRegionDiscoveryMetadata(e){this.regionUsed=e.region_used,this.regionSource=e.region_source,this.regionOutcome=e.region_outcome}setCacheOutcome(e){this.cacheOutcome=e}setNativeBrokerErrorCode(e){const t=this.getLastRequests();t.nativeBrokerErrorCode=e,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,t,this.correlationId)}getNativeBrokerErrorCode(){return this.getLastRequests().nativeBrokerErrorCode}clearNativeBrokerErrorCode(){const e=this.getLastRequests();delete e.nativeBrokerErrorCode,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,e,this.correlationId)}static makeExtraSkuString(e){return hu(e)}}const na="missing_kid_error",ra="missing_alg_error";const gu={[na]:"The JOSE Header for the requested JWT, JWS or JWK object requires a keyId to be configured as the 'kid' header claim. No 'kid' value was provided.",[ra]:"The JOSE Header for the requested JWT, JWS or JWK object requires an algorithm to be specified as the 'alg' header claim. No 'alg' value was provided."};class so extends L{constructor(e,t){super(e,t),this.name="JoseHeaderError",Object.setPrototypeOf(this,so.prototype)}}function li(r){return new so(r,gu[r])}class ao{constructor(e){this.typ=e.typ,this.alg=e.alg,this.kid=e.kid}static getShrHeaderString(e){if(!e.kid)throw li(na);if(!e.alg)throw li(ra);const t=new ao({typ:e.typ||sd.Pop,kid:e.kid,alg:e.alg});return JSON.stringify(t)}}const co="pkce_not_created",lo="ear_jwk_empty",oa="ear_jwe_empty",cr="crypto_nonexistent",On="empty_navigate_uri",ia="hash_empty_error",ho="no_state_in_hash",sa="hash_does_not_contain_known_properties",aa="unable_to_parse_state",ca="state_interaction_type_mismatch",la="interaction_in_progress",da="popup_window_error",ha="empty_window_error",Rt="user_cancelled",fu="monitor_popup_timeout",ua="monitor_window_timeout",ga="redirect_in_iframe",fa="block_iframe_reload",pa="block_nested_popups",pu="iframe_closed_prematurely",Nn="silent_logout_unsupported",ma="no_account_error",mu="silent_prompt_value_error",ya="no_token_request_cache_error",Ca="unable_to_parse_token_request_cache_error",yu="auth_request_not_set_error",Cu="invalid_cache_type",Mn="non_browser_environment",Xe="database_not_open",dn="no_network_connectivity",Ta="post_request_failed",Aa="get_request_failed",lr="failed_to_parse_response",Ia="unable_to_load_token",uo="crypto_key_not_found",wa="auth_code_required",Ea="auth_code_or_nativeAccountId_required",va="spa_code_and_nativeAccountId_present",go="database_unavailable",Sa="unable_to_acquire_token_from_native_platform",ka="native_handshake_timeout",ba="native_extension_not_installed",fo="native_connection_not_established",Et="uninitialized_public_client_application",_a="native_prompt_not_supported",Ra="invalid_base64_string",Pa="invalid_pop_token_request",Oa="failed_to_build_headers",Na="failed_to_parse_headers",Gt="failed_to_decrypt_ear_response",hn="timed_out";const ve="For more visit: aka.ms/msaljs/browser-errors",Tu={[co]:"The PKCE code challenge and verifier could not be generated.",[lo]:"No EAR encryption key provided. This is unexpected.",[oa]:"Server response does not contain ear_jwe property. This is unexpected.",[cr]:"The crypto object or function is not available.",[On]:"Navigation URI is empty. Please check stack trace for more info.",[ia]:`Hash value cannot be processed because it is empty. Please verify that your redirectUri is not clearing the hash. ${ve}`,[ho]:"Hash does not contain state. Please verify that the request originated from msal.",[sa]:`Hash does not contain known properites. Please verify that your redirectUri is not changing the hash.  ${ve}`,[aa]:"Unable to parse state. Please verify that the request originated from msal.",[ca]:"Hash contains state but the interaction type does not match the caller.",[la]:`Interaction is currently in progress. Please ensure that this interaction has been completed before calling an interactive API.   ${ve}`,[da]:"Error opening popup window. This can happen if you are using IE or if popups are blocked in the browser.",[ha]:"window.open returned null or undefined window object.",[Rt]:"User cancelled the flow.",[fu]:`Token acquisition in popup failed due to timeout.  ${ve}`,[ua]:`Token acquisition in iframe failed due to timeout.  ${ve}`,[ga]:"Redirects are not supported for iframed or brokered applications. Please ensure you are using MSAL.js in a top frame of the window if using the redirect APIs, or use the popup APIs.",[fa]:`Request was blocked inside an iframe because MSAL detected an authentication response.  ${ve}`,[pa]:"Request was blocked inside a popup because MSAL detected it was running in a popup.",[pu]:"The iframe being monitored was closed prematurely.",[Nn]:"Silent logout not supported. Please call logoutRedirect or logoutPopup instead.",[ma]:"No account object provided to acquireTokenSilent and no active account has been set. Please call setActiveAccount or provide an account on the request.",[mu]:"The value given for the prompt value is not valid for silent requests - must be set to 'none' or 'no_session'.",[ya]:"No token request found in cache.",[Ca]:"The cached token request could not be parsed.",[yu]:"Auth Request not set. Please ensure initiateAuthRequest was called from the InteractionHandler",[Cu]:"Invalid cache type",[Mn]:"Login and token requests are not supported in non-browser environments.",[Xe]:"Database is not open!",[dn]:"No network connectivity. Check your internet connection.",[Ta]:"Network request failed: If the browser threw a CORS error, check that the redirectUri is registered in the Azure App Portal as type 'SPA'",[Aa]:"Network request failed. Please check the network trace to determine root cause.",[lr]:"Failed to parse network response. Check network trace.",[Ia]:"Error loading token to cache.",[uo]:"Cryptographic Key or Keypair not found in browser storage.",[wa]:"An authorization code must be provided (as the `code` property on the request) to this flow.",[Ea]:"An authorization code or nativeAccountId must be provided to this flow.",[va]:"Request cannot contain both spa code and native account id.",[go]:"IndexedDB, which is required for persistent cryptographic key storage, is unavailable. This may be caused by browser privacy features which block persistent storage in third-party contexts.",[Sa]:`Unable to acquire token from native platform.  ${ve}`,[ka]:"Timed out while attempting to establish connection to browser extension",[ba]:"Native extension is not installed. If you think this is a mistake call the initialize function.",[fo]:`Connection to native platform has not been established. Please install a compatible browser extension and run initialize().  ${ve}`,[Et]:`You must call and await the initialize function before attempting to call any other MSAL API.  ${ve}`,[_a]:"The provided prompt is not supported by the native platform. This request should be routed to the web based flow.",[Ra]:"Invalid base64 encoded string.",[Pa]:"Invalid PoP token request. The request should not have both a popKid value and signPopToken set to true.",[Oa]:"Failed to build request headers object.",[Na]:"Failed to parse response headers",[Gt]:"Failed to decrypt ear response",[hn]:"The request timed out."};class Mt extends L{constructor(e,t){super(e,Tu[e],t),Object.setPrototypeOf(this,Mt.prototype),this.name="BrowserAuthError"}}function T(r,e){return new Mt(r,e)}const re={INVALID_GRANT_ERROR:"invalid_grant",POPUP_WIDTH:483,POPUP_HEIGHT:600,POPUP_NAME_PREFIX:"msal",DEFAULT_POLL_INTERVAL_MS:30,MSAL_SKU:"msal.js.browser"},he={CHANNEL_ID:"53ee284d-920a-4b59-9d30-a60315b26836",PREFERRED_EXTENSION_ID:"ppnbnpeolgkicgegkbkbjmhlideopiji",MATS_TELEMETRY:"MATS",MICROSOFT_ENTRA_BROKERID:"MicrosoftEntra",DOM_API_NAME:"DOM API",PLATFORM_DOM_APIS:"get-token-and-sign-out",PLATFORM_DOM_PROVIDER:"PlatformAuthDOMHandler",PLATFORM_EXTENSION_PROVIDER:"PlatformAuthExtensionHandler"},mt={HandshakeRequest:"Handshake",HandshakeResponse:"HandshakeResponse",GetToken:"GetToken",Response:"Response"},Y={LocalStorage:"localStorage",SessionStorage:"sessionStorage",MemoryStorage:"memoryStorage"},di={GET:"GET",POST:"POST"},Ne={SIGNIN:"signin",SIGNOUT:"signout"},$={ORIGIN_URI:"request.origin",URL_HASH:"urlHash",REQUEST_PARAMS:"request.params",VERIFIER:"code.verifier",INTERACTION_STATUS_KEY:"interaction.status",NATIVE_REQUEST:"request.native"},Bt={WRAPPER_SKU:"wrapper.sku",WRAPPER_VER:"wrapper.version"},M={acquireTokenRedirect:861,acquireTokenPopup:862,ssoSilent:863,acquireTokenSilent_authCode:864,handleRedirectPromise:865,acquireTokenByCode:866,acquireTokenSilent_silentFlow:61,logout:961,logoutPopup:962};var E;(function(r){r.Redirect="redirect",r.Popup="popup",r.Silent="silent",r.None="none"})(E||(E={}));const z={Startup:"startup",Login:"login",Logout:"logout",AcquireToken:"acquireToken",SsoSilent:"ssoSilent",HandleRedirect:"handleRedirect",None:"none"},hi={scopes:dt},Ma="jwk",Au={React:"@azure/msal-react"},dr="msal.db",Iu=1,wu=`${dr}.keys`,ee={Default:0,AccessToken:1,AccessTokenAndRefreshToken:2,RefreshToken:3,RefreshTokenAndNetwork:4,Skip:5},Eu=[ee.Default,ee.Skip,ee.RefreshTokenAndNetwork];function Kt(r){return encodeURIComponent(Pt(r).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"))}function He(r){return Ua(r).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function Pt(r){return Ua(new TextEncoder().encode(r))}function Ua(r){const e=Array.from(r,t=>String.fromCodePoint(t)).join("");return btoa(e)}function ne(r){return new TextDecoder().decode(xe(r))}function xe(r){let e=r.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw T(Ra)}const t=atob(e);return Uint8Array.from(t,n=>n.codePointAt(0)||0)}const vu="RSASSA-PKCS1-v1_5",ut="AES-GCM",Da="HKDF",po="SHA-256",Su=2048,ku=new Uint8Array([1,0,1]),ui="0123456789abcdef",gi=new Uint32Array(1),mo="raw",La="encrypt",yo="decrypt",bu="deriveKey",_u="crypto_subtle_undefined",Co={name:vu,hash:po,modulusLength:Su,publicExponent:ku};function Ru(r){if(!window)throw T(Mn);if(!window.crypto)throw T(cr);if(!r&&!window.crypto.subtle)throw T(cr,_u)}async function xa(r,e,t){e?.addQueueMeasurement(d.Sha256Digest,t);const o=new TextEncoder().encode(r);return window.crypto.subtle.digest(po,o)}function Pu(r){return window.crypto.getRandomValues(r)}function Wn(){return window.crypto.getRandomValues(gi),gi[0]}function ye(){const r=Date.now(),e=Wn()*1024+(Wn()&1023),t=new Uint8Array(16),n=Math.trunc(e/2**30),o=e&2**30-1,i=Wn();t[0]=r/2**40,t[1]=r/2**32,t[2]=r/2**24,t[3]=r/2**16,t[4]=r/2**8,t[5]=r,t[6]=112|n>>>8,t[7]=n,t[8]=128|o>>>24,t[9]=o>>>16,t[10]=o>>>8,t[11]=o,t[12]=i>>>24,t[13]=i>>>16,t[14]=i>>>8,t[15]=i;let s="";for(let a=0;a<t.length;a++)s+=ui.charAt(t[a]>>>4),s+=ui.charAt(t[a]&15),(a===3||a===5||a===7||a===9)&&(s+="-");return s}async function Ou(r,e){return window.crypto.subtle.generateKey(Co,r,e)}async function Qn(r){return window.crypto.subtle.exportKey(Ma,r)}async function Nu(r,e,t){return window.crypto.subtle.importKey(Ma,r,Co,e,t)}async function Mu(r,e){return window.crypto.subtle.sign(Co,r,e)}async function To(){const r=await Ha(),t={alg:"dir",kty:"oct",k:He(new Uint8Array(r))};return Pt(JSON.stringify(t))}async function Uu(r){const e=ne(r),n=JSON.parse(e).k,o=xe(n);return window.crypto.subtle.importKey(mo,o,ut,!1,[yo])}async function Du(r,e){const t=e.split(".");if(t.length!==5)throw T(Gt,"jwe_length");const n=await Uu(r).catch(()=>{throw T(Gt,"import_key")});try{const o=new TextEncoder().encode(t[0]),i=xe(t[2]),s=xe(t[3]),a=xe(t[4]),c=a.byteLength*8,l=new Uint8Array(s.length+a.length);l.set(s),l.set(a,s.length);const h=await window.crypto.subtle.decrypt({name:ut,iv:i,tagLength:c,additionalData:o},n,l);return new TextDecoder().decode(h)}catch{throw T(Gt,"decrypt")}}async function Ha(){const r=await window.crypto.subtle.generateKey({name:ut,length:256},!0,[La,yo]);return window.crypto.subtle.exportKey(mo,r)}async function fi(r){return window.crypto.subtle.importKey(mo,r,Da,!1,[bu])}async function Fa(r,e,t){return window.crypto.subtle.deriveKey({name:Da,salt:e,hash:po,info:new TextEncoder().encode(t)},r,{name:ut,length:256},!1,[La,yo])}async function Lu(r,e,t){const n=new TextEncoder().encode(e),o=window.crypto.getRandomValues(new Uint8Array(16)),i=await Fa(r,o,t),s=await window.crypto.subtle.encrypt({name:ut,iv:new Uint8Array(12)},i,n);return{data:He(new Uint8Array(s)),nonce:He(o)}}async function pi(r,e,t,n){const o=xe(n),i=await Fa(r,xe(e),t),s=await window.crypto.subtle.decrypt({name:ut,iv:new Uint8Array(12)},i,o);return new TextDecoder().decode(s)}async function Ba(r){const e=await xa(r),t=new Uint8Array(e);return He(t)}const Un="storage_not_supported",G="stubbed_public_client_application_called",Ao="in_mem_redirect_unavailable";const zt={[Un]:"Given storage configuration option was not supported.",[G]:"Stub instance of Public Client Application was called. If using msal-react, please ensure context is not used without a provider. For more visit: aka.ms/msaljs/browser-errors",[Ao]:"Redirect cannot be supported. In-memory storage was selected and storeAuthStateInCookie=false, which would cause the library to be unable to handle the incoming hash. If you would like to use the redirect API, please use session/localStorage or set storeAuthStateInCookie=true."};zt[Un],zt[G],zt[Ao];class Io extends L{constructor(e,t){super(e,t),this.name="BrowserConfigurationAuthError",Object.setPrototypeOf(this,Io.prototype)}}function K(r){return new Io(r,zt[r])}function Ka(r){r.location.hash="",typeof r.history.replaceState=="function"&&r.history.replaceState(null,"",`${r.location.origin}${r.location.pathname}${r.location.search}`)}function xu(r){const e=r.split("#");e.shift(),window.location.hash=e.length>0?e.join("#"):""}function wo(){return window.parent!==window}function Hu(){return typeof window<"u"&&!!window.opener&&window.opener!==window&&typeof window.name=="string"&&window.name.indexOf(`${re.POPUP_NAME_PREFIX}.`)===0}function be(){return typeof window<"u"&&window.location?window.location.href.split("?")[0].split("#")[0]:""}function Fu(){const e=new N(window.location.href).getUrlComponents();return`${e.Protocol}//${e.HostNameAndPort}/`}function Bu(){if(N.hashContainsKnownProperties(window.location.hash)&&wo())throw T(fa)}function Ku(r){if(wo()&&!r)throw T(ga)}function $u(){if(Hu())throw T(pa)}function $a(){if(typeof window>"u")throw T(Mn)}function Ga(r){if(!r)throw T(Et)}function Eo(r){$a(),Bu(),$u(),Ga(r)}function mi(r,e){if(Eo(r),Ku(e.system.allowRedirectInIframe),e.cache.cacheLocation===Y.MemoryStorage&&!e.cache.storeAuthStateInCookie)throw K(Ao)}function za(r){const e=document.createElement("link");e.rel="preconnect",e.href=new URL(r).origin,e.crossOrigin="anonymous",document.head.appendChild(e),window.setTimeout(()=>{try{document.head.removeChild(e)}catch{}},1e4)}function Gu(){return ye()}class un{navigateInternal(e,t){return un.defaultNavigateWindow(e,t)}navigateExternal(e,t){return un.defaultNavigateWindow(e,t)}static defaultNavigateWindow(e,t){return t.noHistory?window.location.replace(e):window.location.assign(e),new Promise((n,o)=>{setTimeout(()=>{o(T(hn,"failed_to_redirect"))},t.timeout)})}}class zu{async sendGetRequestAsync(e,t){let n,o={},i=0;const s=yi(t);try{n=await fetch(e,{method:di.GET,headers:s})}catch(a){throw At(T(window.navigator.onLine?Aa:dn),void 0,void 0,a)}o=Ci(n.headers);try{return i=n.status,{headers:o,body:await n.json(),status:i}}catch(a){throw At(T(lr),i,o,a)}}async sendPostRequestAsync(e,t){const n=t&&t.body||"",o=yi(t);let i,s=0,a={};try{i=await fetch(e,{method:di.POST,headers:o,body:n})}catch(c){throw At(T(window.navigator.onLine?Ta:dn),void 0,void 0,c)}a=Ci(i.headers);try{return s=i.status,{headers:a,body:await i.json(),status:s}}catch(c){throw At(T(lr),s,a,c)}}}function yi(r){try{const e=new Headers;if(!(r&&r.headers))return e;const t=r.headers;return Object.entries(t).forEach(([n,o])=>{e.append(n,o)}),e}catch(e){throw At(T(Oa),void 0,void 0,e)}}function Ci(r){try{const e={};return r.forEach((t,n)=>{e[n]=t}),e}catch{throw T(Na)}}const qu=6e4,hr=1e4,ju=3e4,qa=2e3;function Vu({auth:r,cache:e,system:t,telemetry:n},o){const i={clientId:p.EMPTY_STRING,authority:`${p.DEFAULT_AUTHORITY}`,knownAuthorities:[],cloudDiscoveryMetadata:p.EMPTY_STRING,authorityMetadata:p.EMPTY_STRING,redirectUri:typeof window<"u"?be():"",postLogoutRedirectUri:p.EMPTY_STRING,navigateToLoginRequestUrl:!0,clientCapabilities:[],protocolMode:oe.AAD,OIDCOptions:{serverResponseType:Tn.FRAGMENT,defaultScopes:[p.OPENID_SCOPE,p.PROFILE_SCOPE,p.OFFLINE_ACCESS_SCOPE]},azureCloudOptions:{azureCloudInstance:Dr.None,tenant:p.EMPTY_STRING},skipAuthorityMetadataCache:!1,supportsNestedAppAuth:!1,instanceAware:!1,encodeExtraQueryParams:!1},s={cacheLocation:Y.SessionStorage,cacheRetentionDays:5,temporaryCacheLocation:Y.SessionStorage,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!!(e&&e.cacheLocation===Y.LocalStorage),claimsBasedCachingEnabled:!1},a={loggerCallback:()=>{},logLevel:H.Info,piiLoggingEnabled:!1},l={...{...Ms,loggerOptions:a,networkClient:o?new zu:iu,navigationClient:new un,loadFrameTimeout:0,windowHashTimeout:t?.loadFrameTimeout||qu,iframeHashTimeout:t?.loadFrameTimeout||hr,navigateFrameWait:0,redirectNavigationTimeout:ju,asyncPopups:!1,allowRedirectInIframe:!1,allowPlatformBroker:!1,allowPlatformBrokerWithDOM:!1,nativeBrokerHandshakeTimeout:t?.nativeBrokerHandshakeTimeout||qa,pollIntervalMilliseconds:re.DEFAULT_POLL_INTERVAL_MS},...t,loggerOptions:t?.loggerOptions||a},h={application:{appName:p.EMPTY_STRING,appVersion:p.EMPTY_STRING},client:new Ns};if(r?.protocolMode!==oe.OIDC&&r?.OIDCOptions&&new _e(l.loggerOptions).warning(JSON.stringify(D(ws))),r?.protocolMode&&r.protocolMode===oe.OIDC&&l?.allowPlatformBroker)throw D(Es);return{auth:{...i,...r,OIDCOptions:{...i.OIDCOptions,...r?.OIDCOptions}},cache:{...s,...e},system:l,telemetry:{...h,...n}}}const Wu="@azure/msal-browser",je="4.27.0";const Z="msal",ja="browser",Ti="|",J=2,qt=2,Qu=`${Z}.${ja}.log.level`,Yu=`${Z}.${ja}.log.pii`,Ai=`${Z}.version`,Ii="account.keys",wi="token.keys";function rt(r=qt){return r<1?`${Z}.${Ii}`:`${Z}.${r}.${Ii}`}function ot(r,e=J){return e<1?`${Z}.${wi}.${r}`:`${Z}.${e}.${wi}.${r}`}class vo{static loggerCallback(e,t){switch(e){case H.Error:console.error(t);return;case H.Info:console.info(t);return;case H.Verbose:console.debug(t);return;case H.Warning:console.warn(t);return;default:console.log(t);return}}constructor(e){this.browserEnvironment=typeof window<"u",this.config=Vu(e,this.browserEnvironment);let t;try{t=window[Y.SessionStorage]}catch{}const n=t?.getItem(Qu),o=t?.getItem(Yu)?.toLowerCase(),i=o==="true"?!0:o==="false"?!1:void 0,s={...this.config.system.loggerOptions},a=n&&Object.keys(H).includes(n)?H[n]:void 0;a&&(s.loggerCallback=vo.loggerCallback,s.logLevel=a),i!==void 0&&(s.piiLoggingEnabled=i),this.logger=new _e(s,Wu,je),this.available=!1}getConfig(){return this.config}getLogger(){return this.logger}isAvailable(){return this.available}isBrowserEnvironment(){return this.browserEnvironment}}class Ve extends vo{getModuleName(){return Ve.MODULE_NAME}getId(){return Ve.ID}async initialize(){return this.available=typeof window<"u",this.available}}Ve.MODULE_NAME="";Ve.ID="StandardOperatingContext";class Ju{constructor(){this.dbName=dr,this.version=Iu,this.tableName=wu,this.dbOpen=!1}async open(){return new Promise((e,t)=>{const n=window.indexedDB.open(this.dbName,this.version);n.addEventListener("upgradeneeded",o=>{o.target.result.createObjectStore(this.tableName)}),n.addEventListener("success",o=>{const i=o;this.db=i.target.result,this.dbOpen=!0,e()}),n.addEventListener("error",()=>t(T(go)))})}closeConnection(){const e=this.db;e&&this.dbOpen&&(e.close(),this.dbOpen=!1)}async validateDbIsOpen(){if(!this.dbOpen)return this.open()}async getItem(e){return await this.validateDbIsOpen(),new Promise((t,n)=>{if(!this.db)return n(T(Xe));const s=this.db.transaction([this.tableName],"readonly").objectStore(this.tableName).get(e);s.addEventListener("success",a=>{const c=a;this.closeConnection(),t(c.target.result)}),s.addEventListener("error",a=>{this.closeConnection(),n(a)})})}async setItem(e,t){return await this.validateDbIsOpen(),new Promise((n,o)=>{if(!this.db)return o(T(Xe));const a=this.db.transaction([this.tableName],"readwrite").objectStore(this.tableName).put(t,e);a.addEventListener("success",()=>{this.closeConnection(),n()}),a.addEventListener("error",c=>{this.closeConnection(),o(c)})})}async removeItem(e){return await this.validateDbIsOpen(),new Promise((t,n)=>{if(!this.db)return n(T(Xe));const s=this.db.transaction([this.tableName],"readwrite").objectStore(this.tableName).delete(e);s.addEventListener("success",()=>{this.closeConnection(),t()}),s.addEventListener("error",a=>{this.closeConnection(),n(a)})})}async getKeys(){return await this.validateDbIsOpen(),new Promise((e,t)=>{if(!this.db)return t(T(Xe));const i=this.db.transaction([this.tableName],"readonly").objectStore(this.tableName).getAllKeys();i.addEventListener("success",s=>{const a=s;this.closeConnection(),e(a.target.result)}),i.addEventListener("error",s=>{this.closeConnection(),t(s)})})}async containsKey(e){return await this.validateDbIsOpen(),new Promise((t,n)=>{if(!this.db)return n(T(Xe));const s=this.db.transaction([this.tableName],"readonly").objectStore(this.tableName).count(e);s.addEventListener("success",a=>{const c=a;this.closeConnection(),t(c.target.result===1)}),s.addEventListener("error",a=>{this.closeConnection(),n(a)})})}async deleteDatabase(){return this.db&&this.dbOpen&&this.closeConnection(),new Promise((e,t)=>{const n=window.indexedDB.deleteDatabase(dr),o=setTimeout(()=>t(!1),200);n.addEventListener("success",()=>(clearTimeout(o),e(!0))),n.addEventListener("blocked",()=>(clearTimeout(o),e(!0))),n.addEventListener("error",()=>(clearTimeout(o),t(!1)))})}}class Dn{constructor(){this.cache=new Map}async initialize(){}getItem(e){return this.cache.get(e)||null}getUserData(e){return this.getItem(e)}setItem(e,t){this.cache.set(e,t)}async setUserData(e,t){this.setItem(e,t)}removeItem(e){this.cache.delete(e)}getKeys(){const e=[];return this.cache.forEach((t,n)=>{e.push(n)}),e}containsKey(e){return this.cache.has(e)}clear(){this.cache.clear()}decryptData(){return Promise.resolve(null)}}class Xu{constructor(e){this.inMemoryCache=new Dn,this.indexedDBCache=new Ju,this.logger=e}handleDatabaseAccessError(e){if(e instanceof Mt&&e.errorCode===go)this.logger.error("Could not access persistent storage. This may be caused by browser privacy features which block persistent storage in third-party contexts.");else throw e}async getItem(e){const t=this.inMemoryCache.getItem(e);if(!t)try{return this.logger.verbose("Queried item not found in in-memory cache, now querying persistent storage."),await this.indexedDBCache.getItem(e)}catch(n){this.handleDatabaseAccessError(n)}return t}async setItem(e,t){this.inMemoryCache.setItem(e,t);try{await this.indexedDBCache.setItem(e,t)}catch(n){this.handleDatabaseAccessError(n)}}async removeItem(e){this.inMemoryCache.removeItem(e);try{await this.indexedDBCache.removeItem(e)}catch(t){this.handleDatabaseAccessError(t)}}async getKeys(){const e=this.inMemoryCache.getKeys();if(e.length===0)try{return this.logger.verbose("In-memory cache is empty, now querying persistent storage."),await this.indexedDBCache.getKeys()}catch(t){this.handleDatabaseAccessError(t)}return e}async containsKey(e){const t=this.inMemoryCache.containsKey(e);if(!t)try{return this.logger.verbose("Key not found in in-memory cache, now querying persistent storage."),await this.indexedDBCache.containsKey(e)}catch(n){this.handleDatabaseAccessError(n)}return t}clearInMemory(){this.logger.verbose("Deleting in-memory keystore"),this.inMemoryCache.clear(),this.logger.verbose("In-memory keystore deleted")}async clearPersistent(){try{this.logger.verbose("Deleting persistent keystore");const e=await this.indexedDBCache.deleteDatabase();return e&&this.logger.verbose("Persistent keystore deleted"),e}catch(e){return this.handleDatabaseAccessError(e),!1}}}class Re{constructor(e,t,n){this.logger=e,Ru(n??!1),this.cache=new Xu(this.logger),this.performanceClient=t}createNewGuid(){return ye()}base64Encode(e){return Pt(e)}base64Decode(e){return ne(e)}base64UrlEncode(e){return Kt(e)}encodeKid(e){return this.base64UrlEncode(JSON.stringify({kid:e}))}async getPublicKeyThumbprint(e){const t=this.performanceClient?.startMeasurement(d.CryptoOptsGetPublicKeyThumbprint,e.correlationId),n=await Ou(Re.EXTRACTABLE,Re.POP_KEY_USAGES),o=await Qn(n.publicKey),i={e:o.e,kty:o.kty,n:o.n},s=Ei(i),a=await this.hashString(s),c=await Qn(n.privateKey),l=await Nu(c,!1,["sign"]);return await this.cache.setItem(a,{privateKey:l,publicKey:n.publicKey,requestMethod:e.resourceRequestMethod,requestUri:e.resourceRequestUri}),t&&t.end({success:!0}),a}async removeTokenBindingKey(e){if(await this.cache.removeItem(e),await this.cache.containsKey(e))throw y(ds)}async clearKeystore(){this.cache.clearInMemory();try{return await this.cache.clearPersistent(),!0}catch(e){return e instanceof Error?this.logger.error(`Clearing keystore failed with error: ${e.message}`):this.logger.error("Clearing keystore failed with unknown error"),!1}}async signJwt(e,t,n,o){const i=this.performanceClient?.startMeasurement(d.CryptoOptsSignJwt,o),s=await this.cache.getItem(t);if(!s)throw T(uo);const a=await Qn(s.publicKey),c=Ei(a),l=Kt(JSON.stringify({kid:t})),h=ao.getShrHeaderString({...n?.header,alg:a.alg,kid:l}),u=Kt(h);e.cnf={jwk:JSON.parse(c)};const g=Kt(JSON.stringify(e)),m=`${u}.${g}`,w=new TextEncoder().encode(m),P=await Mu(s.privateKey,w),b=He(new Uint8Array(P)),v=`${m}.${b}`;return i&&i.end({success:!0}),v}async hashString(e){return Ba(e)}}Re.POP_KEY_USAGES=["sign","verify"];Re.EXTRACTABLE=!0;function Ei(r){return JSON.stringify(r,Object.keys(r).sort())}const Zu=1440*60*1e3,ur={Lax:"Lax",None:"None"};class Va{initialize(){return Promise.resolve()}getItem(e){const t=`${encodeURIComponent(e)}`,n=document.cookie.split(";");for(let o=0;o<n.length;o++){const i=n[o],[s,...a]=decodeURIComponent(i).trim().split("="),c=a.join("=");if(s===t)return c}return""}getUserData(){throw y(_)}setItem(e,t,n,o=!0,i=ur.Lax){let s=`${encodeURIComponent(e)}=${encodeURIComponent(t)};path=/;SameSite=${i};`;if(n){const a=eg(n);s+=`expires=${a};`}(o||i===ur.None)&&(s+="Secure;"),document.cookie=s}async setUserData(){return Promise.reject(y(_))}removeItem(e){this.setItem(e,"",-1)}getKeys(){const e=document.cookie.split(";"),t=[];return e.forEach(n=>{const o=decodeURIComponent(n).trim().split("=");t.push(o[0])}),t}containsKey(e){return this.getKeys().includes(e)}decryptData(){return Promise.resolve(null)}}function eg(r){const e=new Date;return new Date(e.getTime()+r*Zu).toUTCString()}function Oe(r,e){const t=r.getItem(rt(e));return t?JSON.parse(t):[]}function ue(r,e,t){const n=e.getItem(ot(r,t));if(n){const o=JSON.parse(n);if(o&&o.hasOwnProperty("idToken")&&o.hasOwnProperty("accessToken")&&o.hasOwnProperty("refreshToken"))return o}return{idToken:[],accessToken:[],refreshToken:[]}}function jt(r){return r.hasOwnProperty("id")&&r.hasOwnProperty("nonce")&&r.hasOwnProperty("data")}const vi="msal.cache.encryption",tg="msal.broadcast.cache";class ng{constructor(e,t,n){if(!window.localStorage)throw K(Un);this.memoryStorage=new Dn,this.initialized=!1,this.clientId=e,this.logger=t,this.performanceClient=n,this.broadcast=new BroadcastChannel(tg)}async initialize(e){const t=new Va,n=t.getItem(vi);let o={key:"",id:""};if(n)try{o=JSON.parse(n)}catch{}if(o.key&&o.id){const i=de(xe,d.Base64Decode,this.logger,this.performanceClient,e)(o.key);this.encryptionCookie={id:o.id,key:await f(fi,d.GenerateHKDF,this.logger,this.performanceClient,e)(i)}}else{const i=ye(),s=await f(Ha,d.GenerateBaseKey,this.logger,this.performanceClient,e)(),a=de(He,d.UrlEncodeArr,this.logger,this.performanceClient,e)(new Uint8Array(s));this.encryptionCookie={id:i,key:await f(fi,d.GenerateHKDF,this.logger,this.performanceClient,e)(s)};const c={id:i,key:a};t.setItem(vi,JSON.stringify(c),0,!0,ur.None)}await f(this.importExistingCache.bind(this),d.ImportExistingCache,this.logger,this.performanceClient,e)(e),this.broadcast.addEventListener("message",this.updateCache.bind(this)),this.initialized=!0}getItem(e){return window.localStorage.getItem(e)}getUserData(e){if(!this.initialized)throw T(Et);return this.memoryStorage.getItem(e)}async decryptData(e,t,n){if(!this.initialized||!this.encryptionCookie)throw T(Et);if(t.id!==this.encryptionCookie.id)return this.performanceClient.incrementFields({encryptedCacheExpiredCount:1},n),null;const o=await f(pi,d.Decrypt,this.logger,this.performanceClient,n)(this.encryptionCookie.key,t.nonce,this.getContext(e),t.data);if(!o)return null;try{return{...JSON.parse(o),lastUpdatedAt:t.lastUpdatedAt}}catch{return this.performanceClient.incrementFields({encryptedCacheCorruptionCount:1},n),null}}setItem(e,t){window.localStorage.setItem(e,t)}async setUserData(e,t,n,o,i){if(!this.initialized||!this.encryptionCookie)throw T(Et);if(i)this.setItem(e,t);else{const{data:s,nonce:a}=await f(Lu,d.Encrypt,this.logger,this.performanceClient,n)(this.encryptionCookie.key,t,this.getContext(e)),c={id:this.encryptionCookie.id,nonce:a,data:s,lastUpdatedAt:o};this.setItem(e,JSON.stringify(c))}this.memoryStorage.setItem(e,t),this.broadcast.postMessage({key:e,value:t,context:this.getContext(e)})}removeItem(e){this.memoryStorage.containsKey(e)&&(this.memoryStorage.removeItem(e),this.broadcast.postMessage({key:e,value:null,context:this.getContext(e)})),window.localStorage.removeItem(e)}getKeys(){return Object.keys(window.localStorage)}containsKey(e){return window.localStorage.hasOwnProperty(e)}clear(){this.memoryStorage.clear(),Oe(this).forEach(n=>this.removeItem(n));const t=ue(this.clientId,this);t.idToken.forEach(n=>this.removeItem(n)),t.accessToken.forEach(n=>this.removeItem(n)),t.refreshToken.forEach(n=>this.removeItem(n)),this.getKeys().forEach(n=>{(n.startsWith(Z)||n.indexOf(this.clientId)!==-1)&&this.removeItem(n)})}async importExistingCache(e){if(!this.encryptionCookie)return;let t=Oe(this);t=await this.importArray(t,e),t.length?this.setItem(rt(),JSON.stringify(t)):this.removeItem(rt());const n=ue(this.clientId,this);n.idToken=await this.importArray(n.idToken,e),n.accessToken=await this.importArray(n.accessToken,e),n.refreshToken=await this.importArray(n.refreshToken,e),n.idToken.length||n.accessToken.length||n.refreshToken.length?this.setItem(ot(this.clientId),JSON.stringify(n)):this.removeItem(ot(this.clientId))}async getItemFromEncryptedCache(e,t){if(!this.encryptionCookie)return null;const n=this.getItem(e);if(!n)return null;let o;try{o=JSON.parse(n)}catch{return null}return jt(o)?o.id!==this.encryptionCookie.id?(this.performanceClient.incrementFields({encryptedCacheExpiredCount:1},t),null):(this.performanceClient.incrementFields({encryptedCacheCount:1},t),f(pi,d.Decrypt,this.logger,this.performanceClient,t)(this.encryptionCookie.key,o.nonce,this.getContext(e),o.data)):(this.performanceClient.incrementFields({unencryptedCacheCount:1},t),n)}async importArray(e,t){const n=[],o=[];return e.forEach(i=>{const s=this.getItemFromEncryptedCache(i,t).then(a=>{a?(this.memoryStorage.setItem(i,a),n.push(i)):this.removeItem(i)});o.push(s)}),await Promise.all(o),n}getContext(e){let t="";return e.includes(this.clientId)&&(t=this.clientId),t}updateCache(e){this.logger.trace("Updating internal cache from broadcast event");const t=this.performanceClient.startMeasurement(d.LocalStorageUpdated);t.add({isBackground:!0});const{key:n,value:o,context:i}=e.data;if(!n){this.logger.error("Broadcast event missing key"),t.end({success:!1,errorCode:"noKey"});return}if(i&&i!==this.clientId){this.logger.trace(`Ignoring broadcast event from clientId: ${i}`),t.end({success:!1,errorCode:"contextMismatch"});return}o?(this.memoryStorage.setItem(n,o),this.logger.verbose("Updated item in internal cache")):(this.memoryStorage.removeItem(n),this.logger.verbose("Removed item from internal cache")),t.end({success:!0})}}class rg{constructor(){if(!window.sessionStorage)throw K(Un)}async initialize(){}getItem(e){return window.sessionStorage.getItem(e)}getUserData(e){return this.getItem(e)}setItem(e,t){window.sessionStorage.setItem(e,t)}async setUserData(e,t){this.setItem(e,t)}removeItem(e){window.sessionStorage.removeItem(e)}getKeys(){return Object.keys(window.sessionStorage)}containsKey(e){return window.sessionStorage.hasOwnProperty(e)}decryptData(){return Promise.resolve(null)}}const A={INITIALIZE_START:"msal:initializeStart",INITIALIZE_END:"msal:initializeEnd",ACCOUNT_ADDED:"msal:accountAdded",ACCOUNT_REMOVED:"msal:accountRemoved",ACTIVE_ACCOUNT_CHANGED:"msal:activeAccountChanged",LOGIN_START:"msal:loginStart",LOGIN_SUCCESS:"msal:loginSuccess",LOGIN_FAILURE:"msal:loginFailure",ACQUIRE_TOKEN_START:"msal:acquireTokenStart",ACQUIRE_TOKEN_SUCCESS:"msal:acquireTokenSuccess",ACQUIRE_TOKEN_FAILURE:"msal:acquireTokenFailure",ACQUIRE_TOKEN_NETWORK_START:"msal:acquireTokenFromNetworkStart",SSO_SILENT_START:"msal:ssoSilentStart",SSO_SILENT_SUCCESS:"msal:ssoSilentSuccess",SSO_SILENT_FAILURE:"msal:ssoSilentFailure",ACQUIRE_TOKEN_BY_CODE_START:"msal:acquireTokenByCodeStart",ACQUIRE_TOKEN_BY_CODE_SUCCESS:"msal:acquireTokenByCodeSuccess",ACQUIRE_TOKEN_BY_CODE_FAILURE:"msal:acquireTokenByCodeFailure",HANDLE_REDIRECT_START:"msal:handleRedirectStart",HANDLE_REDIRECT_END:"msal:handleRedirectEnd",POPUP_OPENED:"msal:popupOpened",LOGOUT_START:"msal:logoutStart",LOGOUT_SUCCESS:"msal:logoutSuccess",LOGOUT_FAILURE:"msal:logoutFailure",LOGOUT_END:"msal:logoutEnd",RESTORE_FROM_BFCACHE:"msal:restoreFromBFCache",BROKER_CONNECTION_ESTABLISHED:"msal:brokerConnectionEstablished"};function Pe(r,e){const t=r.indexOf(e);t>-1&&r.splice(t,1)}class gr extends sr{constructor(e,t,n,o,i,s,a){super(e,n,o,i,a),this.cacheConfig=t,this.logger=o,this.internalStorage=new Dn,this.browserStorage=Si(e,t.cacheLocation,o,i),this.temporaryCacheStorage=Si(e,t.temporaryCacheLocation,o,i),this.cookieStorage=new Va,this.eventHandler=s}async initialize(e){this.performanceClient.addFields({cacheLocation:this.cacheConfig.cacheLocation,cacheRetentionDays:this.cacheConfig.cacheRetentionDays},e),await this.browserStorage.initialize(e),await this.migrateExistingCache(e),this.trackVersionChanges(e)}async migrateExistingCache(e){let t=Oe(this.browserStorage),n=ue(this.clientId,this.browserStorage);this.performanceClient.addFields({preMigrateAcntCount:t.length,preMigrateATCount:n.accessToken.length,preMigrateITCount:n.idToken.length,preMigrateRTCount:n.refreshToken.length},e);for(let i=0;i<qt;i++){const s=i;await this.removeStaleAccounts(i,s,e)}for(let i=0;i<J;i++){const s=i;await this.migrateIdTokens(i,s,e)}const o=this.getKMSIValues();for(let i=0;i<J;i++)await this.migrateAccessTokens(i,o,e),await this.migrateRefreshTokens(i,o,e);t=Oe(this.browserStorage),n=ue(this.clientId,this.browserStorage),this.performanceClient.addFields({postMigrateAcntCount:t.length,postMigrateATCount:n.accessToken.length,postMigrateITCount:n.idToken.length,postMigrateRTCount:n.refreshToken.length},e)}async updateOldEntry(e,t){const n=this.browserStorage.getItem(e),o=this.validateAndParseJson(n||"");if(!o)return this.browserStorage.removeItem(e),null;if(!o.lastUpdatedAt)o.lastUpdatedAt=Date.now().toString(),this.setItem(e,JSON.stringify(o),t);else if(ni(o.lastUpdatedAt,this.cacheConfig.cacheRetentionDays))return this.browserStorage.removeItem(e),this.performanceClient.incrementFields({expiredCacheRemovedCount:1},t),null;const i=jt(o)?await this.browserStorage.decryptData(e,o,t):o;return!i||!bn(i)?(this.performanceClient.incrementFields({invalidCacheCount:1},t),null):(ri(i)||oi(i))&&i.expiresOn&&an(i.expiresOn,Wi)?(this.browserStorage.removeItem(e),this.performanceClient.incrementFields({expiredCacheRemovedCount:1},t),null):i}async removeStaleAccounts(e,t,n){const o=Oe(this.browserStorage,e);if(o.length!==0){for(const i of[...o]){this.performanceClient.incrementFields({oldAcntCount:1},n);const s=this.browserStorage.getItem(i),a=this.validateAndParseJson(s||"");if(!a){Pe(o,i);continue}if(a.lastUpdatedAt)ni(a.lastUpdatedAt,this.cacheConfig.cacheRetentionDays)&&(await this.removeAccountOldSchema(i,a,t,n),Pe(o,i));else{a.lastUpdatedAt=Date.now().toString(),this.setItem(i,JSON.stringify(a),n);continue}}this.setAccountKeys(o,n,e)}}async removeAccountOldSchema(e,t,n,o){const s=(jt(t)?await this.browserStorage.decryptData(e,t,o):t)?.homeAccountId;if(s){const a=this.getTokenKeys(n);[...a.idToken].filter(c=>c.includes(s)).forEach(c=>{this.browserStorage.removeItem(c),Pe(a.idToken,c)}),[...a.accessToken].filter(c=>c.includes(s)).forEach(c=>{this.browserStorage.removeItem(c),Pe(a.accessToken,c)}),[...a.refreshToken].filter(c=>c.includes(s)).forEach(c=>{this.browserStorage.removeItem(c),Pe(a.refreshToken,c)}),this.setTokenKeys(a,o,n)}this.performanceClient.incrementFields({expiredAcntRemovedCount:1},o),this.browserStorage.removeItem(e)}getKMSIValues(){const e={},t=this.getTokenKeys().idToken;for(const n of t){const o=this.browserStorage.getUserData(n);if(o){const i=JSON.parse(o),s=Ae(i.secret,ne);s&&(e[i.homeAccountId]=Ie(s))}}return e}async migrateIdTokens(e,t,n){const o=ue(this.clientId,this.browserStorage,e);if(o.idToken.length===0)return;const i=ue(this.clientId,this.browserStorage,J),s=Oe(this.browserStorage),a=Oe(this.browserStorage,t);for(const c of[...o.idToken]){this.performanceClient.incrementFields({oldITCount:1},n);const l=await this.updateOldEntry(c,n);if(!l){Pe(o.idToken,c);continue}const h=s.find(v=>v.includes(l.homeAccountId)),u=a.find(v=>v.includes(l.homeAccountId));let g=null;if(h)g=this.getAccount(h,n);else if(u){const v=this.browserStorage.getItem(u),O=this.validateAndParseJson(v||"");g=O&&jt(O)?await this.browserStorage.decryptData(u,O,n):O}if(!g){this.performanceClient.incrementFields({skipITMigrateCount:1},n);continue}const m=Ae(l.secret,ne),I=this.generateCredentialKey(l),w=this.getIdTokenCredential(I,n),P=Object.keys(m).includes("signin_state"),b=w&&Object.keys(Ae(w.secret,ne)||{}).includes("signin_state");if(!w||l.lastUpdatedAt>w.lastUpdatedAt&&(P||!b)){const v=g.tenantProfiles||[],O=Kr(m)||g.realm;if(O&&!v.find(j=>j.tenantId===O)){const j=In(g.homeAccountId,g.localAccountId,O,m);v.push(j)}g.tenantProfiles=v;const S=this.generateAccountKey(B.getAccountInfo(g)),x=Ie(m);await this.setUserData(S,JSON.stringify(g),n,g.lastUpdatedAt,x),s.includes(S)||s.push(S),await this.setUserData(I,JSON.stringify(l),n,l.lastUpdatedAt,x),this.performanceClient.incrementFields({migratedITCount:1},n),i.idToken.push(I)}}this.setTokenKeys(o,n,e),this.setTokenKeys(i,n),this.setAccountKeys(s,n)}async migrateAccessTokens(e,t,n){const o=ue(this.clientId,this.browserStorage,e);if(o.accessToken.length===0)return;const i=ue(this.clientId,this.browserStorage,J);for(const s of[...o.accessToken]){this.performanceClient.incrementFields({oldATCount:1},n);const a=await this.updateOldEntry(s,n);if(!a){Pe(o.accessToken,s);continue}if(!Object.keys(t).includes(a.homeAccountId)){this.performanceClient.incrementFields({skipATMigrateCount:1},n);continue}const c=this.generateCredentialKey(a),l=t[a.homeAccountId];if(!i.accessToken.includes(c))await this.setUserData(c,JSON.stringify(a),n,a.lastUpdatedAt,l),this.performanceClient.incrementFields({migratedATCount:1},n),i.accessToken.push(c);else{const h=this.getAccessTokenCredential(c,n);(!h||a.lastUpdatedAt>h.lastUpdatedAt)&&(await this.setUserData(c,JSON.stringify(a),n,a.lastUpdatedAt,l),this.performanceClient.incrementFields({migratedATCount:1},n))}}this.setTokenKeys(o,n,e),this.setTokenKeys(i,n)}async migrateRefreshTokens(e,t,n){const o=ue(this.clientId,this.browserStorage,e);if(o.refreshToken.length===0)return;const i=ue(this.clientId,this.browserStorage,J);for(const s of[...o.refreshToken]){this.performanceClient.incrementFields({oldRTCount:1},n);const a=await this.updateOldEntry(s,n);if(!a){Pe(o.refreshToken,s);continue}if(!Object.keys(t).includes(a.homeAccountId)){this.performanceClient.incrementFields({skipRTMigrateCount:1},n);continue}const c=this.generateCredentialKey(a),l=t[a.homeAccountId];if(!i.refreshToken.includes(c))await this.setUserData(c,JSON.stringify(a),n,a.lastUpdatedAt,l),this.performanceClient.incrementFields({migratedRTCount:1},n),i.refreshToken.push(c);else{const h=this.getRefreshTokenCredential(c,n);(!h||a.lastUpdatedAt>h.lastUpdatedAt)&&(await this.setUserData(c,JSON.stringify(a),n,a.lastUpdatedAt,l),this.performanceClient.incrementFields({migratedRTCount:1},n))}}this.setTokenKeys(o,n,e),this.setTokenKeys(i,n)}trackVersionChanges(e){const t=this.browserStorage.getItem(Ai);t&&(this.logger.info(`MSAL.js was last initialized by version: ${t}`),this.performanceClient.addFields({previousLibraryVersion:t},e)),t!==je&&this.setItem(Ai,je,e)}validateAndParseJson(e){if(!e)return null;try{const t=JSON.parse(e);return t&&typeof t=="object"?t:null}catch{return null}}setItem(e,t,n){const o=new Array(J+1).fill(0),i=[],s=20;for(let a=0;a<=s;a++)try{if(this.browserStorage.setItem(e,t),a>0)for(let c=0;c<=J;c++){const l=o.slice(0,c).reduce((u,g)=>u+g,0);if(l>=a)break;const h=a>l+o[c]?l+o[c]:a;a>l&&o[c]>0&&this.removeAccessTokenKeys(i.slice(l,h),n,c)}break}catch(c){const l=ir(c);if(l.errorCode===nn&&a<s){if(!i.length)for(let h=0;h<=J;h++)if(e===ot(this.clientId,h)){const u=JSON.parse(t).accessToken;i.push(...u),o[h]=u.length}else{const u=this.getTokenKeys(h).accessToken;i.push(...u),o[h]=u.length}if(i.length<=a)throw l;this.removeAccessToken(i[a],n,!1)}else throw l}}async setUserData(e,t,n,o,i){const s=new Array(J+1).fill(0),a=[],c=20;for(let l=0;l<=c;l++)try{if(await f(this.browserStorage.setUserData.bind(this.browserStorage),d.SetUserData,this.logger,this.performanceClient)(e,t,n,o,i),l>0)for(let h=0;h<=J;h++){const u=s.slice(0,h).reduce((m,I)=>m+I,0);if(u>=l)break;const g=l>u+s[h]?u+s[h]:l;l>u&&s[h]>0&&this.removeAccessTokenKeys(a.slice(u,g),n,h)}break}catch(h){const u=ir(h);if(u.errorCode===nn&&l<c){if(!a.length)for(let g=0;g<=J;g++){const m=this.getTokenKeys(g).accessToken;a.push(...m),s[g]=m.length}if(a.length<=l)throw u;this.removeAccessToken(a[l],n,!1)}else throw u}}getAccount(e,t){this.logger.trace("BrowserCacheManager.getAccount called");const n=this.browserStorage.getUserData(e);if(!n)return this.removeAccountKeyFromMap(e,t),null;const o=this.validateAndParseJson(n);return!o||!B.isAccountEntity(o)?null:sr.toObject(new B,o)}async setAccount(e,t,n){this.logger.trace("BrowserCacheManager.setAccount called");const o=this.generateAccountKey(B.getAccountInfo(e)),i=Date.now().toString();e.lastUpdatedAt=i,await this.setUserData(o,JSON.stringify(e),t,i,n);const s=this.addAccountKeyToMap(o,t);this.performanceClient.addFields({kmsi:n},t),this.cacheConfig.cacheLocation===Y.LocalStorage&&s&&this.eventHandler.emitEvent(A.ACCOUNT_ADDED,void 0,B.getAccountInfo(e))}getAccountKeys(){return Oe(this.browserStorage)}setAccountKeys(e,t,n=qt){e.length===0?this.removeItem(rt(n)):this.setItem(rt(n),JSON.stringify(e),t)}addAccountKeyToMap(e,t){this.logger.trace("BrowserCacheManager.addAccountKeyToMap called"),this.logger.tracePii(`BrowserCacheManager.addAccountKeyToMap called with key: ${e}`);const n=this.getAccountKeys();return n.indexOf(e)===-1?(n.push(e),this.setItem(rt(),JSON.stringify(n),t),this.logger.verbose("BrowserCacheManager.addAccountKeyToMap account key added"),!0):(this.logger.verbose("BrowserCacheManager.addAccountKeyToMap account key already exists in map"),!1)}removeAccountKeyFromMap(e,t){this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap called"),this.logger.tracePii(`BrowserCacheManager.removeAccountKeyFromMap called with key: ${e}`);const n=this.getAccountKeys(),o=n.indexOf(e);o>-1?(n.splice(o,1),this.setAccountKeys(n,t),this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap account key removed")):this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap key not found in existing map")}removeAccount(e,t){const n=this.getActiveAccount(t);n?.homeAccountId===e.homeAccountId&&n?.environment===e.environment&&this.setActiveAccount(null,t),super.removeAccount(e,t),this.removeAccountKeyFromMap(this.generateAccountKey(e),t),this.browserStorage.getKeys().forEach(o=>{o.includes(e.homeAccountId)&&o.includes(e.environment)&&this.browserStorage.removeItem(o)}),this.cacheConfig.cacheLocation===Y.LocalStorage&&this.eventHandler.emitEvent(A.ACCOUNT_REMOVED,void 0,e)}removeIdToken(e,t){super.removeIdToken(e,t);const n=this.getTokenKeys(),o=n.idToken.indexOf(e);o>-1&&(this.logger.info("idToken removed from tokenKeys map"),n.idToken.splice(o,1),this.setTokenKeys(n,t))}removeAccessToken(e,t,n=!0){super.removeAccessToken(e,t),n&&this.removeAccessTokenKeys([e],t)}removeAccessTokenKeys(e,t,n=J){this.logger.trace("removeAccessTokenKey called");const o=this.getTokenKeys(n);let i=0;if(e.forEach(s=>{const a=o.accessToken.indexOf(s);a>-1&&(o.accessToken.splice(a,1),i++)}),i>0){this.logger.info(`removed ${i} accessToken keys from tokenKeys map`),this.setTokenKeys(o,t,n);return}}removeRefreshToken(e,t){super.removeRefreshToken(e,t);const n=this.getTokenKeys(),o=n.refreshToken.indexOf(e);o>-1&&(this.logger.info("refreshToken removed from tokenKeys map"),n.refreshToken.splice(o,1),this.setTokenKeys(n,t))}getTokenKeys(e=J){return ue(this.clientId,this.browserStorage,e)}setTokenKeys(e,t,n=J){if(e.idToken.length===0&&e.accessToken.length===0&&e.refreshToken.length===0){this.removeItem(ot(this.clientId,n));return}else this.setItem(ot(this.clientId,n),JSON.stringify(e),t)}getIdTokenCredential(e,t){const n=this.browserStorage.getUserData(e);if(!n)return this.logger.trace("BrowserCacheManager.getIdTokenCredential: called, no cache hit"),this.removeIdToken(e,t),null;const o=this.validateAndParseJson(n);return!o||!Kh(o)?(this.logger.trace("BrowserCacheManager.getIdTokenCredential: called, no cache hit"),null):(this.logger.trace("BrowserCacheManager.getIdTokenCredential: cache hit"),o)}async setIdTokenCredential(e,t,n){this.logger.trace("BrowserCacheManager.setIdTokenCredential called");const o=this.generateCredentialKey(e),i=Date.now().toString();e.lastUpdatedAt=i,await this.setUserData(o,JSON.stringify(e),t,i,n);const s=this.getTokenKeys();s.idToken.indexOf(o)===-1&&(this.logger.info("BrowserCacheManager: addTokenKey - idToken added to map"),s.idToken.push(o),this.setTokenKeys(s,t))}getAccessTokenCredential(e,t){const n=this.browserStorage.getUserData(e);if(!n)return this.logger.trace("BrowserCacheManager.getAccessTokenCredential: called, no cache hit"),this.removeAccessTokenKeys([e],t),null;const o=this.validateAndParseJson(n);return!o||!ri(o)?(this.logger.trace("BrowserCacheManager.getAccessTokenCredential: called, no cache hit"),null):(this.logger.trace("BrowserCacheManager.getAccessTokenCredential: cache hit"),o)}async setAccessTokenCredential(e,t,n){this.logger.trace("BrowserCacheManager.setAccessTokenCredential called");const o=this.generateCredentialKey(e),i=Date.now().toString();e.lastUpdatedAt=i,await this.setUserData(o,JSON.stringify(e),t,i,n);const s=this.getTokenKeys(),a=s.accessToken.indexOf(o);a!==-1&&s.accessToken.splice(a,1),this.logger.trace(`access token ${a===-1?"added to":"updated in"} map`),s.accessToken.push(o),this.setTokenKeys(s,t)}getRefreshTokenCredential(e,t){const n=this.browserStorage.getUserData(e);if(!n)return this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: called, no cache hit"),this.removeRefreshToken(e,t),null;const o=this.validateAndParseJson(n);return!o||!oi(o)?(this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: called, no cache hit"),null):(this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: cache hit"),o)}async setRefreshTokenCredential(e,t,n){this.logger.trace("BrowserCacheManager.setRefreshTokenCredential called");const o=this.generateCredentialKey(e),i=Date.now().toString();e.lastUpdatedAt=i,await this.setUserData(o,JSON.stringify(e),t,i,n);const s=this.getTokenKeys();s.refreshToken.indexOf(o)===-1&&(this.logger.info("BrowserCacheManager: addTokenKey - refreshToken added to map"),s.refreshToken.push(o),this.setTokenKeys(s,t))}getAppMetadata(e){const t=this.browserStorage.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getAppMetadata: called, no cache hit"),null;const n=this.validateAndParseJson(t);return!n||!qh(e,n)?(this.logger.trace("BrowserCacheManager.getAppMetadata: called, no cache hit"),null):(this.logger.trace("BrowserCacheManager.getAppMetadata: cache hit"),n)}setAppMetadata(e,t){this.logger.trace("BrowserCacheManager.setAppMetadata called");const n=zh(e);this.setItem(n,JSON.stringify(e),t)}getServerTelemetry(e){const t=this.browserStorage.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getServerTelemetry: called, no cache hit"),null;const n=this.validateAndParseJson(t);return!n||!$h(e,n)?(this.logger.trace("BrowserCacheManager.getServerTelemetry: called, no cache hit"),null):(this.logger.trace("BrowserCacheManager.getServerTelemetry: cache hit"),n)}setServerTelemetry(e,t,n){this.logger.trace("BrowserCacheManager.setServerTelemetry called"),this.setItem(e,JSON.stringify(t),n)}getAuthorityMetadata(e){const t=this.internalStorage.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getAuthorityMetadata: called, no cache hit"),null;const n=this.validateAndParseJson(t);return n&&jh(e,n)?(this.logger.trace("BrowserCacheManager.getAuthorityMetadata: cache hit"),n):null}getAuthorityMetadataKeys(){return this.internalStorage.getKeys().filter(t=>this.isAuthorityMetadata(t))}setWrapperMetadata(e,t){this.internalStorage.setItem(Bt.WRAPPER_SKU,e),this.internalStorage.setItem(Bt.WRAPPER_VER,t)}getWrapperMetadata(){const e=this.internalStorage.getItem(Bt.WRAPPER_SKU)||p.EMPTY_STRING,t=this.internalStorage.getItem(Bt.WRAPPER_VER)||p.EMPTY_STRING;return[e,t]}setAuthorityMetadata(e,t){this.logger.trace("BrowserCacheManager.setAuthorityMetadata called"),this.internalStorage.setItem(e,JSON.stringify(t))}getActiveAccount(e){const t=this.generateCacheKey(Go.ACTIVE_ACCOUNT_FILTERS),n=this.browserStorage.getItem(t);if(!n)return this.logger.trace("BrowserCacheManager.getActiveAccount: No active account filters found"),null;const o=this.validateAndParseJson(n);return o?(this.logger.trace("BrowserCacheManager.getActiveAccount: Active account filters schema found"),this.getAccountInfoFilteredBy({homeAccountId:o.homeAccountId,localAccountId:o.localAccountId,tenantId:o.tenantId},e)):(this.logger.trace("BrowserCacheManager.getActiveAccount: No active account found"),null)}setActiveAccount(e,t){const n=this.generateCacheKey(Go.ACTIVE_ACCOUNT_FILTERS);if(e){this.logger.verbose("setActiveAccount: Active account set");const o={homeAccountId:e.homeAccountId,localAccountId:e.localAccountId,tenantId:e.tenantId,lastUpdatedAt:ie().toString()};this.setItem(n,JSON.stringify(o),t)}else this.logger.verbose("setActiveAccount: No account passed, active account not set"),this.browserStorage.removeItem(n);this.eventHandler.emitEvent(A.ACTIVE_ACCOUNT_CHANGED)}getThrottlingCache(e){const t=this.browserStorage.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getThrottlingCache: called, no cache hit"),null;const n=this.validateAndParseJson(t);return!n||!Gh(e,n)?(this.logger.trace("BrowserCacheManager.getThrottlingCache: called, no cache hit"),null):(this.logger.trace("BrowserCacheManager.getThrottlingCache: cache hit"),n)}setThrottlingCache(e,t,n){this.logger.trace("BrowserCacheManager.setThrottlingCache called"),this.setItem(e,JSON.stringify(t),n)}getTemporaryCache(e,t){const n=t?this.generateCacheKey(e):e;if(this.cacheConfig.storeAuthStateInCookie){const i=this.cookieStorage.getItem(n);if(i)return this.logger.trace("BrowserCacheManager.getTemporaryCache: storeAuthStateInCookies set to true, retrieving from cookies"),i}const o=this.temporaryCacheStorage.getItem(n);if(!o){if(this.cacheConfig.cacheLocation===Y.LocalStorage){const i=this.browserStorage.getItem(n);if(i)return this.logger.trace("BrowserCacheManager.getTemporaryCache: Temporary cache item found in local storage"),i}return this.logger.trace("BrowserCacheManager.getTemporaryCache: No cache item found in local storage"),null}return this.logger.trace("BrowserCacheManager.getTemporaryCache: Temporary cache item returned"),o}setTemporaryCache(e,t,n){const o=n?this.generateCacheKey(e):e;this.temporaryCacheStorage.setItem(o,t),this.cacheConfig.storeAuthStateInCookie&&(this.logger.trace("BrowserCacheManager.setTemporaryCache: storeAuthStateInCookie set to true, setting item cookie"),this.cookieStorage.setItem(o,t,void 0,this.cacheConfig.secureCookies))}removeItem(e){this.browserStorage.removeItem(e)}removeTemporaryItem(e){this.temporaryCacheStorage.removeItem(e),this.cacheConfig.storeAuthStateInCookie&&(this.logger.trace("BrowserCacheManager.removeItem: storeAuthStateInCookie is true, clearing item cookie"),this.cookieStorage.removeItem(e))}getKeys(){return this.browserStorage.getKeys()}clear(e){this.removeAllAccounts(e),this.removeAppMetadata(e),this.temporaryCacheStorage.getKeys().forEach(t=>{(t.indexOf(Z)!==-1||t.indexOf(this.clientId)!==-1)&&this.removeTemporaryItem(t)}),this.browserStorage.getKeys().forEach(t=>{(t.indexOf(Z)!==-1||t.indexOf(this.clientId)!==-1)&&this.browserStorage.removeItem(t)}),this.internalStorage.clear()}clearTokensAndKeysWithClaims(e){this.performanceClient.addQueueMeasurement(d.ClearTokensAndKeysWithClaims,e);const t=this.getTokenKeys();let n=0;t.accessToken.forEach(o=>{const i=this.getAccessTokenCredential(o,e);i?.requestedClaimsHash&&o.includes(i.requestedClaimsHash.toLowerCase())&&(this.removeAccessToken(o,e),n++)}),n>0&&this.logger.warning(`${n} access tokens with claims in the cache keys have been removed from the cache.`)}generateCacheKey(e){return le.startsWith(e,Z)?e:`${Z}.${this.clientId}.${e}`}generateCredentialKey(e){const t=e.credentialType===W.REFRESH_TOKEN&&e.familyId||e.clientId,n=e.tokenType&&e.tokenType.toLowerCase()!==U.BEARER.toLowerCase()?e.tokenType.toLowerCase():"";return[`${Z}.${J}`,e.homeAccountId,e.environment,e.credentialType,t,e.realm||"",e.target||"",e.requestedClaimsHash||"",n].join(Ti).toLowerCase()}generateAccountKey(e){const t=e.homeAccountId.split(".")[1];return[`${Z}.${qt}`,e.homeAccountId,e.environment,t||e.tenantId||""].join(Ti).toLowerCase()}resetRequestCache(){this.logger.trace("BrowserCacheManager.resetRequestCache called"),this.removeTemporaryItem(this.generateCacheKey($.REQUEST_PARAMS)),this.removeTemporaryItem(this.generateCacheKey($.VERIFIER)),this.removeTemporaryItem(this.generateCacheKey($.ORIGIN_URI)),this.removeTemporaryItem(this.generateCacheKey($.URL_HASH)),this.removeTemporaryItem(this.generateCacheKey($.NATIVE_REQUEST)),this.setInteractionInProgress(!1)}cacheAuthorizeRequest(e,t){this.logger.trace("BrowserCacheManager.cacheAuthorizeRequest called");const n=Pt(JSON.stringify(e));if(this.setTemporaryCache($.REQUEST_PARAMS,n,!0),t){const o=Pt(t);this.setTemporaryCache($.VERIFIER,o,!0)}}getCachedRequest(){this.logger.trace("BrowserCacheManager.getCachedRequest called");const e=this.getTemporaryCache($.REQUEST_PARAMS,!0);if(!e)throw T(ya);const t=this.getTemporaryCache($.VERIFIER,!0);let n,o="";try{n=JSON.parse(ne(e)),t&&(o=ne(t))}catch(i){throw this.logger.errorPii(`Attempted to parse: ${e}`),this.logger.error(`Parsing cached token request threw with error: ${i}`),T(Ca)}return[n,o]}getCachedNativeRequest(){this.logger.trace("BrowserCacheManager.getCachedNativeRequest called");const e=this.getTemporaryCache($.NATIVE_REQUEST,!0);if(!e)return this.logger.trace("BrowserCacheManager.getCachedNativeRequest: No cached native request found"),null;const t=this.validateAndParseJson(e);return t||(this.logger.error("BrowserCacheManager.getCachedNativeRequest: Unable to parse native request"),null)}isInteractionInProgress(e){const t=this.getInteractionInProgress()?.clientId;return e?t===this.clientId:!!t}getInteractionInProgress(){const e=`${Z}.${$.INTERACTION_STATUS_KEY}`,t=this.getTemporaryCache(e,!1);try{return t?JSON.parse(t):null}catch{return this.logger.error("Cannot parse interaction status. Removing temporary cache items and clearing url hash. Retrying interaction should fix the error"),this.removeTemporaryItem(e),this.resetRequestCache(),Ka(window),null}}setInteractionInProgress(e,t=Ne.SIGNIN){const n=`${Z}.${$.INTERACTION_STATUS_KEY}`;if(e){if(this.getInteractionInProgress())throw T(la);this.setTemporaryCache(n,JSON.stringify({clientId:this.clientId,type:t}),!1)}else!e&&this.getInteractionInProgress()?.clientId===this.clientId&&this.removeTemporaryItem(n)}async hydrateCache(e,t){const n=Sn(e.account?.homeAccountId,e.account?.environment,e.idToken,this.clientId,e.tenantId);let o;t.claims&&(o=await this.cryptoImpl.hashString(t.claims));const i=kn(e.account?.homeAccountId,e.account.environment,e.accessToken,this.clientId,e.tenantId,e.scopes.join(" "),e.expiresOn?ti(e.expiresOn):0,e.extExpiresOn?ti(e.extExpiresOn):0,ne,void 0,e.tokenType,void 0,t.sshKid,t.claims,o),s={idToken:n,accessToken:i};return this.saveCacheRecord(s,e.correlationId,Ie(Ae(e.idToken,ne)))}async saveCacheRecord(e,t,n,o){try{await super.saveCacheRecord(e,t,n,o)}catch(i){if(i instanceof tt&&this.performanceClient&&t)try{const s=this.getTokenKeys();this.performanceClient.addFields({cacheRtCount:s.refreshToken.length,cacheIdCount:s.idToken.length,cacheAtCount:s.accessToken.length},t)}catch{}throw i}}}function Si(r,e,t,n){try{switch(e){case Y.LocalStorage:return new ng(r,t,n);case Y.SessionStorage:return new rg;case Y.MemoryStorage:default:break}}catch(o){t.error(o)}return new Dn}const og=(r,e,t,n)=>{const o={cacheLocation:Y.MemoryStorage,cacheRetentionDays:5,temporaryCacheLocation:Y.MemoryStorage,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!1,claimsBasedCachingEnabled:!1};return new gr(r,o,Xt,e,t,n)};function ig(r,e,t,n,o){return r.verbose("getAllAccounts called"),t?e.getAllAccounts(o||{},n):[]}function sg(r,e,t,n){const o=t.getAccountInfoFilteredBy(r,n);return o?(e.verbose("getAccount: Account matching provided filter found, returning"),o):(e.verbose("getAccount: No matching account found, returning null"),null)}function ag(r,e,t,n){if(e.trace("getAccountByUsername called"),!r)return e.warning("getAccountByUsername: No username provided"),null;const o=t.getAccountInfoFilteredBy({username:r},n);return o?(e.verbose("getAccountByUsername: Account matching username found, returning"),e.verbosePii(`getAccountByUsername: Returning signed-in accounts matching username: ${r}`),o):(e.verbose("getAccountByUsername: No matching account found, returning null"),null)}function cg(r,e,t,n){if(e.trace("getAccountByHomeId called"),!r)return e.warning("getAccountByHomeId: No homeAccountId provided"),null;const o=t.getAccountInfoFilteredBy({homeAccountId:r},n);return o?(e.verbose("getAccountByHomeId: Account matching homeAccountId found, returning"),e.verbosePii(`getAccountByHomeId: Returning signed-in accounts matching homeAccountId: ${r}`),o):(e.verbose("getAccountByHomeId: No matching account found, returning null"),null)}function lg(r,e,t,n){if(e.trace("getAccountByLocalId called"),!r)return e.warning("getAccountByLocalId: No localAccountId provided"),null;const o=t.getAccountInfoFilteredBy({localAccountId:r},n);return o?(e.verbose("getAccountByLocalId: Account matching localAccountId found, returning"),e.verbosePii(`getAccountByLocalId: Returning signed-in accounts matching localAccountId: ${r}`),o):(e.verbose("getAccountByLocalId: No matching account found, returning null"),null)}function dg(r,e,t){e.setActiveAccount(r,t)}function hg(r,e){return r.getActiveAccount(e)}const ug="msal.broadcast.event";class gg{constructor(e){this.eventCallbacks=new Map,this.logger=e||new _e({}),typeof BroadcastChannel<"u"&&(this.broadcastChannel=new BroadcastChannel(ug)),this.invokeCrossTabCallbacks=this.invokeCrossTabCallbacks.bind(this)}addEventCallback(e,t,n){if(typeof window<"u"){const o=n||Gu();return this.eventCallbacks.has(o)?(this.logger.error(`Event callback with id: ${o} is already registered. Please provide a unique id or remove the existing callback and try again.`),null):(this.eventCallbacks.set(o,[e,t||[]]),this.logger.verbose(`Event callback registered with id: ${o}`),o)}return null}removeEventCallback(e){this.eventCallbacks.delete(e),this.logger.verbose(`Event callback ${e} removed.`)}emitEvent(e,t,n,o){const i={eventType:e,interactionType:t||null,payload:n||null,error:o||null,timestamp:Date.now()};switch(e){case A.ACCOUNT_ADDED:case A.ACCOUNT_REMOVED:case A.ACTIVE_ACCOUNT_CHANGED:this.broadcastChannel?.postMessage(i);break;default:this.invokeCallbacks(i);break}}invokeCallbacks(e){this.eventCallbacks.forEach(([t,n],o)=>{(n.length===0||n.includes(e.eventType))&&(this.logger.verbose(`Emitting event to callback ${o}: ${e.eventType}`),t.apply(null,[e]))})}invokeCrossTabCallbacks(e){const t=e.data;this.invokeCallbacks(t)}subscribeCrossTab(){this.broadcastChannel?.addEventListener("message",this.invokeCrossTabCallbacks)}unsubscribeCrossTab(){this.broadcastChannel?.removeEventListener("message",this.invokeCrossTabCallbacks)}}class Wa{constructor(e,t,n,o,i,s,a,c,l){this.config=e,this.browserStorage=t,this.browserCrypto=n,this.networkClient=this.config.system.networkClient,this.eventHandler=i,this.navigationClient=s,this.platformAuthProvider=c,this.correlationId=l||ye(),this.logger=o.clone(re.MSAL_SKU,je,this.correlationId),this.performanceClient=a}async clearCacheOnLogout(e,t){if(t)try{this.browserStorage.removeAccount(t,e),this.logger.verbose("Cleared cache items belonging to the account provided in the logout request.")}catch{this.logger.error("Account provided in logout request was not found. Local cache unchanged.")}else try{this.logger.verbose("No account provided in logout request, clearing all cache items.",this.correlationId),this.browserStorage.clear(e),await this.browserCrypto.clearKeystore()}catch{this.logger.error("Attempted to clear all MSAL cache items and failed. Local cache unchanged.")}}getRedirectUri(e){this.logger.verbose("getRedirectUri called");const t=e||this.config.auth.redirectUri;return N.getAbsoluteUrl(t,be())}initializeServerTelemetryManager(e,t){this.logger.verbose("initializeServerTelemetryManager called");const n={clientId:this.config.auth.clientId,correlationId:this.correlationId,apiId:e,forceRefresh:t||!1,wrapperSKU:this.browserStorage.getWrapperMetadata()[0],wrapperVer:this.browserStorage.getWrapperMetadata()[1]};return new _t(n,this.browserStorage)}async getDiscoveredAuthority(e){const{account:t}=e,n=e.requestExtraQueryParameters&&e.requestExtraQueryParameters.hasOwnProperty("instance_aware")?e.requestExtraQueryParameters.instance_aware:void 0;this.performanceClient.addQueueMeasurement(d.StandardInteractionClientGetDiscoveredAuthority,this.correlationId);const o={protocolMode:this.config.auth.protocolMode,OIDCOptions:this.config.auth.OIDCOptions,knownAuthorities:this.config.auth.knownAuthorities,cloudDiscoveryMetadata:this.config.auth.cloudDiscoveryMetadata,authorityMetadata:this.config.auth.authorityMetadata,skipAuthorityMetadataCache:this.config.auth.skipAuthorityMetadataCache},i=e.requestAuthority||this.config.auth.authority,s=n?.length?n==="true":this.config.auth.instanceAware,a=t&&s?this.config.auth.authority.replace(N.getDomainFromUrl(i),t.environment):i,c=X.generateAuthority(a,e.requestAzureCloudOptions||this.config.auth.azureCloudOptions),l=await f(Qs,d.AuthorityFactoryCreateDiscoveredInstance,this.logger,this.performanceClient,this.correlationId)(c,this.config.system.networkClient,this.browserStorage,o,this.logger,this.correlationId,this.performanceClient);if(t&&!l.isAlias(t.environment))throw D(vs);return l}}async function So(r,e,t,n){t.addQueueMeasurement(d.InitializeBaseRequest,r.correlationId);const o=r.authority||e.auth.authority,i=[...r&&r.scopes||[]],s={...r,correlationId:r.correlationId,authority:o,scopes:i};if(!s.authenticationScheme)s.authenticationScheme=U.BEARER,n.verbose(`Authentication Scheme wasn't explicitly set in request, defaulting to "Bearer" request`);else{if(s.authenticationScheme===U.SSH){if(!r.sshJwk)throw D(An);if(!r.sshKid)throw D(Is)}n.verbose(`Authentication Scheme set to "${s.authenticationScheme}" as configured in Auth request`)}return e.cache.claimsBasedCachingEnabled&&r.claims&&!le.isEmptyObj(r.claims)&&(s.requestedClaimsHash=await Ba(r.claims)),s}async function fg(r,e,t,n,o){n.addQueueMeasurement(d.InitializeSilentRequest,r.correlationId);const i=await f(So,d.InitializeBaseRequest,o,n,r.correlationId)(r,t,n,o);return{...r,...i,account:e,forceRefresh:r.forceRefresh||!1}}function Qa(r,e){let t;const n=r.httpMethod;if(e===oe.EAR){if(t=n||$e.POST,t!==$e.POST)throw D(Ss)}else t=n||$e.GET;if(r.authorizePostBodyParameters&&t!==$e.POST)throw D(ks);return t}class gt extends Wa{initializeLogoutRequest(e){this.logger.verbose("initializeLogoutRequest called",e?.correlationId);const t={correlationId:this.correlationId||ye(),...e};if(e)if(e.logoutHint)this.logger.verbose("logoutHint has already been set in logoutRequest");else if(e.account){const n=this.getLogoutHintFromIdTokenClaims(e.account);n&&(this.logger.verbose("Setting logoutHint to login_hint ID Token Claim value for the account provided"),t.logoutHint=n)}else this.logger.verbose("logoutHint was not set and account was not passed into logout request, logoutHint will not be set");else this.logger.verbose("logoutHint will not be set since no logout request was configured");return!e||e.postLogoutRedirectUri!==null?e&&e.postLogoutRedirectUri?(this.logger.verbose("Setting postLogoutRedirectUri to uri set on logout request",t.correlationId),t.postLogoutRedirectUri=N.getAbsoluteUrl(e.postLogoutRedirectUri,be())):this.config.auth.postLogoutRedirectUri===null?this.logger.verbose("postLogoutRedirectUri configured as null and no uri set on request, not passing post logout redirect",t.correlationId):this.config.auth.postLogoutRedirectUri?(this.logger.verbose("Setting postLogoutRedirectUri to configured uri",t.correlationId),t.postLogoutRedirectUri=N.getAbsoluteUrl(this.config.auth.postLogoutRedirectUri,be())):(this.logger.verbose("Setting postLogoutRedirectUri to current page",t.correlationId),t.postLogoutRedirectUri=N.getAbsoluteUrl(be(),be())):this.logger.verbose("postLogoutRedirectUri passed as null, not setting post logout redirect uri",t.correlationId),t}getLogoutHintFromIdTokenClaims(e){const t=e.idTokenClaims;if(t){if(t.login_hint)return t.login_hint;this.logger.verbose("The ID Token Claims tied to the provided account do not contain a login_hint claim, logoutHint will not be added to logout request")}else this.logger.verbose("The provided account does not contain ID Token Claims, logoutHint will not be added to logout request");return null}async createAuthCodeClient(e){this.performanceClient.addQueueMeasurement(d.StandardInteractionClientCreateAuthCodeClient,this.correlationId);const t=await f(this.getClientConfiguration.bind(this),d.StandardInteractionClientGetClientConfiguration,this.logger,this.performanceClient,this.correlationId)(e);return new Zs(t,this.performanceClient)}async getClientConfiguration(e){const{serverTelemetryManager:t,requestAuthority:n,requestAzureCloudOptions:o,requestExtraQueryParameters:i,account:s}=e;this.performanceClient.addQueueMeasurement(d.StandardInteractionClientGetClientConfiguration,this.correlationId);const a=e.authority||await f(this.getDiscoveredAuthority.bind(this),d.StandardInteractionClientGetDiscoveredAuthority,this.logger,this.performanceClient,this.correlationId)({requestAuthority:n,requestAzureCloudOptions:o,requestExtraQueryParameters:i,account:s}),c=this.config.system.loggerOptions;return{authOptions:{clientId:this.config.auth.clientId,authority:a,clientCapabilities:this.config.auth.clientCapabilities,redirectUri:this.config.auth.redirectUri},systemOptions:{tokenRenewalOffsetSeconds:this.config.system.tokenRenewalOffsetSeconds,preventCorsPreflight:!0},loggerOptions:{loggerCallback:c.loggerCallback,piiLoggingEnabled:c.piiLoggingEnabled,logLevel:c.logLevel,correlationId:this.correlationId},cacheOptions:{claimsBasedCachingEnabled:this.config.cache.claimsBasedCachingEnabled},cryptoInterface:this.browserCrypto,networkInterface:this.networkClient,storageInterface:this.browserStorage,serverTelemetryManager:t,libraryInfo:{sku:re.MSAL_SKU,version:je,cpu:p.EMPTY_STRING,os:p.EMPTY_STRING},telemetry:this.config.telemetry}}async initializeAuthorizationRequest(e,t){this.performanceClient.addQueueMeasurement(d.StandardInteractionClientInitializeAuthorizationRequest,this.correlationId);const n=this.getRedirectUri(e.redirectUri),o={interactionType:t},i=ht.setRequestState(this.browserCrypto,e&&e.state||p.EMPTY_STRING,o),a={...await f(So,d.InitializeBaseRequest,this.logger,this.performanceClient,this.correlationId)({...e,correlationId:this.correlationId},this.config,this.performanceClient,this.logger),redirectUri:n,state:i,nonce:e.nonce||ye(),responseMode:this.config.auth.OIDCOptions.serverResponseType},c={...a,httpMethod:Qa(a,this.config.auth.protocolMode)};if(e.loginHint||e.sid)return c;const l=e.account||this.browserStorage.getActiveAccount(this.correlationId);return l&&(this.logger.verbose("Setting validated request account",this.correlationId),this.logger.verbosePii(`Setting validated request account: ${l.homeAccountId}`,this.correlationId),c.account=l),c}}function pg(r,e){if(!e)return null;try{return ht.parseRequestState(r,e).libraryState.meta}catch{throw y(st)}}function vt(r,e,t){const n=en(r);if(!n)throw Rs(r)?(t.error(`A ${e} is present in the iframe but it does not contain known properties. It's likely that the ${e} has been replaced by code running on the redirectUri page.`),t.errorPii(`The ${e} detected is: ${r}`),T(sa)):(t.error(`The request has returned to the redirectUri but a ${e} is not present. It's likely that the ${e} has been removed or the page has been redirected by code running on the redirectUri page.`),T(ia));return n}function mg(r,e,t){if(!r.state)throw T(ho);const n=pg(e,r.state);if(!n)throw T(aa);if(n.interactionType!==t)throw T(ca)}class Ya{constructor(e,t,n,o,i){this.authModule=e,this.browserStorage=t,this.authCodeRequest=n,this.logger=o,this.performanceClient=i}async handleCodeResponse(e,t){this.performanceClient.addQueueMeasurement(d.HandleCodeResponse,t.correlationId);let n;try{n=au(e,t.state)}catch(o){throw o instanceof Ye&&o.subError===Rt?T(Rt):o}return f(this.handleCodeResponseFromServer.bind(this),d.HandleCodeResponseFromServer,this.logger,this.performanceClient,t.correlationId)(n,t)}async handleCodeResponseFromServer(e,t,n=!0){if(this.performanceClient.addQueueMeasurement(d.HandleCodeResponseFromServer,t.correlationId),this.logger.trace("InteractionHandler.handleCodeResponseFromServer called"),this.authCodeRequest.code=e.code,e.cloud_instance_host_name&&await f(this.authModule.updateAuthority.bind(this.authModule),d.UpdateTokenEndpointAuthority,this.logger,this.performanceClient,t.correlationId)(e.cloud_instance_host_name,t.correlationId),n&&(e.nonce=t.nonce||void 0),e.state=t.state,e.client_info)this.authCodeRequest.clientInfo=e.client_info;else{const i=this.createCcsCredentials(t);i&&(this.authCodeRequest.ccsCredential=i)}return await f(this.authModule.acquireToken.bind(this.authModule),d.AuthClientAcquireToken,this.logger,this.performanceClient,t.correlationId)(this.authCodeRequest,e)}createCcsCredentials(e){return e.account?{credential:e.account.homeAccountId,type:pe.HOME_ACCOUNT_ID}:e.loginHint?{credential:e.loginHint,type:pe.UPN}:null}}const yg="ContentError",Cg="PageException",Ja="user_switch";const Tg="USER_INTERACTION_REQUIRED",Ag="USER_CANCEL",Ig="NO_NETWORK",wg="DISABLED",Eg="ACCOUNT_UNAVAILABLE",vg="UX_NOT_ALLOWED";const Sg=-2147186943,kg={[Ja]:"User attempted to switch accounts in the native broker, which is not allowed. All new accounts must sign-in through the standard web flow first, please try again."};class Te extends L{constructor(e,t,n){super(e,t),Object.setPrototypeOf(this,Te.prototype),this.name="NativeAuthError",this.ext=n}}function Ze(r){if(r.ext&&r.ext.status&&r.ext.status===wg||r.ext&&r.ext.error&&r.ext.error===Sg)return!0;switch(r.errorCode){case yg:case Cg:return!0;default:return!1}}function gn(r,e,t){if(t&&t.status)switch(t.status){case Eg:return ln(Ys);case Tg:return new me(r,e);case Ag:return T(Rt);case Ig:return T(dn);case vg:return ln(ro)}return new Te(r,kg[r]||e,t)}class Xa extends gt{async acquireToken(e){this.performanceClient.addQueueMeasurement(d.SilentCacheClientAcquireToken,e.correlationId);const t=this.initializeServerTelemetryManager(M.acquireTokenSilent_silentFlow),n=await f(this.getClientConfiguration.bind(this),d.StandardInteractionClientGetClientConfiguration,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:t,requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,account:e.account}),o=new ou(n,this.performanceClient);this.logger.verbose("Silent auth client created");try{const s=(await f(o.acquireCachedToken.bind(o),d.SilentFlowClientAcquireCachedToken,this.logger,this.performanceClient,e.correlationId)(e))[0];return this.performanceClient.addFields({fromCache:!0},e.correlationId),s}catch(i){throw i instanceof Mt&&i.errorCode===uo&&this.logger.verbose("Signing keypair for bound access token not found. Refreshing bound access token and generating a new crypto keypair."),i}}logout(e){this.logger.verbose("logoutRedirect called");const t=this.initializeLogoutRequest(e);return this.clearCacheOnLogout(t.correlationId,t?.account)}}class Vt extends Wa{constructor(e,t,n,o,i,s,a,c,l,h,u,g){super(e,t,n,o,i,s,c,l,g),this.apiId=a,this.accountId=h,this.platformAuthProvider=l,this.nativeStorageManager=u,this.silentCacheClient=new Xa(e,this.nativeStorageManager,n,o,i,s,c,l,g);const m=this.platformAuthProvider.getExtensionName();this.skus=_t.makeExtraSkuString({libraryName:re.MSAL_SKU,libraryVersion:je,extensionName:m,extensionVersion:this.platformAuthProvider.getExtensionVersion()})}addRequestSKUs(e){e.extraParameters={...e.extraParameters,[Ah]:this.skus}}async acquireToken(e,t){this.performanceClient.addQueueMeasurement(d.NativeInteractionClientAcquireToken,this.correlationId),this.logger.trace("NativeInteractionClient - acquireToken called.");const n=this.performanceClient.startMeasurement(d.NativeInteractionClientAcquireToken,this.correlationId),o=ie(),i=this.initializeServerTelemetryManager(this.apiId);try{const s=await this.initializeNativeRequest(e);try{const c=await this.acquireTokensFromCache(this.accountId,s);return n.end({success:!0,isNativeBroker:!1,fromCache:!0}),c}catch(c){if(t===ee.AccessToken)throw this.logger.info("MSAL internal Cache does not contain tokens, return error as per cache policy"),n.end({success:!1,brokerErrorCode:"cache_request_failed"}),c;this.logger.info("MSAL internal Cache does not contain tokens, proceed to make a native call")}const a=await this.platformAuthProvider.sendMessage(s);return await this.handleNativeResponse(a,s,o).then(c=>(n.end({success:!0,isNativeBroker:!0,requestId:c.requestId}),i.clearNativeBrokerErrorCode(),c)).catch(c=>{throw n.end({success:!1,errorCode:c.errorCode,subErrorCode:c.subError}),c})}catch(s){throw s instanceof Te&&i.setNativeBrokerErrorCode(s.errorCode),n.end({success:!1}),s}}createSilentCacheRequest(e,t){return{authority:e.authority,correlationId:this.correlationId,scopes:q.fromString(e.scope).asArray(),account:t,forceRefresh:!1}}async acquireTokensFromCache(e,t){if(!e)throw this.logger.warning("NativeInteractionClient:acquireTokensFromCache - No nativeAccountId provided"),y(rr);const n=this.browserStorage.getBaseAccountInfo({nativeAccountId:e},this.correlationId);if(!n)throw y(rr);try{const o=this.createSilentCacheRequest(t,n),i=await this.silentCacheClient.acquireToken(o),s={...n,idTokenClaims:i?.idTokenClaims,idToken:i?.idToken};return{...i,account:s}}catch(o){throw o}}async acquireTokenRedirect(e,t){this.logger.trace("NativeInteractionClient - acquireTokenRedirect called.");const{...n}=e;delete n.onRedirectNavigate;const o=await this.initializeNativeRequest(n);try{await this.platformAuthProvider.sendMessage(o)}catch(a){if(a instanceof Te&&(this.initializeServerTelemetryManager(this.apiId).setNativeBrokerErrorCode(a.errorCode),Ze(a)))throw a}this.browserStorage.setTemporaryCache($.NATIVE_REQUEST,JSON.stringify(o),!0);const i={apiId:M.acquireTokenRedirect,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},s=this.config.auth.navigateToLoginRequestUrl?window.location.href:this.getRedirectUri(e.redirectUri);t.end({success:!0}),await this.navigationClient.navigateExternal(s,i)}async handleRedirectPromise(e,t){if(this.logger.trace("NativeInteractionClient - handleRedirectPromise called."),!this.browserStorage.isInteractionInProgress(!0))return this.logger.info("handleRedirectPromise called but there is no interaction in progress, returning null."),null;const n=this.browserStorage.getCachedNativeRequest();if(!n)return this.logger.verbose("NativeInteractionClient - handleRedirectPromise called but there is no cached request, returning null."),e&&t&&e?.addFields({errorCode:"no_cached_request"},t),null;const{prompt:o,...i}=n;o&&this.logger.verbose("NativeInteractionClient - handleRedirectPromise called and prompt was included in the original request, removing prompt from cached request to prevent second interaction with native broker window."),this.browserStorage.removeItem(this.browserStorage.generateCacheKey($.NATIVE_REQUEST));const s=ie();try{this.logger.verbose("NativeInteractionClient - handleRedirectPromise sending message to native broker.");const a=await this.platformAuthProvider.sendMessage(i),c=await this.handleNativeResponse(a,i,s);return this.initializeServerTelemetryManager(this.apiId).clearNativeBrokerErrorCode(),e&&this.correlationId&&this.performanceClient.addFields({isNativeBroker:!0},this.correlationId),c}catch(a){throw a}}logout(){return this.logger.trace("NativeInteractionClient - logout called."),Promise.reject("Logout not implemented yet")}async handleNativeResponse(e,t,n){this.logger.trace("NativeInteractionClient - handleNativeResponse called.");const o=Ae(e.id_token,ne),i=this.createHomeAccountIdentifier(e,o),s=this.browserStorage.getAccountInfoFilteredBy({nativeAccountId:t.accountId},this.correlationId)?.homeAccountId;if(t.extraParameters?.child_client_id&&e.account.id!==t.accountId)this.logger.info("handleNativeServerResponse: Double broker flow detected, ignoring accountId mismatch");else if(i!==s&&e.account.id!==t.accountId)throw gn(Ja);const a=await this.getDiscoveredAuthority({requestAuthority:t.authority}),c=oo(this.browserStorage,a,i,ne,this.correlationId,o,e.client_info,void 0,o.tid,void 0,e.account.id,this.logger);e.expires_in=Number(e.expires_in);const l=await this.generateAuthenticationResult(e,t,o,c,a.canonicalAuthority,n);return await this.cacheAccount(c,this.correlationId,Ie(o)),await this.cacheNativeTokens(e,t,i,o,e.access_token,l.tenantId,n),l}createHomeAccountIdentifier(e,t){return B.generateHomeAccountId(e.client_info||p.EMPTY_STRING,ge.Default,this.logger,this.browserCrypto,t)}generateScopes(e,t){return t?q.fromString(t):q.fromString(e)}async generatePopAccessToken(e,t){if(t.tokenType===U.POP&&t.signPopToken){if(e.shr)return this.logger.trace("handleNativeServerResponse: SHR is enabled in native layer"),e.shr;const n=new at(this.browserCrypto),o={resourceRequestMethod:t.resourceRequestMethod,resourceRequestUri:t.resourceRequestUri,shrClaims:t.shrClaims,shrNonce:t.shrNonce};if(!t.keyId)throw y(Nr);return n.signPopToken(e.access_token,t.keyId,o)}else return e.access_token}async generateAuthenticationResult(e,t,n,o,i,s){const a=this.addTelemetryFromNativeResponse(e.properties.MATS),c=this.generateScopes(t.scope,e.scope),l=e.account.properties||{},h=l.UID||n.oid||n.sub||p.EMPTY_STRING,u=l.TenantId||n.tid||p.EMPTY_STRING,g=Br(B.getAccountInfo(o),void 0,n,e.id_token);g.nativeAccountId!==e.account.id&&(g.nativeAccountId=e.account.id);const m=await this.generatePopAccessToken(e,t),I=t.tokenType===U.POP?U.POP:U.BEARER;return{authority:i,uniqueId:h,tenantId:u,scopes:c.asArray(),account:g,idToken:e.id_token,idTokenClaims:n,accessToken:m,fromCache:a?this.isResponseFromCache(a):!1,expiresOn:nt(s+e.expires_in),tokenType:I,correlationId:this.correlationId,state:e.state,fromNativeBroker:!0}}async cacheAccount(e,t,n){await this.browserStorage.setAccount(e,this.correlationId,n),this.browserStorage.removeAccountContext(B.getAccountInfo(e),t)}cacheNativeTokens(e,t,n,o,i,s,a){const c=Sn(n,t.authority,e.id_token||"",t.clientId,o.tid||""),l=t.tokenType===U.POP?p.SHR_NONCE_VALIDITY:(typeof e.expires_in=="string"?parseInt(e.expires_in,10):e.expires_in)||0,h=a+l,u=this.generateScopes(e.scope,t.scope),g=kn(n,t.authority,i,t.clientId,o.tid||s,u.printScopes(),h,0,ne,void 0,t.tokenType,void 0,t.keyId),m={idToken:c,accessToken:g};return this.nativeStorageManager.saveCacheRecord(m,this.correlationId,Ie(o),t.storeInCache)}getExpiresInValue(e,t){return e===U.POP?p.SHR_NONCE_VALIDITY:(typeof t=="string"?parseInt(t,10):t)||0}addTelemetryFromNativeResponse(e){const t=this.getMATSFromResponse(e);return t?(this.performanceClient.addFields({extensionId:this.platformAuthProvider.getExtensionId(),extensionVersion:this.platformAuthProvider.getExtensionVersion(),matsBrokerVersion:t.broker_version,matsAccountJoinOnStart:t.account_join_on_start,matsAccountJoinOnEnd:t.account_join_on_end,matsDeviceJoin:t.device_join,matsPromptBehavior:t.prompt_behavior,matsApiErrorCode:t.api_error_code,matsUiVisible:t.ui_visible,matsSilentCode:t.silent_code,matsSilentBiSubCode:t.silent_bi_sub_code,matsSilentMessage:t.silent_message,matsSilentStatus:t.silent_status,matsHttpStatus:t.http_status,matsHttpEventCount:t.http_event_count},this.correlationId),t):null}getMATSFromResponse(e){if(e)try{return JSON.parse(e)}catch{this.logger.error("NativeInteractionClient - Error parsing MATS telemetry, returning null instead")}return null}isResponseFromCache(e){return typeof e.is_cached>"u"?(this.logger.verbose("NativeInteractionClient - MATS telemetry does not contain field indicating if response was served from cache. Returning false."),!1):!!e.is_cached}async initializeNativeRequest(e){this.logger.trace("NativeInteractionClient - initializeNativeRequest called");const t=await this.getCanonicalAuthority(e),{scopes:n,...o}=e,i=new q(n||[]);i.appendScopes(dt);const s={...o,accountId:this.accountId,clientId:this.config.auth.clientId,authority:t.urlString,scope:i.printScopes(),redirectUri:this.getRedirectUri(e.redirectUri),prompt:this.getPrompt(e.prompt),correlationId:this.correlationId,tokenType:e.authenticationScheme,windowTitleSubstring:document.title,extraParameters:{...e.extraQueryParameters,...e.tokenQueryParameters},extendedExpiryToken:!1,keyId:e.popKid};if(s.signPopToken&&e.popKid)throw T(Pa);if(this.handleExtraBrokerParams(s),s.extraParameters=s.extraParameters||{},s.extraParameters.telemetry=he.MATS_TELEMETRY,e.authenticationScheme===U.POP){const a={resourceRequestUri:e.resourceRequestUri,resourceRequestMethod:e.resourceRequestMethod,shrClaims:e.shrClaims,shrNonce:e.shrNonce},c=new at(this.browserCrypto);let l;if(s.keyId)l=this.browserCrypto.base64UrlEncode(JSON.stringify({kid:s.keyId})),s.signPopToken=!1;else{const h=await f(c.generateCnf.bind(c),d.PopTokenGenerateCnf,this.logger,this.performanceClient,this.correlationId)(a,this.logger);l=h.reqCnfString,s.keyId=h.kid,s.signPopToken=!0}s.reqCnf=l}return this.addRequestSKUs(s),s}async getCanonicalAuthority(e){const t=e.authority||this.config.auth.authority;e.account&&await this.getDiscoveredAuthority({requestAuthority:t,requestAzureCloudOptions:e.azureCloudOptions,account:e.account});const n=new N(t);return n.validateAsUri(),n}getPrompt(e){switch(this.apiId){case M.ssoSilent:case M.acquireTokenSilent_silentFlow:return this.logger.trace("initializeNativeRequest: silent request sets prompt to none"),Q.NONE}if(!e){this.logger.trace("initializeNativeRequest: prompt was not provided");return}switch(e){case Q.NONE:case Q.CONSENT:case Q.LOGIN:case Q.SELECT_ACCOUNT:return this.logger.trace("initializeNativeRequest: prompt is compatible with native flow"),e;default:throw this.logger.trace(`initializeNativeRequest: prompt = ${e} is not compatible with native flow`),T(_a)}}handleExtraBrokerParams(e){const t=e.extraParameters&&e.extraParameters.hasOwnProperty(rn)&&e.extraParameters.hasOwnProperty(on)&&e.extraParameters.hasOwnProperty(ze);if(!e.embeddedClientId&&!t)return;let n="";const o=e.redirectUri;e.embeddedClientId?(e.redirectUri=this.config.auth.redirectUri,n=e.embeddedClientId):e.extraParameters&&(e.redirectUri=e.extraParameters[on],n=e.extraParameters[ze]),e.extraParameters={child_client_id:n,child_redirect_uri:o},this.performanceClient?.addFields({embeddedClientId:n,embeddedRedirectUri:o},this.correlationId)}}async function ko(r,e,t,n,o){const i=su({...r.auth,authority:e},t,n,o);if(Yr(i,{sku:re.MSAL_SKU,version:je,os:"",cpu:""}),r.auth.protocolMode!==oe.OIDC&&Jr(i,r.telemetry.application),t.platformBroker&&(vh(i),o.addFields({isPlatformAuthorizeRequest:!0},t.correlationId),t.authenticationScheme===U.POP)){const s=new Re(n,o),a=new at(s);let c;t.popKid?c=s.encodeKid(t.popKid):c=(await f(a.generateCnf.bind(a),d.PopTokenGenerateCnf,n,o,t.correlationId)(t,n)).reqCnfString,eo(i,c)}return wn(i,t.correlationId,o),i}async function bo(r,e,t,n,o){if(!t.codeChallenge)throw D(xr);const i=await f(ko,d.GetStandardParams,n,o,t.correlationId)(r,e,t,n,o);return zr(i,Sr.CODE),Xr(i,t.codeChallenge,p.S256_CODE_CHALLENGE_METHOD),Le(i,t.extraQueryParameters||{}),io(e,i,r.auth.encodeExtraQueryParams,t.extraQueryParameters)}async function _o(r,e,t,n,o,i){if(!n.earJwk)throw T(lo);const s=await ko(e,t,n,o,i);zr(s,Sr.IDTOKEN_TOKEN_REFRESHTOKEN),Dh(s,n.earJwk),Xr(s,n.codeChallenge,p.S256_CODE_CHALLENGE_METHOD);const a=new Map;Le(a,n.extraQueryParameters||{});const c=io(t,a,e.auth.encodeExtraQueryParams,n.extraQueryParameters);return Za(r,c,s)}async function Ro(r,e,t,n,o,i){const s=await ko(e,t,n,o,i);zr(s,Sr.CODE),Xr(s,n.codeChallenge,n.codeChallengeMethod||p.S256_CODE_CHALLENGE_METHOD),Lh(s,n.authorizePostBodyParameters||{});const a=new Map;Le(a,n.extraQueryParameters||{});const c=io(t,a,e.auth.encodeExtraQueryParams,n.extraQueryParameters);return Za(r,c,s)}function Za(r,e,t){const n=r.createElement("form");return n.method="post",n.action=e,t.forEach((o,i)=>{const s=r.createElement("input");s.hidden=!0,s.name=i,s.value=o,n.appendChild(s)}),r.body.appendChild(n),n}async function ec(r,e,t,n,o,i,s,a,c,l){if(a.verbose("Account id found, calling WAM for token"),!l)throw T(fo);const h=new Re(a,c),u=new Vt(n,o,h,a,s,n.system.navigationClient,t,c,l,e,i,r.correlationId),{userRequestState:g}=ht.parseRequestState(h,r.state);return f(u.acquireToken.bind(u),d.NativeInteractionClientAcquireToken,a,c,r.correlationId)({...r,state:g,prompt:void 0})}async function it(r,e,t,n,o,i,s,a,c,l,h,u){if(Ce.removeThrottle(s,o.auth.clientId,r),e.accountId)return f(ec,d.HandleResponsePlatformBroker,l,h,r.correlationId)(r,e.accountId,n,o,s,a,c,l,h,u);const g={...r,code:e.code||"",codeVerifier:t},m=new Ya(i,s,g,l,h);return await f(m.handleCodeResponse.bind(m),d.HandleCodeResponse,l,h,r.correlationId)(e,r)}async function Po(r,e,t,n,o,i,s,a,c,l,h){if(Ce.removeThrottle(i,n.auth.clientId,r),ea(e,r.state),!e.ear_jwe)throw T(oa);if(!r.earJwk)throw T(lo);const u=JSON.parse(await f(Du,d.DecryptEarResponse,c,l,r.correlationId)(r.earJwk,e.ear_jwe));if(u.accountId)return f(ec,d.HandleResponsePlatformBroker,c,l,r.correlationId)(r,u.accountId,t,n,i,s,a,c,l,h);const g=new qe(n.auth.clientId,i,new Re(c,l),c,null,null,l);g.validateTokenResponse(u);const m={code:"",state:r.state,nonce:r.nonce,client_info:u.client_info,cloud_graph_host_name:u.cloud_graph_host_name,cloud_instance_host_name:u.cloud_instance_host_name,cloud_instance_name:u.cloud_instance_name,msgraph_host:u.msgraph_host};return await f(g.handleServerTokenResponse.bind(g),d.HandleServerTokenResponse,c,l,r.correlationId)(u,o,ie(),r,m,void 0,void 0,void 0,void 0)}const bg=32;async function We(r,e,t){r.addQueueMeasurement(d.GeneratePkceCodes,t);const n=de(_g,d.GenerateCodeVerifier,e,r,t)(r,e,t),o=await f(Rg,d.GenerateCodeChallengeFromVerifier,e,r,t)(n,r,e,t);return{verifier:n,challenge:o}}function _g(r,e,t){try{const n=new Uint8Array(bg);return de(Pu,d.GetRandomValues,e,r,t)(n),He(n)}catch{throw T(co)}}async function Rg(r,e,t,n){e.addQueueMeasurement(d.GenerateCodeChallengeFromVerifier,n);try{const o=await f(xa,d.Sha256Digest,t,e,n)(r,e,n);return He(new Uint8Array(o))}catch{throw T(co)}}class fn{constructor(e,t,n,o){this.logger=e,this.handshakeTimeoutMs=t,this.extensionId=o,this.resolvers=new Map,this.handshakeResolvers=new Map,this.messageChannel=new MessageChannel,this.windowListener=this.onWindowMessage.bind(this),this.performanceClient=n,this.handshakeEvent=n.startMeasurement(d.NativeMessageHandlerHandshake),this.platformAuthType=he.PLATFORM_EXTENSION_PROVIDER}async sendMessage(e){this.logger.trace(this.platformAuthType+" - sendMessage called.");const t={method:mt.GetToken,request:e},n={channel:he.CHANNEL_ID,extensionId:this.extensionId,responseId:ye(),body:t};this.logger.trace(this.platformAuthType+" - Sending request to browser extension"),this.logger.tracePii(this.platformAuthType+` - Sending request to browser extension: ${JSON.stringify(n)}`),this.messageChannel.port1.postMessage(n);const o=await new Promise((s,a)=>{this.resolvers.set(n.responseId,{resolve:s,reject:a})});return this.validatePlatformBrokerResponse(o)}static async createProvider(e,t,n){e.trace("PlatformAuthExtensionHandler - createProvider called.");try{const o=new fn(e,t,n,he.PREFERRED_EXTENSION_ID);return await o.sendHandshakeRequest(),o}catch{const i=new fn(e,t,n);return await i.sendHandshakeRequest(),i}}async sendHandshakeRequest(){this.logger.trace(this.platformAuthType+" - sendHandshakeRequest called."),window.addEventListener("message",this.windowListener,!1);const e={channel:he.CHANNEL_ID,extensionId:this.extensionId,responseId:ye(),body:{method:mt.HandshakeRequest}};return this.handshakeEvent.add({extensionId:this.extensionId,extensionHandshakeTimeoutMs:this.handshakeTimeoutMs}),this.messageChannel.port1.onmessage=t=>{this.onChannelMessage(t)},window.postMessage(e,window.origin,[this.messageChannel.port2]),new Promise((t,n)=>{this.handshakeResolvers.set(e.responseId,{resolve:t,reject:n}),this.timeoutId=window.setTimeout(()=>{window.removeEventListener("message",this.windowListener,!1),this.messageChannel.port1.close(),this.messageChannel.port2.close(),this.handshakeEvent.end({extensionHandshakeTimedOut:!0,success:!1}),n(T(ka)),this.handshakeResolvers.delete(e.responseId)},this.handshakeTimeoutMs)})}onWindowMessage(e){if(this.logger.trace(this.platformAuthType+" - onWindowMessage called"),e.source!==window)return;const t=e.data;if(!(!t.channel||t.channel!==he.CHANNEL_ID)&&!(t.extensionId&&t.extensionId!==this.extensionId)&&t.body.method===mt.HandshakeRequest){const n=this.handshakeResolvers.get(t.responseId);if(!n){this.logger.trace(this.platformAuthType+`.onWindowMessage - resolver can't be found for request ${t.responseId}`);return}this.logger.verbose(t.extensionId?`Extension with id: ${t.extensionId} not installed`:"No extension installed"),clearTimeout(this.timeoutId),this.messageChannel.port1.close(),this.messageChannel.port2.close(),window.removeEventListener("message",this.windowListener,!1),this.handshakeEvent.end({success:!1,extensionInstalled:!1}),n.reject(T(ba))}}onChannelMessage(e){this.logger.trace(this.platformAuthType+" - onChannelMessage called.");const t=e.data,n=this.resolvers.get(t.responseId),o=this.handshakeResolvers.get(t.responseId);try{const i=t.body.method;if(i===mt.Response){if(!n)return;const s=t.body.response;if(this.logger.trace(this.platformAuthType+" - Received response from browser extension"),this.logger.tracePii(this.platformAuthType+` - Received response from browser extension: ${JSON.stringify(s)}`),s.status!=="Success")n.reject(gn(s.code,s.description,s.ext));else if(s.result)s.result.code&&s.result.description?n.reject(gn(s.result.code,s.result.description,s.result.ext)):n.resolve(s.result);else throw er(Jt,"Event does not contain result.");this.resolvers.delete(t.responseId)}else if(i===mt.HandshakeResponse){if(!o){this.logger.trace(this.platformAuthType+`.onChannelMessage - resolver can't be found for request ${t.responseId}`);return}clearTimeout(this.timeoutId),window.removeEventListener("message",this.windowListener,!1),this.extensionId=t.extensionId,this.extensionVersion=t.body.version,this.logger.verbose(this.platformAuthType+` - Received HandshakeResponse from extension: ${this.extensionId}`),this.handshakeEvent.end({extensionInstalled:!0,success:!0}),o.resolve(),this.handshakeResolvers.delete(t.responseId)}}catch(i){this.logger.error("Error parsing response from WAM Extension"),this.logger.errorPii(`Error parsing response from WAM Extension: ${i}`),this.logger.errorPii(`Unable to parse ${e}`),n?n.reject(i):o&&o.reject(i)}}validatePlatformBrokerResponse(e){if(e.hasOwnProperty("access_token")&&e.hasOwnProperty("id_token")&&e.hasOwnProperty("client_info")&&e.hasOwnProperty("account")&&e.hasOwnProperty("scope")&&e.hasOwnProperty("expires_in"))return e;throw er(Jt,"Response missing expected properties.")}getExtensionId(){return this.extensionId}getExtensionVersion(){return this.extensionVersion}getExtensionName(){return this.getExtensionId()===he.PREFERRED_EXTENSION_ID?"chrome":this.getExtensionId()?.length?"unknown":void 0}}class Oo{constructor(e,t,n){this.logger=e,this.performanceClient=t,this.correlationId=n,this.platformAuthType=he.PLATFORM_DOM_PROVIDER}static async createProvider(e,t,n){if(e.trace("PlatformAuthDOMHandler: createProvider called"),window.navigator?.platformAuthentication&&(await window.navigator.platformAuthentication.getSupportedContracts(he.MICROSOFT_ENTRA_BROKERID))?.includes(he.PLATFORM_DOM_APIS))return e.trace("Platform auth api available in DOM"),new Oo(e,t,n)}getExtensionId(){return he.MICROSOFT_ENTRA_BROKERID}getExtensionVersion(){return""}getExtensionName(){return he.DOM_API_NAME}async sendMessage(e){this.logger.trace(this.platformAuthType+" - Sending request to browser DOM API");try{const t=this.initializePlatformDOMRequest(e),n=await window.navigator.platformAuthentication.executeGetToken(t);return this.validatePlatformBrokerResponse(n)}catch(t){throw this.logger.error(this.platformAuthType+" - executeGetToken DOM API error"),t}}initializePlatformDOMRequest(e){this.logger.trace(this.platformAuthType+" - initializeNativeDOMRequest called");const{accountId:t,clientId:n,authority:o,scope:i,redirectUri:s,correlationId:a,state:c,storeInCache:l,embeddedClientId:h,extraParameters:u,...g}=e,m=this.getDOMExtraParams(g);return{accountId:t,brokerId:this.getExtensionId(),authority:o,clientId:n,correlationId:a||this.correlationId,extraParameters:{...u,...m},isSecurityTokenService:!1,redirectUri:s,scope:i,state:c,storeInCache:l,embeddedClientId:h}}validatePlatformBrokerResponse(e){if(e.hasOwnProperty("isSuccess")){if(e.hasOwnProperty("accessToken")&&e.hasOwnProperty("idToken")&&e.hasOwnProperty("clientInfo")&&e.hasOwnProperty("account")&&e.hasOwnProperty("scopes")&&e.hasOwnProperty("expiresIn"))return this.logger.trace(this.platformAuthType+" - platform broker returned successful and valid response"),this.convertToPlatformBrokerResponse(e);if(e.hasOwnProperty("error")){const t=e;if(t.isSuccess===!1&&t.error&&t.error.code)throw this.logger.trace(this.platformAuthType+" - platform broker returned error response"),gn(t.error.code,t.error.description,{error:parseInt(t.error.errorCode),protocol_error:t.error.protocolError,status:t.error.status,properties:t.error.properties})}}throw er(Jt,"Response missing expected properties.")}convertToPlatformBrokerResponse(e){return this.logger.trace(this.platformAuthType+" - convertToNativeResponse called"),{access_token:e.accessToken,id_token:e.idToken,client_info:e.clientInfo,account:e.account,expires_in:e.expiresIn,scope:e.scopes,state:e.state||"",properties:e.properties||{},extendedLifetimeToken:e.extendedLifetimeToken??!1,shr:e.proofOfPossessionPayload}}getDOMExtraParams(e){return{...Object.entries(e).reduce((o,[i,s])=>(o[i]=String(s),o),{})}}}async function Pg(r,e,t,n,o){r.trace("getPlatformAuthProvider called",t),r.trace("Has client allowed platform auth via DOM API: "+o);let i;try{o&&(i=await Oo.createProvider(r,e,t)),i||(r.trace("Platform auth via DOM API not available, checking for extension"),i=await fn.createProvider(r,n||qa,e))}catch(s){r.trace("Platform auth not available",s)}return i}function Ot(r,e,t,n){if(e.trace("isPlatformAuthAllowed called"),!r.system.allowPlatformBroker&&r.system.allowPlatformBrokerWithDOM)throw D(bs);if(!r.system.allowPlatformBroker)return e.trace("isPlatformAuthAllowed: allowPlatformBroker is not enabled, returning false"),!1;if(!t)return e.trace("isPlatformAuthAllowed: Platform auth provider is not initialized, returning false"),!1;if(n)switch(n){case U.BEARER:case U.POP:return e.trace("isPlatformAuthAllowed: authenticationScheme is supported, returning true"),!0;default:return e.trace("isPlatformAuthAllowed: authenticationScheme is not supported, returning false"),!1}return!0}class Og extends gt{constructor(e,t,n,o,i,s,a,c,l,h){super(e,t,n,o,i,s,a,l,h),this.unloadWindow=this.unloadWindow.bind(this),this.nativeStorage=c,this.eventHandler=i}acquireToken(e,t){let n;try{if(n={popupName:this.generatePopupName(e.scopes||dt,e.authority||this.config.auth.authority),popupWindowAttributes:e.popupWindowAttributes||{},popupWindowParent:e.popupWindowParent??window},this.performanceClient.addFields({isAsyncPopup:this.config.system.asyncPopups},this.correlationId),this.config.system.asyncPopups)return this.logger.verbose("asyncPopups set to true, acquiring token"),this.acquireTokenPopupAsync(e,n,t);{const i={...e,httpMethod:Qa(e,this.config.auth.protocolMode)};return this.logger.verbose("asyncPopup set to false, opening popup before acquiring token"),n.popup=this.openSizedPopup("about:blank",n),this.acquireTokenPopupAsync(i,n,t)}}catch(o){return Promise.reject(o)}}logout(e){try{this.logger.verbose("logoutPopup called");const t=this.initializeLogoutRequest(e),n={popupName:this.generateLogoutPopupName(t),popupWindowAttributes:e?.popupWindowAttributes||{},popupWindowParent:e?.popupWindowParent??window},o=e&&e.authority,i=e&&e.mainWindowRedirectUri;return this.config.system.asyncPopups?(this.logger.verbose("asyncPopups set to true"),this.logoutPopupAsync(t,n,o,i)):(this.logger.verbose("asyncPopup set to false, opening popup"),n.popup=this.openSizedPopup("about:blank",n),this.logoutPopupAsync(t,n,o,i))}catch(t){return Promise.reject(t)}}async acquireTokenPopupAsync(e,t,n){this.logger.verbose("acquireTokenPopupAsync called");const o=await f(this.initializeAuthorizationRequest.bind(this),d.StandardInteractionClientInitializeAuthorizationRequest,this.logger,this.performanceClient,this.correlationId)(e,E.Popup);t.popup&&za(o.authority);const i=Ot(this.config,this.logger,this.platformAuthProvider,e.authenticationScheme);return o.platformBroker=i,this.config.auth.protocolMode===oe.EAR?this.executeEarFlow(o,t,n):this.executeCodeFlow(o,t,n)}async executeCodeFlow(e,t,n){const o=e.correlationId,i=this.initializeServerTelemetryManager(M.acquireTokenPopup),s=n||await f(We,d.GeneratePkceCodes,this.logger,this.performanceClient,o)(this.performanceClient,this.logger,o),a={...e,codeChallenge:s.challenge};try{const c=await f(this.createAuthCodeClient.bind(this),d.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,o)({serverTelemetryManager:i,requestAuthority:a.authority,requestAzureCloudOptions:a.azureCloudOptions,requestExtraQueryParameters:a.extraQueryParameters,account:a.account});if(a.httpMethod===$e.POST)return await this.executeCodeFlowWithPost(a,t,c,s.verifier);{const l=await f(bo,d.GetAuthCodeUrl,this.logger,this.performanceClient,o)(this.config,c.authority,a,this.logger,this.performanceClient),h=this.initiateAuthRequest(l,t);this.eventHandler.emitEvent(A.POPUP_OPENED,E.Popup,{popupWindow:h},null);const u=await this.monitorPopupForHash(h,t.popupWindowParent),g=de(vt,d.DeserializeResponse,this.logger,this.performanceClient,this.correlationId)(u,this.config.auth.OIDCOptions.serverResponseType,this.logger);return await f(it,d.HandleResponseCode,this.logger,this.performanceClient,o)(e,g,s.verifier,M.acquireTokenPopup,this.config,c,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}}catch(c){throw t.popup?.close(),c instanceof L&&(c.setCorrelationId(this.correlationId),i.cacheFailedRequest(c)),c}}async executeEarFlow(e,t,n){const o=e.correlationId,i=await f(this.getDiscoveredAuthority.bind(this),d.StandardInteractionClientGetDiscoveredAuthority,this.logger,this.performanceClient,o)({requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account}),s=await f(To,d.GenerateEarKey,this.logger,this.performanceClient,o)(),a=n||await f(We,d.GeneratePkceCodes,this.logger,this.performanceClient,o)(this.performanceClient,this.logger,o),c={...e,earJwk:s,codeChallenge:a.challenge},l=t.popup||this.openPopup("about:blank",t);(await _o(l.document,this.config,i,c,this.logger,this.performanceClient)).submit();const u=await f(this.monitorPopupForHash.bind(this),d.SilentHandlerMonitorIframeForHash,this.logger,this.performanceClient,o)(l,t.popupWindowParent),g=de(vt,d.DeserializeResponse,this.logger,this.performanceClient,this.correlationId)(u,this.config.auth.OIDCOptions.serverResponseType,this.logger);if(!g.ear_jwe&&g.code){const m=await f(this.createAuthCodeClient.bind(this),d.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,o)({serverTelemetryManager:this.initializeServerTelemetryManager(M.acquireTokenPopup),requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account,authority:i});return f(it,d.HandleResponseCode,this.logger,this.performanceClient,o)(c,g,a.verifier,M.acquireTokenPopup,this.config,m,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}else return f(Po,d.HandleResponseEar,this.logger,this.performanceClient,o)(c,g,M.acquireTokenPopup,this.config,i,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}async executeCodeFlowWithPost(e,t,n,o){const i=e.correlationId,s=await f(this.getDiscoveredAuthority.bind(this),d.StandardInteractionClientGetDiscoveredAuthority,this.logger,this.performanceClient,i)({requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account}),a=t.popup||this.openPopup("about:blank",t);(await Ro(a.document,this.config,s,e,this.logger,this.performanceClient)).submit();const l=await f(this.monitorPopupForHash.bind(this),d.SilentHandlerMonitorIframeForHash,this.logger,this.performanceClient,i)(a,t.popupWindowParent),h=de(vt,d.DeserializeResponse,this.logger,this.performanceClient,this.correlationId)(l,this.config.auth.OIDCOptions.serverResponseType,this.logger);return f(it,d.HandleResponseCode,this.logger,this.performanceClient,i)(e,h,o,M.acquireTokenPopup,this.config,n,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}async logoutPopupAsync(e,t,n,o){this.logger.verbose("logoutPopupAsync called"),this.eventHandler.emitEvent(A.LOGOUT_START,E.Popup,e);const i=this.initializeServerTelemetryManager(M.logoutPopup);try{await this.clearCacheOnLogout(this.correlationId,e.account);const s=await f(this.createAuthCodeClient.bind(this),d.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:i,requestAuthority:n,account:e.account||void 0});try{s.authority.endSessionEndpoint}catch{if(e.account?.homeAccountId&&e.postLogoutRedirectUri&&s.authority.protocolMode===oe.OIDC){if(this.eventHandler.emitEvent(A.LOGOUT_SUCCESS,E.Popup,e),o){const l={apiId:M.logoutPopup,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},h=N.getAbsoluteUrl(o,be());await this.navigationClient.navigateInternal(h,l)}t.popup?.close();return}}const a=s.getLogoutUri(e);this.eventHandler.emitEvent(A.LOGOUT_SUCCESS,E.Popup,e);const c=this.openPopup(a,t);if(this.eventHandler.emitEvent(A.POPUP_OPENED,E.Popup,{popupWindow:c},null),await this.monitorPopupForHash(c,t.popupWindowParent).catch(()=>{}),o){const l={apiId:M.logoutPopup,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},h=N.getAbsoluteUrl(o,be());this.logger.verbose("Redirecting main window to url specified in the request"),this.logger.verbosePii(`Redirecting main window to: ${h}`),await this.navigationClient.navigateInternal(h,l)}else this.logger.verbose("No main window navigation requested")}catch(s){throw t.popup?.close(),s instanceof L&&(s.setCorrelationId(this.correlationId),i.cacheFailedRequest(s)),this.eventHandler.emitEvent(A.LOGOUT_FAILURE,E.Popup,null,s),this.eventHandler.emitEvent(A.LOGOUT_END,E.Popup),s}this.eventHandler.emitEvent(A.LOGOUT_END,E.Popup)}initiateAuthRequest(e,t){if(e)return this.logger.infoPii(`Navigate to: ${e}`),this.openPopup(e,t);throw this.logger.error("Navigate url is empty"),T(On)}monitorPopupForHash(e,t){return new Promise((n,o)=>{this.logger.verbose("PopupHandler.monitorPopupForHash - polling started");const i=setInterval(()=>{if(e.closed){this.logger.error("PopupHandler.monitorPopupForHash - window closed"),clearInterval(i),o(T(Rt));return}let s="";try{s=e.location.href}catch{}if(!s||s==="about:blank")return;clearInterval(i);let a="";const c=this.config.auth.OIDCOptions.serverResponseType;e&&(c===Tn.QUERY?a=e.location.search:a=e.location.hash),this.logger.verbose("PopupHandler.monitorPopupForHash - popup window is on same origin as caller"),n(a)},this.config.system.pollIntervalMilliseconds)}).finally(()=>{this.cleanPopup(e,t)})}openPopup(e,t){try{let n;if(t.popup?(n=t.popup,this.logger.verbosePii(`Navigating popup window to: ${e}`),n.location.assign(e)):typeof t.popup>"u"&&(this.logger.verbosePii(`Opening popup window to: ${e}`),n=this.openSizedPopup(e,t)),!n)throw T(ha);return n.focus&&n.focus(),this.currentWindow=n,t.popupWindowParent.addEventListener("beforeunload",this.unloadWindow),n}catch(n){throw this.logger.error("error opening popup "+n.message),T(da)}}openSizedPopup(e,{popupName:t,popupWindowAttributes:n,popupWindowParent:o}){const i=o.screenLeft?o.screenLeft:o.screenX,s=o.screenTop?o.screenTop:o.screenY,a=o.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,c=o.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;let l=n.popupSize?.width,h=n.popupSize?.height,u=n.popupPosition?.top,g=n.popupPosition?.left;return(!l||l<0||l>a)&&(this.logger.verbose("Default popup window width used. Window width not configured or invalid."),l=re.POPUP_WIDTH),(!h||h<0||h>c)&&(this.logger.verbose("Default popup window height used. Window height not configured or invalid."),h=re.POPUP_HEIGHT),(!u||u<0||u>c)&&(this.logger.verbose("Default popup window top position used. Window top not configured or invalid."),u=Math.max(0,c/2-re.POPUP_HEIGHT/2+s)),(!g||g<0||g>a)&&(this.logger.verbose("Default popup window left position used. Window left not configured or invalid."),g=Math.max(0,a/2-re.POPUP_WIDTH/2+i)),o.open(e,t,`width=${l}, height=${h}, top=${u}, left=${g}, scrollbars=yes`)}unloadWindow(e){this.currentWindow&&this.currentWindow.close(),e.preventDefault()}cleanPopup(e,t){e.close(),t.removeEventListener("beforeunload",this.unloadWindow)}generatePopupName(e,t){return`${re.POPUP_NAME_PREFIX}.${this.config.auth.clientId}.${e.join("-")}.${t}.${this.correlationId}`}generateLogoutPopupName(e){const t=e.account&&e.account.homeAccountId;return`${re.POPUP_NAME_PREFIX}.${this.config.auth.clientId}.${t}.${this.correlationId}`}}function Ng(){if(typeof window>"u"||typeof window.performance>"u"||typeof window.performance.getEntriesByType!="function")return;const r=window.performance.getEntriesByType("navigation");return(r.length?r[0]:void 0)?.type}class Mg extends gt{constructor(e,t,n,o,i,s,a,c,l,h){super(e,t,n,o,i,s,a,l,h),this.nativeStorage=c}async acquireToken(e){const t=await f(this.initializeAuthorizationRequest.bind(this),d.StandardInteractionClientInitializeAuthorizationRequest,this.logger,this.performanceClient,this.correlationId)(e,E.Redirect);t.platformBroker=Ot(this.config,this.logger,this.platformAuthProvider,e.authenticationScheme);const n=i=>{i.persisted&&(this.logger.verbose("Page was restored from back/forward cache. Clearing temporary cache."),this.browserStorage.resetRequestCache(),this.eventHandler.emitEvent(A.RESTORE_FROM_BFCACHE,E.Redirect))},o=this.getRedirectStartPage(e.redirectStartPage);this.logger.verbosePii(`Redirect start page: ${o}`),this.browserStorage.setTemporaryCache($.ORIGIN_URI,o,!0),window.addEventListener("pageshow",n);try{this.config.auth.protocolMode===oe.EAR?await this.executeEarFlow(t):await this.executeCodeFlow(t,e.onRedirectNavigate)}catch(i){throw i instanceof L&&i.setCorrelationId(this.correlationId),window.removeEventListener("pageshow",n),i}}async executeCodeFlow(e,t){const n=e.correlationId,o=this.initializeServerTelemetryManager(M.acquireTokenRedirect),i=await f(We,d.GeneratePkceCodes,this.logger,this.performanceClient,n)(this.performanceClient,this.logger,n),s={...e,codeChallenge:i.challenge};this.browserStorage.cacheAuthorizeRequest(s,i.verifier);try{if(s.httpMethod===$e.POST)return await this.executeCodeFlowWithPost(s);{const a=await f(this.createAuthCodeClient.bind(this),d.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:o,requestAuthority:s.authority,requestAzureCloudOptions:s.azureCloudOptions,requestExtraQueryParameters:s.extraQueryParameters,account:s.account}),c=await f(bo,d.GetAuthCodeUrl,this.logger,this.performanceClient,e.correlationId)(this.config,a.authority,s,this.logger,this.performanceClient);return await this.initiateAuthRequest(c,t)}}catch(a){throw a instanceof L&&(a.setCorrelationId(this.correlationId),o.cacheFailedRequest(a)),a}}async executeEarFlow(e){const t=e.correlationId,n=await f(this.getDiscoveredAuthority.bind(this),d.StandardInteractionClientGetDiscoveredAuthority,this.logger,this.performanceClient,t)({requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account}),o=await f(To,d.GenerateEarKey,this.logger,this.performanceClient,t)(),i=await f(We,d.GeneratePkceCodes,this.logger,this.performanceClient,t)(this.performanceClient,this.logger,t),s={...e,earJwk:o,codeChallenge:i.challenge};return this.browserStorage.cacheAuthorizeRequest(s,i.verifier),(await _o(document,this.config,n,s,this.logger,this.performanceClient)).submit(),new Promise((c,l)=>{setTimeout(()=>{l(T(hn,"failed_to_redirect"))},this.config.system.redirectNavigationTimeout)})}async executeCodeFlowWithPost(e){const t=e.correlationId,n=await f(this.getDiscoveredAuthority.bind(this),d.StandardInteractionClientGetDiscoveredAuthority,this.logger,this.performanceClient,t)({requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account});return this.browserStorage.cacheAuthorizeRequest(e),(await Ro(document,this.config,n,e,this.logger,this.performanceClient)).submit(),new Promise((i,s)=>{setTimeout(()=>{s(T(hn,"failed_to_redirect"))},this.config.system.redirectNavigationTimeout)})}async handleRedirectPromise(e="",t,n,o){const i=this.initializeServerTelemetryManager(M.handleRedirectPromise);try{const[s,a]=this.getRedirectResponse(e||"");if(!s)return this.logger.info("handleRedirectPromise did not detect a response as a result of a redirect. Cleaning temporary cache."),this.browserStorage.resetRequestCache(),Ng()!=="back_forward"?o.event.errorCode="no_server_response":this.logger.verbose("Back navigation event detected. Muting no_server_response error"),null;const c=this.browserStorage.getTemporaryCache($.ORIGIN_URI,!0)||p.EMPTY_STRING,l=Qo(c),h=Qo(window.location.href);if(l===h&&this.config.auth.navigateToLoginRequestUrl)return this.logger.verbose("Current page is loginRequestUrl, handling response"),c.indexOf("#")>-1&&xu(c),await this.handleResponse(s,t,n,i);if(this.config.auth.navigateToLoginRequestUrl){if(!wo()||this.config.system.allowRedirectInIframe){this.browserStorage.setTemporaryCache($.URL_HASH,a,!0);const u={apiId:M.handleRedirectPromise,timeout:this.config.system.redirectNavigationTimeout,noHistory:!0};let g=!0;if(!c||c==="null"){const m=Fu();this.browserStorage.setTemporaryCache($.ORIGIN_URI,m,!0),this.logger.warning("Unable to get valid login request url from cache, redirecting to home page"),g=await this.navigationClient.navigateInternal(m,u)}else this.logger.verbose(`Navigating to loginRequestUrl: ${c}`),g=await this.navigationClient.navigateInternal(c,u);if(!g)return await this.handleResponse(s,t,n,i)}}else return this.logger.verbose("NavigateToLoginRequestUrl set to false, handling response"),await this.handleResponse(s,t,n,i);return null}catch(s){throw s instanceof L&&(s.setCorrelationId(this.correlationId),i.cacheFailedRequest(s)),s}}getRedirectResponse(e){this.logger.verbose("getRedirectResponseHash called");let t=e;t||(this.config.auth.OIDCOptions.serverResponseType===Tn.QUERY?t=window.location.search:t=window.location.hash);let n=en(t);if(n){try{mg(n,this.browserCrypto,E.Redirect)}catch(i){return i instanceof L&&this.logger.error(`Interaction type validation failed due to ${i.errorCode}: ${i.errorMessage}`),[null,""]}return Ka(window),this.logger.verbose("Hash contains known properties, returning response hash"),[n,t]}const o=this.browserStorage.getTemporaryCache($.URL_HASH,!0);return this.browserStorage.removeItem(this.browserStorage.generateCacheKey($.URL_HASH)),o&&(n=en(o),n)?(this.logger.verbose("Hash does not contain known properties, returning cached hash"),[n,o]):[null,""]}async handleResponse(e,t,n,o){if(!e.state)throw T(ho);if(e.ear_jwe){const a=await f(this.getDiscoveredAuthority.bind(this),d.StandardInteractionClientGetDiscoveredAuthority,this.logger,this.performanceClient,t.correlationId)({requestAuthority:t.authority,requestAzureCloudOptions:t.azureCloudOptions,requestExtraQueryParameters:t.extraQueryParameters,account:t.account});return f(Po,d.HandleResponseEar,this.logger,this.performanceClient,t.correlationId)(t,e,M.acquireTokenRedirect,this.config,a,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}const s=await f(this.createAuthCodeClient.bind(this),d.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:o,requestAuthority:t.authority});return f(it,d.HandleResponseCode,this.logger,this.performanceClient,t.correlationId)(t,e,n,M.acquireTokenRedirect,this.config,s,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}async initiateAuthRequest(e,t){if(this.logger.verbose("RedirectHandler.initiateAuthRequest called"),e){this.logger.infoPii(`RedirectHandler.initiateAuthRequest: Navigate to: ${e}`);const n={apiId:M.acquireTokenRedirect,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},o=t||this.config.auth.onRedirectNavigate;if(typeof o=="function")if(this.logger.verbose("RedirectHandler.initiateAuthRequest: Invoking onRedirectNavigate callback"),o(e)!==!1){this.logger.verbose("RedirectHandler.initiateAuthRequest: onRedirectNavigate did not return false, navigating"),await this.navigationClient.navigateExternal(e,n);return}else{this.logger.verbose("RedirectHandler.initiateAuthRequest: onRedirectNavigate returned false, stopping navigation");return}else{this.logger.verbose("RedirectHandler.initiateAuthRequest: Navigating window to navigate url"),await this.navigationClient.navigateExternal(e,n);return}}else throw this.logger.info("RedirectHandler.initiateAuthRequest: Navigate url is empty"),T(On)}async logout(e){this.logger.verbose("logoutRedirect called");const t=this.initializeLogoutRequest(e),n=this.initializeServerTelemetryManager(M.logout);try{this.eventHandler.emitEvent(A.LOGOUT_START,E.Redirect,e),await this.clearCacheOnLogout(this.correlationId,t.account);const o={apiId:M.logout,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},i=await f(this.createAuthCodeClient.bind(this),d.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:n,requestAuthority:e&&e.authority,requestExtraQueryParameters:e?.extraQueryParameters,account:e&&e.account||void 0});if(i.authority.protocolMode===oe.OIDC)try{i.authority.endSessionEndpoint}catch{if(t.account?.homeAccountId){this.eventHandler.emitEvent(A.LOGOUT_SUCCESS,E.Redirect,t);return}}const s=i.getLogoutUri(t);if(this.eventHandler.emitEvent(A.LOGOUT_SUCCESS,E.Redirect,t),e&&typeof e.onRedirectNavigate=="function")if(e.onRedirectNavigate(s)!==!1){this.logger.verbose("Logout onRedirectNavigate did not return false, navigating"),this.browserStorage.getInteractionInProgress()||this.browserStorage.setInteractionInProgress(!0,Ne.SIGNOUT),await this.navigationClient.navigateExternal(s,o);return}else this.browserStorage.setInteractionInProgress(!1),this.logger.verbose("Logout onRedirectNavigate returned false, stopping navigation");else{this.browserStorage.getInteractionInProgress()||this.browserStorage.setInteractionInProgress(!0,Ne.SIGNOUT),await this.navigationClient.navigateExternal(s,o);return}}catch(o){throw o instanceof L&&(o.setCorrelationId(this.correlationId),n.cacheFailedRequest(o)),this.eventHandler.emitEvent(A.LOGOUT_FAILURE,E.Redirect,null,o),this.eventHandler.emitEvent(A.LOGOUT_END,E.Redirect),o}this.eventHandler.emitEvent(A.LOGOUT_END,E.Redirect)}getRedirectStartPage(e){const t=e||window.location.href;return N.getAbsoluteUrl(t,be())}}async function Ug(r,e,t,n,o){if(e.addQueueMeasurement(d.SilentHandlerInitiateAuthRequest,n),!r)throw t.info("Navigate url is empty"),T(On);return o?f(xg,d.SilentHandlerLoadFrame,t,e,n)(r,o,e,n):de(Hg,d.SilentHandlerLoadFrameSync,t,e,n)(r)}async function Dg(r,e,t,n,o){const i=Ln();if(!i.contentDocument)throw"No document associated with iframe!";return(await Ro(i.contentDocument,r,e,t,n,o)).submit(),i}async function Lg(r,e,t,n,o){const i=Ln();if(!i.contentDocument)throw"No document associated with iframe!";return(await _o(i.contentDocument,r,e,t,n,o)).submit(),i}async function ki(r,e,t,n,o,i,s){return n.addQueueMeasurement(d.SilentHandlerMonitorIframeForHash,i),new Promise((a,c)=>{e<hr&&o.warning(`system.loadFrameTimeout or system.iframeHashTimeout set to lower (${e}ms) than the default (${hr}ms). This may result in timeouts.`);const l=window.setTimeout(()=>{window.clearInterval(h),c(T(ua))},e),h=window.setInterval(()=>{let u="";const g=r.contentWindow;try{u=g?g.location.href:""}catch{}if(!u||u==="about:blank")return;let m="";g&&(s===Tn.QUERY?m=g.location.search:m=g.location.hash),window.clearTimeout(l),window.clearInterval(h),a(m)},t)}).finally(()=>{de(Fg,d.RemoveHiddenIframe,o,n,i)(r)})}function xg(r,e,t,n){return t.addQueueMeasurement(d.SilentHandlerLoadFrame,n),new Promise((o,i)=>{const s=Ln();window.setTimeout(()=>{if(!s){i("Unable to load iframe");return}s.src=r,o(s)},e)})}function Hg(r){const e=Ln();return e.src=r,e}function Ln(){const r=document.createElement("iframe");return r.className="msalSilentIframe",r.style.visibility="hidden",r.style.position="absolute",r.style.width=r.style.height="0",r.style.border="0",r.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms"),r.setAttribute("allow","local-network-access *"),document.body.appendChild(r),r}function Fg(r){document.body===r.parentNode&&document.body.removeChild(r)}class Bg extends gt{constructor(e,t,n,o,i,s,a,c,l,h,u){super(e,t,n,o,i,s,c,h,u),this.apiId=a,this.nativeStorage=l}async acquireToken(e){this.performanceClient.addQueueMeasurement(d.SilentIframeClientAcquireToken,e.correlationId),!e.loginHint&&!e.sid&&(!e.account||!e.account.username)&&this.logger.warning("No user hint provided. The authorization server may need more information to complete this request.");const t={...e};t.prompt?t.prompt!==Q.NONE&&t.prompt!==Q.NO_SESSION&&(this.logger.warning(`SilentIframeClient. Replacing invalid prompt ${t.prompt} with ${Q.NONE}`),t.prompt=Q.NONE):t.prompt=Q.NONE;const n=await f(this.initializeAuthorizationRequest.bind(this),d.StandardInteractionClientInitializeAuthorizationRequest,this.logger,this.performanceClient,e.correlationId)(t,E.Silent);return n.platformBroker=Ot(this.config,this.logger,this.platformAuthProvider,n.authenticationScheme),za(n.authority),this.config.auth.protocolMode===oe.EAR?this.executeEarFlow(n):this.executeCodeFlow(n)}async executeCodeFlow(e){let t;const n=this.initializeServerTelemetryManager(this.apiId);try{return t=await f(this.createAuthCodeClient.bind(this),d.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,e.correlationId)({serverTelemetryManager:n,requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account}),await f(this.silentTokenHelper.bind(this),d.SilentIframeClientTokenHelper,this.logger,this.performanceClient,e.correlationId)(t,e)}catch(o){if(o instanceof L&&(o.setCorrelationId(this.correlationId),n.cacheFailedRequest(o)),!t||!(o instanceof L)||o.errorCode!==re.INVALID_GRANT_ERROR)throw o;return this.performanceClient.addFields({retryError:o.errorCode},this.correlationId),await f(this.silentTokenHelper.bind(this),d.SilentIframeClientTokenHelper,this.logger,this.performanceClient,this.correlationId)(t,e)}}async executeEarFlow(e){const t=e.correlationId,n=await f(this.getDiscoveredAuthority.bind(this),d.StandardInteractionClientGetDiscoveredAuthority,this.logger,this.performanceClient,t)({requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account}),o=await f(To,d.GenerateEarKey,this.logger,this.performanceClient,t)(),i=await f(We,d.GeneratePkceCodes,this.logger,this.performanceClient,t)(this.performanceClient,this.logger,t),s={...e,earJwk:o,codeChallenge:i.challenge},a=await f(Lg,d.SilentHandlerInitiateAuthRequest,this.logger,this.performanceClient,t)(this.config,n,s,this.logger,this.performanceClient),c=this.config.auth.OIDCOptions.serverResponseType,l=await f(ki,d.SilentHandlerMonitorIframeForHash,this.logger,this.performanceClient,t)(a,this.config.system.iframeHashTimeout,this.config.system.pollIntervalMilliseconds,this.performanceClient,this.logger,t,c),h=de(vt,d.DeserializeResponse,this.logger,this.performanceClient,t)(l,c,this.logger);if(!h.ear_jwe&&h.code){const u=await f(this.createAuthCodeClient.bind(this),d.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,t)({serverTelemetryManager:this.initializeServerTelemetryManager(this.apiId),requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account,authority:n});return f(it,d.HandleResponseCode,this.logger,this.performanceClient,t)(s,h,i.verifier,this.apiId,this.config,u,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}else return f(Po,d.HandleResponseEar,this.logger,this.performanceClient,t)(s,h,this.apiId,this.config,n,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}logout(){return Promise.reject(T(Nn))}async silentTokenHelper(e,t){const n=t.correlationId;this.performanceClient.addQueueMeasurement(d.SilentIframeClientTokenHelper,n);const o=await f(We,d.GeneratePkceCodes,this.logger,this.performanceClient,n)(this.performanceClient,this.logger,n),i={...t,codeChallenge:o.challenge};let s;if(t.httpMethod===$e.POST)s=await f(Dg,d.SilentHandlerInitiateAuthRequest,this.logger,this.performanceClient,n)(this.config,e.authority,i,this.logger,this.performanceClient);else{const h=await f(bo,d.GetAuthCodeUrl,this.logger,this.performanceClient,n)(this.config,e.authority,i,this.logger,this.performanceClient);s=await f(Ug,d.SilentHandlerInitiateAuthRequest,this.logger,this.performanceClient,n)(h,this.performanceClient,this.logger,n,this.config.system.navigateFrameWait)}const a=this.config.auth.OIDCOptions.serverResponseType,c=await f(ki,d.SilentHandlerMonitorIframeForHash,this.logger,this.performanceClient,n)(s,this.config.system.iframeHashTimeout,this.config.system.pollIntervalMilliseconds,this.performanceClient,this.logger,n,a),l=de(vt,d.DeserializeResponse,this.logger,this.performanceClient,n)(c,a,this.logger);return f(it,d.HandleResponseCode,this.logger,this.performanceClient,n)(t,l,o.verifier,this.apiId,this.config,e,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}}class Kg extends gt{async acquireToken(e){this.performanceClient.addQueueMeasurement(d.SilentRefreshClientAcquireToken,e.correlationId);const t=await f(So,d.InitializeBaseRequest,this.logger,this.performanceClient,e.correlationId)(e,this.config,this.performanceClient,this.logger),n={...e,...t};e.redirectUri&&(n.redirectUri=this.getRedirectUri(e.redirectUri));const o=this.initializeServerTelemetryManager(M.acquireTokenSilent_silentFlow),i=await this.createRefreshTokenClient({serverTelemetryManager:o,authorityUrl:n.authority,azureCloudOptions:n.azureCloudOptions,account:n.account});return f(i.acquireTokenByRefreshToken.bind(i),d.RefreshTokenClientAcquireTokenByRefreshToken,this.logger,this.performanceClient,e.correlationId)(n).catch(s=>{throw s.setCorrelationId(this.correlationId),o.cacheFailedRequest(s),s})}logout(){return Promise.reject(T(Nn))}async createRefreshTokenClient(e){const t=await f(this.getClientConfiguration.bind(this),d.StandardInteractionClientGetClientConfiguration,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:e.serverTelemetryManager,requestAuthority:e.authorityUrl,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account});return new ru(t,this.performanceClient)}}class $g{constructor(e,t,n,o){this.isBrowserEnvironment=typeof window<"u",this.config=e,this.storage=t,this.logger=n,this.cryptoObj=o}async loadExternalTokens(e,t,n){if(!this.isBrowserEnvironment)throw T(Mn);const o=e.correlationId||ye(),i=t.id_token?Ae(t.id_token,ne):void 0,s=Ie(i||{}),a={protocolMode:this.config.auth.protocolMode,knownAuthorities:this.config.auth.knownAuthorities,cloudDiscoveryMetadata:this.config.auth.cloudDiscoveryMetadata,authorityMetadata:this.config.auth.authorityMetadata,skipAuthorityMetadataCache:this.config.auth.skipAuthorityMetadataCache},c=e.authority?new X(X.generateAuthority(e.authority,e.azureCloudOptions),this.config.system.networkClient,this.storage,a,this.logger,e.correlationId||ye()):void 0,l=await this.loadAccount(e,n.clientInfo||t.client_info||"",o,i,c),h=await this.loadIdToken(t,l.homeAccountId,l.environment,l.realm,o,s),u=await this.loadAccessToken(e,t,l.homeAccountId,l.environment,l.realm,n,o,s),g=await this.loadRefreshToken(t,l.homeAccountId,l.environment,o,s);return this.generateAuthenticationResult(e,{account:l,idToken:h,accessToken:u,refreshToken:g},i,c)}async loadAccount(e,t,n,o,i){if(this.logger.verbose("TokenCache - loading account"),e.account){const l=B.createFromAccountInfo(e.account);return await this.storage.setAccount(l,n,Ie(o||{})),l}else if(!i||!t&&!o)throw this.logger.error("TokenCache - if an account is not provided on the request, authority and either clientInfo or idToken must be provided instead."),T(Ia);const s=B.generateHomeAccountId(t,i.authorityType,this.logger,this.cryptoObj,o),a=o?.tid,c=oo(this.storage,i,s,ne,n,o,t,i.hostnameAndPort,a,void 0,void 0,this.logger);return await this.storage.setAccount(c,n,Ie(o||{})),c}async loadIdToken(e,t,n,o,i,s){if(!e.id_token)return this.logger.verbose("TokenCache - no id token found in response"),null;this.logger.verbose("TokenCache - loading id token");const a=Sn(t,n,e.id_token,this.config.auth.clientId,o);return await this.storage.setIdTokenCredential(a,i,s),a}async loadAccessToken(e,t,n,o,i,s,a,c){if(t.access_token)if(t.expires_in){if(!t.scope&&(!e.scopes||!e.scopes.length))return this.logger.error("TokenCache - scopes not specified in the request or response. Cannot add token to the cache."),null}else return this.logger.error("TokenCache - no expiration set on the access token. Cannot add it to the cache."),null;else return this.logger.verbose("TokenCache - no access token found in response"),null;this.logger.verbose("TokenCache - loading access token");const l=t.scope?q.fromString(t.scope):new q(e.scopes),h=s.expiresOn||t.expires_in+ie(),u=s.extendedExpiresOn||(t.ext_expires_in||t.expires_in)+ie(),g=kn(n,o,t.access_token,this.config.auth.clientId,i,l.printScopes(),h,u,ne);return await this.storage.setAccessTokenCredential(g,a,c),g}async loadRefreshToken(e,t,n,o,i){if(!e.refresh_token)return this.logger.verbose("TokenCache - no refresh token found in response"),null;this.logger.verbose("TokenCache - loading refresh token");const s=Vs(t,n,e.refresh_token,this.config.auth.clientId,e.foci,void 0,e.refresh_token_expires_in);return await this.storage.setRefreshTokenCredential(s,o,i),s}generateAuthenticationResult(e,t,n,o){let i="",s=[],a=null,c;t?.accessToken&&(i=t.accessToken.secret,s=q.fromString(t.accessToken.target).asArray(),a=nt(t.accessToken.expiresOn),c=nt(t.accessToken.extendedExpiresOn));const l=t.account;return{authority:o?o.canonicalAuthority:"",uniqueId:t.account.localAccountId,tenantId:t.account.realm,scopes:s,account:B.getAccountInfo(l),idToken:t.idToken?.secret||"",idTokenClaims:n||{},accessToken:i,fromCache:!0,expiresOn:a,correlationId:e.correlationId||"",requestId:"",extExpiresOn:c,familyId:t.refreshToken?.familyId||"",tokenType:t?.accessToken?.tokenType||"",state:e.state||"",cloudGraphHostName:l.cloudGraphHostName||"",msGraphHost:l.msGraphHost||"",fromNativeBroker:!1}}}class Gg extends Zs{constructor(e){super(e),this.includeRedirectUri=!1}}class zg extends gt{constructor(e,t,n,o,i,s,a,c,l,h){super(e,t,n,o,i,s,c,l,h),this.apiId=a}async acquireToken(e){if(!e.code)throw T(wa);const t=await f(this.initializeAuthorizationRequest.bind(this),d.StandardInteractionClientInitializeAuthorizationRequest,this.logger,this.performanceClient,e.correlationId)(e,E.Silent),n=this.initializeServerTelemetryManager(this.apiId);try{const o={...t,code:e.code},i=await f(this.getClientConfiguration.bind(this),d.StandardInteractionClientGetClientConfiguration,this.logger,this.performanceClient,e.correlationId)({serverTelemetryManager:n,requestAuthority:t.authority,requestAzureCloudOptions:t.azureCloudOptions,requestExtraQueryParameters:t.extraQueryParameters,account:t.account}),s=new Gg(i);this.logger.verbose("Auth code client created");const a=new Ya(s,this.browserStorage,o,this.logger,this.performanceClient);return await f(a.handleCodeResponseFromServer.bind(a),d.HandleCodeResponseFromServer,this.logger,this.performanceClient,e.correlationId)({code:e.code,msgraph_host:e.msGraphHost,cloud_graph_host_name:e.cloudGraphHostName,cloud_instance_host_name:e.cloudInstanceHostName},t,!1)}catch(o){throw o instanceof L&&(o.setCorrelationId(this.correlationId),n.cacheFailedRequest(o)),o}}logout(){return Promise.reject(T(Nn))}}function qg(r,e,t){const n=window.msal?.clientIds||[],o=n.length,i=n.filter(s=>s===r).length;i>1&&t.warning("There is already an instance of MSAL.js in the window with the same client id."),e.add({msalInstanceCount:o,sameClientIdInstanceCount:i})}function $t(r,e,t){try{Eo(r)}catch(n){throw e.end({success:!1},n,t),n}}class xn{constructor(e){this.operatingContext=e,this.isBrowserEnvironment=this.operatingContext.isBrowserEnvironment(),this.config=e.getConfig(),this.initialized=!1,this.logger=this.operatingContext.getLogger(),this.networkClient=this.config.system.networkClient,this.navigationClient=this.config.system.navigationClient,this.redirectResponse=new Map,this.hybridAuthCodeResponses=new Map,this.performanceClient=this.config.telemetry.client,this.browserCrypto=this.isBrowserEnvironment?new Re(this.logger,this.performanceClient):Xt,this.eventHandler=new gg(this.logger),this.browserStorage=this.isBrowserEnvironment?new gr(this.config.auth.clientId,this.config.cache,this.browserCrypto,this.logger,this.performanceClient,this.eventHandler,Wh(this.config.auth)):og(this.config.auth.clientId,this.logger,this.performanceClient,this.eventHandler);const t={cacheLocation:Y.MemoryStorage,cacheRetentionDays:5,temporaryCacheLocation:Y.MemoryStorage,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!1,claimsBasedCachingEnabled:!1};this.nativeInternalStorage=new gr(this.config.auth.clientId,t,this.browserCrypto,this.logger,this.performanceClient,this.eventHandler),this.tokenCache=new $g(this.config,this.browserStorage,this.logger,this.browserCrypto),this.activeSilentTokenRequests=new Map,this.trackPageVisibility=this.trackPageVisibility.bind(this),this.trackPageVisibilityWithMeasurement=this.trackPageVisibilityWithMeasurement.bind(this)}static async createController(e,t){const n=new xn(e);return await n.initialize(t),n}trackPageVisibility(e){e&&(this.logger.info("Perf: Visibility change detected"),this.performanceClient.incrementFields({visibilityChangeCount:1},e))}async initialize(e,t){if(this.logger.trace("initialize called"),this.initialized){this.logger.info("initialize has already been called, exiting early.");return}if(!this.isBrowserEnvironment){this.logger.info("in non-browser environment, exiting early."),this.initialized=!0,this.eventHandler.emitEvent(A.INITIALIZE_END);return}const n=e?.correlationId||this.getRequestCorrelationId(),o=this.config.system.allowPlatformBroker,i=this.performanceClient.startMeasurement(d.InitializeClientApplication,n);if(this.eventHandler.emitEvent(A.INITIALIZE_START),!t)try{this.logMultipleInstances(i)}catch{}if(await f(this.browserStorage.initialize.bind(this.browserStorage),d.InitializeCache,this.logger,this.performanceClient,n)(n),o)try{this.platformAuthProvider=await Pg(this.logger,this.performanceClient,n,this.config.system.nativeBrokerHandshakeTimeout,this.config.system.allowPlatformBrokerWithDOM)}catch(s){this.logger.verbose(s)}this.config.cache.claimsBasedCachingEnabled||(this.logger.verbose("Claims-based caching is disabled. Clearing the previous cache with claims"),de(this.browserStorage.clearTokensAndKeysWithClaims.bind(this.browserStorage),d.ClearTokensAndKeysWithClaims,this.logger,this.performanceClient,n)(n)),this.config.system.asyncPopups&&await this.preGeneratePkceCodes(n),this.initialized=!0,this.eventHandler.emitEvent(A.INITIALIZE_END),i.end({allowPlatformBroker:o,success:!0})}async handleRedirectPromise(e){if(this.logger.verbose("handleRedirectPromise called"),Ga(this.initialized),this.isBrowserEnvironment){const t=e||"";let n=this.redirectResponse.get(t);return typeof n>"u"?(n=this.handleRedirectPromiseInternal(e),this.redirectResponse.set(t,n),this.logger.verbose("handleRedirectPromise has been called for the first time, storing the promise")):this.logger.verbose("handleRedirectPromise has been called previously, returning the result from the first call"),n}return this.logger.verbose("handleRedirectPromise returns null, not browser environment"),null}async handleRedirectPromiseInternal(e){if(!this.browserStorage.isInteractionInProgress(!0))return this.logger.info("handleRedirectPromise called but there is no interaction in progress, returning null."),null;if(this.browserStorage.getInteractionInProgress()?.type===Ne.SIGNOUT)return this.logger.verbose("handleRedirectPromise removing interaction_in_progress flag and returning null after sign-out"),this.browserStorage.setInteractionInProgress(!1),Promise.resolve(null);const n=this.getAllAccounts(),o=this.browserStorage.getCachedNativeRequest(),i=o&&this.platformAuthProvider&&!e;let s;this.eventHandler.emitEvent(A.HANDLE_REDIRECT_START,E.Redirect);let a;try{if(i&&this.platformAuthProvider){s=this.performanceClient.startMeasurement(d.AcquireTokenRedirect,o?.correlationId||""),this.logger.trace("handleRedirectPromise - acquiring token from native platform"),s.add({isPlatformBrokerRequest:!0});const c=new Vt(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,M.handleRedirectPromise,this.performanceClient,this.platformAuthProvider,o.accountId,this.nativeInternalStorage,o.correlationId);a=f(c.handleRedirectPromise.bind(c),d.HandleNativeRedirectPromiseMeasurement,this.logger,this.performanceClient,s.event.correlationId)(this.performanceClient,s.event.correlationId)}else{const[c,l]=this.browserStorage.getCachedRequest(),h=c.correlationId;s=this.performanceClient.startMeasurement(d.AcquireTokenRedirect,h),this.logger.trace("handleRedirectPromise - acquiring token from web flow");const u=this.createRedirectClient(h);a=f(u.handleRedirectPromise.bind(u),d.HandleRedirectPromiseMeasurement,this.logger,this.performanceClient,s.event.correlationId)(e,c,l,s)}}catch(c){throw this.browserStorage.resetRequestCache(),c}return a.then(c=>(c?(this.browserStorage.resetRequestCache(),n.length<this.getAllAccounts().length?(this.eventHandler.emitEvent(A.LOGIN_SUCCESS,E.Redirect,c),this.logger.verbose("handleRedirectResponse returned result, login success")):(this.eventHandler.emitEvent(A.ACQUIRE_TOKEN_SUCCESS,E.Redirect,c),this.logger.verbose("handleRedirectResponse returned result, acquire token success")),s.end({success:!0},void 0,c.account)):s.event.errorCode?s.end({success:!1},void 0):s.discard(),this.eventHandler.emitEvent(A.HANDLE_REDIRECT_END,E.Redirect),c)).catch(c=>{this.browserStorage.resetRequestCache();const l=c;throw n.length>0?this.eventHandler.emitEvent(A.ACQUIRE_TOKEN_FAILURE,E.Redirect,null,l):this.eventHandler.emitEvent(A.LOGIN_FAILURE,E.Redirect,null,l),this.eventHandler.emitEvent(A.HANDLE_REDIRECT_END,E.Redirect),s.end({success:!1},l),c})}async acquireTokenRedirect(e){const t=this.getRequestCorrelationId(e);this.logger.verbose("acquireTokenRedirect called",t);const n=this.performanceClient.startMeasurement(d.AcquireTokenPreRedirect,t);n.add({scenarioId:e.scenarioId});const o=e.onRedirectNavigate;if(o)e.onRedirectNavigate=s=>{const a=typeof o=="function"?o(s):void 0;return n.add({navigateCallbackResult:a!==!1}),n.event=n.end({success:!0},void 0,e.account)||n.event,a};else{const s=this.config.auth.onRedirectNavigate;this.config.auth.onRedirectNavigate=a=>{const c=typeof s=="function"?s(a):void 0;return n.add({navigateCallbackResult:c!==!1}),n.event=n.end({success:!0},void 0,e.account)||n.event,c}}const i=this.getAllAccounts().length>0;try{mi(this.initialized,this.config),this.browserStorage.setInteractionInProgress(!0,Ne.SIGNIN),i?this.eventHandler.emitEvent(A.ACQUIRE_TOKEN_START,E.Redirect,e):this.eventHandler.emitEvent(A.LOGIN_START,E.Redirect,e);let s;return this.platformAuthProvider&&this.canUsePlatformBroker(e)?s=new Vt(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,M.acquireTokenRedirect,this.performanceClient,this.platformAuthProvider,this.getNativeAccountId(e),this.nativeInternalStorage,t).acquireTokenRedirect(e,n).catch(c=>{if(n.add({brokerErrorName:c.name,brokerErrorCode:c.errorCode}),c instanceof Te&&Ze(c))return this.platformAuthProvider=void 0,this.createRedirectClient(t).acquireToken(e);if(c instanceof me)return this.logger.verbose("acquireTokenRedirect - Resolving interaction required error thrown by native broker by falling back to web flow"),this.createRedirectClient(t).acquireToken(e);throw c}):s=this.createRedirectClient(t).acquireToken(e),await s}catch(s){throw this.browserStorage.resetRequestCache(),n.event.status===2?this.performanceClient.startMeasurement(d.AcquireTokenRedirect,t).end({success:!1},s,e.account):n.end({success:!1},s,e.account),i?this.eventHandler.emitEvent(A.ACQUIRE_TOKEN_FAILURE,E.Redirect,null,s):this.eventHandler.emitEvent(A.LOGIN_FAILURE,E.Redirect,null,s),s}}acquireTokenPopup(e){const t=this.getRequestCorrelationId(e),n=this.performanceClient.startMeasurement(d.AcquireTokenPopup,t);n.add({scenarioId:e.scenarioId});try{this.logger.verbose("acquireTokenPopup called",t),$t(this.initialized,n,e.account),this.browserStorage.setInteractionInProgress(!0,Ne.SIGNIN)}catch(a){return Promise.reject(a)}const o=this.getAllAccounts();o.length>0?this.eventHandler.emitEvent(A.ACQUIRE_TOKEN_START,E.Popup,e):this.eventHandler.emitEvent(A.LOGIN_START,E.Popup,e);let i;const s=this.getPreGeneratedPkceCodes(t);return this.canUsePlatformBroker(e)?(n.add({isPlatformBrokerRequest:!0}),i=this.acquireTokenNative({...e,correlationId:t},M.acquireTokenPopup).then(a=>(n.end({success:!0},void 0,a.account),a)).catch(a=>{if(n.add({brokerErrorName:a.name,brokerErrorCode:a.errorCode}),a instanceof Te&&Ze(a))return this.platformAuthProvider=void 0,this.createPopupClient(t).acquireToken(e,s);if(a instanceof me)return this.logger.verbose("acquireTokenPopup - Resolving interaction required error thrown by native broker by falling back to web flow"),this.createPopupClient(t).acquireToken(e,s);throw a})):i=this.createPopupClient(t).acquireToken(e,s),i.then(a=>(o.length<this.getAllAccounts().length?this.eventHandler.emitEvent(A.LOGIN_SUCCESS,E.Popup,a):this.eventHandler.emitEvent(A.ACQUIRE_TOKEN_SUCCESS,E.Popup,a),n.end({success:!0,accessTokenSize:a.accessToken.length,idTokenSize:a.idToken.length},void 0,a.account),a)).catch(a=>(o.length>0?this.eventHandler.emitEvent(A.ACQUIRE_TOKEN_FAILURE,E.Popup,null,a):this.eventHandler.emitEvent(A.LOGIN_FAILURE,E.Popup,null,a),n.end({success:!1},a,e.account),Promise.reject(a))).finally(async()=>{this.browserStorage.setInteractionInProgress(!1),this.config.system.asyncPopups&&await this.preGeneratePkceCodes(t)})}trackPageVisibilityWithMeasurement(){const e=this.ssoSilentMeasurement||this.acquireTokenByCodeAsyncMeasurement;e&&(this.logger.info("Perf: Visibility change detected in ",e.event.name),e.increment({visibilityChangeCount:1}))}async ssoSilent(e){const t=this.getRequestCorrelationId(e),n={...e,prompt:e.prompt,correlationId:t};this.ssoSilentMeasurement=this.performanceClient.startMeasurement(d.SsoSilent,t),this.ssoSilentMeasurement?.add({scenarioId:e.scenarioId}),$t(this.initialized,this.ssoSilentMeasurement,e.account),this.ssoSilentMeasurement?.increment({visibilityChangeCount:0}),document.addEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement),this.logger.verbose("ssoSilent called",t),this.eventHandler.emitEvent(A.SSO_SILENT_START,E.Silent,n);let o;return this.canUsePlatformBroker(n)?(this.ssoSilentMeasurement?.add({isPlatformBrokerRequest:!0}),o=this.acquireTokenNative(n,M.ssoSilent).catch(i=>{if(this.ssoSilentMeasurement?.add({brokerErrorName:i.name,brokerErrorCode:i.errorCode}),i instanceof Te&&Ze(i))return this.platformAuthProvider=void 0,this.createSilentIframeClient(n.correlationId).acquireToken(n);throw i})):o=this.createSilentIframeClient(n.correlationId).acquireToken(n),o.then(i=>(this.eventHandler.emitEvent(A.SSO_SILENT_SUCCESS,E.Silent,i),this.ssoSilentMeasurement?.end({success:!0,accessTokenSize:i.accessToken.length,idTokenSize:i.idToken.length},void 0,i.account),i)).catch(i=>{throw this.eventHandler.emitEvent(A.SSO_SILENT_FAILURE,E.Silent,null,i),this.ssoSilentMeasurement?.end({success:!1},i,e.account),i}).finally(()=>{document.removeEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement)})}async acquireTokenByCode(e){const t=this.getRequestCorrelationId(e);this.logger.trace("acquireTokenByCode called",t);const n=this.performanceClient.startMeasurement(d.AcquireTokenByCode,t);$t(this.initialized,n),this.eventHandler.emitEvent(A.ACQUIRE_TOKEN_BY_CODE_START,E.Silent,e),n.add({scenarioId:e.scenarioId});try{if(e.code&&e.nativeAccountId)throw T(va);if(e.code){const o=e.code;let i=this.hybridAuthCodeResponses.get(o);return i?(this.logger.verbose("Existing acquireTokenByCode request found",t),n.discard()):(this.logger.verbose("Initiating new acquireTokenByCode request",t),i=this.acquireTokenByCodeAsync({...e,correlationId:t}).then(s=>(this.eventHandler.emitEvent(A.ACQUIRE_TOKEN_BY_CODE_SUCCESS,E.Silent,s),this.hybridAuthCodeResponses.delete(o),n.end({success:!0,accessTokenSize:s.accessToken.length,idTokenSize:s.idToken.length},void 0,s.account),s)).catch(s=>{throw this.hybridAuthCodeResponses.delete(o),this.eventHandler.emitEvent(A.ACQUIRE_TOKEN_BY_CODE_FAILURE,E.Silent,null,s),n.end({success:!1},s),s}),this.hybridAuthCodeResponses.set(o,i)),await i}else if(e.nativeAccountId)if(this.canUsePlatformBroker(e,e.nativeAccountId)){n.add({isPlatformBrokerRequest:!0});const o=await this.acquireTokenNative({...e,correlationId:t},M.acquireTokenByCode,e.nativeAccountId).catch(i=>{throw i instanceof Te&&Ze(i)&&(this.platformAuthProvider=void 0),n.add({brokerErrorName:i.name,brokerErrorCode:i.errorCode}),i});return n.end({success:!0},void 0,o.account),o}else throw T(Sa);else throw T(Ea)}catch(o){throw this.eventHandler.emitEvent(A.ACQUIRE_TOKEN_BY_CODE_FAILURE,E.Silent,null,o),n.end({success:!1},o),o}}async acquireTokenByCodeAsync(e){return this.logger.trace("acquireTokenByCodeAsync called",e.correlationId),this.acquireTokenByCodeAsyncMeasurement=this.performanceClient.startMeasurement(d.AcquireTokenByCodeAsync,e.correlationId),this.acquireTokenByCodeAsyncMeasurement?.increment({visibilityChangeCount:0}),document.addEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement),await this.createSilentAuthCodeClient(e.correlationId).acquireToken(e).then(o=>(this.acquireTokenByCodeAsyncMeasurement?.end({success:!0,fromCache:o.fromCache}),o)).catch(o=>{throw this.acquireTokenByCodeAsyncMeasurement?.end({success:!1},o),o}).finally(()=>{document.removeEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement)})}async acquireTokenFromCache(e,t){switch(this.performanceClient.addQueueMeasurement(d.AcquireTokenFromCache,e.correlationId),t){case ee.Default:case ee.AccessToken:case ee.AccessTokenAndRefreshToken:const n=this.createSilentCacheClient(e.correlationId);return f(n.acquireToken.bind(n),d.SilentCacheClientAcquireToken,this.logger,this.performanceClient,e.correlationId)(e);default:throw y(De)}}async acquireTokenByRefreshToken(e,t){switch(this.performanceClient.addQueueMeasurement(d.AcquireTokenByRefreshToken,e.correlationId),t){case ee.Default:case ee.AccessTokenAndRefreshToken:case ee.RefreshToken:case ee.RefreshTokenAndNetwork:const n=this.createSilentRefreshClient(e.correlationId);return f(n.acquireToken.bind(n),d.SilentRefreshClientAcquireToken,this.logger,this.performanceClient,e.correlationId)(e);default:throw y(De)}}async acquireTokenBySilentIframe(e){this.performanceClient.addQueueMeasurement(d.AcquireTokenBySilentIframe,e.correlationId);const t=this.createSilentIframeClient(e.correlationId);return f(t.acquireToken.bind(t),d.SilentIframeClientAcquireToken,this.logger,this.performanceClient,e.correlationId)(e)}async logout(e){const t=this.getRequestCorrelationId(e);return this.logger.warning("logout API is deprecated and will be removed in msal-browser v3.0.0. Use logoutRedirect instead.",t),this.logoutRedirect({correlationId:t,...e})}async logoutRedirect(e){const t=this.getRequestCorrelationId(e);return mi(this.initialized,this.config),this.browserStorage.setInteractionInProgress(!0,Ne.SIGNOUT),this.createRedirectClient(t).logout(e)}logoutPopup(e){try{const t=this.getRequestCorrelationId(e);return Eo(this.initialized),this.browserStorage.setInteractionInProgress(!0,Ne.SIGNOUT),this.createPopupClient(t).logout(e).finally(()=>{this.browserStorage.setInteractionInProgress(!1)})}catch(t){return Promise.reject(t)}}async clearCache(e){if(!this.isBrowserEnvironment){this.logger.info("in non-browser environment, returning early.");return}const t=this.getRequestCorrelationId(e);return this.createSilentCacheClient(t).logout(e)}getAllAccounts(e){const t=this.getRequestCorrelationId();return ig(this.logger,this.browserStorage,this.isBrowserEnvironment,t,e)}getAccount(e){const t=this.getRequestCorrelationId();return sg(e,this.logger,this.browserStorage,t)}getAccountByUsername(e){const t=this.getRequestCorrelationId();return ag(e,this.logger,this.browserStorage,t)}getAccountByHomeId(e){const t=this.getRequestCorrelationId();return cg(e,this.logger,this.browserStorage,t)}getAccountByLocalId(e){const t=this.getRequestCorrelationId();return lg(e,this.logger,this.browserStorage,t)}setActiveAccount(e){const t=this.getRequestCorrelationId();dg(e,this.browserStorage,t)}getActiveAccount(){const e=this.getRequestCorrelationId();return hg(this.browserStorage,e)}async hydrateCache(e,t){this.logger.verbose("hydrateCache called");const n=B.createFromAccountInfo(e.account,e.cloudGraphHostName,e.msGraphHost);return await this.browserStorage.setAccount(n,e.correlationId,Ie(e.idTokenClaims)),e.fromNativeBroker?(this.logger.verbose("Response was from native broker, storing in-memory"),this.nativeInternalStorage.hydrateCache(e,t)):this.browserStorage.hydrateCache(e,t)}async acquireTokenNative(e,t,n,o){if(this.logger.trace("acquireTokenNative called"),!this.platformAuthProvider)throw T(fo);return new Vt(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,t,this.performanceClient,this.platformAuthProvider,n||this.getNativeAccountId(e),this.nativeInternalStorage,e.correlationId).acquireToken(e,o)}canUsePlatformBroker(e,t){if(this.logger.trace("canUsePlatformBroker called"),!this.platformAuthProvider)return this.logger.trace("canUsePlatformBroker: platform broker unavilable, returning false"),!1;if(!Ot(this.config,this.logger,this.platformAuthProvider,e.authenticationScheme))return this.logger.trace("canUsePlatformBroker: isBrokerAvailable returned false, returning false"),!1;if(e.prompt)switch(e.prompt){case Q.NONE:case Q.CONSENT:case Q.LOGIN:case Q.SELECT_ACCOUNT:this.logger.trace("canUsePlatformBroker: prompt is compatible with platform broker flow");break;default:return this.logger.trace(`canUsePlatformBroker: prompt = ${e.prompt} is not compatible with platform broker flow, returning false`),!1}return!t&&!this.getNativeAccountId(e)?(this.logger.trace("canUsePlatformBroker: nativeAccountId is not available, returning false"),!1):!0}getNativeAccountId(e){const t=e.account||this.getAccount({loginHint:e.loginHint,sid:e.sid})||this.getActiveAccount();return t&&t.nativeAccountId||""}createPopupClient(e){return new Og(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeInternalStorage,this.platformAuthProvider,e)}createRedirectClient(e){return new Mg(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeInternalStorage,this.platformAuthProvider,e)}createSilentIframeClient(e){return new Bg(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,M.ssoSilent,this.performanceClient,this.nativeInternalStorage,this.platformAuthProvider,e)}createSilentCacheClient(e){return new Xa(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.platformAuthProvider,e)}createSilentRefreshClient(e){return new Kg(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.platformAuthProvider,e)}createSilentAuthCodeClient(e){return new zg(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,M.acquireTokenByCode,this.performanceClient,this.platformAuthProvider,e)}addEventCallback(e,t){return this.eventHandler.addEventCallback(e,t)}removeEventCallback(e){this.eventHandler.removeEventCallback(e)}addPerformanceCallback(e){return $a(),this.performanceClient.addPerformanceCallback(e)}removePerformanceCallback(e){return this.performanceClient.removePerformanceCallback(e)}enableAccountStorageEvents(){if(this.config.cache.cacheLocation!==Y.LocalStorage){this.logger.info("Account storage events are only available when cacheLocation is set to localStorage");return}this.eventHandler.subscribeCrossTab()}disableAccountStorageEvents(){if(this.config.cache.cacheLocation!==Y.LocalStorage){this.logger.info("Account storage events are only available when cacheLocation is set to localStorage");return}this.eventHandler.unsubscribeCrossTab()}getTokenCache(){return this.tokenCache}getLogger(){return this.logger}setLogger(e){this.logger=e}initializeWrapperLibrary(e,t){this.browserStorage.setWrapperMetadata(e,t)}setNavigationClient(e){this.navigationClient=e}getConfiguration(){return this.config}getPerformanceClient(){return this.performanceClient}isBrowserEnv(){return this.isBrowserEnvironment}getRequestCorrelationId(e){return e?.correlationId?e.correlationId:this.isBrowserEnvironment?ye():p.EMPTY_STRING}async loginRedirect(e){const t=this.getRequestCorrelationId(e);return this.logger.verbose("loginRedirect called",t),this.acquireTokenRedirect({correlationId:t,...e||hi})}loginPopup(e){const t=this.getRequestCorrelationId(e);return this.logger.verbose("loginPopup called",t),this.acquireTokenPopup({correlationId:t,...e||hi})}async acquireTokenSilent(e){const t=this.getRequestCorrelationId(e),n=this.performanceClient.startMeasurement(d.AcquireTokenSilent,t);n.add({cacheLookupPolicy:e.cacheLookupPolicy,scenarioId:e.scenarioId}),$t(this.initialized,n,e.account),this.logger.verbose("acquireTokenSilent called",t);const o=e.account||this.getActiveAccount();if(!o)throw T(ma);return this.acquireTokenSilentDeduped(e,o,t).then(i=>(n.end({success:!0,fromCache:i.fromCache,accessTokenSize:i.accessToken.length,idTokenSize:i.idToken.length},void 0,i.account),{...i,state:e.state,correlationId:t})).catch(i=>{throw i instanceof L&&i.setCorrelationId(t),n.end({success:!1},i,o),i})}async acquireTokenSilentDeduped(e,t,n){const o=_n(this.config.auth.clientId,{...e,authority:e.authority||this.config.auth.authority},t.homeAccountId),i=JSON.stringify(o),s=this.activeSilentTokenRequests.get(i);if(typeof s>"u"){this.logger.verbose("acquireTokenSilent called for the first time, storing active request",n),this.performanceClient.addFields({deduped:!1},n);const a=f(this.acquireTokenSilentAsync.bind(this),d.AcquireTokenSilentAsync,this.logger,this.performanceClient,n)({...e,correlationId:n},t);return this.activeSilentTokenRequests.set(i,a),a.finally(()=>{this.activeSilentTokenRequests.delete(i)})}else return this.logger.verbose("acquireTokenSilent has been called previously, returning the result from the first call",n),this.performanceClient.addFields({deduped:!0},n),s}async acquireTokenSilentAsync(e,t){const n=()=>this.trackPageVisibility(e.correlationId);this.performanceClient.addQueueMeasurement(d.AcquireTokenSilentAsync,e.correlationId),this.eventHandler.emitEvent(A.ACQUIRE_TOKEN_START,E.Silent,e),e.correlationId&&this.performanceClient.incrementFields({visibilityChangeCount:0},e.correlationId),document.addEventListener("visibilitychange",n);const o=await f(fg,d.InitializeSilentRequest,this.logger,this.performanceClient,e.correlationId)(e,t,this.config,this.performanceClient,this.logger),i=e.cacheLookupPolicy||ee.Default;return this.acquireTokenSilentNoIframe(o,i).catch(async a=>{if(jg(a,i))if(this.activeIframeRequest)if(i!==ee.Skip){const[l,h]=this.activeIframeRequest;this.logger.verbose(`Iframe request is already in progress, awaiting resolution for request with correlationId: ${h}`,o.correlationId);const u=this.performanceClient.startMeasurement(d.AwaitConcurrentIframe,o.correlationId);u.add({awaitIframeCorrelationId:h});const g=await l;if(u.end({success:g}),g)return this.logger.verbose(`Parallel iframe request with correlationId: ${h} succeeded. Retrying cache and/or RT redemption`,o.correlationId),this.acquireTokenSilentNoIframe(o,i);throw this.logger.info(`Iframe request with correlationId: ${h} failed. Interaction is required.`),a}else return this.logger.warning("Another iframe request is currently in progress and CacheLookupPolicy is set to Skip. This may result in degraded performance and/or reliability for both calls. Please consider changing the CacheLookupPolicy to take advantage of request queuing and token cache.",o.correlationId),f(this.acquireTokenBySilentIframe.bind(this),d.AcquireTokenBySilentIframe,this.logger,this.performanceClient,o.correlationId)(o);else{let l;return this.activeIframeRequest=[new Promise(h=>{l=h}),o.correlationId],this.logger.verbose("Refresh token expired/invalid or CacheLookupPolicy is set to Skip, attempting acquire token by iframe.",o.correlationId),f(this.acquireTokenBySilentIframe.bind(this),d.AcquireTokenBySilentIframe,this.logger,this.performanceClient,o.correlationId)(o).then(h=>(l(!0),h)).catch(h=>{throw l(!1),h}).finally(()=>{this.activeIframeRequest=void 0})}else throw a}).then(a=>(this.eventHandler.emitEvent(A.ACQUIRE_TOKEN_SUCCESS,E.Silent,a),this.performanceClient.addFields({fromCache:a.fromCache},e.correlationId),a)).catch(a=>{throw this.eventHandler.emitEvent(A.ACQUIRE_TOKEN_FAILURE,E.Silent,null,a),a}).finally(()=>{document.removeEventListener("visibilitychange",n)})}async acquireTokenSilentNoIframe(e,t){return Ot(this.config,this.logger,this.platformAuthProvider,e.authenticationScheme)&&e.account.nativeAccountId?(this.logger.verbose("acquireTokenSilent - attempting to acquire token from native platform"),this.performanceClient.addFields({isPlatformBrokerRequest:!0},e.correlationId),this.acquireTokenNative(e,M.acquireTokenSilent_silentFlow,e.account.nativeAccountId,t).catch(async n=>{throw this.performanceClient.addFields({brokerErrorName:n.name,brokerErrorCode:n.errorCode},e.correlationId),n instanceof Te&&Ze(n)?(this.logger.verbose("acquireTokenSilent - native platform unavailable, falling back to web flow"),this.platformAuthProvider=void 0,y(De)):n})):(this.logger.verbose("acquireTokenSilent - attempting to acquire token from web flow"),t===ee.AccessToken&&this.logger.verbose("acquireTokenSilent - cache lookup policy set to AccessToken, attempting to acquire token from local cache"),f(this.acquireTokenFromCache.bind(this),d.AcquireTokenFromCache,this.logger,this.performanceClient,e.correlationId)(e,t).catch(n=>{if(t===ee.AccessToken)throw n;return this.eventHandler.emitEvent(A.ACQUIRE_TOKEN_NETWORK_START,E.Silent,e),f(this.acquireTokenByRefreshToken.bind(this),d.AcquireTokenByRefreshToken,this.logger,this.performanceClient,e.correlationId)(e,t)}))}async preGeneratePkceCodes(e){return this.logger.verbose("Generating new PKCE codes"),this.pkceCode=await f(We,d.GeneratePkceCodes,this.logger,this.performanceClient,e)(this.performanceClient,this.logger,e),Promise.resolve()}getPreGeneratedPkceCodes(e){this.logger.verbose("Attempting to pick up pre-generated PKCE codes");const t=this.pkceCode?{...this.pkceCode}:void 0;return this.pkceCode=void 0,this.logger.verbose(`${t?"Found":"Did not find"} pre-generated PKCE codes`),this.performanceClient.addFields({usePreGeneratedPkce:!!t},e),t}logMultipleInstances(e){const t=this.config.auth.clientId;if(!window)return;window.msal=window.msal||{},window.msal.clientIds=window.msal.clientIds||[],window.msal.clientIds.length>0&&this.logger.verbose("There is already an instance of MSAL.js in the window."),window.msal.clientIds.push(t),qg(t,e,this.logger)}}function jg(r,e){const t=!(r instanceof me&&r.subError!==Pn),n=r.errorCode===re.INVALID_GRANT_ERROR||r.errorCode===De,o=t&&n||r.errorCode===cn||r.errorCode===no,i=Eu.includes(e);return o&&i}async function Vg(r,e){const t=new Ve(r);return await t.initialize(),xn.createController(t,e)}class No{static async createPublicClientApplication(e){const t=await Vg(e);return new No(e,t)}constructor(e,t){this.isBroker=!1,this.controller=t||new xn(new Ve(e))}async initialize(e){return this.controller.initialize(e,this.isBroker)}async acquireTokenPopup(e){return this.controller.acquireTokenPopup(e)}acquireTokenRedirect(e){return this.controller.acquireTokenRedirect(e)}acquireTokenSilent(e){return this.controller.acquireTokenSilent(e)}acquireTokenByCode(e){return this.controller.acquireTokenByCode(e)}addEventCallback(e,t){return this.controller.addEventCallback(e,t)}removeEventCallback(e){return this.controller.removeEventCallback(e)}addPerformanceCallback(e){return this.controller.addPerformanceCallback(e)}removePerformanceCallback(e){return this.controller.removePerformanceCallback(e)}enableAccountStorageEvents(){this.controller.enableAccountStorageEvents()}disableAccountStorageEvents(){this.controller.disableAccountStorageEvents()}getAccount(e){return this.controller.getAccount(e)}getAccountByHomeId(e){return this.controller.getAccountByHomeId(e)}getAccountByLocalId(e){return this.controller.getAccountByLocalId(e)}getAccountByUsername(e){return this.controller.getAccountByUsername(e)}getAllAccounts(e){return this.controller.getAllAccounts(e)}handleRedirectPromise(e){return this.controller.handleRedirectPromise(e)}loginPopup(e){return this.controller.loginPopup(e)}loginRedirect(e){return this.controller.loginRedirect(e)}logout(e){return this.controller.logout(e)}logoutRedirect(e){return this.controller.logoutRedirect(e)}logoutPopup(e){return this.controller.logoutPopup(e)}ssoSilent(e){return this.controller.ssoSilent(e)}getTokenCache(){return this.controller.getTokenCache()}getLogger(){return this.controller.getLogger()}setLogger(e){this.controller.setLogger(e)}setActiveAccount(e){this.controller.setActiveAccount(e)}getActiveAccount(){return this.controller.getActiveAccount()}initializeWrapperLibrary(e,t){return this.controller.initializeWrapperLibrary(e,t)}setNavigationClient(e){this.controller.setNavigationClient(e)}getConfiguration(){return this.controller.getConfiguration()}async hydrateCache(e,t){return this.controller.hydrateCache(e,t)}clearCache(e){return this.controller.clearCache(e)}}const Wg={initialize:()=>Promise.reject(K(G)),acquireTokenPopup:()=>Promise.reject(K(G)),acquireTokenRedirect:()=>Promise.reject(K(G)),acquireTokenSilent:()=>Promise.reject(K(G)),acquireTokenByCode:()=>Promise.reject(K(G)),getAllAccounts:()=>[],getAccount:()=>null,getAccountByHomeId:()=>null,getAccountByUsername:()=>null,getAccountByLocalId:()=>null,handleRedirectPromise:()=>Promise.reject(K(G)),loginPopup:()=>Promise.reject(K(G)),loginRedirect:()=>Promise.reject(K(G)),logout:()=>Promise.reject(K(G)),logoutRedirect:()=>Promise.reject(K(G)),logoutPopup:()=>Promise.reject(K(G)),ssoSilent:()=>Promise.reject(K(G)),addEventCallback:()=>null,removeEventCallback:()=>{},addPerformanceCallback:()=>"",removePerformanceCallback:()=>!1,enableAccountStorageEvents:()=>{},disableAccountStorageEvents:()=>{},getTokenCache:()=>{throw K(G)},getLogger:()=>{throw K(G)},setLogger:()=>{},setActiveAccount:()=>{},getActiveAccount:()=>null,initializeWrapperLibrary:()=>{},setNavigationClient:()=>{},getConfiguration:()=>{throw K(G)},hydrateCache:()=>Promise.reject(K(G)),clearCache:()=>Promise.reject(K(G))};class Qg{static getInteractionStatusFromEvent(e,t){switch(e.eventType){case A.LOGIN_START:return z.Login;case A.SSO_SILENT_START:return z.SsoSilent;case A.ACQUIRE_TOKEN_START:if(e.interactionType===E.Redirect||e.interactionType===E.Popup)return z.AcquireToken;break;case A.HANDLE_REDIRECT_START:return z.HandleRedirect;case A.LOGOUT_START:return z.Logout;case A.SSO_SILENT_SUCCESS:case A.SSO_SILENT_FAILURE:if(t&&t!==z.SsoSilent)break;return z.None;case A.LOGOUT_END:if(t&&t!==z.Logout)break;return z.None;case A.HANDLE_REDIRECT_END:if(t&&t!==z.HandleRedirect)break;return z.None;case A.LOGIN_SUCCESS:case A.LOGIN_FAILURE:case A.ACQUIRE_TOKEN_SUCCESS:case A.ACQUIRE_TOKEN_FAILURE:case A.RESTORE_FROM_BFCACHE:if(e.interactionType===E.Redirect||e.interactionType===E.Popup){if(t&&t!==z.Login&&t!==z.AcquireToken)break;return z.None}break}return null}}const Yg={instance:Wg,inProgress:z.None,accounts:[],logger:new _e({})},tc=k.createContext(Yg);tc.Consumer;function bi(r,e){if(r.length!==e.length)return!1;const t=[...e];return r.every(n=>{const o=t.shift();return!n||!o?!1:n.homeAccountId===o.homeAccountId&&n.localAccountId===o.localAccountId&&n.username===o.username})}const Jg="@azure/msal-react",_i="3.0.23";const pn={UNBLOCK_INPROGRESS:"UNBLOCK_INPROGRESS",EVENT:"EVENT"},Xg=(r,e)=>{const{type:t,payload:n}=e;let o=r.inProgress;switch(t){case pn.UNBLOCK_INPROGRESS:r.inProgress===z.Startup&&(o=z.None,n.logger.info("MsalProvider - handleRedirectPromise resolved, setting inProgress to 'none'"));break;case pn.EVENT:const s=n.message,a=Qg.getInteractionStatusFromEvent(s,r.inProgress);a&&(n.logger.info(`MsalProvider - ${s.eventType} results in setting inProgress from ${r.inProgress} to ${a}`),o=a);break;default:throw new Error(`Unknown action type: ${t}`)}if(o===z.Startup)return r;const i=n.instance.getAllAccounts();return o!==r.inProgress&&!bi(i,r.accounts)?{...r,inProgress:o,accounts:i}:o!==r.inProgress?{...r,inProgress:o}:bi(i,r.accounts)?r:{...r,accounts:i}};function Zg({instance:r,children:e}){k.useEffect(()=>{r.initializeWrapperLibrary(Au.React,_i)},[r]);const t=k.useMemo(()=>r.getLogger().clone(Jg,_i),[r]),[n,o]=k.useReducer(Xg,void 0,()=>({inProgress:z.Startup,accounts:[]}));k.useEffect(()=>{const s=r.addEventCallback(a=>{o({payload:{instance:r,logger:t,message:a},type:pn.EVENT})});return t.verbose(`MsalProvider - Registered event callback with id: ${s}`),r.initialize().then(()=>{r.handleRedirectPromise().catch(()=>{}).finally(()=>{o({payload:{instance:r,logger:t},type:pn.UNBLOCK_INPROGRESS})})}).catch(()=>{}),()=>{s&&(t.verbose(`MsalProvider - Removing event callback ${s}`),r.removeEventCallback(s))}},[r,t]);const i={instance:r,inProgress:n.inProgress,accounts:n.accounts,logger:t};return Ct.createElement(tc.Provider,{value:i},e)}const ef="d4bfbeda-57f3-4cea-98c4-21245eb37168",tf="3daafc20-d3d6-4c1f-a91f-d9b87d68bf3b",nf="4c65cf31-118a-4cc3-b970-15cc20df31c7",rf=typeof window<"u"?`${window.location.origin}/`:"/",of=rf,sf={auth:{clientId:tf,authority:`https://login.microsoftonline.com/${ef}`,redirectUri:of},cache:{cacheLocation:"sessionStorage",storeAuthStateInCookie:!1}},yt={scopes:[`api://${nf}/access_as_user`]},pf="https://func-flashcardapp-prod-001-btcrd8cnekhuddeh.uksouth-01.azurewebsites.net",nc=k.createContext(void 0);function mf(){const r=k.useContext(nc);if(!r)throw new Error("useAuth must be used within AuthProvider");return r}const yf=({children:r})=>{const e=k.useMemo(()=>new No(sf),[]),t=k.useRef(!1),n=k.useRef(!1),o=k.useRef(!1),[i,s]=k.useState(()=>{const b=e.getAllAccounts();return b.length?b[0]:null}),[a,c]=k.useState(!1),[l,h]=k.useState(!0),u=k.useRef(!1);k.useEffect(()=>{let b=!0;return(async()=>{try{if(!t.current&&typeof e.initialize=="function")try{await e.initialize(),t.current=!0,console.debug("MSAL initialized (mount)")}catch(S){console.warn("MSAL initialize failed (mount):",S)}o.current=!0;const v=await e.handleRedirectPromise();if(!b)return;if(v&&v.account){s(v.account),c(!1),h(!1),n.current=!1,o.current=!1;return}const O=e.getAllAccounts();if(O.length){s(O[0]),c(!1),h(!1),n.current=!1,o.current=!1;return}u.current||(u.current=!0,c(!0),console.debug("No MSAL account found — redirecting to login"),await e.loginRedirect(yt))}catch(v){console.error("MSAL redirect handling error:",v),c(!1),h(!1),n.current=!1}finally{o.current=!1}})(),()=>{b=!1}},[e]);const g=async()=>{if(!t.current){if(typeof e.initialize=="function")try{await e.initialize(),console.debug("MSAL initialized (ensure)")}catch(b){console.warn("MSAL initialize failed (ensure):",b)}t.current=!0}},m=Ct.useCallback(async()=>{await g();const b=typeof window<"u"&&(window.location.search.includes("code=")||window.location.search.includes("error=")||window.location.hash.includes("id_token")||window.location.hash.includes("access_token"));if(o.current||b){console.debug("Skipping loginRedirect because redirect is being processed or URL contains response");return}return e.loginRedirect(yt)},[e]),I=Ct.useCallback(async()=>(await g(),e.logoutRedirect()),[e]),w=Ct.useCallback(async()=>{await g(),await(async()=>{let j=0;for(;o.current&&j<3e3;)await new Promise(F=>setTimeout(F,100)),j+=100})();try{o.current=!0;const S=await e.handleRedirectPromise();S&&S.account&&(s(S.account),c(!1),n.current=!1,o.current=!1)}catch(S){console.debug("handleRedirectPromise in acquireToken threw:",S),o.current=!1}const v=e.getAllAccounts(),O=v.length?v[0]:void 0;if(!O){if(n.current)console.debug("Interactive flow already locked");else{n.current=!0,u.current=!0,c(!0);try{await e.loginRedirect(yt)}catch(S){S&&S.errorCode==="interaction_in_progress"?console.debug("MSAL interaction already in progress"):console.error("MSAL loginRedirect failed:",S)}}throw new Error("Redirecting to login")}try{const S=await e.acquireTokenSilent({...yt,account:O});return s(O),S.accessToken}catch(S){try{n.current?console.debug("MSAL interaction already in progress (acquireTokenRedirect)"):(n.current=!0,u.current=!0,c(!0),await e.acquireTokenRedirect({...yt,account:O}))}catch(x){x&&x.errorCode==="interaction_in_progress"?console.debug("MSAL interaction already in progress (acquireTokenRedirect)"):console.error("acquireTokenRedirect failed:",x)}throw S}},[e]),P=Ct.useMemo(()=>({isAuthenticated:!!i,account:i,login:m,logout:I,acquireToken:w}),[i,m,I,w]);return l||a?R.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",minHeight:"100vh",backgroundColor:"#fff"},children:[R.jsx("div",{style:{width:"48px",height:"48px",border:"4px solid #f3f3f3",borderTop:"4px solid #228be6",borderRadius:"50%",animation:"spin 1s linear infinite"}}),R.jsx("style",{children:`
          @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
          }
        `})]}):R.jsx(Zg,{instance:e,children:R.jsx(nc.Provider,{value:P,children:r})})};export{yf as A,Cn as B,df as C,Ui as D,Gl as E,Ir as F,Se as G,Wc as H,El as I,hf as J,Yn as K,mr as L,Kc as M,yn as N,pf as O,ji as T,wr as U,Gc as a,ff as b,gf as c,Ri as d,lf as e,al as f,Zc as g,mf as h,ct as i,ce as j,fr as k,we as l,St as m,Ar as n,Ge as o,uf as p,Ni as q,C as r,mn as s,Wt as t,Nt as u,vl as v,xc as w,Bi as x,Qe as y,pr as z};
