import{w as U,a as o,p as e}from"./chunk-EPOLDU6W-Db15p_wQ.js";import{C as X,S as Y,T as Z,G as C,B as x,P as B,c as _,h as N,g as ee,b as se}from"./api-TiMZYRdJ.js";import{h as te,T as p}from"./AuthProvider-B78M3Mu0.js";import{F as re,S as ae}from"./SentenceCard-BtKCukHC.js";import{T as ne}from"./TextInput-DMgR66im.js";import{C as oe}from"./Checkbox-B8dqXa_Z.js";import"./index-xUmu4QGa.js";import"./Tooltip-CochBmdA.js";import"./OptionalPortal-CyEJmNpe.js";import"./use-isomorphic-effect-CHtvWNEI.js";import"./get-contrast-color-CU6lvNmn.js";import"./CheckIcon-BRVzKdZC.js";function Pe({}){return[{title:"Forvo Sentence Search"}]}const Fe=U(function(){const[S,R]=o.useState(""),[r,j]=o.useState([]),[w,W]=o.useState(!1),[D,E]=o.useState(!1),[t,P]=o.useState(0),[i,k]=o.useState([]),[y,F]=o.useState([]),[d,f]=o.useState(0),[G,b]=o.useState(!1),[A,Q]=o.useState(!1),{acquireToken:T}=te(),I=async()=>{W(!0),E(!0),g();let s=[];try{const a=await T();if(A){const l=await _(S,a);console.log("Word variations:",l);const c=await Promise.all(l.map(async n=>await N(n,a)));console.log("Forvo results for all forms:",c);const h=new Set;let u=0;s=c.flat().map((n,O)=>n&&!h.has(n.phrase)?(h.add(n.phrase),{CardId:`forvo-${u++}`,Phrase:n.phrase,PhraseStress:n.phrase,Audio:n.audio||"",Translation:""}):null).filter(n=>n!==null)}else{const l=await N(S,a);console.log("Forvo results:",l),s=l.map((c,h)=>({CardId:`forvo-${h}`,Phrase:c.phrase,PhraseStress:c.phrase,Audio:c.audio||"",Translation:""}))}console.log("All results to set:",s),j(s),P(0)}catch(a){console.error("Failed to search Forvo:",a),j([])}finally{W(!1)}},$=async s=>{k(s),f(0),b(!0);try{if(r.length>0&&t<r.length){const a=r[t],l=await T(),[c,h]=await Promise.all([Promise.all(s.map(u=>se(u,a.Phrase,l))),ee(a.Phrase,l)]);F(c),j(u=>{const m=[...u];return m[t]={...m[t],PhraseStress:h||m[t].Phrase},m})}}catch(a){console.error("Failed to fetch word data or stress marks:",a),F([])}finally{b(!1)}},g=()=>{k([]),F([]),f(0)},q=()=>{d>0&&f(s=>s-1)},z=()=>{d<i.length-1&&f(s=>s+1)},H=d===0,K=d===i.length-1,V=()=>{t>0&&(P(s=>s-1),g())},J=()=>{t<r.length-1&&(P(s=>s+1),g())},M=t===0,L=t===r.length-1,v=r.length>0?r[t]:null;return e.jsx(X,{size:"md",className:"pt-16 pb-16",children:e.jsxs(Y,{gap:"lg",children:[e.jsxs("div",{children:[e.jsx(Z,{order:2,children:"Forvo Sentence Search"}),e.jsx(p,{mt:"sm",c:"dimmed",children:"Search for Russian phrases with native speaker audio from Forvo"})]}),e.jsxs(C,{gap:"sm",children:[e.jsx(ne,{placeholder:"Enter a phrase to search...",value:S,onChange:s=>R(s.currentTarget.value),onKeyPress:s=>{s.key==="Enter"&&I()},style:{flex:1}}),e.jsx(x,{onClick:I,loading:w,children:"Search"})]}),e.jsx(oe,{label:"Search all word forms",checked:A,onChange:s=>Q(s.currentTarget.checked)}),D&&!w&&r.length===0&&e.jsx(B,{p:"lg",radius:"md",withBorder:!0,children:e.jsxs(p,{c:"dimmed",children:['No results found for "',S,'"']})}),r.length>0&&v&&e.jsxs(e.Fragment,{children:[i.length>0?e.jsx(e.Fragment,{children:G?e.jsx(B,{p:"lg",radius:"md",withBorder:!0,children:e.jsx(p,{children:"Creating flashcards..."})}):y.length>0?e.jsxs(e.Fragment,{children:[e.jsx(re,{phrase:v,selectedWord:i[d],wordData:y[d],isLoading:!1,onBack:g,isForvoAudio:!0}),e.jsxs(C,{justify:"space-between",mt:"xl",children:[e.jsx(x,{variant:"subtle",onClick:q,disabled:H,children:"Previous"}),e.jsxs(p,{c:"dimmed",children:[d+1," / ",i.length]}),e.jsx(x,{variant:"subtle",onClick:z,disabled:K,children:"Next"})]})]}):null}):e.jsx(ae,{phrase:v,onSelectWords:$,selectedWords:i}),i.length===0&&e.jsxs(C,{justify:"space-between",mt:"xl",children:[e.jsx(x,{variant:"subtle",onClick:V,disabled:M,children:"Previous"}),e.jsxs(p,{c:"dimmed",children:[t+1," / ",r.length]}),e.jsx(x,{variant:"subtle",onClick:J,disabled:L,children:L?"Last Result":"Next"})]})]})]})})});export{Fe as default,Pe as meta};
