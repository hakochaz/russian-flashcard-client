import{w as U,b as n,t as e}from"./index-CWD__XTI.js";import{S as X,T as Y,G as F,P as D,c as Z,i as G,g as _,b as ee}from"./api-CO88OdlV.js";import{h as se,T as f,B as g}from"./AuthProvider-DIbg4P3B.js";import{F as te,S as re}from"./SentenceCard-BMF-z7BU.js";import{C as ae}from"./Container-D1gD7sw9.js";import{T as ne}from"./TextInput-i3HMMitU.js";import{C as oe}from"./Checkbox-Ze26yarO.js";import"./Tooltip-BmlxqTPC.js";import"./OptionalPortal-CAJ6Pykm.js";import"./use-isomorphic-effect-Chui70N-.js";import"./get-contrast-color-tvsM5tXo.js";import"./CheckIcon-SLjj_-bk.js";function we({}){return[{title:"Forvo Sentence Search"}]}const Pe=U(function(){const[x,K]=n.useState(""),[t,j]=n.useState([]),[k,y]=n.useState(!1),[Q,$]=n.useState(!1),[a,w]=n.useState(0),[o,C]=n.useState([]),[W,P]=n.useState([]),[c,S]=n.useState(0),[q,b]=n.useState(!1),[A,z]=n.useState(!1),{acquireToken:T}=se();n.useEffect(()=>{const s=r=>{r.key==="ArrowLeft"?o.length>0?I():t.length>0&&B():r.key==="ArrowRight"&&(o.length>0?E():t.length>0&&N())};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[o.length,c,a,t.length]);const L=async()=>{y(!0),$(!0),p();let s=[];try{const r=await T();if(A){const i=await Z(x,r);console.log("Word variations:",i);const d=await Promise.all(i.map(async l=>await G(l,r)));console.log("Forvo results for all forms:",d);const h=new Set;let u=0;s=d.flat().map((l,O)=>l&&!h.has(l.phrase)?(h.add(l.phrase),{CardId:`forvo-${u++}`,Phrase:l.phrase,PhraseStress:l.phrase,Audio:l.audio||"",Translation:""}):null).filter(l=>l!==null)}else{const i=await G(x,r);console.log("Forvo results:",i),s=i.map((d,h)=>({CardId:`forvo-${h}`,Phrase:d.phrase,PhraseStress:d.phrase,Audio:d.audio||"",Translation:""}))}console.log("All results to set:",s),j(s),w(0)}catch(r){console.error("Failed to search Forvo:",r),j([])}finally{y(!1)}},H=async s=>{C(s),S(0),b(!0);try{if(t.length>0&&a<t.length){const r=t[a],i=await T(),[d,h]=await Promise.all([Promise.all(s.map(u=>ee(u,r.Phrase,i))),_(r.Phrase,i)]);P(d),j(u=>{const m=[...u];return m[a]={...m[a],PhraseStress:h||m[a].Phrase},m})}}catch(r){console.error("Failed to fetch word data or stress marks:",r),P([])}finally{b(!1)}},p=()=>{C([]),P([]),S(0)},I=()=>{c>0&&S(s=>s-1)},E=()=>{c<o.length-1&&S(s=>s+1)},V=c===0,J=c===o.length-1,B=()=>{a>0&&(w(s=>s-1),p())},N=()=>{a<t.length-1&&(w(s=>s+1),p())},M=a===0,R=a===t.length-1,v=t.length>0?t[a]:null;return e.jsx(ae,{size:"md",className:"pt-16 pb-16",children:e.jsxs(X,{gap:"lg",children:[e.jsxs("div",{children:[e.jsx(Y,{order:2,children:"Forvo Sentence Search"}),e.jsx(f,{mt:"sm",c:"dimmed",children:"Search for Russian phrases with native speaker audio from Forvo"})]}),e.jsxs(F,{gap:"sm",children:[e.jsx(ne,{placeholder:"Enter a phrase to search...",value:x,onChange:s=>K(s.currentTarget.value),onKeyPress:s=>{s.key==="Enter"&&L()},style:{flex:1}}),e.jsx(g,{onClick:L,loading:k,children:"Search"})]}),e.jsx(oe,{label:"Search all word forms",checked:A,onChange:s=>z(s.currentTarget.checked)}),Q&&!k&&t.length===0&&e.jsx(D,{p:"lg",radius:"md",withBorder:!0,children:e.jsxs(f,{c:"dimmed",children:['No results found for "',x,'"']})}),t.length>0&&v&&e.jsxs(e.Fragment,{children:[o.length>0?e.jsx(e.Fragment,{children:q?e.jsx(D,{p:"lg",radius:"md",withBorder:!0,children:e.jsx(f,{children:"Creating flashcards..."})}):W.length>0?e.jsxs(e.Fragment,{children:[e.jsx(te,{phrase:v,selectedWord:o[c],wordData:W[c],isLoading:!1,onBack:p,isForvoAudio:!0}),e.jsxs(F,{justify:"space-between",mt:"xl",children:[e.jsx(g,{variant:"subtle",onClick:I,disabled:V,children:"Previous"}),e.jsxs(f,{c:"dimmed",children:[c+1," / ",o.length]}),e.jsx(g,{variant:"subtle",onClick:E,disabled:J,children:"Next"})]})]}):null}):e.jsx(re,{phrase:v,onSelectWords:H,selectedWords:o}),o.length===0&&e.jsxs(F,{justify:"space-between",mt:"xl",children:[e.jsx(g,{variant:"subtle",onClick:B,disabled:M,children:"Previous"}),e.jsxs(f,{c:"dimmed",children:[a+1," / ",t.length]}),e.jsx(g,{variant:"subtle",onClick:N,disabled:R,children:R?"Last Result":"Next"})]})]})]})})});export{Pe as default,we as meta};
