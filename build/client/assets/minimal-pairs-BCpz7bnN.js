import{t as e,w as Be,b as u}from"./index-CWD__XTI.js";import{S as N,G as y,T as ue,P as S,n as Me,o as Pe,j as me,p as Te,A as O}from"./api-CuIHRb5R.js";import{z as he,C,I as fe,u as Ee,k as D,n as Ne,o as Ae,i as Ge,E as qe,j as xe,h as Re,T as i,B as P}from"./AuthProvider-DIbg4P3B.js";import{C as ke}from"./Container-D1gD7sw9.js";import{T as Q}from"./TextInput-i3HMMitU.js";import{p as L}from"./px-DP8G9a6Q.js";import{S as Fe}from"./Select-DZJN4bQk.js";import"./use-isomorphic-effect-Chui70N-.js";import"./OptionalPortal-CAJ6Pykm.js";import"./CheckIcon-SLjj_-bk.js";function Ue(n,r){return n in r?L(r[n]):L(n)}function $e(n,r){const l=n.map(x=>({value:x,px:Ue(x,r)}));return l.sort((x,h)=>x.px-h.px),l}function G(n){return typeof n=="object"&&n!==null?"base"in n?n.base:void 0:n}var pe={container:"m_925c2d2c",root:"m_2415a157"};function Ve({spacing:n,verticalSpacing:r,cols:l,selector:x}){const h=Ee(),f=r===void 0?n:r,z=he({"--sg-spacing-x":C(G(n)),"--sg-spacing-y":C(G(f)),"--sg-cols":G(l)?.toString()}),m=D(h.breakpoints).reduce((a,j)=>(a[j]||(a[j]={}),typeof n=="object"&&n[j]!==void 0&&(a[j]["--sg-spacing-x"]=C(n[j])),typeof f=="object"&&f[j]!==void 0&&(a[j]["--sg-spacing-y"]=C(f[j])),typeof l=="object"&&l[j]!==void 0&&(a[j]["--sg-cols"]=l[j]),a),{}),p=$e(D(m),h.breakpoints).filter(a=>D(m[a.value]).length>0).map(a=>({query:`(min-width: ${h.breakpoints[a.value]})`,styles:m[a.value]}));return e.jsx(fe,{styles:z,media:p,selector:x})}function X(n){return typeof n=="object"&&n!==null?D(n):[]}function We(n){return n.sort((r,l)=>L(r)-L(l))}function _e({spacing:n,verticalSpacing:r,cols:l}){const x=Array.from(new Set([...X(n),...X(r),...X(l)]));return We(x)}function Oe({spacing:n,verticalSpacing:r,cols:l,selector:x}){const h=r===void 0?n:r,f=he({"--sg-spacing-x":C(G(n)),"--sg-spacing-y":C(G(h)),"--sg-cols":G(l)?.toString()}),z=_e({spacing:n,verticalSpacing:r,cols:l}),m=z.reduce((p,a)=>(p[a]||(p[a]={}),typeof n=="object"&&n[a]!==void 0&&(p[a]["--sg-spacing-x"]=C(n[a])),typeof h=="object"&&h[a]!==void 0&&(p[a]["--sg-spacing-y"]=C(h[a])),typeof l=="object"&&l[a]!==void 0&&(p[a]["--sg-cols"]=l[a]),p),{}),b=z.map(p=>({query:`simple-grid (min-width: ${p})`,styles:m[p]}));return e.jsx(fe,{styles:f,container:b,selector:x})}const De={cols:1,spacing:"md",type:"media"},A=Ne((n,r)=>{const l=Ae("SimpleGrid",De,n),{classNames:x,className:h,style:f,styles:z,unstyled:m,vars:b,cols:p,verticalSpacing:a,spacing:j,type:U,attributes:I,...q}=l,T=Ge({name:"SimpleGrid",classes:pe,props:l,className:h,style:f,classNames:x,styles:z,unstyled:m,attributes:I,vars:b}),B=qe();return U==="container"?e.jsxs(e.Fragment,{children:[e.jsx(Oe,{...l,selector:`.${B}`}),e.jsx("div",{...T("container"),children:e.jsx(xe,{ref:r,...T("root",{className:B}),...q})})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ve,{...l,selector:`.${B}`}),e.jsx(xe,{ref:r,...T("root",{className:B}),...q})]})});A.classes=pe;A.displayName="@mantine/core/SimpleGrid";function is({}){return[{title:"Minimal Pairs"}]}const Le=n=>{const r=n.split("/"),l=(r[0]||"").trim(),x=r.slice(1).join("/").trim();return[l,x]},ts=Be(function(){const[r,l]=u.useState("1"),[x,h]=u.useState(!1),[f,z]=u.useState(null),[m,b]=u.useState(null),[p,a]=u.useState(null),[j,U]=u.useState(""),[I,q]=u.useState("view"),[T,B]=u.useState(""),[Y,Z]=u.useState(""),[ee,se]=u.useState("easy"),[ne,$]=u.useState(null),[ie,H]=u.useState(null),[je,te]=u.useState(!1),[re,V]=u.useState(new Set),R=u.useRef([]),k=u.useRef([]),le=u.useRef(null),{acquireToken:W}=Re();u.useEffect(()=>{(async()=>{try{const o=await W(),d=await Me(o);b(d)}catch(o){console.debug("Could not acquire token for minimal pairs count",o)}})()},[]),u.useEffect(()=>{if(I!=="view"||le.current===r)return;const s=async()=>{h(!0),a(null);try{const o=await W(),d=await Pe(r,o);d?(d.pronunciations1&&(d.pronunciations1=me(d.pronunciations1)),d.pronunciations2&&(d.pronunciations2=me(d.pronunciations2)),z(d)):(a("Item not found"),z(null))}catch(o){console.debug("Could not acquire token or fetch minimal pair",o)}finally{h(!1)}};le.current=r,s()},[r,I,W]);const ge=()=>{const s=parseInt(r)-1;s>=1&&l(String(s))},ye=()=>{if(!ae){const s=parseInt(r)+1;l(String(s))}},we=()=>{if(m&&m>0){re.size>=m&&V(new Set);const s=[];for(let c=1;c<=m;c++)re.has(c)||s.push(c);if(s.length===0){V(new Set);const c=Math.floor(Math.random()*m)+1;V(new Set([c])),l(String(c));return}const o=Math.floor(Math.random()*s.length),d=s[o];V(c=>new Set([...c,d])),l(String(d))}},ve=r==="1",ae=m!==null&&parseInt(r)===m,de=()=>{const s=j.trim();if(s&&/^\d+$/.test(s)){const o=parseInt(s);(m===null||o>=1&&o<=m)&&(l(s),U(""))}},_=(s,o)=>{R.current.forEach(c=>{c&&(c.pause(),c.currentTime=0)}),k.current.forEach(c=>{c&&(c.pause(),c.currentTime=0)});const d=s.current[o];d&&(d.currentTime=0,d.play())},Se=async()=>{const s=T.trim(),o=Y.trim();if(!s||!o){$("Both words are required"),H(null);return}te(!0),$(null),H(null);try{const d=await W(),c=`${s}/${o}`;if(!await Te(c,ee,d)){$("Could not add minimal pair");return}H("Minimal pair added successfully"),B(""),Z(""),se("easy"),b(M=>M!==null?M+1:M)}catch(d){console.debug("Could not acquire token or add minimal pair",d),$("Could not add minimal pair")}finally{te(!1)}},ze=()=>{if(!f?.pronunciations1||!f?.pronunciations2)return null;const s=f.pronunciations1,o=f.pronunciations2,d=new Map(s.map((t,g)=>[t.username,g])),c=new Map(o.map((t,g)=>[t.username,g])),F=Array.from(d.keys()).filter(t=>c.has(t)),M=s.map((t,g)=>g).filter(t=>!F.includes(s[t].username)),K=o.map((t,g)=>g).filter(t=>!F.includes(o[t].username)),oe=M.map(t=>s[t]),ce=K.map(t=>o[t]);return e.jsxs(N,{gap:"lg",children:[F.length>0&&e.jsxs("div",{children:[e.jsx(i,{size:"sm",c:"dimmed",fw:500,mb:"xs",children:"Matching speakers"}),e.jsx(N,{gap:"sm",children:F.map(t=>{const g=d.get(t),w=c.get(t),v=s[g],E=o[w];return e.jsxs(A,{cols:2,spacing:"sm",children:[e.jsx(S,{p:"md",radius:"md",withBorder:!0,bg:"gray.0",children:e.jsxs(y,{gap:"xl",align:"center",wrap:"nowrap",children:[e.jsx(O,{size:"xl",radius:"xl",variant:"filled",color:"blue",onClick:()=>_(R,g),children:"▶"}),e.jsx("audio",{ref:J=>{R.current[g]=J},style:{display:"none"},children:e.jsx("source",{src:v.audioMp3,type:"audio/mpeg"})}),e.jsxs(y,{gap:"lg",wrap:"nowrap",style:{flex:1},children:[e.jsxs("div",{children:[e.jsx(i,{size:"xs",c:"dimmed",children:"Username"}),e.jsx(i,{size:"sm",fw:500,children:v.username})]}),e.jsxs("div",{children:[e.jsx(i,{size:"xs",c:"dimmed",children:"Gender"}),e.jsx(i,{size:"sm",fw:500,children:v.sex==="m"?"Male":v.sex==="f"?"Female":v.sex})]}),e.jsxs("div",{children:[e.jsx(i,{size:"xs",c:"dimmed",children:"Country"}),e.jsx(i,{size:"sm",fw:500,children:v.country})]})]})]})}),e.jsx(S,{p:"md",radius:"md",withBorder:!0,bg:"gray.0",children:e.jsxs(y,{gap:"xl",align:"center",wrap:"nowrap",children:[e.jsx(O,{size:"xl",radius:"xl",variant:"filled",color:"blue",onClick:()=>_(k,w),children:"▶"}),e.jsx("audio",{ref:J=>{k.current[w]=J},style:{display:"none"},children:e.jsx("source",{src:E.audioMp3,type:"audio/mpeg"})}),e.jsxs(y,{gap:"lg",wrap:"nowrap",style:{flex:1},children:[e.jsxs("div",{children:[e.jsx(i,{size:"xs",c:"dimmed",children:"Username"}),e.jsx(i,{size:"sm",fw:500,children:E.username})]}),e.jsxs("div",{children:[e.jsx(i,{size:"xs",c:"dimmed",children:"Gender"}),e.jsx(i,{size:"sm",fw:500,children:E.sex==="m"?"Male":E.sex==="f"?"Female":E.sex})]}),e.jsxs("div",{children:[e.jsx(i,{size:"xs",c:"dimmed",children:"Country"}),e.jsx(i,{size:"sm",fw:500,children:E.country})]})]})]})})]},t)})})]}),(M.length>0||K.length>0)&&e.jsxs("div",{children:[e.jsx(i,{size:"sm",c:"dimmed",fw:500,mb:"xs",children:"Other speakers"}),e.jsxs(A,{cols:2,spacing:"lg",children:[e.jsx("div",{children:oe.length>0&&e.jsx(N,{gap:"sm",children:oe.map((t,g)=>{const w=M[g];return e.jsx(S,{p:"md",radius:"md",withBorder:!0,bg:"gray.0",children:e.jsxs(y,{gap:"xl",align:"center",wrap:"nowrap",children:[e.jsx(O,{size:"xl",radius:"xl",variant:"filled",color:"blue",onClick:()=>_(R,w),children:"▶"}),e.jsx("audio",{ref:v=>{R.current[w]=v},style:{display:"none"},children:e.jsx("source",{src:t.audioMp3,type:"audio/mpeg"})}),e.jsxs(y,{gap:"lg",wrap:"nowrap",style:{flex:1},children:[e.jsxs("div",{children:[e.jsx(i,{size:"xs",c:"dimmed",children:"Username"}),e.jsx(i,{size:"sm",fw:500,children:t.username})]}),e.jsxs("div",{children:[e.jsx(i,{size:"xs",c:"dimmed",children:"Gender"}),e.jsx(i,{size:"sm",fw:500,children:t.sex==="m"?"Male":t.sex==="f"?"Female":t.sex})]}),e.jsxs("div",{children:[e.jsx(i,{size:"xs",c:"dimmed",children:"Country"}),e.jsx(i,{size:"sm",fw:500,children:t.country})]})]})]})},w)})})}),e.jsx("div",{children:ce.length>0&&e.jsx(N,{gap:"sm",children:ce.map((t,g)=>{const w=K[g];return e.jsx(S,{p:"md",radius:"md",withBorder:!0,bg:"gray.0",children:e.jsxs(y,{gap:"xl",align:"center",wrap:"nowrap",children:[e.jsx(O,{size:"xl",radius:"xl",variant:"filled",color:"blue",onClick:()=>_(k,w),children:"▶"}),e.jsx("audio",{ref:v=>{k.current[w]=v},style:{display:"none"},children:e.jsx("source",{src:t.audioMp3,type:"audio/mpeg"})}),e.jsxs(y,{gap:"lg",wrap:"nowrap",style:{flex:1},children:[e.jsxs("div",{children:[e.jsx(i,{size:"xs",c:"dimmed",children:"Username"}),e.jsx(i,{size:"sm",fw:500,children:t.username})]}),e.jsxs("div",{children:[e.jsx(i,{size:"xs",c:"dimmed",children:"Gender"}),e.jsx(i,{size:"sm",fw:500,children:t.sex==="m"?"Male":t.sex==="f"?"Female":t.sex})]}),e.jsxs("div",{children:[e.jsx(i,{size:"xs",c:"dimmed",children:"Country"}),e.jsx(i,{size:"sm",fw:500,children:t.country})]})]})]})},w)})})})]})]})]})},Ie=f?.entity?.Pair||"",[Ce,be]=Le(Ie);return e.jsx(ke,{size:"xl",className:"pt-16 pb-16",children:e.jsxs(N,{gap:"lg",children:[e.jsxs(y,{justify:"space-between",align:"flex-end",wrap:"wrap",children:[e.jsxs("div",{children:[e.jsx(ue,{order:2,children:"Minimal Pairs"}),e.jsx(i,{mt:"sm",c:"dimmed",children:"Practice distinguishing similar sounds"})]}),e.jsxs(y,{gap:"sm",wrap:"nowrap",align:"flex-end",children:[e.jsx(P,{variant:I==="view"?"filled":"light",onClick:()=>q("view"),children:"View all"}),e.jsx(P,{variant:I==="add"?"filled":"light",onClick:()=>q("add"),children:"Add new"}),I==="view"&&e.jsxs(y,{gap:"xs",wrap:"nowrap",align:"flex-end",children:[e.jsx(Q,{placeholder:"Item No",value:j,onChange:s=>U(s.currentTarget.value),onKeyPress:s=>{s.key==="Enter"&&de()},size:"sm",w:80}),e.jsx(P,{onClick:de,variant:"light",size:"sm",children:"Go"}),e.jsx(P,{onClick:we,variant:"outline",size:"sm",children:"Random"})]})]})]}),I==="add"?e.jsx(S,{p:"lg",radius:"md",withBorder:!0,children:e.jsx("form",{onSubmit:s=>{s.preventDefault(),Se()},children:e.jsxs(N,{gap:"md",children:[e.jsx(ue,{order:3,children:"Add a new minimal pair"}),e.jsxs(A,{cols:2,spacing:"md",children:[e.jsx(Q,{label:"Word 1",placeholder:"Enter first word",value:T,onChange:s=>B(s.currentTarget.value),required:!0}),e.jsx(Q,{label:"Word 2",placeholder:"Enter second word",value:Y,onChange:s=>Z(s.currentTarget.value),required:!0})]}),e.jsx(Fe,{label:"Difficulty",data:[{value:"easy",label:"Easy"},{value:"medium",label:"Medium"},{value:"hard",label:"Hard"}],value:ee,onChange:s=>s&&se(s),required:!0}),ne&&e.jsx(i,{c:"red",children:ne}),ie&&e.jsx(i,{c:"green",children:ie}),e.jsx(y,{justify:"flex-start",children:e.jsx(P,{type:"submit",loading:je,children:"Add minimal pair"})})]})})}):x?e.jsx(S,{p:"lg",radius:"md",withBorder:!0,children:e.jsx(i,{children:"Loading item..."})}):p?e.jsx(S,{p:"lg",radius:"md",withBorder:!0,children:e.jsx(i,{c:"red",children:p})}):f?e.jsxs(e.Fragment,{children:[e.jsxs(A,{cols:2,spacing:"lg",children:[e.jsx(S,{p:"xl",radius:"md",withBorder:!0,bg:"blue.0",children:e.jsx(i,{size:"xl",fw:600,ta:"center",style:{lineHeight:1.6},children:Ce})}),e.jsx(S,{p:"xl",radius:"md",withBorder:!0,bg:"blue.0",children:e.jsx(i,{size:"xl",fw:600,ta:"center",style:{lineHeight:1.6},children:be})})]}),ze(),e.jsxs(y,{justify:"space-between",mt:"xl",children:[e.jsx(P,{variant:"subtle",onClick:ge,disabled:ve,children:"← Previous"}),e.jsxs(i,{c:"dimmed",children:[r," / ",m||"?"]}),e.jsx(P,{variant:"subtle",onClick:ye,disabled:ae,children:"Next →"})]})]}):e.jsx(S,{p:"lg",radius:"md",withBorder:!0,children:e.jsx(i,{c:"dimmed",children:"No item loaded"})})]})})});export{ts as default,is as meta};
