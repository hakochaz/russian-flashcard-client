import{t as e,w as Be,b as u}from"./index-CWD__XTI.js";import{S as A,G as y,T as xe,P as S,o as Me,p as Pe,k as he,q as Ee,A as _}from"./api-CO88OdlV.js";import{z as pe,C,I as je,u as Te,k as O,n as Ae,o as ke,i as Ne,E as qe,j as fe,h as Ge,T as i,B as P}from"./AuthProvider-DIbg4P3B.js";import{C as Re}from"./Container-D1gD7sw9.js";import{T as Q}from"./TextInput-i3HMMitU.js";import{p as D}from"./px-DP8G9a6Q.js";import{S as Fe}from"./Select-DZJN4bQk.js";import"./use-isomorphic-effect-Chui70N-.js";import"./OptionalPortal-CAJ6Pykm.js";import"./CheckIcon-SLjj_-bk.js";function Ue(n,r){return n in r?D(r[n]):D(n)}function Le(n,r){const l=n.map(x=>({value:x,px:Ue(x,r)}));return l.sort((x,h)=>x.px-h.px),l}function N(n){return typeof n=="object"&&n!==null?"base"in n?n.base:void 0:n}var ge={container:"m_925c2d2c",root:"m_2415a157"};function $e({spacing:n,verticalSpacing:r,cols:l,selector:x}){const h=Te(),f=r===void 0?n:r,z=pe({"--sg-spacing-x":C(N(n)),"--sg-spacing-y":C(N(f)),"--sg-cols":N(l)?.toString()}),m=O(h.breakpoints).reduce((a,j)=>(a[j]||(a[j]={}),typeof n=="object"&&n[j]!==void 0&&(a[j]["--sg-spacing-x"]=C(n[j])),typeof f=="object"&&f[j]!==void 0&&(a[j]["--sg-spacing-y"]=C(f[j])),typeof l=="object"&&l[j]!==void 0&&(a[j]["--sg-cols"]=l[j]),a),{}),p=Le(O(m),h.breakpoints).filter(a=>O(m[a.value]).length>0).map(a=>({query:`(min-width: ${h.breakpoints[a.value]})`,styles:m[a.value]}));return e.jsx(je,{styles:z,media:p,selector:x})}function X(n){return typeof n=="object"&&n!==null?O(n):[]}function Ve(n){return n.sort((r,l)=>D(r)-D(l))}function We({spacing:n,verticalSpacing:r,cols:l}){const x=Array.from(new Set([...X(n),...X(r),...X(l)]));return Ve(x)}function _e({spacing:n,verticalSpacing:r,cols:l,selector:x}){const h=r===void 0?n:r,f=pe({"--sg-spacing-x":C(N(n)),"--sg-spacing-y":C(N(h)),"--sg-cols":N(l)?.toString()}),z=We({spacing:n,verticalSpacing:r,cols:l}),m=z.reduce((p,a)=>(p[a]||(p[a]={}),typeof n=="object"&&n[a]!==void 0&&(p[a]["--sg-spacing-x"]=C(n[a])),typeof h=="object"&&h[a]!==void 0&&(p[a]["--sg-spacing-y"]=C(h[a])),typeof l=="object"&&l[a]!==void 0&&(p[a]["--sg-cols"]=l[a]),p),{}),b=z.map(p=>({query:`simple-grid (min-width: ${p})`,styles:m[p]}));return e.jsx(je,{styles:f,container:b,selector:x})}const Oe={cols:1,spacing:"md",type:"media"},k=Ae((n,r)=>{const l=ke("SimpleGrid",Oe,n),{classNames:x,className:h,style:f,styles:z,unstyled:m,vars:b,cols:p,verticalSpacing:a,spacing:j,type:U,attributes:I,...q}=l,E=Ne({name:"SimpleGrid",classes:ge,props:l,className:h,style:f,classNames:x,styles:z,unstyled:m,attributes:I,vars:b}),B=qe();return U==="container"?e.jsxs(e.Fragment,{children:[e.jsx(_e,{...l,selector:`.${B}`}),e.jsx("div",{...E("container"),children:e.jsx(fe,{ref:r,...E("root",{className:B}),...q})})]}):e.jsxs(e.Fragment,{children:[e.jsx($e,{...l,selector:`.${B}`}),e.jsx(fe,{ref:r,...E("root",{className:B}),...q})]})});k.classes=ge;k.displayName="@mantine/core/SimpleGrid";function is({}){return[{title:"Minimal Pairs"}]}const De=n=>{const r=n.split("/"),l=(r[0]||"").trim(),x=r.slice(1).join("/").trim();return[l,x]},ts=Be(function(){const[r,l]=u.useState("1"),[x,h]=u.useState(!1),[f,z]=u.useState(null),[m,b]=u.useState(null),[p,a]=u.useState(null),[j,U]=u.useState(""),[I,q]=u.useState("view"),[E,B]=u.useState(""),[Y,Z]=u.useState(""),[ee,se]=u.useState("easy"),[ne,L]=u.useState(null),[ie,H]=u.useState(null),[ye,te]=u.useState(!1),[re,$]=u.useState(new Set),G=u.useRef([]),R=u.useRef([]),le=u.useRef(null),{acquireToken:V}=Ge();u.useEffect(()=>{(async()=>{try{const d=await V(),o=await Me(d);b(o)}catch(d){console.debug("Could not acquire token for minimal pairs count",d)}})()},[]),u.useEffect(()=>{if(I!=="view"||le.current===r)return;const s=async()=>{h(!0),a(null);try{const d=await V(),o=await Pe(r,d);o?(o.pronunciations1&&(o.pronunciations1=he(o.pronunciations1)),o.pronunciations2&&(o.pronunciations2=he(o.pronunciations2)),z(o)):(a("Item not found"),z(null))}catch(d){console.debug("Could not acquire token or fetch minimal pair",d)}finally{h(!1)}};le.current=r,s()},[r,I,V]),u.useEffect(()=>{const s=d=>{d.key==="ArrowLeft"?ae():d.key==="ArrowRight"&&de()};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[r,m]);const ae=()=>{const s=parseInt(r)-1;s>=1&&l(String(s))},de=()=>{if(!oe){const s=parseInt(r)+1;l(String(s))}},we=()=>{if(m&&m>0){re.size>=m&&$(new Set);const s=[];for(let c=1;c<=m;c++)re.has(c)||s.push(c);if(s.length===0){$(new Set);const c=Math.floor(Math.random()*m)+1;$(new Set([c])),l(String(c));return}const d=Math.floor(Math.random()*s.length),o=s[d];$(c=>new Set([...c,o])),l(String(o))}},ve=r==="1",oe=m!==null&&parseInt(r)===m,ce=()=>{const s=j.trim();if(s&&/^\d+$/.test(s)){const d=parseInt(s);(m===null||d>=1&&d<=m)&&(l(s),U(""))}},W=(s,d)=>{G.current.forEach(c=>{c&&(c.pause(),c.currentTime=0)}),R.current.forEach(c=>{c&&(c.pause(),c.currentTime=0)});const o=s.current[d];o&&(o.currentTime=0,o.play())},Se=async()=>{const s=E.trim(),d=Y.trim();if(!s||!d){L("Both words are required"),H(null);return}te(!0),L(null),H(null);try{const o=await V(),c=`${s}/${d}`;if(!await Ee(c,ee,o)){L("Could not add minimal pair");return}H("Minimal pair added successfully"),B(""),Z(""),se("easy"),b(M=>M!==null?M+1:M)}catch(o){console.debug("Could not acquire token or add minimal pair",o),L("Could not add minimal pair")}finally{te(!1)}},ze=()=>{if(!f?.pronunciations1||!f?.pronunciations2)return null;const s=f.pronunciations1,d=f.pronunciations2,o=new Map(s.map((t,g)=>[t.username,g])),c=new Map(d.map((t,g)=>[t.username,g])),F=Array.from(o.keys()).filter(t=>c.has(t)),M=s.map((t,g)=>g).filter(t=>!F.includes(s[t].username)),K=d.map((t,g)=>g).filter(t=>!F.includes(d[t].username)),ue=M.map(t=>s[t]),me=K.map(t=>d[t]);return e.jsxs(A,{gap:"lg",children:[F.length>0&&e.jsxs("div",{children:[e.jsx(i,{size:"sm",c:"dimmed",fw:500,mb:"xs",children:"Matching speakers"}),e.jsx(A,{gap:"sm",children:F.map(t=>{const g=o.get(t),w=c.get(t),v=s[g],T=d[w];return e.jsxs(k,{cols:2,spacing:"sm",children:[e.jsx(S,{p:"md",radius:"md",withBorder:!0,bg:"gray.0",children:e.jsxs(y,{gap:"xl",align:"center",wrap:"nowrap",children:[e.jsx(_,{size:"xl",radius:"xl",variant:"filled",color:"blue",onClick:()=>W(G,g),children:"▶"}),e.jsx("audio",{ref:J=>{G.current[g]=J},style:{display:"none"},children:e.jsx("source",{src:v.audioMp3,type:"audio/mpeg"})}),e.jsxs(y,{gap:"lg",wrap:"nowrap",style:{flex:1},children:[e.jsxs("div",{children:[e.jsx(i,{size:"xs",c:"dimmed",children:"Username"}),e.jsx(i,{size:"sm",fw:500,children:v.username})]}),e.jsxs("div",{children:[e.jsx(i,{size:"xs",c:"dimmed",children:"Gender"}),e.jsx(i,{size:"sm",fw:500,children:v.sex==="m"?"Male":v.sex==="f"?"Female":v.sex})]}),e.jsxs("div",{children:[e.jsx(i,{size:"xs",c:"dimmed",children:"Country"}),e.jsx(i,{size:"sm",fw:500,children:v.country})]})]})]})}),e.jsx(S,{p:"md",radius:"md",withBorder:!0,bg:"gray.0",children:e.jsxs(y,{gap:"xl",align:"center",wrap:"nowrap",children:[e.jsx(_,{size:"xl",radius:"xl",variant:"filled",color:"blue",onClick:()=>W(R,w),children:"▶"}),e.jsx("audio",{ref:J=>{R.current[w]=J},style:{display:"none"},children:e.jsx("source",{src:T.audioMp3,type:"audio/mpeg"})}),e.jsxs(y,{gap:"lg",wrap:"nowrap",style:{flex:1},children:[e.jsxs("div",{children:[e.jsx(i,{size:"xs",c:"dimmed",children:"Username"}),e.jsx(i,{size:"sm",fw:500,children:T.username})]}),e.jsxs("div",{children:[e.jsx(i,{size:"xs",c:"dimmed",children:"Gender"}),e.jsx(i,{size:"sm",fw:500,children:T.sex==="m"?"Male":T.sex==="f"?"Female":T.sex})]}),e.jsxs("div",{children:[e.jsx(i,{size:"xs",c:"dimmed",children:"Country"}),e.jsx(i,{size:"sm",fw:500,children:T.country})]})]})]})})]},t)})})]}),(M.length>0||K.length>0)&&e.jsxs("div",{children:[e.jsx(i,{size:"sm",c:"dimmed",fw:500,mb:"xs",children:"Other speakers"}),e.jsxs(k,{cols:2,spacing:"lg",children:[e.jsx("div",{children:ue.length>0&&e.jsx(A,{gap:"sm",children:ue.map((t,g)=>{const w=M[g];return e.jsx(S,{p:"md",radius:"md",withBorder:!0,bg:"gray.0",children:e.jsxs(y,{gap:"xl",align:"center",wrap:"nowrap",children:[e.jsx(_,{size:"xl",radius:"xl",variant:"filled",color:"blue",onClick:()=>W(G,w),children:"▶"}),e.jsx("audio",{ref:v=>{G.current[w]=v},style:{display:"none"},children:e.jsx("source",{src:t.audioMp3,type:"audio/mpeg"})}),e.jsxs(y,{gap:"lg",wrap:"nowrap",style:{flex:1},children:[e.jsxs("div",{children:[e.jsx(i,{size:"xs",c:"dimmed",children:"Username"}),e.jsx(i,{size:"sm",fw:500,children:t.username})]}),e.jsxs("div",{children:[e.jsx(i,{size:"xs",c:"dimmed",children:"Gender"}),e.jsx(i,{size:"sm",fw:500,children:t.sex==="m"?"Male":t.sex==="f"?"Female":t.sex})]}),e.jsxs("div",{children:[e.jsx(i,{size:"xs",c:"dimmed",children:"Country"}),e.jsx(i,{size:"sm",fw:500,children:t.country})]})]})]})},w)})})}),e.jsx("div",{children:me.length>0&&e.jsx(A,{gap:"sm",children:me.map((t,g)=>{const w=K[g];return e.jsx(S,{p:"md",radius:"md",withBorder:!0,bg:"gray.0",children:e.jsxs(y,{gap:"xl",align:"center",wrap:"nowrap",children:[e.jsx(_,{size:"xl",radius:"xl",variant:"filled",color:"blue",onClick:()=>W(R,w),children:"▶"}),e.jsx("audio",{ref:v=>{R.current[w]=v},style:{display:"none"},children:e.jsx("source",{src:t.audioMp3,type:"audio/mpeg"})}),e.jsxs(y,{gap:"lg",wrap:"nowrap",style:{flex:1},children:[e.jsxs("div",{children:[e.jsx(i,{size:"xs",c:"dimmed",children:"Username"}),e.jsx(i,{size:"sm",fw:500,children:t.username})]}),e.jsxs("div",{children:[e.jsx(i,{size:"xs",c:"dimmed",children:"Gender"}),e.jsx(i,{size:"sm",fw:500,children:t.sex==="m"?"Male":t.sex==="f"?"Female":t.sex})]}),e.jsxs("div",{children:[e.jsx(i,{size:"xs",c:"dimmed",children:"Country"}),e.jsx(i,{size:"sm",fw:500,children:t.country})]})]})]})},w)})})})]})]})]})},Ie=f?.entity?.Pair||"",[Ce,be]=De(Ie);return e.jsx(Re,{size:"xl",className:"pt-16 pb-16",children:e.jsxs(A,{gap:"lg",children:[e.jsxs(y,{justify:"space-between",align:"flex-end",wrap:"wrap",children:[e.jsxs("div",{children:[e.jsx(xe,{order:2,children:"Minimal Pairs"}),e.jsx(i,{mt:"sm",c:"dimmed",children:"Practice distinguishing similar sounds"})]}),e.jsxs(y,{gap:"sm",wrap:"nowrap",align:"flex-end",children:[e.jsx(P,{variant:I==="view"?"filled":"light",onClick:()=>q("view"),children:"View all"}),e.jsx(P,{variant:I==="add"?"filled":"light",onClick:()=>q("add"),children:"Add new"}),I==="view"&&e.jsxs(y,{gap:"xs",wrap:"nowrap",align:"flex-end",children:[e.jsx(Q,{placeholder:"Item No",value:j,onChange:s=>U(s.currentTarget.value),onKeyPress:s=>{s.key==="Enter"&&ce()},size:"sm",w:80}),e.jsx(P,{onClick:ce,variant:"light",size:"sm",children:"Go"}),e.jsx(P,{onClick:we,variant:"outline",size:"sm",children:"Random"})]})]})]}),I==="add"?e.jsx(S,{p:"lg",radius:"md",withBorder:!0,children:e.jsx("form",{onSubmit:s=>{s.preventDefault(),Se()},children:e.jsxs(A,{gap:"md",children:[e.jsx(xe,{order:3,children:"Add a new minimal pair"}),e.jsxs(k,{cols:2,spacing:"md",children:[e.jsx(Q,{label:"Word 1",placeholder:"Enter first word",value:E,onChange:s=>B(s.currentTarget.value),required:!0}),e.jsx(Q,{label:"Word 2",placeholder:"Enter second word",value:Y,onChange:s=>Z(s.currentTarget.value),required:!0})]}),e.jsx(Fe,{label:"Difficulty",data:[{value:"easy",label:"Easy"},{value:"medium",label:"Medium"},{value:"hard",label:"Hard"}],value:ee,onChange:s=>s&&se(s),required:!0}),ne&&e.jsx(i,{c:"red",children:ne}),ie&&e.jsx(i,{c:"green",children:ie}),e.jsx(y,{justify:"flex-start",children:e.jsx(P,{type:"submit",loading:ye,children:"Add minimal pair"})})]})})}):x?e.jsx(S,{p:"lg",radius:"md",withBorder:!0,children:e.jsx(i,{children:"Loading item..."})}):p?e.jsx(S,{p:"lg",radius:"md",withBorder:!0,children:e.jsx(i,{c:"red",children:p})}):f?e.jsxs(e.Fragment,{children:[e.jsxs(k,{cols:2,spacing:"lg",children:[e.jsx(S,{p:"xl",radius:"md",withBorder:!0,bg:"blue.0",children:e.jsx(i,{size:"xl",fw:600,ta:"center",style:{lineHeight:1.6},children:Ce})}),e.jsx(S,{p:"xl",radius:"md",withBorder:!0,bg:"blue.0",children:e.jsx(i,{size:"xl",fw:600,ta:"center",style:{lineHeight:1.6},children:be})})]}),ze(),e.jsxs(y,{justify:"space-between",mt:"xl",children:[e.jsx(P,{variant:"subtle",onClick:ae,disabled:ve,children:"← Previous"}),e.jsxs(i,{c:"dimmed",children:[r," / ",m||"?"]}),e.jsx(P,{variant:"subtle",onClick:de,disabled:oe,children:"Next →"})]})]}):e.jsx(S,{p:"lg",radius:"md",withBorder:!0,children:e.jsx(i,{c:"dimmed",children:"No item loaded"})})]})})});export{ts as default,is as meta};
