import{p as e,w as Be,a as u}from"./chunk-EPOLDU6W-Db15p_wQ.js";import{C as Me,S as N,G as y,T as ue,B as P,P as S,o as Pe,p as Te,k as me,q as Ee,A as O}from"./api-TiMZYRdJ.js";import{w as he,x as C,I as pe,u as Ne,k as D,m as qe,n as Ae,i as Ge,y as Re,B as xe,h as ke,T as i}from"./AuthProvider-B78M3Mu0.js";import{T as Q}from"./TextInput-DMgR66im.js";import{p as L}from"./px-DP8G9a6Q.js";import{S as Fe}from"./Select-COlyjj7a.js";import"./index-xUmu4QGa.js";import"./use-isomorphic-effect-CHtvWNEI.js";import"./OptionalPortal-CyEJmNpe.js";import"./CheckIcon-BRVzKdZC.js";function Ue(n,r){return n in r?L(r[n]):L(n)}function $e(n,r){const l=n.map(x=>({value:x,px:Ue(x,r)}));return l.sort((x,h)=>x.px-h.px),l}function A(n){return typeof n=="object"&&n!==null?"base"in n?n.base:void 0:n}var fe={container:"m_925c2d2c",root:"m_2415a157"};function Ve({spacing:n,verticalSpacing:r,cols:l,selector:x}){const h=Ne(),p=r===void 0?n:r,I=he({"--sg-spacing-x":C(A(n)),"--sg-spacing-y":C(A(p)),"--sg-cols":A(l)?.toString()}),m=D(h.breakpoints).reduce((a,j)=>(a[j]||(a[j]={}),typeof n=="object"&&n[j]!==void 0&&(a[j]["--sg-spacing-x"]=C(n[j])),typeof p=="object"&&p[j]!==void 0&&(a[j]["--sg-spacing-y"]=C(p[j])),typeof l=="object"&&l[j]!==void 0&&(a[j]["--sg-cols"]=l[j]),a),{}),f=$e(D(m),h.breakpoints).filter(a=>D(m[a.value]).length>0).map(a=>({query:`(min-width: ${h.breakpoints[a.value]})`,styles:m[a.value]}));return e.jsx(pe,{styles:I,media:f,selector:x})}function X(n){return typeof n=="object"&&n!==null?D(n):[]}function We(n){return n.sort((r,l)=>L(r)-L(l))}function _e({spacing:n,verticalSpacing:r,cols:l}){const x=Array.from(new Set([...X(n),...X(r),...X(l)]));return We(x)}function Oe({spacing:n,verticalSpacing:r,cols:l,selector:x}){const h=r===void 0?n:r,p=he({"--sg-spacing-x":C(A(n)),"--sg-spacing-y":C(A(h)),"--sg-cols":A(l)?.toString()}),I=_e({spacing:n,verticalSpacing:r,cols:l}),m=I.reduce((f,a)=>(f[a]||(f[a]={}),typeof n=="object"&&n[a]!==void 0&&(f[a]["--sg-spacing-x"]=C(n[a])),typeof h=="object"&&h[a]!==void 0&&(f[a]["--sg-spacing-y"]=C(h[a])),typeof l=="object"&&l[a]!==void 0&&(f[a]["--sg-cols"]=l[a]),f),{}),b=I.map(f=>({query:`simple-grid (min-width: ${f})`,styles:m[f]}));return e.jsx(pe,{styles:p,container:b,selector:x})}const De={cols:1,spacing:"md",type:"media"},q=qe((n,r)=>{const l=Ae("SimpleGrid",De,n),{classNames:x,className:h,style:p,styles:I,unstyled:m,vars:b,cols:f,verticalSpacing:a,spacing:j,type:U,attributes:z,...G}=l,T=Ge({name:"SimpleGrid",classes:fe,props:l,className:h,style:p,classNames:x,styles:I,unstyled:m,attributes:z,vars:b}),B=Re();return U==="container"?e.jsxs(e.Fragment,{children:[e.jsx(Oe,{...l,selector:`.${B}`}),e.jsx("div",{...T("container"),children:e.jsx(xe,{ref:r,...T("root",{className:B}),...G})})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ve,{...l,selector:`.${B}`}),e.jsx(xe,{ref:r,...T("root",{className:B}),...G})]})});q.classes=fe;q.displayName="@mantine/core/SimpleGrid";function is({}){return[{title:"Minimal Pairs"}]}const Le=n=>{const r=n.split("/"),l=(r[0]||"").trim(),x=r.slice(1).join("/").trim();return[l,x]},ts=Be(function(){const[r,l]=u.useState("1"),[x,h]=u.useState(!1),[p,I]=u.useState(null),[m,b]=u.useState(null),[f,a]=u.useState(null),[j,U]=u.useState(""),[z,G]=u.useState("view"),[T,B]=u.useState(""),[Y,Z]=u.useState(""),[ee,se]=u.useState("easy"),[ne,$]=u.useState(null),[ie,H]=u.useState(null),[je,te]=u.useState(!1),[re,V]=u.useState(new Set),R=u.useRef([]),k=u.useRef([]),le=u.useRef(null),{acquireToken:W}=ke();u.useEffect(()=>{(async()=>{try{const o=await W(),d=await Pe(o);b(d)}catch(o){console.debug("Could not acquire token for minimal pairs count",o)}})()},[]),u.useEffect(()=>{if(z!=="view"||le.current===r)return;const s=async()=>{h(!0),a(null);try{const o=await W(),d=await Te(r,o);d?(d.pronunciations1&&(d.pronunciations1=me(d.pronunciations1)),d.pronunciations2&&(d.pronunciations2=me(d.pronunciations2)),I(d)):(a("Item not found"),I(null))}catch(o){console.debug("Could not acquire token or fetch minimal pair",o)}finally{h(!1)}};le.current=r,s()},[r,z,W]);const ge=()=>{const s=parseInt(r)-1;s>=1&&l(String(s))},ye=()=>{if(!ae){const s=parseInt(r)+1;l(String(s))}},we=()=>{if(m&&m>0){re.size>=m&&V(new Set);const s=[];for(let c=1;c<=m;c++)re.has(c)||s.push(c);if(s.length===0){V(new Set);const c=Math.floor(Math.random()*m)+1;V(new Set([c])),l(String(c));return}const o=Math.floor(Math.random()*s.length),d=s[o];V(c=>new Set([...c,d])),l(String(d))}},ve=r==="1",ae=m!==null&&parseInt(r)===m,de=()=>{const s=j.trim();if(s&&/^\d+$/.test(s)){const o=parseInt(s);(m===null||o>=1&&o<=m)&&(l(s),U(""))}},_=(s,o)=>{R.current.forEach(c=>{c&&(c.pause(),c.currentTime=0)}),k.current.forEach(c=>{c&&(c.pause(),c.currentTime=0)});const d=s.current[o];d&&(d.currentTime=0,d.play())},Se=async()=>{const s=T.trim(),o=Y.trim();if(!s||!o){$("Both words are required"),H(null);return}te(!0),$(null),H(null);try{const d=await W(),c=`${s}/${o}`;if(!await Ee(c,ee,d)){$("Could not add minimal pair");return}H("Minimal pair added successfully"),B(""),Z(""),se("easy"),b(M=>M!==null?M+1:M)}catch(d){console.debug("Could not acquire token or add minimal pair",d),$("Could not add minimal pair")}finally{te(!1)}},Ie=()=>{if(!p?.pronunciations1||!p?.pronunciations2)return null;const s=p.pronunciations1,o=p.pronunciations2,d=new Map(s.map((t,g)=>[t.username,g])),c=new Map(o.map((t,g)=>[t.username,g])),F=Array.from(d.keys()).filter(t=>c.has(t)),M=s.map((t,g)=>g).filter(t=>!F.includes(s[t].username)),K=o.map((t,g)=>g).filter(t=>!F.includes(o[t].username)),oe=M.map(t=>s[t]),ce=K.map(t=>o[t]);return e.jsxs(N,{gap:"lg",children:[F.length>0&&e.jsxs("div",{children:[e.jsx(i,{size:"sm",c:"dimmed",fw:500,mb:"xs",children:"Matching speakers"}),e.jsx(N,{gap:"sm",children:F.map(t=>{const g=d.get(t),w=c.get(t),v=s[g],E=o[w];return e.jsxs(q,{cols:2,spacing:"sm",children:[e.jsx(S,{p:"md",radius:"md",withBorder:!0,bg:"gray.0",children:e.jsxs(y,{gap:"xl",align:"center",wrap:"nowrap",children:[e.jsx(O,{size:"xl",radius:"xl",variant:"filled",color:"blue",onClick:()=>_(R,g),children:"▶"}),e.jsx("audio",{ref:J=>{R.current[g]=J},style:{display:"none"},children:e.jsx("source",{src:v.audioMp3,type:"audio/mpeg"})}),e.jsxs(y,{gap:"lg",wrap:"nowrap",style:{flex:1},children:[e.jsxs("div",{children:[e.jsx(i,{size:"xs",c:"dimmed",children:"Username"}),e.jsx(i,{size:"sm",fw:500,children:v.username})]}),e.jsxs("div",{children:[e.jsx(i,{size:"xs",c:"dimmed",children:"Gender"}),e.jsx(i,{size:"sm",fw:500,children:v.sex==="m"?"Male":v.sex==="f"?"Female":v.sex})]}),e.jsxs("div",{children:[e.jsx(i,{size:"xs",c:"dimmed",children:"Country"}),e.jsx(i,{size:"sm",fw:500,children:v.country})]})]})]})}),e.jsx(S,{p:"md",radius:"md",withBorder:!0,bg:"gray.0",children:e.jsxs(y,{gap:"xl",align:"center",wrap:"nowrap",children:[e.jsx(O,{size:"xl",radius:"xl",variant:"filled",color:"blue",onClick:()=>_(k,w),children:"▶"}),e.jsx("audio",{ref:J=>{k.current[w]=J},style:{display:"none"},children:e.jsx("source",{src:E.audioMp3,type:"audio/mpeg"})}),e.jsxs(y,{gap:"lg",wrap:"nowrap",style:{flex:1},children:[e.jsxs("div",{children:[e.jsx(i,{size:"xs",c:"dimmed",children:"Username"}),e.jsx(i,{size:"sm",fw:500,children:E.username})]}),e.jsxs("div",{children:[e.jsx(i,{size:"xs",c:"dimmed",children:"Gender"}),e.jsx(i,{size:"sm",fw:500,children:E.sex==="m"?"Male":E.sex==="f"?"Female":E.sex})]}),e.jsxs("div",{children:[e.jsx(i,{size:"xs",c:"dimmed",children:"Country"}),e.jsx(i,{size:"sm",fw:500,children:E.country})]})]})]})})]},t)})})]}),(M.length>0||K.length>0)&&e.jsxs("div",{children:[e.jsx(i,{size:"sm",c:"dimmed",fw:500,mb:"xs",children:"Other speakers"}),e.jsxs(q,{cols:2,spacing:"lg",children:[e.jsx("div",{children:oe.length>0&&e.jsx(N,{gap:"sm",children:oe.map((t,g)=>{const w=M[g];return e.jsx(S,{p:"md",radius:"md",withBorder:!0,bg:"gray.0",children:e.jsxs(y,{gap:"xl",align:"center",wrap:"nowrap",children:[e.jsx(O,{size:"xl",radius:"xl",variant:"filled",color:"blue",onClick:()=>_(R,w),children:"▶"}),e.jsx("audio",{ref:v=>{R.current[w]=v},style:{display:"none"},children:e.jsx("source",{src:t.audioMp3,type:"audio/mpeg"})}),e.jsxs(y,{gap:"lg",wrap:"nowrap",style:{flex:1},children:[e.jsxs("div",{children:[e.jsx(i,{size:"xs",c:"dimmed",children:"Username"}),e.jsx(i,{size:"sm",fw:500,children:t.username})]}),e.jsxs("div",{children:[e.jsx(i,{size:"xs",c:"dimmed",children:"Gender"}),e.jsx(i,{size:"sm",fw:500,children:t.sex==="m"?"Male":t.sex==="f"?"Female":t.sex})]}),e.jsxs("div",{children:[e.jsx(i,{size:"xs",c:"dimmed",children:"Country"}),e.jsx(i,{size:"sm",fw:500,children:t.country})]})]})]})},w)})})}),e.jsx("div",{children:ce.length>0&&e.jsx(N,{gap:"sm",children:ce.map((t,g)=>{const w=K[g];return e.jsx(S,{p:"md",radius:"md",withBorder:!0,bg:"gray.0",children:e.jsxs(y,{gap:"xl",align:"center",wrap:"nowrap",children:[e.jsx(O,{size:"xl",radius:"xl",variant:"filled",color:"blue",onClick:()=>_(k,w),children:"▶"}),e.jsx("audio",{ref:v=>{k.current[w]=v},style:{display:"none"},children:e.jsx("source",{src:t.audioMp3,type:"audio/mpeg"})}),e.jsxs(y,{gap:"lg",wrap:"nowrap",style:{flex:1},children:[e.jsxs("div",{children:[e.jsx(i,{size:"xs",c:"dimmed",children:"Username"}),e.jsx(i,{size:"sm",fw:500,children:t.username})]}),e.jsxs("div",{children:[e.jsx(i,{size:"xs",c:"dimmed",children:"Gender"}),e.jsx(i,{size:"sm",fw:500,children:t.sex==="m"?"Male":t.sex==="f"?"Female":t.sex})]}),e.jsxs("div",{children:[e.jsx(i,{size:"xs",c:"dimmed",children:"Country"}),e.jsx(i,{size:"sm",fw:500,children:t.country})]})]})]})},w)})})})]})]})]})},ze=p?.entity?.Pair||"",[Ce,be]=Le(ze);return e.jsx(Me,{size:"xl",className:"pt-16 pb-16",children:e.jsxs(N,{gap:"lg",children:[e.jsxs(y,{justify:"space-between",align:"flex-end",wrap:"wrap",children:[e.jsxs("div",{children:[e.jsx(ue,{order:2,children:"Minimal Pairs"}),e.jsx(i,{mt:"sm",c:"dimmed",children:"Practice distinguishing similar sounds"})]}),e.jsxs(y,{gap:"sm",wrap:"nowrap",align:"flex-end",children:[e.jsx(P,{variant:z==="view"?"filled":"light",onClick:()=>G("view"),children:"View all"}),e.jsx(P,{variant:z==="add"?"filled":"light",onClick:()=>G("add"),children:"Add new"}),z==="view"&&e.jsxs(y,{gap:"xs",wrap:"nowrap",align:"flex-end",children:[e.jsx(Q,{placeholder:"Item No",value:j,onChange:s=>U(s.currentTarget.value),onKeyPress:s=>{s.key==="Enter"&&de()},size:"sm",w:80}),e.jsx(P,{onClick:de,variant:"light",size:"sm",children:"Go"}),e.jsx(P,{onClick:we,variant:"outline",size:"sm",children:"Random"})]})]})]}),z==="add"?e.jsx(S,{p:"lg",radius:"md",withBorder:!0,children:e.jsx("form",{onSubmit:s=>{s.preventDefault(),Se()},children:e.jsxs(N,{gap:"md",children:[e.jsx(ue,{order:3,children:"Add a new minimal pair"}),e.jsxs(q,{cols:2,spacing:"md",children:[e.jsx(Q,{label:"Word 1",placeholder:"Enter first word",value:T,onChange:s=>B(s.currentTarget.value),required:!0}),e.jsx(Q,{label:"Word 2",placeholder:"Enter second word",value:Y,onChange:s=>Z(s.currentTarget.value),required:!0})]}),e.jsx(Fe,{label:"Difficulty",data:[{value:"easy",label:"Easy"},{value:"medium",label:"Medium"},{value:"hard",label:"Hard"}],value:ee,onChange:s=>s&&se(s),required:!0}),ne&&e.jsx(i,{c:"red",children:ne}),ie&&e.jsx(i,{c:"green",children:ie}),e.jsx(y,{justify:"flex-start",children:e.jsx(P,{type:"submit",loading:je,children:"Add minimal pair"})})]})})}):x?e.jsx(S,{p:"lg",radius:"md",withBorder:!0,children:e.jsx(i,{children:"Loading item..."})}):f?e.jsx(S,{p:"lg",radius:"md",withBorder:!0,children:e.jsx(i,{c:"red",children:f})}):p?e.jsxs(e.Fragment,{children:[e.jsxs(q,{cols:2,spacing:"lg",children:[e.jsx(S,{p:"xl",radius:"md",withBorder:!0,bg:"blue.0",children:e.jsx(i,{size:"xl",fw:600,ta:"center",style:{lineHeight:1.6},children:Ce})}),e.jsx(S,{p:"xl",radius:"md",withBorder:!0,bg:"blue.0",children:e.jsx(i,{size:"xl",fw:600,ta:"center",style:{lineHeight:1.6},children:be})})]}),Ie(),e.jsxs(y,{justify:"space-between",mt:"xl",children:[e.jsx(P,{variant:"subtle",onClick:ge,disabled:ve,children:"← Previous"}),e.jsxs(i,{c:"dimmed",children:[r," / ",m||"?"]}),e.jsx(P,{variant:"subtle",onClick:ye,disabled:ae,children:"Next →"})]})]}):e.jsx(S,{p:"lg",radius:"md",withBorder:!0,children:e.jsx(i,{c:"dimmed",children:"No item loaded"})})]})})});export{ts as default,is as meta};
