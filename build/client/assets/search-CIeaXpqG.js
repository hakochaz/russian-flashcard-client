import{w as U,b as a,t as e}from"./index-CWD__XTI.js";import{S as X,T as Y,G as k,P as L,c as R,s as p,b as B}from"./api-CuIHRb5R.js";import{h as Z,T as m,B as f}from"./AuthProvider-DIbg4P3B.js";import{F as _,S as $}from"./SentenceCard-yGJGrL-H.js";import{C as ee}from"./Container-D1gD7sw9.js";import{T as te}from"./TextInput-i3HMMitU.js";import{C as se}from"./Checkbox-Ze26yarO.js";import"./Tooltip-BmlxqTPC.js";import"./OptionalPortal-CAJ6Pykm.js";import"./use-isomorphic-effect-Chui70N-.js";import"./get-contrast-color-tvsM5tXo.js";import"./CheckIcon-SLjj_-bk.js";function Se({}){return[{title:"Sentences Search"}]}const ge=U(function(){const[u,N]=a.useState(""),[r,b]=a.useState([]),[y,P]=a.useState(!1),[E,q]=a.useState(!1),[c,j]=a.useState(0),[l,W]=a.useState([]),[v,x]=a.useState([]),[i,S]=a.useState(0),[D,F]=a.useState(!1),[I,G]=a.useState(!1),{acquireToken:C}=Z(),T=async()=>{P(!0),q(!0),g();let t=[];try{if(I)try{const s=await C(),d=await R(u,s),h=await Promise.all(d.map(o=>p(o,s))),n=new Set;t=h.flat().filter(o=>n.has(o.CardId)?!1:(n.add(o.CardId),!0))}catch(s){console.debug("Could not acquire token for variations search, falling back:",s);const d=await R(u),h=await Promise.all(d.map(o=>p(o))),n=new Set;t=h.flat().filter(o=>n.has(o.CardId)?!1:(n.add(o.CardId),!0))}else try{const s=await C();t=await p(u,s)}catch(s){console.debug("Could not acquire token for search",s),t=await p(u)}b(t),j(0)}catch(s){console.error("Failed to search:",s),b([])}finally{P(!1)}},Q=async t=>{W(t),S(0),F(!0);try{if(r.length>0&&c<r.length){const s=r[c];try{const d=await C(),h=await Promise.all(t.map(n=>B(n,s.Phrase,d)));x(h)}catch(d){console.debug("Could not acquire token for word data",d);const h=await Promise.all(t.map(n=>B(n,s.Phrase)));x(h)}}}catch(s){console.error("Failed to fetch word data:",s),x([])}finally{F(!1)}},g=()=>{W([]),x([]),S(0)},z=()=>{i>0&&S(t=>t-1)},H=()=>{i<l.length-1&&S(t=>t+1)},K=i===0,V=i===l.length-1,J=()=>{c>0&&(j(t=>t-1),g())},M=()=>{c<r.length-1&&(j(t=>t+1),g())},O=c===0,A=c===r.length-1,w=r.length>0?r[c]:null;return e.jsx(ee,{size:"md",className:"pt-16 pb-16",children:e.jsxs(X,{gap:"lg",children:[e.jsxs("div",{children:[e.jsx(Y,{order:2,children:"Sentences Search"}),e.jsx(m,{mt:"sm",c:"dimmed",children:"Search for a word to find example sentences"})]}),e.jsxs(k,{gap:"sm",children:[e.jsx(te,{placeholder:"Enter a word to search...",value:u,onChange:t=>N(t.currentTarget.value),onKeyPress:t=>{t.key==="Enter"&&T()},style:{flex:1}}),e.jsx(f,{onClick:T,loading:y,children:"Search"})]}),e.jsx(se,{label:"Search all word forms",checked:I,onChange:t=>G(t.currentTarget.checked)}),E&&!y&&r.length===0&&e.jsx(L,{p:"lg",radius:"md",withBorder:!0,children:e.jsxs(m,{c:"dimmed",children:['No results found for "',u,'"']})}),r.length>0&&w&&e.jsxs(e.Fragment,{children:[l.length>0?e.jsx(e.Fragment,{children:D?e.jsx(L,{p:"lg",radius:"md",withBorder:!0,children:e.jsx(m,{children:"Creating flashcards..."})}):v.length>0?e.jsxs(e.Fragment,{children:[e.jsx(_,{phrase:w,selectedWord:l[i],wordData:v[i],isLoading:!1,onBack:g}),e.jsxs(k,{justify:"space-between",mt:"xl",children:[e.jsx(f,{variant:"subtle",onClick:z,disabled:K,children:"Previous"}),e.jsxs(m,{c:"dimmed",children:[i+1," / ",l.length]}),e.jsx(f,{variant:"subtle",onClick:H,disabled:V,children:"Next"})]})]}):null}):e.jsx($,{phrase:w,onSelectWords:Q,selectedWords:l}),l.length===0&&e.jsxs(k,{justify:"space-between",mt:"xl",children:[e.jsx(f,{variant:"subtle",onClick:J,disabled:O,children:"Previous"}),e.jsxs(m,{c:"dimmed",children:[c+1," / ",r.length]}),e.jsx(f,{variant:"subtle",onClick:M,disabled:A,children:A?"Last Result":"Next"})]})]})]})})});export{ge as default,Se as meta};
