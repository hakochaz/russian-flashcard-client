import{w as U,b as a,t as e}from"./index-CWD__XTI.js";import{S as X,T as Y,G as C,P as N,c as q,s as p,b as D}from"./api-CO88OdlV.js";import{h as Z,T as f,B as m}from"./AuthProvider-DIbg4P3B.js";import{F as _,S as $}from"./SentenceCard-BMF-z7BU.js";import{C as ee}from"./Container-D1gD7sw9.js";import{T as te}from"./TextInput-i3HMMitU.js";import{C as se}from"./Checkbox-Ze26yarO.js";import"./Tooltip-BmlxqTPC.js";import"./OptionalPortal-CAJ6Pykm.js";import"./use-isomorphic-effect-Chui70N-.js";import"./get-contrast-color-tvsM5tXo.js";import"./CheckIcon-SLjj_-bk.js";function ge({}){return[{title:"Sentences Search"}]}const Se=U(function(){const[u,G]=a.useState(""),[r,y]=a.useState([]),[b,v]=a.useState(!1),[K,Q]=a.useState(!1),[o,w]=a.useState(0),[n,P]=a.useState([]),[W,x]=a.useState([]),[i,g]=a.useState(0),[z,F]=a.useState(!1),[I,H]=a.useState(!1),{acquireToken:j}=Z();a.useEffect(()=>{const t=s=>{s.key==="ArrowLeft"?n.length>0?L():r.length>0&&R():s.key==="ArrowRight"&&(n.length>0?T():r.length>0&&E())};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[n.length,i,o,r.length]);const A=async()=>{v(!0),Q(!0),S();let t=[];try{if(I)try{const s=await j(),d=await q(u,s),h=await Promise.all(d.map(c=>p(c,s))),l=new Set;t=h.flat().filter(c=>l.has(c.CardId)?!1:(l.add(c.CardId),!0))}catch(s){console.debug("Could not acquire token for variations search, falling back:",s);const d=await q(u),h=await Promise.all(d.map(c=>p(c))),l=new Set;t=h.flat().filter(c=>l.has(c.CardId)?!1:(l.add(c.CardId),!0))}else try{const s=await j();t=await p(u,s)}catch(s){console.debug("Could not acquire token for search",s),t=await p(u)}y(t),w(0)}catch(s){console.error("Failed to search:",s),y([])}finally{v(!1)}},V=async t=>{P(t),g(0),F(!0);try{if(r.length>0&&o<r.length){const s=r[o];try{const d=await j(),h=await Promise.all(t.map(l=>D(l,s.Phrase,d)));x(h)}catch(d){console.debug("Could not acquire token for word data",d);const h=await Promise.all(t.map(l=>D(l,s.Phrase)));x(h)}}}catch(s){console.error("Failed to fetch word data:",s),x([])}finally{F(!1)}},S=()=>{P([]),x([]),g(0)},L=()=>{i>0&&g(t=>t-1)},T=()=>{i<n.length-1&&g(t=>t+1)},J=i===0,M=i===n.length-1,R=()=>{o>0&&(w(t=>t-1),S())},E=()=>{o<r.length-1&&(w(t=>t+1),S())},O=o===0,B=o===r.length-1,k=r.length>0?r[o]:null;return e.jsx(ee,{size:"md",className:"pt-16 pb-16",children:e.jsxs(X,{gap:"lg",children:[e.jsxs("div",{children:[e.jsx(Y,{order:2,children:"Sentences Search"}),e.jsx(f,{mt:"sm",c:"dimmed",children:"Search for a word to find example sentences"})]}),e.jsxs(C,{gap:"sm",children:[e.jsx(te,{placeholder:"Enter a word to search...",value:u,onChange:t=>G(t.currentTarget.value),onKeyPress:t=>{t.key==="Enter"&&A()},style:{flex:1}}),e.jsx(m,{onClick:A,loading:b,children:"Search"})]}),e.jsx(se,{label:"Search all word forms",checked:I,onChange:t=>H(t.currentTarget.checked)}),K&&!b&&r.length===0&&e.jsx(N,{p:"lg",radius:"md",withBorder:!0,children:e.jsxs(f,{c:"dimmed",children:['No results found for "',u,'"']})}),r.length>0&&k&&e.jsxs(e.Fragment,{children:[n.length>0?e.jsx(e.Fragment,{children:z?e.jsx(N,{p:"lg",radius:"md",withBorder:!0,children:e.jsx(f,{children:"Creating flashcards..."})}):W.length>0?e.jsxs(e.Fragment,{children:[e.jsx(_,{phrase:k,selectedWord:n[i],wordData:W[i],isLoading:!1,onBack:S}),e.jsxs(C,{justify:"space-between",mt:"xl",children:[e.jsx(m,{variant:"subtle",onClick:L,disabled:J,children:"Previous"}),e.jsxs(f,{c:"dimmed",children:[i+1," / ",n.length]}),e.jsx(m,{variant:"subtle",onClick:T,disabled:M,children:"Next"})]})]}):null}):e.jsx($,{phrase:k,onSelectWords:V,selectedWords:n}),n.length===0&&e.jsxs(C,{justify:"space-between",mt:"xl",children:[e.jsx(m,{variant:"subtle",onClick:R,disabled:O,children:"Previous"}),e.jsxs(f,{c:"dimmed",children:[o+1," / ",r.length]}),e.jsx(m,{variant:"subtle",onClick:E,disabled:B,children:B?"Last Result":"Next"})]})]})]})})});export{Se as default,ge as meta};
