import{b as s,R as G,t as e,w as Se}from"./index-CWD__XTI.js";import{S as W,G as w,T as oe,P as R,A as ye,l as be,m as je,k as ze,n as Ce}from"./api-CO88OdlV.js";import{n as Re,o as Ie,h as Ee,T as c,B as I}from"./AuthProvider-DIbg4P3B.js";import{C as Le}from"./Container-D1gD7sw9.js";import{b as me,T as de}from"./TextInput-i3HMMitU.js";import{S as Te}from"./Select-DZJN4bQk.js";import"./use-isomorphic-effect-Chui70N-.js";import"./OptionalPortal-CAJ6Pykm.js";import"./CheckIcon-SLjj_-bk.js";var ke={};function He(){return typeof process<"u"&&ke?"production":"development"}function q(){return q=Object.assign?Object.assign.bind():function(a){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)({}).hasOwnProperty.call(r,i)&&(a[i]=r[i])}return a},q.apply(null,arguments)}function Pe(a,t){if(a==null)return{};var r={};for(var i in a)if({}.hasOwnProperty.call(a,i)){if(t.indexOf(i)!==-1)continue;r[i]=a[i]}return r}var Ae=s.useLayoutEffect,Fe=function(t){var r=G.useRef(t);return Ae(function(){r.current=t}),r},le=function(t,r){if(typeof t=="function"){t(r);return}t.current=r},Be=function(t,r){var i=G.useRef();return G.useCallback(function(d){t.current=d,i.current&&le(i.current,null),i.current=r,r&&le(r,d)},[r])},ce={"min-height":"0","max-height":"none",height:"0",visibility:"hidden",overflow:"hidden",position:"absolute","z-index":"-1000",top:"0",right:"0",display:"block"},Ne=function(t){Object.keys(ce).forEach(function(r){t.style.setProperty(r,ce[r],"important")})},ue=Ne,m=null,he=function(t,r){var i=t.scrollHeight;return r.sizingStyle.boxSizing==="border-box"?i+r.borderSize:i-r.paddingSize};function Me(a,t,r,i){r===void 0&&(r=1),i===void 0&&(i=1/0),m||(m=document.createElement("textarea"),m.setAttribute("tabindex","-1"),m.setAttribute("aria-hidden","true"),ue(m)),m.parentNode===null&&document.body.appendChild(m);var d=a.paddingSize,x=a.borderSize,h=a.sizingStyle,g=h.boxSizing;Object.keys(h).forEach(function(v){var z=v;m.style[z]=h[z]}),ue(m),m.value=t;var f=he(m,a);m.value=t,f=he(m,a),m.value="x";var l=m.scrollHeight-d,S=l*r;g==="border-box"&&(S=S+d+x),f=Math.max(S,f);var y=l*i;return g==="border-box"&&(y=y+d+x),f=Math.min(y,f),[f,l]}var fe=function(){},_e=function(t,r){return t.reduce(function(i,d){return i[d]=r[d],i},{})},We=["borderBottomWidth","borderLeftWidth","borderRightWidth","borderTopWidth","boxSizing","fontFamily","fontSize","fontStyle","fontWeight","letterSpacing","lineHeight","paddingBottom","paddingLeft","paddingRight","paddingTop","tabSize","textIndent","textRendering","textTransform","width","wordBreak","wordSpacing","scrollbarGutter"],Ge=!!document.documentElement.currentStyle,qe=function(t){var r=window.getComputedStyle(t);if(r===null)return null;var i=_e(We,r),d=i.boxSizing;if(d==="")return null;Ge&&d==="border-box"&&(i.width=parseFloat(i.width)+parseFloat(i.borderRightWidth)+parseFloat(i.borderLeftWidth)+parseFloat(i.paddingRight)+parseFloat(i.paddingLeft)+"px");var x=parseFloat(i.paddingBottom)+parseFloat(i.paddingTop),h=parseFloat(i.borderBottomWidth)+parseFloat(i.borderTopWidth);return{sizingStyle:i,paddingSize:x,borderSize:h}},Oe=qe;function O(a,t,r){var i=Fe(r);s.useLayoutEffect(function(){var d=function(h){return i.current(h)};if(a)return a.addEventListener(t,d),function(){return a.removeEventListener(t,d)}},[])}var $e=function(t,r){O(document.body,"reset",function(i){t.current.form===i.target&&r(i)})},De=function(t){O(window,"resize",t)},Ke=function(t){O(document.fonts,"loadingdone",t)},Ue=["cacheMeasurements","maxRows","minRows","onChange","onHeightChange"],Ve=function(t,r){var i=t.cacheMeasurements,d=t.maxRows,x=t.minRows,h=t.onChange,g=h===void 0?fe:h,f=t.onHeightChange,l=f===void 0?fe:f,S=Pe(t,Ue),y=S.value!==void 0,v=s.useRef(null),z=Be(v,r),k=s.useRef(0),C=s.useRef(),j=function(){var p=v.current,H=i&&C.current?C.current:Oe(p);if(H){C.current=H;var P=Me(H,p.value||p.placeholder||"x",x,d),L=P[0],A=P[1];k.current!==L&&(k.current=L,p.style.setProperty("height",L+"px","important"),l(L,{rowHeight:A}))}},D=function(p){y||j(),g(p)};return s.useLayoutEffect(j),$e(v,function(){if(!y){var E=v.current.value;requestAnimationFrame(function(){var p=v.current;p&&E!==p.value&&j()})}}),De(j),Ke(j),s.createElement("textarea",q({},S,{onChange:D,ref:z}))},Ye=s.forwardRef(Ve);const Xe={size:"sm"},$=Re((a,t)=>{const{autosize:r,maxRows:i,minRows:d,__staticSelector:x,resize:h,...g}=Ie("Textarea",Xe,a),f=r&&He()!=="test",l=f?{maxRows:i,minRows:d}:{};return e.jsx(me,{component:f?Ye:"textarea",ref:t,...g,__staticSelector:x||"Textarea",multiline:!0,"data-no-overflow":r&&i===void 0||void 0,__vars:{"--input-resize":h},...l})});$.classes=me.classes;$.displayName="@mantine/core/Textarea";function at({}){return[{title:"Shadowing"}]}const ot=Se(function(){const[t,r]=s.useState("1"),[i,d]=s.useState(!0),[x,h]=s.useState(!1),[g,f]=s.useState(null),[l,S]=s.useState(null),[y,v]=s.useState(null),[z,k]=s.useState(""),[C,j]=s.useState(0),[D,E]=s.useState(null),[p,H]=s.useState(""),[P,L]=s.useState(0),[A,K]=s.useState(!1),[T,U]=s.useState("view"),[M,V]=s.useState(""),[Y,X]=s.useState("easy"),[Z,F]=s.useState(null),[J,_]=s.useState(null),[ge,Q]=s.useState(!1),[ee,B]=s.useState(new Set),te=s.useRef([]),ne=s.useRef(null),{acquireToken:N}=Ee(),pe=n=>{const o=te.current[n];o&&(o.currentTime=0,o.play(),j(u=>u+1),E(n))};s.useEffect(()=>{(async()=>{try{const o=await N(),u=await be(o);S(u)}catch(o){console.debug("Could not acquire token for item count",o)}finally{d(!1)}})()},[]),s.useEffect(()=>{j(0),K(!1)},[t]),s.useEffect(()=>{const n=parseInt(p,10);!A&&n>0&&C>=n&&(L(o=>o+1),K(!0))},[C,p,A]),s.useEffect(()=>{if(T!=="view"||ne.current===t)return;const n=async()=>{h(!0),v(null);try{const o=await N(),u=await je(t,o);u?(u.pronunciations&&(u.pronunciations=ze(u.pronunciations)),f(u)):(v("Item not found"),f(null))}catch(o){console.debug("Could not acquire token or fetch entity",o)}finally{h(!1)}};ne.current=t,n()},[t,T,N]),s.useEffect(()=>{const n=o=>{o.key==="ArrowLeft"?re():o.key==="ArrowRight"&&ie()};return window.addEventListener("keydown",n),()=>window.removeEventListener("keydown",n)},[t,l]);const re=()=>{const n=parseInt(t)-1;n>=1&&r(String(n))},ie=()=>{if(!se){const n=parseInt(t)+1;r(String(n))}},xe=()=>{if(l&&l>0){ee.size>=l&&B(new Set);const n=[];for(let b=1;b<=l;b++)ee.has(b)||n.push(b);if(n.length===0){B(new Set);const b=Math.floor(Math.random()*l)+1;B(new Set([b])),r(String(b));return}const o=Math.floor(Math.random()*n.length),u=n[o];B(b=>new Set([...b,u])),r(String(u))}},ve=t==="1",se=l!==null&&parseInt(t)===l,ae=()=>{const n=z.trim();if(n&&/^\d+$/.test(n)){const o=parseInt(n);(l===null||o>=1&&o<=l)&&(r(n),k(""))}},we=async()=>{if(!M.trim()){F("Sentence is required"),_(null);return}Q(!0),F(null),_(null);try{const n=await N();if(!await Ce(M.trim(),Y,n)){F("Could not add sentence");return}_("Sentence added successfully"),V(""),X("easy"),S(u=>u!==null?u+1:u)}catch(n){console.debug("Could not acquire token or add sentence",n),F("Could not add sentence")}finally{Q(!1)}};return e.jsx(Le,{size:"md",className:"pt-16 pb-16",children:e.jsxs(W,{gap:"lg",children:[e.jsxs(w,{justify:"space-between",align:"flex-end",wrap:"wrap",children:[e.jsxs("div",{children:[e.jsx(oe,{order:2,children:"Shadowing"}),e.jsx(c,{mt:"sm",c:"dimmed",children:"Practice pronunciation with native speakers"})]}),e.jsxs(w,{gap:"sm",wrap:"nowrap",align:"flex-end",children:[e.jsx(I,{variant:T==="view"?"filled":"light",onClick:()=>U("view"),children:"View all"}),e.jsx(I,{variant:T==="add"?"filled":"light",onClick:()=>U("add"),children:"Add new"}),T==="view"&&e.jsxs(w,{gap:"xs",wrap:"nowrap",align:"flex-end",children:[e.jsx(de,{placeholder:"Item No",value:z,onChange:n=>k(n.currentTarget.value),onKeyPress:n=>{n.key==="Enter"&&ae()},size:"sm",w:80}),e.jsx(I,{onClick:ae,variant:"light",size:"sm",children:"Go"}),e.jsx(I,{onClick:xe,variant:"outline",size:"sm",children:"Random"})]})]})]}),T==="add"?e.jsx(R,{p:"lg",radius:"md",withBorder:!0,children:e.jsx("form",{onSubmit:n=>{n.preventDefault(),we()},children:e.jsxs(W,{gap:"md",children:[e.jsx(oe,{order:3,children:"Add a new sentence"}),e.jsx($,{label:"Sentence",placeholder:"Enter the sentence",value:M,onChange:n=>V(n.currentTarget.value),minRows:3,required:!0}),e.jsx(Te,{label:"Difficulty",data:[{value:"easy",label:"Easy"},{value:"medium",label:"Medium"},{value:"hard",label:"Hard"}],value:Y,onChange:n=>n&&X(n),required:!0}),Z&&e.jsx(c,{c:"red",children:Z}),J&&e.jsx(c,{c:"green",children:J}),e.jsx(w,{justify:"flex-start",children:e.jsx(I,{type:"submit",loading:ge,children:"Add sentence"})})]})})}):x?e.jsx(R,{p:"lg",radius:"md",withBorder:!0,children:e.jsx(c,{children:"Loading item..."})}):y?e.jsx(R,{p:"lg",radius:"md",withBorder:!0,children:e.jsx(c,{c:"red",children:y})}):g?e.jsxs(e.Fragment,{children:[e.jsx(R,{p:"xl",radius:"md",withBorder:!0,bg:"blue.0",children:e.jsx(c,{size:"xl",fw:600,ta:"center",style:{lineHeight:1.6},children:g.entity.Sentence})}),e.jsxs("div",{children:[e.jsxs(w,{justify:"space-between",align:"center",mb:"xs",children:[e.jsxs(w,{gap:"sm",align:"center",wrap:"nowrap",children:[e.jsx(c,{size:"sm",c:"dimmed",fw:500,children:"Replay goal"}),e.jsx(de,{placeholder:"e.g. 10",value:p,onChange:n=>H(n.currentTarget.value),size:"sm",w:120,type:"number",min:1})]}),e.jsxs(c,{size:"sm",fw:600,children:["Sentences complete: ",P]})]}),e.jsxs(w,{justify:"space-between",align:"center",mb:"md",children:[e.jsxs(c,{size:"sm",c:"dimmed",fw:500,children:["Pronunciations (",g.pronunciations?.length||0,"):"]}),e.jsxs(c,{size:"sm",c:"dimmed",fw:500,children:["Plays on this card: ",C]})]}),e.jsx(W,{gap:"sm",children:g.pronunciations&&g.pronunciations.length>0?g.pronunciations.map((n,o)=>e.jsx(R,{p:"md",radius:"md",withBorder:!0,bg:"gray.0",children:e.jsxs(w,{gap:"xl",align:"center",wrap:"nowrap",children:[e.jsx(ye,{size:"xl",radius:"xl",variant:"filled",color:"blue",onClick:()=>pe(o),children:"▶"}),e.jsx("audio",{ref:u=>{te.current[o]=u},onEnded:()=>E(null),style:{display:"none"},children:e.jsx("source",{src:n.audioMp3,type:"audio/mpeg"})}),e.jsxs(w,{gap:"lg",wrap:"nowrap",style:{flex:1},children:[e.jsxs("div",{children:[e.jsx(c,{size:"xs",c:"dimmed",children:"Username"}),e.jsx(c,{size:"sm",fw:500,children:n.username})]}),e.jsxs("div",{children:[e.jsx(c,{size:"xs",c:"dimmed",children:"Gender"}),e.jsx(c,{size:"sm",fw:500,children:n.sex==="m"?"Male":n.sex==="f"?"Female":n.sex})]}),e.jsxs("div",{children:[e.jsx(c,{size:"xs",c:"dimmed",children:"Country"}),e.jsx(c,{size:"sm",fw:500,children:n.country})]})]})]})},o)):e.jsx(R,{p:"md",radius:"md",withBorder:!0,children:e.jsx(c,{c:"dimmed",children:"No pronunciations available"})})})]}),e.jsxs(w,{justify:"space-between",mt:"xl",children:[e.jsx(I,{variant:"subtle",onClick:re,disabled:ve,children:"← Previous"}),e.jsxs(c,{c:"dimmed",children:[t," / ",l||"?"]}),e.jsx(I,{variant:"subtle",onClick:ie,disabled:se,children:"Next →"})]})]}):e.jsx(R,{p:"lg",radius:"md",withBorder:!0,children:e.jsx(c,{c:"dimmed",children:"No item loaded"})})]})})});export{ot as default,at as meta};
