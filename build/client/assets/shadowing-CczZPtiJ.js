import{b as s,R as G,t as e,w as Se}from"./index-CWD__XTI.js";import{S as W,G as w,T as se,P as I,A as ye,l as be,m as je,k as ze,n as Ce}from"./api-CO88OdlV.js";import{n as Ie,o as Re,h as Ee,T as l,B as R}from"./AuthProvider-DIbg4P3B.js";import{C as Te}from"./Container-D1gD7sw9.js";import{b as he,T as ae}from"./TextInput-i3HMMitU.js";import{S as Le}from"./Select-DZJN4bQk.js";import"./use-isomorphic-effect-Chui70N-.js";import"./OptionalPortal-CAJ6Pykm.js";import"./CheckIcon-SLjj_-bk.js";var ke={};function He(){return typeof process<"u"&&ke?"production":"development"}function q(){return q=Object.assign?Object.assign.bind():function(a){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(a[i]=n[i])}return a},q.apply(null,arguments)}function Pe(a,t){if(a==null)return{};var n={};for(var i in a)if({}.hasOwnProperty.call(a,i)){if(t.indexOf(i)!==-1)continue;n[i]=a[i]}return n}var Ae=s.useLayoutEffect,Fe=function(t){var n=G.useRef(t);return Ae(function(){n.current=t}),n},oe=function(t,n){if(typeof t=="function"){t(n);return}t.current=n},Be=function(t,n){var i=G.useRef();return G.useCallback(function(d){t.current=d,i.current&&oe(i.current,null),i.current=n,n&&oe(n,d)},[n])},de={"min-height":"0","max-height":"none",height:"0",visibility:"hidden",overflow:"hidden",position:"absolute","z-index":"-1000",top:"0",right:"0",display:"block"},Ne=function(t){Object.keys(de).forEach(function(n){t.style.setProperty(n,de[n],"important")})},le=Ne,m=null,ce=function(t,n){var i=t.scrollHeight;return n.sizingStyle.boxSizing==="border-box"?i+n.borderSize:i-n.paddingSize};function Me(a,t,n,i){n===void 0&&(n=1),i===void 0&&(i=1/0),m||(m=document.createElement("textarea"),m.setAttribute("tabindex","-1"),m.setAttribute("aria-hidden","true"),le(m)),m.parentNode===null&&document.body.appendChild(m);var d=a.paddingSize,x=a.borderSize,h=a.sizingStyle,p=h.boxSizing;Object.keys(h).forEach(function(v){var z=v;m.style[z]=h[z]}),le(m),m.value=t;var f=ce(m,a);m.value=t,f=ce(m,a),m.value="x";var c=m.scrollHeight-d,S=c*n;p==="border-box"&&(S=S+d+x),f=Math.max(S,f);var y=c*i;return p==="border-box"&&(y=y+d+x),f=Math.min(y,f),[f,c]}var ue=function(){},_e=function(t,n){return t.reduce(function(i,d){return i[d]=n[d],i},{})},We=["borderBottomWidth","borderLeftWidth","borderRightWidth","borderTopWidth","boxSizing","fontFamily","fontSize","fontStyle","fontWeight","letterSpacing","lineHeight","paddingBottom","paddingLeft","paddingRight","paddingTop","tabSize","textIndent","textRendering","textTransform","width","wordBreak","wordSpacing","scrollbarGutter"],Ge=!!document.documentElement.currentStyle,qe=function(t){var n=window.getComputedStyle(t);if(n===null)return null;var i=_e(We,n),d=i.boxSizing;if(d==="")return null;Ge&&d==="border-box"&&(i.width=parseFloat(i.width)+parseFloat(i.borderRightWidth)+parseFloat(i.borderLeftWidth)+parseFloat(i.paddingRight)+parseFloat(i.paddingLeft)+"px");var x=parseFloat(i.paddingBottom)+parseFloat(i.paddingTop),h=parseFloat(i.borderBottomWidth)+parseFloat(i.borderTopWidth);return{sizingStyle:i,paddingSize:x,borderSize:h}},Oe=qe;function O(a,t,n){var i=Fe(n);s.useLayoutEffect(function(){var d=function(h){return i.current(h)};if(a)return a.addEventListener(t,d),function(){return a.removeEventListener(t,d)}},[])}var $e=function(t,n){O(document.body,"reset",function(i){t.current.form===i.target&&n(i)})},De=function(t){O(window,"resize",t)},Ue=function(t){O(document.fonts,"loadingdone",t)},Ve=["cacheMeasurements","maxRows","minRows","onChange","onHeightChange"],Ye=function(t,n){var i=t.cacheMeasurements,d=t.maxRows,x=t.minRows,h=t.onChange,p=h===void 0?ue:h,f=t.onHeightChange,c=f===void 0?ue:f,S=Pe(t,Ve),y=S.value!==void 0,v=s.useRef(null),z=Be(v,n),k=s.useRef(0),C=s.useRef(),j=function(){var g=v.current,H=i&&C.current?C.current:Oe(g);if(H){C.current=H;var P=Me(H,g.value||g.placeholder||"x",x,d),T=P[0],A=P[1];k.current!==T&&(k.current=T,g.style.setProperty("height",T+"px","important"),c(T,{rowHeight:A}))}},D=function(g){y||j(),p(g)};return s.useLayoutEffect(j),$e(v,function(){if(!y){var E=v.current.value;requestAnimationFrame(function(){var g=v.current;g&&E!==g.value&&j()})}}),De(j),Ue(j),s.createElement("textarea",q({},S,{onChange:D,ref:z}))},Ke=s.forwardRef(Ye);const Xe={size:"sm"},$=Ie((a,t)=>{const{autosize:n,maxRows:i,minRows:d,__staticSelector:x,resize:h,...p}=Re("Textarea",Xe,a),f=n&&He()!=="test",c=f?{maxRows:i,minRows:d}:{};return e.jsx(he,{component:f?Ke:"textarea",ref:t,...p,__staticSelector:x||"Textarea",multiline:!0,"data-no-overflow":n&&i===void 0||void 0,__vars:{"--input-resize":h},...c})});$.classes=he.classes;$.displayName="@mantine/core/Textarea";function at({}){return[{title:"Shadowing"}]}const ot=Se(function(){const[t,n]=s.useState("1"),[i,d]=s.useState(!0),[x,h]=s.useState(!1),[p,f]=s.useState(null),[c,S]=s.useState(null),[y,v]=s.useState(null),[z,k]=s.useState(""),[C,j]=s.useState(0),[D,E]=s.useState(null),[g,H]=s.useState(""),[P,T]=s.useState(0),[A,U]=s.useState(!1),[L,V]=s.useState("view"),[M,Y]=s.useState(""),[K,X]=s.useState("easy"),[Z,F]=s.useState(null),[J,_]=s.useState(null),[fe,Q]=s.useState(!1),[ee,B]=s.useState(new Set),te=s.useRef([]),ne=s.useRef(null),{acquireToken:N}=Ee(),me=r=>{const o=te.current[r];o&&(o.currentTime=0,o.play(),j(u=>u+1),E(r))};s.useEffect(()=>{(async()=>{try{const o=await N(),u=await be(o);S(u)}catch(o){console.debug("Could not acquire token for item count",o)}finally{d(!1)}})()},[]),s.useEffect(()=>{j(0),U(!1)},[t]),s.useEffect(()=>{const r=parseInt(g,10);!A&&r>0&&C>=r&&(T(o=>o+1),U(!0))},[C,g,A]),s.useEffect(()=>{if(L!=="view"||ne.current===t)return;const r=async()=>{h(!0),v(null);try{const o=await N(),u=await je(t,o);u?(u.pronunciations&&(u.pronunciations=ze(u.pronunciations)),f(u)):(v("Item not found"),f(null))}catch(o){console.debug("Could not acquire token or fetch entity",o)}finally{h(!1)}};ne.current=t,r()},[t,L,N]);const pe=()=>{const r=parseInt(t)-1;r>=1&&n(String(r))},ge=()=>{if(!re){const r=parseInt(t)+1;n(String(r))}},xe=()=>{if(c&&c>0){ee.size>=c&&B(new Set);const r=[];for(let b=1;b<=c;b++)ee.has(b)||r.push(b);if(r.length===0){B(new Set);const b=Math.floor(Math.random()*c)+1;B(new Set([b])),n(String(b));return}const o=Math.floor(Math.random()*r.length),u=r[o];B(b=>new Set([...b,u])),n(String(u))}},ve=t==="1",re=c!==null&&parseInt(t)===c,ie=()=>{const r=z.trim();if(r&&/^\d+$/.test(r)){const o=parseInt(r);(c===null||o>=1&&o<=c)&&(n(r),k(""))}},we=async()=>{if(!M.trim()){F("Sentence is required"),_(null);return}Q(!0),F(null),_(null);try{const r=await N();if(!await Ce(M.trim(),K,r)){F("Could not add sentence");return}_("Sentence added successfully"),Y(""),X("easy"),S(u=>u!==null?u+1:u)}catch(r){console.debug("Could not acquire token or add sentence",r),F("Could not add sentence")}finally{Q(!1)}};return e.jsx(Te,{size:"md",className:"pt-16 pb-16",children:e.jsxs(W,{gap:"lg",children:[e.jsxs(w,{justify:"space-between",align:"flex-end",wrap:"wrap",children:[e.jsxs("div",{children:[e.jsx(se,{order:2,children:"Shadowing"}),e.jsx(l,{mt:"sm",c:"dimmed",children:"Practice pronunciation with native speakers"})]}),e.jsxs(w,{gap:"sm",wrap:"nowrap",align:"flex-end",children:[e.jsx(R,{variant:L==="view"?"filled":"light",onClick:()=>V("view"),children:"View all"}),e.jsx(R,{variant:L==="add"?"filled":"light",onClick:()=>V("add"),children:"Add new"}),L==="view"&&e.jsxs(w,{gap:"xs",wrap:"nowrap",align:"flex-end",children:[e.jsx(ae,{placeholder:"Item No",value:z,onChange:r=>k(r.currentTarget.value),onKeyPress:r=>{r.key==="Enter"&&ie()},size:"sm",w:80}),e.jsx(R,{onClick:ie,variant:"light",size:"sm",children:"Go"}),e.jsx(R,{onClick:xe,variant:"outline",size:"sm",children:"Random"})]})]})]}),L==="add"?e.jsx(I,{p:"lg",radius:"md",withBorder:!0,children:e.jsx("form",{onSubmit:r=>{r.preventDefault(),we()},children:e.jsxs(W,{gap:"md",children:[e.jsx(se,{order:3,children:"Add a new sentence"}),e.jsx($,{label:"Sentence",placeholder:"Enter the sentence",value:M,onChange:r=>Y(r.currentTarget.value),minRows:3,required:!0}),e.jsx(Le,{label:"Difficulty",data:[{value:"easy",label:"Easy"},{value:"medium",label:"Medium"},{value:"hard",label:"Hard"}],value:K,onChange:r=>r&&X(r),required:!0}),Z&&e.jsx(l,{c:"red",children:Z}),J&&e.jsx(l,{c:"green",children:J}),e.jsx(w,{justify:"flex-start",children:e.jsx(R,{type:"submit",loading:fe,children:"Add sentence"})})]})})}):x?e.jsx(I,{p:"lg",radius:"md",withBorder:!0,children:e.jsx(l,{children:"Loading item..."})}):y?e.jsx(I,{p:"lg",radius:"md",withBorder:!0,children:e.jsx(l,{c:"red",children:y})}):p?e.jsxs(e.Fragment,{children:[e.jsx(I,{p:"xl",radius:"md",withBorder:!0,bg:"blue.0",children:e.jsx(l,{size:"xl",fw:600,ta:"center",style:{lineHeight:1.6},children:p.entity.Sentence})}),e.jsxs("div",{children:[e.jsxs(w,{justify:"space-between",align:"center",mb:"xs",children:[e.jsxs(w,{gap:"sm",align:"center",wrap:"nowrap",children:[e.jsx(l,{size:"sm",c:"dimmed",fw:500,children:"Replay goal"}),e.jsx(ae,{placeholder:"e.g. 10",value:g,onChange:r=>H(r.currentTarget.value),size:"sm",w:120,type:"number",min:1})]}),e.jsxs(l,{size:"sm",fw:600,children:["Sentences complete: ",P]})]}),e.jsxs(w,{justify:"space-between",align:"center",mb:"md",children:[e.jsxs(l,{size:"sm",c:"dimmed",fw:500,children:["Pronunciations (",p.pronunciations?.length||0,"):"]}),e.jsxs(l,{size:"sm",c:"dimmed",fw:500,children:["Plays on this card: ",C]})]}),e.jsx(W,{gap:"sm",children:p.pronunciations&&p.pronunciations.length>0?p.pronunciations.map((r,o)=>e.jsx(I,{p:"md",radius:"md",withBorder:!0,bg:"gray.0",children:e.jsxs(w,{gap:"xl",align:"center",wrap:"nowrap",children:[e.jsx(ye,{size:"xl",radius:"xl",variant:"filled",color:"blue",onClick:()=>me(o),children:"▶"}),e.jsx("audio",{ref:u=>{te.current[o]=u},onEnded:()=>E(null),style:{display:"none"},children:e.jsx("source",{src:r.audioMp3,type:"audio/mpeg"})}),e.jsxs(w,{gap:"lg",wrap:"nowrap",style:{flex:1},children:[e.jsxs("div",{children:[e.jsx(l,{size:"xs",c:"dimmed",children:"Username"}),e.jsx(l,{size:"sm",fw:500,children:r.username})]}),e.jsxs("div",{children:[e.jsx(l,{size:"xs",c:"dimmed",children:"Gender"}),e.jsx(l,{size:"sm",fw:500,children:r.sex==="m"?"Male":r.sex==="f"?"Female":r.sex})]}),e.jsxs("div",{children:[e.jsx(l,{size:"xs",c:"dimmed",children:"Country"}),e.jsx(l,{size:"sm",fw:500,children:r.country})]})]})]})},o)):e.jsx(I,{p:"md",radius:"md",withBorder:!0,children:e.jsx(l,{c:"dimmed",children:"No pronunciations available"})})})]}),e.jsxs(w,{justify:"space-between",mt:"xl",children:[e.jsx(R,{variant:"subtle",onClick:pe,disabled:ve,children:"← Previous"}),e.jsxs(l,{c:"dimmed",children:[t," / ",c||"?"]}),e.jsx(R,{variant:"subtle",onClick:ge,disabled:re,children:"Next →"})]})]}):e.jsx(I,{p:"lg",radius:"md",withBorder:!0,children:e.jsx(l,{c:"dimmed",children:"No item loaded"})})]})})});export{ot as default,at as meta};
